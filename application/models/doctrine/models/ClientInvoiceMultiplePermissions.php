<?php

/**
 * ClientInvoiceMultiplePermissions
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ISPC
 * @subpackage Application (2020-12-08)
 * @author     Ancuta <office@originalware.com>
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 *  ISPC-2312
 */
class ClientInvoiceMultiplePermissions extends BaseClientInvoiceMultiplePermissions
{            
    /**
     * translations are grouped into an array
     * @var unknown
     */
    const LANGUAGE_ARRAY    = 'clientinvoicemultiplepermissions_lang';
            
    /**
     * define the FORMID and FORMNAME, if you want to piggyback some triggers
     * @var unknown
     */
    const TRIGGER_FORMID    = null;
    const TRIGGER_FORMNAME  = 'frm_clientinvoicemultiplepermissions';
            
    /**
     * insert into patient_files will use this
     */
    const PATIENT_FILE_TABNAME  = 'ClientInvoiceMultiplePermissions';
    const PATIENT_FILE_TITLE    = 'ClientInvoiceMultiplePermissions PDF'; //this will be translated
            
    /**
     * insert into patient_course will use this
     */
    const PATIENT_COURSE_TITLE      = 'ClientInvoiceMultiplePermissions PDF was created';
    const PATIENT_COURSE_TABNAME    = 'clientinvoicemultiplepermissions';
    const PATIENT_COURSE_TYPE       = ''; // add letter

    public function get_client_invoice_perms($client)
    {
        
        $cip = Doctrine_Query::create()
        ->select('*')
        ->from('ClientInvoiceMultiplePermissions')
        ->where('clientid="' . $client . '"')
        ->andWhere('isdelete = "0"');
        $cip_res = $cip->fetchArray();
        
        if($cip_res)
        {
            foreach($cip_res as $k_perms => $v_perms)
            {
                $permissions[$v_perms['invoice']]['canedit'] = $v_perms['canedit'];
                $permissions[$v_perms['invoice']]['canadd'] = $v_perms['canadd'];
                $permissions[$v_perms['invoice']]['canview'] = $v_perms['canview'];
                $permissions[$v_perms['invoice']]['candelete'] = $v_perms['candelete'];
            }
        }
        
        return $permissions;
    }
    
    /**
     * ISPC-2312
     * Ancuta 06.12.2020
     * @param unknown $client
     * @return array
     */
    public function get_client_allowed_invoices($client)
    {
        if(empty($client)){
            return array();
        }
        
        $cip_res_arr = Doctrine_Query::create()
        ->select('*')
        ->from('ClientInvoiceMultiplePermissions')
        ->where('clientid=?', $client)
        ->andWhere('isdelete = "0"')
        ->orderBy('id ASC')
        ->fetchArray();
        
        
        $permissions = array();
        if(!empty($cip_res_arr))
        {
            foreach($cip_res_arr as $k=>$cip_res){
                
                if ($cip_res['canview'] == "1"){
                    $permissions[$cip_res['invoice']] = $cip_res['invoice'];
                }
            }
        }
        
        return $permissions;
    }
    
    

}