<?php
// ISPC-2400
/**
 * PatientCrisisHistory
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ISPC
 * @subpackage Application (2019-06-27)
 * @author     Ancuta <office@originalware.com>
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class PatientCrisisHistory extends BasePatientCrisisHistory
{            
    /**
     * translations are grouped into an array
     * @var unknown
     */
    const LANGUAGE_ARRAY    = 'patientcrisishistory_lang';
            
    /**
     * define the FORMID and FORMNAME, if you want to piggyback some triggers
     * @var unknown
     */
    const TRIGGER_FORMID    = null;
    const TRIGGER_FORMNAME  = 'frm_patientcrisishistory';
            
    /**
     * insert into patient_files will use this
     */
    const PATIENT_FILE_TABNAME  = 'PatientCrisisHistory';
    const PATIENT_FILE_TITLE    = 'PatientCrisisHistory PDF'; //this will be translated
            
    /**
     * insert into patient_course will use this
     */
    const PATIENT_COURSE_TITLE      = 'PatientCrisisHistory PDF was created';
    const PATIENT_COURSE_TABNAME    = 'patientcrisishistory';
    const PATIENT_COURSE_TYPE       = ''; // add letter


    public function getPatientCrisisHistory($ipid)
    {
        $loc = Doctrine_Query::create()
        ->select("*")
        ->from('PatientCrisisHistory')
        ->where("ipid='" . $ipid . "'")
        ->orderBy("status_date DESC");
        $disarr = $loc->execute();
        
        $logininfo = new Zend_Session_Namespace('Login_Info');
        $clientid = $logininfo->clientid; 
        $user = new User();
        //$user_details = $user->get_AllByClientid($clientid);
        $user_details = $user->get_all_client_users($clientid);
        
        if($disarr)
        {   
            $livearr = $disarr->toArray();
            foreach($livearr as $k=>$cr_data){
                //$livearr[$k]['status_create_user_nice_name'] = $user_details[$cr_data['status_create_user']]['nice_name'];
                $livearr[$k]['status_create_user_nice_name'] = $user_details[$cr_data['status_create_user']]['user_title'].' '.$user_details[$cr_data['status_create_user']]['first_name'].' '.$user_details[$cr_data['status_create_user']]['last_name'];
            }
            return $livearr;
        }
    }
 

    public static function getLastPatientCrisisHistory($ipid)
    {
        $drop = Doctrine_Query::create()
        ->select("*")
        ->from('PatientCrisisHistory')
        ->where("ipid=?", $ipid)
        ->orderBy('status_date desc')
        ->limit(1);
        
        $loc = $drop->execute();
        if($loc)
        {
            $livearr = $loc->toArray();
            return $livearr;
        }
    }
    
    public function getFirstCrisisHistory($ipid)
    {
        $drop = Doctrine_Query::create()
        ->select("*")
        ->from('PatientCrisisHistory')
        ->where("ipid= ?", $ipid)
        ->orderBy('create_date asc')
        ->limit(1);
        $crdate = $drop->execute();
        
        if($crdate)
        {
            $livearr = $crdate->toArray();
            return $livearr;
        }
    }
       
}

?>