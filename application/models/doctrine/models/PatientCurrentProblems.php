<?php

/**
 * PatientCurrentProblems
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ISPC
 * @subpackage Application (2018-09-14)
 * @author     carmen <office@originalware.com>
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class PatientCurrentProblems extends BasePatientCurrentProblems
{
	/**
	 * define the FORMID and FORMNAME, if you want to piggyback some triggers
	 * @var unknown
	 */
	const TRIGGER_FORMID    = null;
	const TRIGGER_FORMNAME  = '';
	
	public function get_patients_problems($ipids = array(), $icon = null, $team = false)
	{
		$actions_sql = Doctrine_Query::create()
		->select('*')
		->from('PatientCurrentProblems')
		->whereIn('ipid', $ipids);
		
		if($icon)
		{
			$actions_sql->andWhere('icon = ?', $icon);
		}
		
		$actionsarray = $actions_sql->fetchArray();
		$actionsarray_team = array();
	
		if($actionsarray)
		{
			if($team)
			{
				foreach($actionsarray as $kact=>$vact)
				{
					$actionsarray_team[$vact['ipid']][$vact['icon']] = $vact['problem'];
				}
				return $actionsarray_team;
			}
			else 
			{
				return $actionsarray;
			}
		}
	}
	
	public function findOneByIpidandIcon($ipid = '', $icon = '', $hydrationMode = Doctrine_Core::HYDRATE_ARRAY )
	{
		if (empty($icon) || ! is_string($icon)) {
	
			return;
	
		} else {
			return $this->getTable()->createQuery('pb')
			->where('ipid = ?')
			->andWhere('icon = ?')
			->orderBy('id DESC') // just in case the delete is not ok
			->limit(1)
			->fetchOne(array($ipid, $icon), $hydrationMode);
		}
	}

}