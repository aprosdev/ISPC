<?php
// ISPC-2790 Lore 12.01.2021
/**
 * PatientFinalPhase
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 * 
 * @package    ISPC-2790
 * @subpackage Application (2021-01-12)
 * @author     Lore <office@originalware.com>
 * @version    SVN: $Id: Builder.php 7490 2010-03-29 19:53:27Z jwage $
 */
class PatientFinalPhase extends BasePatientFinalPhase
{            

    public function getPatientFinalPhase($ipid)
    {
        if (empty($ipid)) {
            return; //fail-safe
        }
        
        $loc = Doctrine_Query::create()
        ->select("*")
        ->from('PatientFinalPhase')
        ->andWhere("ipid= ? ", $ipid);
        $disarr = $loc->fetchArray();
        
        return $disarr;
        
    }
 
    public static function getWasInformed()
    {
        $was_informed = array(
            '1' => "leibliche Eltern",
            '2' => "leibliche Mutter",
            '3' => "leiblichen Vater",
            '4' => "leibliche Mutter mit Partner",
            '5' => "leiblichen Vater mit Partnerin",
            '6' => "Großeltern",
            '7' => "Pflegeeltern",
            '8' => "Adoptiveltern",
            '9' => "Wohnheim/-gruppe",
            '10'=> "SAPV",
            '11'=> "Ambulanten Pflegedienst",
            '12'=> "Seelsorger",
            '13'=> 'Sonstiges',
        );
        
        return $was_informed;
    }
     
    public static function getCarechild()
    {
        $care_child = array(
            '1' => "Waschen und Anziehen in Versorgungseinrichtung",
            '2' => "Versorgung durch Pflegekraft",
            '3' => "Versorgung durch Eltern/ Angehörige",
            '4' => "Rituelle Waschung gewünscht",
            '5'=> 'Sonstiges',
        );
        
        return $care_child;
    }
    
    public function getFinalPhase($ipid)
    {
        if (empty($ipid)) {
            return;
        }
        
        $pfp = new PatientFinalPhase();
        $pfp_stm = $pfp->getPatientFinalPhase($ipid);
        //dd($pfp_stm);
        if(!empty($pfp_stm)){
            
            $ja_nein = array('1' => 'Nein', '2' => 'keine Angabe', '3' => 'Ja', '4' => 'Sonstiges');
            
            $pfp_stm[0]['preparation'] = '<ul class="finalphase_pm">';
                if(!empty($pfp_stm[0]['death_discussed_opt'])){
                    $pfp_stm[0]['death_discussed'] = '<ul class="finalphase_pm">';
                    $death_discussed_opt_arr = explode(",", $pfp_stm[0]['death_discussed_opt']);
                    foreach($death_discussed_opt_arr as $km => $vm){
                        $pfp_stm[0]['death_discussed'] .= '<li>'.$ja_nein[$vm];
                        if($vm == 4){
                            $pfp_stm[0]['death_discussed'] .= ' ('.$pfp_stm[0]['death_discussed_text'].')';
                        }
                        $pfp_stm[0]['death_discussed'] .= '</li>';
                    }
                    $pfp_stm[0]['death_discussed'] .= '</ul>';
                }
                if(!empty($pfp_stm[0]['undertaker_informed_opt'])){
                    $pfp_stm[0]['undertaker_informed'] = '<ul class="finalphase_pm">';
                    $undertaker_informed_opt_arr = explode(",", $pfp_stm[0]['undertaker_informed_opt']);
                    foreach($undertaker_informed_opt_arr as $km => $vm){
                        $pfp_stm[0]['undertaker_informed'] .= '<li>'.$ja_nein[$vm];
                        if($vm == 4){
                            $pfp_stm[0]['undertaker_informed'] .= ' ('.$pfp_stm[0]['undertaker_informed_text'].')';
                        }
                        $pfp_stm[0]['undertaker_informed'] .= '</li>';
                    }
                    $pfp_stm[0]['undertaker_informed'] .= '</ul>';
                }
                if(!empty($pfp_stm[0]['coffin_chosen_opt'])){
                    $pfp_stm[0]['coffin_chosen'] = '<ul class="finalphase_pm">';
                    $coffin_chosen_opt_arr = explode(",", $pfp_stm[0]['coffin_chosen_opt']);
                    foreach($coffin_chosen_opt_arr as $km => $vm){
                        $pfp_stm[0]['coffin_chosen'] .= '<li>'.$ja_nein[$vm];
                        if($vm == 4){
                            $pfp_stm[0]['coffin_chosen'] .= ' ('.$pfp_stm[0]['coffin_chosen_text'].')';
                        }
                        $pfp_stm[0]['coffin_chosen'] .= '</li>';
                    }
                    $pfp_stm[0]['coffin_chosen'] .= '</ul>';
                }
                
                if(!empty($pfp_stm[0]['how_was_informed_opt'])){
                    $was_informed = PatientFinalPhase::getWasInformed();
                    $pfp_stm[0]['was_informed'] = '<ul class="finalphase_pm">';
                    $how_was_informed_opt_arr = explode(",", $pfp_stm[0]['how_was_informed_opt']);
                    foreach($how_was_informed_opt_arr as $km => $vm){
                        $pfp_stm[0]['was_informed'] .= '<li>'.$was_informed[$vm];
                        if($vm == 13){
                            $pfp_stm[0]['was_informed'] .= ' ('.$pfp_stm[0]['how_was_informed_text'].')';
                        }
                        $pfp_stm[0]['was_informed'] .= '</li>';
                    }
                    $pfp_stm[0]['was_informed'] .= '</ul>';
                }
            $pfp_stm[0]['preparation'] .= '</ul>';
            
            
            $pfp_stm[0]['After_dying'] = '<ul class="finalphase_pm">';
                if(!empty($pfp_stm[0]['care_child_opt'])){
                    $care_child = PatientFinalPhase::getCarechild();
                    
                    $pfp_stm[0]['care_child'] = '<ul class="finalphase_pm">';
                    $care_child_arr = explode(",", $pfp_stm[0]['care_child_opt']);
                    //dd($care_child_arr);
                    foreach($care_child_arr as $km => $vm){
                        $pfp_stm[0]['care_child'] .= '<li>'.$care_child[$vm];
                        if($vm == 5){
                            $pfp_stm[0]['care_child'] .= ' ('.$pfp_stm[0]['care_child_text'].')';
                        }
                        $pfp_stm[0]['care_child'] .= '</li>';
                    }
                    $pfp_stm[0]['care_child'] .= '</ul>';
                }
                if(!empty($pfp_stm[0]['laying_out_opt'])){
                    $pfp_stm[0]['laying_out'] = '<ul class="finalphase_pm">';
                    $laying_out_opt_arr = explode(",", $pfp_stm[0]['laying_out_opt']);
                    foreach($laying_out_opt_arr as $km => $vm){
                        $pfp_stm[0]['laying_out'] .= '<li>'.$ja_nein[$vm];
                        if($vm == 4){
                            $pfp_stm[0]['laying_out'] .= ' ('.$pfp_stm[0]['laying_out_text'].')';
                        }
                        $pfp_stm[0]['laying_out'] .= '</li>';
                    }
                    $pfp_stm[0]['laying_out'] .= '</ul>';
                }
                if(!empty($pfp_stm[0]['memento_desired_opt'])){
                    $pfp_stm[0]['memento_desired'] = '<ul class="finalphase_pm">';
                    $memento_desired_opt_arr = explode(",", $pfp_stm[0]['memento_desired_opt']);
                    foreach($memento_desired_opt_arr as $km => $vm){
                        $pfp_stm[0]['memento_desired'] .= '<li>'.$ja_nein[$vm];
                        if($vm == 4){
                            $pfp_stm[0]['memento_desired'] .= ' ('.$pfp_stm[0]['memento_desired_text'].')';
                        }
                        $pfp_stm[0]['memento_desired'] .= '</li>';
                    }
                    $pfp_stm[0]['memento_desired'] .= '</ul>';
                }
            $pfp_stm[0]['After_dying'] .= '</ul>';

        }
        
        return $pfp_stm;
        
    }
    
    
}

?>





