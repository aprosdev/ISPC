<script type="text/javascript">
	var detailscookies = <?php echo $this->detailscookies; ?>;
</script>
<?php
$this->headScript()->appendFile(RES_FILE_PATH . '/javascript/dragdiv/dragdivpatient.js?'.date('Ymd'));
$specialists_types = $this->specialists_types;

$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/chosen_v1.6.2/chosen.jquery.min.js');
$this->headLink()->appendStylesheet(RES_FILE_PATH.'/javascript/chosen_v1.6.2/chosen_2016.09.22.css');
$disable_update = $this->disable_update;

//manual add the js for this view, and not from php
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/views/patient/patientdetails.js');

if ($this->displaylivingwill == 1) {
	//add file uploader
	$this->headScript()->appendFile(APP_BASE.'javascript/fine-uploader/fine-uploader.min.js');
	$this->headLink()->appendStylesheet(APP_BASE.'javascript/fine-uploader/fine-uploader.css');
	
	//rendered-add the fine-uploader file-uploader template
	$qqtemplate = $this->render("templates/qq_fileupload_template_small_2017_09.html");
	//$qqtemplate = Pms_Template::createTemplate(array(), 'templates/qq_fileupload_template_2018_08.html');
	$this->headScript()->setAllowArbitraryAttributes(true)->appendScript($qqtemplate, 'text/template', array("id" => "qq-template", "noescape" => true));

}

?>


<script type="text/javascript">
	var disable_update = '<?php echo $this->disable_update ?>';
 	var patid = '<?php echo $this->pat_enc_id ?>';
	var isdischarged = <?php echo $this->isdischarged ?>;
	var hospiz_users_nr = <?php echo $this->hospiz_users_nr ?>;
	var hospizverein_users_nr = <?php echo $this->hospizverein_users_nr ?>;
	var hospiz_assusers = <?php echo $this->hospiz_assusers ?>;
	var hospizverein_assusers = <?php echo $this->hospizverein_assusers ?>;
	var visits_settings_disabled_users = jQuery.parseJSON('<?php echo ($this->pat_visits_settings_disabled_users); ?>');
	var first_admission_ever = "<?php echo $this->first_admission_ever ?>";

	var loading = function(){
		var dlist = '<div class="DropDwnTable" style="position:absolute;"><table border="0" align="left" cellpadding="0" cellspacing="0" class="Dropdwntble"><tr class="bluerow"><td valign="top"><img src="<?php echo RES_FILE_PATH; ?>/images/loading.gif"></td></tr></table></div>';
		document.getElementById('doctdropdown').style.display = "";
		document.getElementById('doctdropdown').innerHTML=dlist;
	}
	
	$(function() {
		$( ".accordion" ).accordion({
			   collapsible: true
		});
	});

	function openSgbv(theUrl)
	{
		document.location.href = appbase+theUrl;
	}


	$(function(){

	//date edit dialog
	$("#fall_edit-dialog").dialog({
	        autoOpen: false,
	        height: 140,
	        modal: true,
	        open: function () {
	        	var current_date = ($(this).data('current_date'));
	        	var current_date_time = ($(this).data('current_date_time'));
	        	
	        	var previous_date_full = ($(this).data('previous_date_full'));
	        	var current_date_full = ($(this).data('current_date_full'));
	        	var next_date_full = ($(this).data('next_date_full'));
	        	
	        	var fald = ($(this).data('fald'));
	        	var date_type = ($(this).data('date_type'));
	        	var previous_date = ($(this).data('previous_date'));
	        	var next_date = ($(this).data('next_date'));
	        	var period_status = ($(this).data('period_status'));
	        	var fall_nr = ($(this).data('fall_nr'));
				var current_dateobj = new Date(current_date_full);

				$('.datepick-popup').css('z-index','1005');

				$('#previous_date').val(previous_date_full);
				$('#current_date').val(current_date_full);
				$('#next_date').val(next_date_full);
				
				
				
				$('#fald').val(fald);
				$('#date_type').val(date_type);
				$('#fall_type').val(period_status);
				$('#fall_nr').val(fall_nr);

				$('#edit_date').val(''); //clear the input field
	        	$('#edit_date').val(current_date); //populate the input field

				$('#edit_date').datepicker({
					dateFormat: 'dd.mm.yy',
					showOn: "both",
					buttonImage: $('#calImg').attr('src'),
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: '',
			        minDate: previous_date,
			        maxDate: next_date
			    });
	        	
	        	
				$('#edit_time').val(''); //clear the input field
	        	$('#edit_time').val(current_date_time); //populate the input field
	        	
				$('#edit_time').timepicker({
							minutes : {
								interval : 5
							},
							showPeriodLabels : false,
							rows : 4,
							hourText : 'Stunde',
							minuteText : 'Minute'
						});
	        },

	        close: function() {
		        //clear and destroy datepicker on modal close	        	
	        	$('#edit_date').datepicker("destroy");
	        }
	    });
	
	
		$(".fall_delete")
		.mouseenter( function () {
			var fall_nr = $(this).attr('rel');
			$('#fall_'+fall_nr).addClass('fall_hover_delete');
		} )
		.mouseleave( function () {
			var fall_nr = $(this).attr('rel');
			$('#fall_'+fall_nr).removeClass('fall_hover_delete');
		} ).click(function(){
			var fall_nr = $(this).attr('rel');
			var fall_adm = $(this).data('adm');
			var fall_dis = $(this).data('dis');
			var fall_type = $(this).data('fall_type');
			
			// delete fall function
			var str_date = '<?php echo $this->translate("Are you sure you want to delete this fall"); ?>';
			var str_action = '<?php echo $this->translate("remove entire fall"); ?>';
			
			jConfirm(str_date, str_action, function(r) {
				
				if(r)
				{
					$('body').addClass('body-overlay');
					
					$.ajax({
						type: 'POST',
						url: 'ajax/deletepatientfalls?id=<?php echo $_REQUEST['id']; ?>',
						data: {
							fall: fall_nr,
							fall_type: fall_type,
							admission_date: fall_adm,
							discharge_date: fall_dis
						},

						success:function(data){
							
							var checkdata = jQuery.parseJSON(data);
							//console.log(checkdata );
							if(checkdata.error == "0"){
								location.href = "<?php echo APP_BASE ?>patient/patientdetails?id=<?php echo $_REQUEST['id'];?>";
							} 
							else
							{
								$('body').removeClass('body-overlay');
								alert(checkdata.text);	
							}
							
						},
						error:function(){
							ajax_done = 1;
						}
					});
				}
			});
			
		});
		
		$(".fall_date_delete")
		.mouseenter( function () {
			var fall_nr = $(this).data('fall_nr');
			var fall_date = $(this).data('fall_date');
			var fall_date_type = $(this).data('fall_date_type');
			$('.fall_date_'+fall_nr+'_'+fall_date_type).addClass('fall_hover_date');
		} )
		.mouseleave( function () {
			var fall_nr = $(this).data('fall_nr');
			var fall_date = $(this).data('fall_date');
			var fall_date_type = $(this).data('fall_date_type');
			$('.fall_date_'+fall_nr+'_'+fall_date_type).removeClass('fall_hover_date');
		} ).click(function(){
			var fall_nr = $(this).data('fall_nr');
			var fall_date = $(this).data('fall_date');
			var fall_date_type = $(this).data('fall_date_type');
			$('.fall_date_'+fall_nr+'_'+fall_date_type).addClass('fall_hover_date');
			var fall_type = $(this).data('period_status');
			
			//console.log($(this));
			
			//console.log(fall_nr);
			//console.log(fall_date);
			//console.log(fall_date_type);
			var move_to_standby = "0";
			if(first_admission_ever ==  fall_date){
				move_to_standby = "1";
			}
			
			// delete fall date function
			// delete fall date function
			if(fall_date_type == "1" && move_to_standby == "0"){
				var str_date = '<?php echo $this->translate("Are you sure you want to delete this admission date"); ?>'
				var str_action = '<?php echo $this->translate("remove admission, move to discharge"); ?>'
			} 
			else if(fall_date_type == "1" && move_to_standby == "1"){
				var str_date = '<?php echo $this->translate("Are you sure you want to delete this admission date and set as STANDBY"); ?>'
				var str_action = '<?php echo $this->translate("remove admission, move to Standby"); ?>'
			}
			else
			{
				var str_date = '<?php echo $this->translate("Are you sure you want to delete this discharge date"); ?>'
				var str_action = '<?php echo $this->translate("remove discharge and reactivate pateint"); ?>'
			}
			
			
			jConfirm(str_date,str_action, function(r) {
				
				if(r)
				{
					if( ! checkclientchanged() ){
						return false;
					}
					$('body').addClass('body-overlay');
					
					$.ajax({
						type: 'POST',
						url: 'ajax/managepatientfalls?id=<?php echo $_REQUEST['id']; ?>',
						data: {
							fall: fall_nr,
							date: fall_date,
							date_type: fall_date_type,
							fall_type: fall_type
						},

						success:function(data){
							
							var checkdata = jQuery.parseJSON(data);
							//console.log(checkdata );
							if(checkdata.error == "0"){
								// add class to body
								//ui-widget-overlay 
								location.href = "<?php echo APP_BASE ?>patient/patientdetails?id=<?php echo $_REQUEST['id'];?>";
							} 
							else
							{
								$('body').removeClass('body-overlay');
								alert(checkdata.text);	
							}
							
						},
						error:function(){
							ajax_done = 1;
						}
					});
				}
			});
		});
		
		

		$(".fall_edit").click(function () {
// 			var edit_data = $(this).attr('rel').split('|');
			//console.log(edit_data);
			
			//console.log($(this));
			
			var current_date_full = $(this).data('current_date_full');
			var date_type = $(this).data('date_type');
			var fald = $(this).data('fald');
			var current_date = $(this).data('current_date');
			var current_date_time = $(this).data('current_date_time');
			var previous_date = $(this).data('previous_date');
			var previous_date_full = $(this).data('previous_date_full');
			var next_date = $(this).data('next_date');
			var next_date_full = $(this).data('next_date_full');
			var period_status = $(this).data('period_status');
			var fall_nr = $(this).data('fall_nr');
			
			$("#fall_edit-dialog")
			.data('current_date_full',current_date_full)
			.data('date_type',date_type)
			.data('fald',fald)
			.data('current_date',current_date)
			.data('current_date_time',current_date_time)
			.data('previous_date',previous_date)
			.data('previous_date_full',previous_date_full)
			.data('next_date',next_date)
			.data('next_date_full',next_date_full)
			.data('period_status',period_status)
			.data('fall_nr',fall_nr)
			.dialog("open");
		        return false;
		});
		
		//vv fall edit start
		$("#vv_fall_edit_dialog").dialog({
	        autoOpen: false,
	        height: 140,
	        modal: true,
	        open: function () {
	        	var vv_current_date = ($(this).data('vv_current_date'));
	        	var vv_previous_date = ($(this).data('vv_previous_date'));
	        	var vv_next_date = ($(this).data('vv_next_date'));
	        	var vv_fallid = ($(this).data('vv_fallid'));
	        	var vv_date_type = ($(this).data('vv_date_type'));
	        	var vv_current_date_full = ($(this).data('vv_current_date_full'));
	        	var vv_next_date_full = ($(this).data('vv_next_date_full'));
	        	var vv_previous_date_full = ($(this).data('vv_previous_date_full'));
	        	
	        	
				var current_dateobj = new Date(vv_current_date);

				$('.datepick-popup').css('z-index','1005');

				$('#vv_previous_date').val(vv_previous_date);
				$('#vv_current_date').val(vv_current_date);
				$('#vv_next_date').val(vv_next_date);
				$('#vv_fallid').val(vv_fallid);
				$('#vv_date_type').val(vv_date_type);
				$('#vv_current_date_full').val(vv_current_date_full);
				$('#vv_previous_date_full').val(vv_previous_date_full);
				$('#vv_next_date_full').val(vv_next_date_full);
				
				$('#vv_edit_date').val(''); //clear the input field
	        	$('#vv_edit_date').val(vv_current_date); //populate the input field

				$('#vv_edit_date').datepicker({
					dateFormat: 'dd.mm.yy',
					showOn: "both",
					buttonImage: $('#calImg').attr('src'),
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: '',
			        minDate: vv_previous_date,
			        maxDate: vv_next_date
			    });
			},

	        close: function() {
		        //clear and destroy datepicker on modal close	        	
	        	$('#vv_edit_date').datepicker("destroy");
	        }
	    });

		$(".vv_fall_edit").click(function () {
			var edit_data = $(this).attr('rel').split('|');
			//console.log(edit_data);
			$("#vv_fall_edit_dialog")
			.data('vv_current_date',edit_data[0])
			.data('vv_date_type',edit_data[1])
			.data('vv_fallid',edit_data[2])
			.data('vv_previous_date',edit_data[3])
			.data('vv_next_date',edit_data[4])
			.data('vv_current_date_full',edit_data[5])
			.data('vv_previous_date_full',edit_data[6])
			.data('vv_next_date_full',edit_data[7])
			.dialog("open");
		        return false;
		});
		//vv fall edit end

		
		$("#check_fall_history").live('click', function(e){
			e.preventDefault();

			$('.fall_err span#fall_alert').replaceWith("");
			if( ! checkclientchanged()){
				return false;
			}
			$.ajax({
				type: 'POST',
				url: 'ajax/checkfalledit?id=<?php echo $_REQUEST['id']; ?>',
				data: {
					previous_date: $('#previous_date').val(),
					next_date: $('#next_date').val(),
					edit_date: $('#edit_date').val(),
					edit_time: $('#edit_time').val()
				},

				success:function(data){
					
					var checkdata = jQuery.parseJSON(data);
					var edit_action = "1"
					var alert_text = "";

					if(checkdata.error == 1){
						 alert_text = '<span id="fall_alert"><?php echo $this->translate("date must be bigger than previous date"); ?>:'+checkdata.previous_date+'</span>';
						 edit_action = "0"
					} else if(checkdata.error == 2){
						 alert_text = '<span id="fall_alert"><?php echo $this->translate("date must be lower than next date"); ?>:'+checkdata.next_date+'</span>';
						 edit_action = "0"
					} else if(checkdata.error == 3){
						 alert_text = '<span id="fall_alert"><?php echo $this->translate("date_error_before_2008"); ?></span>';
						 edit_action = "0"
					} else {
						 alert_text = '<span id="fall_alert"><img src="<?php echo RES_FILE_PATH; ?>/images/ajax-loader.gif"></span>';
						 edit_action = "1"
					}
					
					$('.fall_err').append(alert_text);
					
					if(edit_action == "1"){
						$('#edit').submit();
					}
					
				},
				error:function(){
					ajax_done = 1;
				}
			});
			
			
 
		});
		
		
		
		
		
		

		$("#vv_fall_end-dialog").dialog({
			autoOpen: false,
			height: 140,
			modal: true,
			open: function () {
				var current_date = ($(this).data('current_date'));
				var vv_previous_date = ($(this).data('vv_previous_date'));
				var vv_next_date = ($(this).data('vv_next_date'));
				$('#end_vv_date').datepicker({
					dateFormat: 'dd.mm.yy',
					showOn: "both",
					buttonImage: $('#calImg').attr('src'),
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: '',
					showOnFocus: true,
					maxDate: vv_next_date,
					minDate: vv_previous_date
				});

				$('.datepick-popup').css('z-index','1005');
				$('#vv_next_date').val(vv_next_date);
				$('#vv_previous_date').val(vv_previous_date);

				$('#end_vv_date').val('');  //clear the input field
				$('#end_vv_date').val(vv_next_date); //populate the input field
				$('#end_vv_date').datepicker('show');
			},
			close: function() {
				//clear and destroy datepicker on modal close
//				$('#end_vv_date').datepicker('clear');
				$('#end_vv_date').datepicker("destroy");;
			}
		});
		
		$("#vv_fall_start-dialog").dialog({
			autoOpen: false,
			height: 140,
			modal: true,
			open: function () {
				var current_date = ($(this).data('current_date'));
				var vv_previous_date = ($(this).data('vv_previous_date'));
				var vv_next_date = ($(this).data('vv_next_date'));
				$('#start_vv_date').datepicker({
					dateFormat: 'dd.mm.yy',
					showOn: "both",
					buttonImage: $('#calImg').attr('src'),
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: '',
					showOnFocus: true,
					maxDate: vv_next_date,
					minDate: vv_previous_date
				});

				$('.datepick-popup').css('z-index','1005');
				$('#vv_next_date').val(vv_next_date);
				$('#vv_previous_date').val(vv_previous_date);

				$('#start_vv_date').val('');  //clear the input field
				$('#start_vv_date').val(vv_next_date); //populate the input field
				$('#start_vv_date').datepicker('show');
			},
			close: function() {
				//clear and destroy datepicker on modal close
				$('#start_vv_date').datepicker("destroy");;
			}
		});

		$('#end_sapv_button').click(function(){
			var data_sel = $(this).attr('rel').split('|');

			$('#vv_fall_end-dialog').data('vv_previous_date', data_sel[0])
						.data('vv_next_date', data_sel[1])
						.data('vv_current_date', data_sel[2])
						.dialog("open");

		});
		
		$('#start_sapv_button').click(function(){
			var data_sel = $(this).attr('rel').split('|');

			$('#vv_fall_start-dialog').data('vv_previous_date', data_sel[0])
						.data('vv_next_date', data_sel[1])
						.data('vv_current_date', data_sel[2])
						.dialog("open");

		});


		/* $('#living_will_from').datepicker({dateFormat: 'dd.mm.yy',
					showOn: "both",
					buttonImage: $('#calImg').attr('src'),
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: '',
					onSelect:function(){
				updatePatientInformation('Master','living_will_from','grow6',this,'<?php echo $this->pat_enc_id ?>','drop')
		}}); */
		
		$("#pegmore").blur(function(){
			updatePatientInformation('MoreInfo','pegmore','grow20',this,'<?php echo $this->pat_enc_id ?>','drop');
		});
		
		$("#vvfreetext").blur(function(){
			updatePatientInformation('Therapieplanung','freetext','grow37',this,'<?php echo $this->pat_enc_id ?>','drop');
		});
		
		$("#anderefree").blur(function(){
			updatePatientInformation('Stastszugehorigkeit','anderefree','grow17',this,'<?php echo $this->pat_enc_id ?>','drop');
		});
		
		$("#portmore").blur(function(){
			updatePatientInformation('MoreInfo','portmore','grow20',this,'<?php echo $this->pat_enc_id ?>','drop');
		});
		
		$("#bedmore").blur(function(){
			updatePatientInformation('Mobility','bedmore','grow5',this,'<?php echo $this->pat_enc_id ?>','drop');
		});
		
		$("#wmore").blur(function(){
			updatePatientInformation('Wunsch','wmore','grow25',this,'<?php echo $this->pat_enc_id ?>','drop');
		});
		
		$("#walkermore").blur(function(){
			updatePatientInformation('Mobility','walkermore','grow5',this,'<?php echo $this->pat_enc_id ?>','drop');
		});

		$("#wheelchairmore").blur(function(){
			updatePatientInformation('Mobility','wheelchairmore','grow5',this,'<?php echo $this->pat_enc_id ?>','drop');
		});

		$("#goablemore").blur(function(){
			updatePatientInformation('Mobility','goablemore','grow5', this,'<?php echo $this->pat_enc_id ?>','drop');
		});
		

		$("#nachtstuhlmore").blur(function(){
			updatePatientInformation('Mobility','nachtstuhlmore','grow5',this,'<?php echo $this->pat_enc_id ?>','drop');
		});

		$("#wechseldruckmatrazemore").blur(function(){
			updatePatientInformation('Mobility','wechseldruckmatrazemore','grow5',this,'<?php echo $this->pat_enc_id ?>','drop');
		});
		
		/* $("#living_will_from").blur(function(){ }); */
		
		/* $("#living_will_deposited").blur(function(){
			updatePatientInformation('Master','living_will_deposited','grow6',this,'<?php echo $this->pat_enc_id ?>','drop');
		});
		 */

		$("#kunstlichemore").blur(function(){
			updatePatientInformation('Kunstliche','kunstlichemore','grow22',this,'<?php echo $this->pat_enc_id ?>','drop');
		});
		
		$("#visit_duration").blur(function(){
			updatePatientInformation('VisitsSettings','visit_duration','grow43',this,'<?php echo $this->pat_enc_id ?>','drop');
		});
		/*
		$("#visits_per_day").blur(function(){
			updatePatientInformation('VisitsSettings','visits_per_day','grow43',this,'<?php echo $this->pat_enc_id ?>','drop');
		});
		*/
		$("select#stage").change(
		function(){
			$('#erstantrag').attr('checked', false);
			$('#horherstufung').attr('checked', false);
		}
	);
	})

	function dropDownchange(ltrval)
	{
		ajaxCallserver({url:'patient/fetchdropdown?ltr='+ltrval,callLoading:loading});
	}

	var chks;
	var formid;
	
	
	/** 
	toggle the .extra_options elemets from inside the elSelector
	elParentSelector must a valid jquery selector
	value = 0|1 hide|show
	
	*/
	function toggleExtraOptions( elSelector, value)
	{
		var parent = $(elSelector).closest(".parent_container");
		if (parent.length > 0) {
			if(value == 1 || value== "yes" || value =="on")
			{
				$( ".extra_options", parent).show();
			}
			else
			{
				$( ".extra_options", parent).hide();
			}
		}
	}
	
	function updatePatientInformation(modname,fldname,formid,chk,patid,drp)
	{
		//chk should be this clicked.. so you can fetch by a standard parent_container and NOT by id
		if(disable_update == "1"){
			alert("<?php echo $this->translate('youdonothavepermission')?>")
			return false;
		}
		
		if(chk.checked == true && drp != "kontactnumber" && fldname != 'living_will'){
			chks = 1;
		} else {
			chks = 0;
		}
		
		
		switch(modname) {
			
			case "Acp":
				
				var division_tab = $(chk).closest(".parent_container").data('division_tab');
				
				toggleExtraOptions(chk, chk.value);
				ajaxcall(modname, fldname, chk.value, patid, formid , {'division_tab':division_tab});
				
				return;
			break;
			
			case "Orientation2":
			case "Mobility2" :
				fldname = chk.value
				chks = Number(chk.checked);
			break;
			
			
		}
		
		
		/* if(fldname=="living_will"){
			togglediv(drp,chk.value);
			ajaxcall(modname,fldname,chk.value,patid,formid);
			$("#living_will_from").val('');
			$("#living_will_deposited").val('');
		}else
 */
		if(fldname=="germination_text" )
		{			
			chks = chk.value;
		}
		
		if(drp=='drop' || drp=='rad' || drp == 'fam' || drp == 'vig' || drp == 'sta' || drp == "kontactnumber")
		{
			chks = chk.value;

			if(drp == "kontactnumber" && chk.checked == false){
				chks = "";
			}
		}

		if(drp == "ern"){
			var values = new Array();
			$.each($("input[name='ernahrung[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		
		if(drp == "kun"){
			var values = new Array();
			$.each($("input[name='kunstliche[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		
		if(drp == "ori"){
			var values = new Array();
			$.each($("input[name='orientierung[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		
		if(drp == "aus"){
			var values = new Array();
			$.each($("input[name='ausscheidung[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		if(drp == "hil"){
			var values = new Array();
			$.each($("input[name='hilfsmittel[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		if(drp == "wun"){
			var values = new Array();
			$.each($("input[name='wunsch[]']:checked"), function() {
				values.push($(this).val());
				chks = values;
			});
		}

		if(fldname=="peg" || fldname=="port" || fldname=="bed" || fldname=="walker" || fldname=="wheelchair" || fldname=="goable" || fldname=="nachtstuhl" || fldname=="wechseldruckmatraze")
		{
			var len = $("#"+fldname+'more').val().length;
			if(chks==0 && len >0)
			{
				jConfirm('<?php echo $this->translate('wantstouncheck'); ?>', '', function(r) {
					if(r)
					{
						togglediv(drp,chks);
						ajaxcall(modname,fldname,chks,patid,formid);
						$("#"+fldname+'more').val('');
					}
					else
					{
						chk.checked = true;
					}

				});
				return false;
			}
			else
			{
				togglediv(drp,chks);
				ajaxcall(modname,fldname,chks,patid,formid);
			}
		}
		else
		{
		    if(fldname != 'living_will'){
			ajaxcall(modname,fldname,chks,patid,formid);
		    }
		}
	}

	/*
	 * extra_params = {} was introduced so you don't have to write each param with key etc etc
	 * call like : ajaxcall(modname, fldname, chks, patid, formid, {'key1':'val1', 'key2':'val2', ... })
	 */
	function ajaxcall(modname,fldname,chks,patid,formid , extra_params){
		 

		if(isdischarged==1){
			jConfirm('<?php echo $this->translate('dischargealert'); ?>', '', function(r) {
				if(r){


					if (fldname =='ishospiz'){
						if($("#ishospiz").is(":checked")){
							if(hospiz_users_nr > 0){
								$( "#assignhospizusers" ).dialog('open');
							}
						}else if(!$("#ishospiz").is(":checked")){
							if(hospiz_assusers > 0){
								$( "#removehospizusers" ).dialog('open');
							}
						}

					}
					if (fldname =='ishospizverein'){
						if($("#ishospizverein").is(":checked")){
							if(hospizverein_users_nr > 0){
								$( "#assignhospizvereinusers" ).dialog('open');
							}
						}else if(!$("#ishospizverein").is(":checked")){
							if(hospizverein_assusers > 0){
								$( "#removehospizvereinusers" ).dialog('open');
							}
						}
					}
					if (! checkclientchanged()) {
						return false;
					}
					
					if (typeof extra_params == "object") {
						//append custom params
						var defaultParams = {
								
								'modname' : modname,
								'fldname' : fldname,
								//'chkval' : encodeURIComponent(chks),
								'chkval' : chks,
								'patid' : patid,
								'formid' : formid,
								
						}
						
						$.extend(defaultParams, extra_params);
						var recursiveEncoded = $.param( defaultParams );
						ajaxCallserver({url:appbase+'patient/updatepatientinfo?' + recursiveEncoded });

					} else {
						ajaxCallserver({url:appbase+'patient/updatepatientinfo?modname='+modname+'&fldname='+fldname+'&chkval='+encodeURIComponent(chks)+'&patid='+patid+'&formid='+formid});
					}
				}
			});

			return false;
		} else {

			if (fldname =='ishospiz'){
				if($("#ishospiz").is(":checked")){
					if(hospiz_users_nr > 0){
						$( "#assignhospizusers" ).dialog('open');
					}
				}else if(!$("#ishospiz").is(":checked")){
					if(hospiz_assusers > 0){
						$( "#removehospizusers" ).dialog('open');
					}
				}

			}
			if (fldname =='ishospizverein'){
				if($("#ishospizverein").is(":checked")){
					if(hospizverein_users_nr > 0){
						$( "#assignhospizvereinusers" ).dialog('open');
					}
				}else if(!$("#ishospizverein").is(":checked")){
					if(hospizverein_assusers > 0){
						$( "#removehospizvereinusers" ).dialog('open');
					}
				}
			}
			if (! checkclientchanged()) {
				return false;
			}
			
			if (typeof extra_params == "object") {
				//append custom params
				var defaultParams = {
						
						'modname' : modname,
						'fldname' : fldname,
						//'chkval' : encodeURIComponent(chks),
						'chkval' : chks,
						'patid' : patid,
						'formid' : formid,
						
				}
				
				$.extend(defaultParams, extra_params);
				var recursiveEncoded = $.param( defaultParams );
				ajaxCallserver({url:appbase+'patient/updatepatientinfo?' + recursiveEncoded });

			} else {
				ajaxCallserver({url:appbase+'patient/updatepatientinfo?modname='+modname+'&fldname='+fldname+'&chkval='+encodeURIComponent(chks)+'&patid='+patid+'&formid='+formid});
			}

		}
	}

	function togglediv(divname,chks)
	{
		if(chks==1)
		{
			$('#'+divname).show();
		}
		else
		{
			$('#'+divname).hide();
		}
	}

	var carediv = function(params)
	{
		document.getElementById('listcarelevel').innerHTML=params.carelist;
	}

	var doctors;
	var docdropdiv = function(params){

		var dlist = '<div class="DropDwnTable"><table border="0" align="left" cellpadding="0" cellspacing="0" class="Dropdwntble">';
		doctors = params.doctors;
		if(doctors.length>0){dlist+='<tr class="bluerow"><td class="first" valign="top"><strong><?php echo $this->translate('name'); ?></strong></td><td class="first" valign="top"><strong><?php echo $this->translate('firstname'); ?></strong></td><td class="first" valign="top"><strong><?php echo $this->translate('city'); ?></strong></td><td valign="top">&nbsp;</td></tr>';}
		else
		{
			dlist+='<tr><td colspan="2" class="BlueBox"><?php echo $this->translate('noresultsaddfamilydoctor'); ?>/td></tr>';
		}

		for(i=0;i<params.doctors.length;i++)
		{
			dlist+='<tr class="bluerow" onclick="selectDoctor('+i+')"><td class="first"  valign="top">'+params.doctors[i].last_name +'</td><td class="first" valign="top">'+params.doctors[i].first_name +'</td><td class="first" valign="top">'+params.doctors[i].city +'</td><td valign="top"><?php echo $this->translate('select'); ?></td></tr>';
		}
		dlist+= "</table></div>";

		document.getElementById('doctdropdown').style.display = "";
		document.getElementById('doctdropdown').innerHTML=dlist;
		document.getElementById('msg').innerHTML = "<?php echo $this->translate('ifnoresultfamilydoctor'); ?>";

	}

	function selectDoctor(i)
	{
		document.getElementById('familydoc_id').value =doctors[i].last_name;
		document.getElementById('doctdropdown').style.display = "none";
		document.getElementById('hidd_docid').value =doctors[i].id;
	}
	function updateHospitz(epid, chk){
		if(chk.checked == true){
			chks = 1;
		} else {
			chks = 0;
		}
		if (! checkclientchanged()) {
			return false;
		}
		ajaxCallserver({url:appbase+'patient/patienthospiz?id='+epid+'&chkval='+encodeURIComponent(chks)});
	}


	function refDropDownchange(ltrval)
	{
		ajaxCallserver({url:'patient/fetchreferreddropdown?ltr='+ltrval,callLoading:r_loading});
	}

    $(function() {

	$('#recording_date').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: ''
	});
	$('#livind_will_from').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: ''
	});

	$('.contactclass').click(function(){
	    $('#FormDiv').toggle();

	});
    });

	$(document).ready(function(){

		var groupIdChild = [];
		var groupId = [];
		var groupIdChildReverse = [];
		$("input[name^=group_id]").each(function(){
			var groupId = $(this).attr('class').split("-");
			if($(this).is(':checked')){
				$('.child-'+groupId[1]).each(function(){
					if(!$(this).is(':checked')){
						$(this).attr('checked', true);
					}
				});
			}
		}).live('change', function(){
			var groupId = $(this).attr('class').split("-");
			if($(this).is(':checked')){
				$('.child-'+groupId[1]).each(function(){
					if(!$(this).is(':checked')){
						$(this).attr('checked', true);
					}
				});
			} else {
				jConfirm('<?php echo $this->translate('deselectallusers'); ?>', '', function(r) {
					if(r)
					{
						$('.child-'+groupId[1]).each(function(){
							if($(this).is(':checked')){
								$(this).attr('checked', false);
							}
						});
					}

				});

				return false;
			}
		});
		
		$("input[name^=user_id]").live('change', function(){
			if(!$(this).is(':checked')){
				var groupIdChild = $(this).attr('class').split("-");
				if($('.parent-'+groupIdChild[1]).is(':checked')){
					$('.parent-'+groupIdChild[1]).attr('checked', false);
				}
			}
			var groupIdChildReverse = $(this).attr('class').split("-");
			var checked = 0;
			$('.child-'+groupIdChildReverse[1]).each(function(){
				if(!$(this).is(':checked')){
					$('.parent-'+groupIdChildReverse[1]).attr('checked', false);
					checked = 1;
				}
			});

			if(checked == 0) {
				$('.parent-'+groupIdChildReverse[1]).attr('checked', true);
			}
		});


		//medipumps
		$( "#medipump_add" ).dialog({
			autoOpen: false,
			title:"<?php echo $this->translate('Add Patient Medipumps'); ?>",
			resizable: false,
			height: 200,
			width: 350,
			modal: true,
			open: function (){
				$('#medipump').val('');
				$('#medipump_date_start').val('');
				$('#medipump_date_end').val('');

				$('#medipump_date_start, #medipump_date_end').datepicker({
					dateFormat: 'dd.mm.yy',
					showOn: "both",
					buttonImage: $('#calImg').attr('src'),
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: ''
				});
			},
			buttons: {
				"<?php echo $this->translate('medipump_add'); ?>": function(){

					if($('#medipump').val() == '0'){
						alert('<?php echo $this->translate('no_medipump_selected'); ?>')
						return false;
					} else if($('#medipump_date_start').val() == '') {
						alert('<?php echo $this->translate('pump_start_date_mandatory'); ?>')
						return false;
					}

					if ( ! checkclientchanged()){
						return false;
					}
					//check for mp overlapping START
					$.ajax({
						type: 'POST',
						url: '<?php echo APP_BASE; ?>ajax/medipumpoverlapping?id=<?php echo $_REQUEST['id']; ?>',
						data: {
							medipump: $('#medipump').val(),
							begin_date: $('#medipump_date_start').val(),
							end_date: $('#medipump_date_end').val()
						},
						beforeSend:function(){
							//loading image
							$('#medipump_ajax_load').show();
						},
						success:function(data){
							$('#medipump_ajax_load').hide();
							var medipumpdata = jQuery.parseJSON(data);

							if(medipumpdata.intersected == 1){
								$('#medipumps_overlapped').dialog('open');
							} else {
								$('.submitform').attr('disabled',true);
								$(".ui-button:first").attr("disabled", true)
								.addClass("ui-state-disabled").next("button").attr("disabled", true)
								.addClass("ui-state-disabled");

							       $('#error_div_edit').html('');
								$('#add_patient_medipumps').submit();

							}
						}
					});
				},
				"<?php echo $this->translate('cancel'); ?>": function(){
					$( "#medipump_add" ).dialog('close');
				}
			},create:function () {
		        $(this).closest(".ui-dialog")
	            .find(".ui-button:first") // the first button
	            .addClass("submitform");
	    },
	   	   close:function () {
	    	$('.submitform').attr('disabled',false),
			 $(".ui-button:first").attr("disabled", false)
			 .removeClass("ui-state-disabled").next("button").attr("disabled", false)
			 .removeClass("ui-state-disabled");
	    }
		});

		$('#add_new_medipumps').live('click', function(){ $('#medipump_add').dialog('open'); });

		//edit medipumps
		$( "#medipump_edit" ).dialog({
			autoOpen: false,
			title:'<?php echo $this->translate('editpatientarticle'); ?>',
			resizable: false,
			height: 200,
			width: 350,
			modal: true,
			open: function (){
				$('#medipump_edit_start, #medipump_edit_end').datepicker({
					dateFormat: 'dd.mm.yy',
					showOn: "both",
					buttonImage: $('#calImg').attr('src'),
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: ''
				});
				$('#error_div_edit').html('');
			},
			buttons: {
				"<?php echo $this->translate('medipump_edit'); ?>": function(){

					if($('#medipump_edit_select').val() == '0'){
						alert('<?php echo $this->translate('no_medipump_selected'); ?>')
						return false;
					} else if($('#medipump_edit_start').val() == '') {
						alert('<?php echo $this->translate('pump_start_date_mandatory'); ?>')
						return false;
					}

					//check for mp overlapping START
					$.ajax({
						type: 'POST',
						url: '<?php echo APP_BASE; ?>ajax/medipumpoverlapping?id=<?php echo $_REQUEST['id']; ?>',
						data: {
							medipump: $('#medipump_edit_select').val(),
							begin_date: $('#medipump_edit_start').val(),
							end_date: $('#medipump_edit_end').val(),
							exclude_id: $('#edit_medipump_id').val()
						},
						beforeSend:function(){
							//loading image
							$('#medipump_ajax_load_edt').show();
						},
						success:function(data){
							$('#medipump_ajax_load_edt').hide();
							var medipumpdata_edt = jQuery.parseJSON(data);

							if(medipumpdata_edt.intersected == 1){
								$('#medipumps_overlapped').dialog('open');
							} else {
								$('.submitform').attr('disabled',true);
								$(".ui-button:first").attr("disabled", true)
								.addClass("ui-state-disabled").next("button").attr("disabled", true)
								.addClass("ui-state-disabled");

							       $('#error_div_edit').html('');
								$('#edit_patient_medipumps').submit();

							}
						}
					});
				},
				"<?php echo $this->translate('cancel'); ?>": function(){
					$( "#medipump_edit" ).dialog('close');
					$('#error_div_edit').html('');
				}
			},
			create:function () {
				$(this).closest(".ui-dialog").find(".ui-button:first").addClass("submitform");
			},
			close:function () {
				$('.submitform').attr('disabled',false),
			 $(".ui-button:first").attr("disabled", false).removeClass("ui-state-disabled").next("button").attr("disabled", false).removeClass("ui-state-disabled");
			}
		});

		$('.edit_medipumps').live('click', function(){
			var curent_id = $(this).attr('alt');

			$('#edit_medipump_id').val(curent_id);
			$('#medipump_edit_select').val($('#medipumpe_id_'+curent_id).val());
			$('#medipump_edit_start').val($('#medipumpe_start_'+curent_id).val());
			$('#medipump_edit_end').val($('#medipumpe_end_'+curent_id).val());
			$('#medipump_edit').dialog('open');
		});

		//delete medipumps
		$( "#medipump_delete" ).dialog({
			autoOpen: false,
			title:'Delete Patient Medipumps',
			resizable: false,
			height: 200,
			width: 350,
			modal: true,
			buttons: {
				"<?php echo $this->translate('medipump_delete'); ?>": function(){
					if ( ! checkclientchanged()){
						return false; 
					}
					$('.submitform').attr('disabled',true);
					 $(".ui-button:first").attr("disabled", true)
					 .addClass("ui-state-disabled").next("button").attr("disabled", true)
					 .addClass("ui-state-disabled");

					$('#del_patient_medipumps').submit();
				},
				"<?php echo $this->translate('cancel'); ?>": function(){
					$( "#medipump_delete" ).dialog('close');
				}
			},create:function () {
		        $(this).closest(".ui-dialog")
	            .find(".ui-button:first") // the first button
	            .addClass("submitform");
	    },
	   	   close:function () {
	    	$('.submitform').attr('disabled',false),
			 $(".ui-button:first").attr("disabled", false)
			 .removeClass("ui-state-disabled").next("button").attr("disabled", false)
			 .removeClass("ui-state-disabled");
	    }
		});

		$('.delete_medipumps').live('click', function(){
			var curent_del_id = $(this).attr('alt');
			$('#del_medipump_id').val(curent_del_id);
			$('#medipump_delete').dialog('open');
		});

		//medipumps overlapped modal
		$('#medipumps_overlapped').dialog({
			autoOpen: false,
			title:'<?php echo $this->translate('medipump_overlapping_title'); ?>',
			resizable: false,
			height: 200,
			width: 350,
			modal: true,
			buttons: {
				"<?php echo $this->translate('ok_button'); ?>": function(){
					$( "#medipumps_overlapped" ).dialog('close');
				}
			}
		});
		$('#approve_visit_overlapped').dialog({
			autoOpen: false,
			title:'<?php echo $this->translate('approve_visit_overlapped_title'); ?>',
			resizable: false,
			height: 200,
			width: 350,
			modal: true,
			buttons: {
				"<?php echo $this->translate('ok_button'); ?>": function(){
					$( "#approve_visit_overlapped" ).dialog('close');
				}
			}
		});


		$( "#sethospizvis" ).dialog({
			autoOpen: false,
			title:'Bitte Benutzer zuweisen, die Rechte für diesen Patienten bekommen sollen',
			resizable: false,
			height: 420,
			width: 350,
			modal: true,
			open: function(){
				$('.loadingdiv').hide();
			},
			buttons: {
				"Speichern": function(){
					$('#sethospizvisform').submit();
					$('.hsusers').hide();
					$('.loadingdiv').show();
					$('.ui-state-default').hide();
				},
				"Abbrechen": function(){
					$( "#sethospizvis" ).dialog('close');
				}
			}
		});
		$( "#removehospizusers" ).dialog({
			autoOpen: false,
			resizable: false,
			height: 180,
			width: 330,
			modal: true,
			open: function(){
				$('.loadingdiv').hide();
			},
			buttons: {
				"Nein": function(){
					$( "#removehospizusers" ).dialog('close');
				},
				"Ja": function(){
					$('#removehospizform').submit();
					$('.loadingdiv').show();
					$('b.removeus').hide();
					$('.ui-state-default').hide();

				}
			}
		});


		$( "#sethospizverein" ).dialog({
			autoOpen: false,
			resizable: false,
			title:'Bitte Benutzer zuweisen, die Rechte für diesen Patienten bekommen sollen',
			height: 420,
			width: 350,
			modal: true,
			open: function(){
				$('.loadingdiv').hide();
			},
			buttons: {
				//"Abschicken": function(){
				"Speichern": function(){
					$('#sethospizvereinform').submit();
					$('.hvusers').hide();
					$('.loadingdiv').show();
					$('.ui-state-default').hide();
				},
				"Abbrechen": function(){
					$( "#sethospizverein" ).dialog('close');
				}
			}

		});

		$( "#removehospizvereinusers" ).dialog({
			autoOpen: false,
			resizable: false,
			height: 120,
			width: 330,
			modal: true,
			open: function(){
				$('.loadingdiv').hide();
			},
			buttons: {
				"Nein": function(){
					$( "#removehospizvereinusers" ).dialog('close');
				},
				"Ja": function(){
					$('#removehospizvereinform').submit();
					$('.loadingdiv').show();
					$('b.removeus').hide();
					$('.ui-state-default').hide();
				}
			}
		});
		$( "#assignhospizusers" ).dialog({
			autoOpen: false,
			resizable: false,
			height: 180,
			width: 330,
			modal: true,
			open: function(){
			},
			buttons: {
				"Nein": function(){
					$( "#assignhospizusers" ).dialog('close');
				},
				"Ja": function(){
					$('#sethospizvis').dialog('open');
					$( "#assignhospizusers" ).dialog('close');
				}
			}
		});
		$( "#assignhospizvereinusers" ).dialog({
			autoOpen: false,
			resizable: false,
			height: 120,
			width: 330,
			modal: true,
			open: function(){
			},
			buttons: {
				"Nein": function(){
					$( "#assignhospizvereinusers" ).dialog('close');
				},
				"Ja": function(){
					$('#sethospizverein').dialog('open');
					$( "#assignhospizvereinusers" ).dialog('close');
				}
			}
		});

		$("#column1").sortable({
			handle : 'h2',
			connectWith: '.patientcolumndetails',
			update : function () {
				var order = $('#column1').sortable('serialize');
				jQuery.get("patient/patientboxorder?col=1&"+order);
			}
		}) ;
		$("#column2").sortable({
			handle : 'h2',
			connectWith: '.patientcolumndetails',
			update : function () {
				var order = $('#column2').sortable('serialize');
				jQuery.get("patient/patientboxorder?col=2&"+order);
			}
		}) ;

		if ($("#wunsch-13").is(":checked")){
			$("#wmorediv").show("slow");
		} else {
			$("#wmorediv").css("display","none");
		}

		$("#wunsch-13").click(function(){
			if ($("#wunsch-13").is(":checked")){
				//show the hidden div
				$("#wmorediv").show("slow");
			} else {
				//otherwise, hide it
				$("#wmorediv").hide("fast");
				$("#wmore").val(""); // we set this just for appearence, the magic is in stammdatenerweitert

			}
		});
		if ($("#kunstliche-5").is(":checked")){
			$("#kunstlichemorediv").show("slow");
		} else {
			$("#kunstlichemorediv").css("display","none");
		}

		$("#kunstliche-5").click(function(){
			if ($("#kunstliche-5").is(":checked")){
				//show the hidden div
				$("#kunstlichemorediv").show("slow");
			} else {
				//otherwise, hide it
				$("#kunstlichemorediv").hide("fast");
				$("#kunstlichemore").val(""); // we set this just for appearence, the magic is in stammdatenerweitert

			}
		});

		$(".log").click(function(){
			$("#log").contents().find('body').html('');
			var milliseconds = new Date().getTime();
			centerPopup({sr:"patient/patientboxhistory?id=<?php echo $this->pid ?>&boxid="+$(this).attr("id")+"&_"+milliseconds,ht:400,wt:450});
			loadPopup();
		});
		
		

		$( "#approve_visit_block" ).dialog({
					autoOpen: false,
					title:"<?php echo $this->translate('Set date interval'); ?>",
					resizable: false,
					height: 200,
					width: 350,
					modal: true,
					open: function (){
						var approved_type = $("#new_visti_type").val();
						$('#approved_visit').val(approved_type);
						$('#approved_from').val('<?php echo date("d.m.Y"); ?>');
						$('#approved_until').val('');

						if(approved_type == 'p1')
						{
							var datas = "P1 genehmigt";
						}
						else if(approved_type == 'p2')
						{
							var datas = "P2 genehmigt";
						}
						else if(approved_type == 'p3')
						{
							var datas = "P3 genehmigt";
						}

						$('#approved_visit_name').append('<span>'+datas+'</span>');

						$('#approved_from').datepicker({
							dateFormat: 'dd.mm.yy',
							showOn: "both",
							buttonImage: $('#calImg').attr('src'),
							buttonImageOnly: true,
							changeMonth: true,
							changeYear: true,
							maxDate: "<?php echo date('d.m.Y',mktime(0,0,0,date('m'),date('d'),date('Y'))) ?>",
							nextText: '',
							prevText: ''
						});

						$('#approved_until').datepicker({
							dateFormat: 'dd.mm.yy',
							showOn: "both",
							buttonImage: $('#calImg').attr('src'),
							buttonImageOnly: true,
							changeMonth: true,
							changeYear: true,
							nextText: '',
							prevText: ''
						});
					},


					buttons: {
						"<?php echo $this->translate('save'); ?>": function(){

							$('.submitform').addClass("inactive_button");
							$('.submitform').attr('disabled',true);
							$(".ui-button:first").addClass("ui-state-disabled").attr("disabled", true).addClass("ui-state-disabled").next("button").attr("disabled", true);

							if($('#approved_from').val() == '')
							{
								alert('<?php echo $this->translate("please provide the start date"); ?>')
								$('.submitform').removeClass("inactive_button");
								$('.submitform').attr('disabled',false);
								$(".ui-button:first").attr("disabled", false).addClass("ui-state-disabled").next("button").attr("disabled", false).addClass("ui-state-disabled");

								return false;
							}

							//check for overlapping START
							$.ajax({
								type: 'POST',
								url: '<?php echo APP_BASE; ?>ajax/approvedtypesoverlapping?id=<?php echo $_REQUEST['id']; ?>',
								data:
								{
									start_date: $('#approved_from').val(),
									end_date: $('#approved_until').val()
								},

								success:function(data)
								{
									var pavtdata = jQuery.parseJSON(data);

									if(pavtdata.interval_incorrect == 1)
									{
										$('.submitform').removeClass("inactive_button");
										$('.submitform').attr('disabled',false);
										$(".ui-button:first").attr("disabled", false).addClass("ui-state-disabled").next("button").attr("disabled", false).addClass("ui-state-disabled");

										alert('<?php echo $this->translate('end date must be greater than start date'); ?>')

										return false;
									}
									else if(pavtdata.intersected == 1)
									{

										$('.submitform').removeClass("inactive_button");
										$('.submitform').attr('disabled',false);
										$(".ui-button:first").attr("disabled", false).addClass("ui-state-disabled").next("button").attr("disabled", false).addClass("ui-state-disabled");

										$('#approve_visit_overlapped').dialog('open');
										return false;
									}
									else
									{
										if ( ! checkclientchanged()) {
											return false; 
										}
								    	$('#error_div_edit').html('');
										$('#approved_visits_type').submit();
									}
								}
							});

						},


						"<?php echo $this->translate('cancel'); ?>": function(){
							$( "#approve_visit_block" ).dialog('close');

							var old_visti_type = $('#old_visti_type').val();
							$('#'+old_visti_type+'_approved').attr('checked', true);

						}
					},

					create:function () {
				        $(this).closest(".ui-dialog")
			            .find(".ui-button:first") // the first button
			            .addClass("submitform");
					},


		   			close:function () {
				    	$('.submitform').attr('disabled',false),
						 $(".ui-button:first").attr("disabled", false)
						 .removeClass("ui-state-disabled").next("button").attr("disabled", false)
						 .removeClass("ui-state-disabled");

				    	$('#approved_visit_name span').remove();
					}
				});

				$('.visit_type_approved').live('click', function(){
					var new_value = $(this).val();
					var selected_value = $('#old_visti_type').val();

					if ($('#'+new_value+'_approved').is(":checked") && new_value != selected_value){

						$('#new_visti_type').val(new_value);
						$('#approve_visit_block').dialog('open');

					}
				});

				//edit pavt
				$( "#approve_visit_block_edit" ).dialog({
					autoOpen: false,
					title:'<?php echo $this->translate('editpatientarticle'); ?>',
					resizable: false,
					height: 200,
					width: 350,
					modal: true,
					open: function (){

						$('#pavt_edit_start').datepicker({
							dateFormat: 'dd.mm.yy',
							showOn: "both",
							buttonImage: $('#calImg').attr('src'),
							buttonImageOnly: true,
							changeMonth: true,
							changeYear: true,
							maxDate: "<?php echo date('d.m.Y',mktime(0,0,0,date('m'),date('d'),date('Y'))) ?>",
							nextText: '',
							prevText: ''
						});
						$('#pavt_edit_end').datepicker({
							dateFormat: 'dd.mm.yy',
							showOn: "both",
							buttonImage: $('#calImg').attr('src'),
							buttonImageOnly: true,
							changeMonth: true,
							changeYear: true,
							nextText: '',
							prevText: ''
						});
						$('#error_div_edit').html('');
					},
					buttons: {
						"<?php echo $this->translate('edit'); ?>": function(){


							$('.submitform').addClass("inactive_button");
							$('.submitform').attr('disabled',true);
							$(".ui-button:first").addClass("ui-state-disabled").attr("disabled", true).addClass("ui-state-disabled").next("button").attr("disabled", true);

							if($('#pavt_edit_start').val() == '')
							{

								$('.submitform').removeClass("inactive_button");
								$('.submitform').attr('disabled',false);
								$(".ui-button:first").attr("disabled", false).addClass("ui-state-disabled").next("button").attr("disabled", false).addClass("ui-state-disabled");

								alert('<?php echo $this->translate('please provide the start date'); ?>')
								return false;
							}


							//check for pavt overlapping START
							$.ajax({
								type: 'POST',
								url: '<?php echo APP_BASE; ?>ajax/approvedtypesoverlapping?id=<?php echo $_REQUEST['id']; ?>',
								data: {
									start_date: $('#pavt_edit_start').val(),
									end_date: $('#pavt_edit_end').val(),
									exclude_id: $('#pavt_edit_id').val()
								},

								success:function(data)
								{
									var pavt_edt = jQuery.parseJSON(data);

									if(pavt_edt.intersected == 1)
									{
										$('.submitform').removeClass("inactive_button");
										$('.submitform').attr('disabled',false);
										$(".ui-button:first").attr("disabled", false).addClass("ui-state-disabled").next("button").attr("disabled", false).addClass("ui-state-disabled");

										$('#approve_visit_overlapped').dialog('open');

									}
									else if(pavt_edt.interval_incorrect == 1)
									{

										$('.submitform').removeClass("inactive_button");
										$('.submitform').attr('disabled',false);
										$(".ui-button:first").attr("disabled", false).addClass("ui-state-disabled").next("button").attr("disabled", false).addClass("ui-state-disabled");

										alert('<?php echo $this->translate('end date must be greater than start date'); ?>')
										return false;
									}
									else
									{
										if ( ! checkclientchanged()) {
											return false; 
										}
										$('.submitform').addClass("inactive_button");
										$('.submitform').attr('disabled',true);
										$(".ui-button:first").addClass("ui-state-disabled").attr("disabled", true).addClass("ui-state-disabled").next("button").attr("disabled", true);


										$('#edit_approved_visits_type').submit();
									}
								}
							});
						},

						"<?php echo $this->translate('cancel'); ?>": function(){
							$( "#approve_visit_block_edit" ).dialog('close');
							$('#error_div_edit').html('');
						}
					},
					create:function () {
						$(this).closest(".ui-dialog").find(".ui-button:first").addClass("submitform");
					},

					close:function () {
						$('.submitform').attr('disabled',false),
					    $(".ui-button:first").attr("disabled", false).removeClass("ui-state-disabled").next("button").attr("disabled", false).removeClass("ui-state-disabled");
					}
				});

				$('.edit_pavt').live('click', function(){
					var curent_id = $(this).attr('alt');

					$('#pavt_edit_id').val(curent_id);
					$('#pavt_edit_start').val($('#pavt_start_'+curent_id).val());
					$('#pavt_edit_end').val($('#pavt_end_'+curent_id).val());

					$('#approve_visit_block_edit').dialog('open');
				});



				//delete pavt - patient approved visits type
				$( "#pavt_delete" ).dialog({
					autoOpen: false,
					title:'Delete Appreved visits type',
					resizable: false,
					height: 200,
					width: 350,
					modal: true,
					buttons: {
						"<?php echo $this->translate('delete'); ?>": function(){
							if (! checkclientchanged()) {
								return false;
							}
							$('.submitform').attr('disabled',true);
							 $(".ui-button:first").attr("disabled", true)
							 .addClass("ui-state-disabled").next("button").attr("disabled", true)
							 .addClass("ui-state-disabled");

							$('#del_pavt').submit();
						},
						"<?php echo $this->translate('cancel'); ?>": function(){
							$( "#pavt_delete" ).dialog('close');
						}
					},create:function () {
				        $(this).closest(".ui-dialog")
			            .find(".ui-button:first") // the first button
			            .addClass("submitform");
			    },
			   	   close:function () {
			    	$('.submitform').attr('disabled',false),
					 $(".ui-button:first").attr("disabled", false)
					 .removeClass("ui-state-disabled").next("button").attr("disabled", false)
					 .removeClass("ui-state-disabled");
					$('#del_pavt_id').val("");
			    }
				});


				$('.delete_pavt').live('click', function(){
					var curent_del_id = $(this).attr('alt');
					$('#del_pavt_id').val(curent_del_id);
					$('#pavt_delete').dialog('open');
				});

		(function( $ ){
			$.fn.jaySort= function(prefix, lst) {
				for (var x=0; x<lst.length; x++)
					$(this).append($('#' + prefix + lst[x]));
			};
		})( jQuery );


		$.getJSON('patient/patientgetboxorder?col=1', function(data){
			if(data){
				$('#column1').jaySort('item_', data);
			}

		});
		$.getJSON('patient/patientgetboxorder?col=2', function(data){
			if(data){
				$('#column2').jaySort('item_', data);
			}

		});
	$('.status_sgbv_radio').live('change click', function(){
		if($(this).val() == '5'){
			$('#approve_date_sgbv').show();
		} else {
			$('#approve_date_sgbv').hide();
		}

	});

	$('.sgbv_show_actions').live('click', function(){
		var row_id = $(this).attr('rel');
		$('#sgbv_actions_'+row_id+'').toggle()
	});

	$('#sgbv_quick_approve').dialog({
		autoOpen:false,
		modal: true,
		title: '<?php echo $this->translate('quick_status_change'); ?>',
		width: '345',
		height: '250',
		resizable: false,
		open: function() {
			$('#approve_date_sgbv_txt').datepicker({
				dateFormat: 'dd.mm.yy',
				showOn: "both",
				buttonImage: $('#calImg').attr('src'),
				buttonImageOnly: true,
				changeMonth: true,
				changeYear: true,
				nextText: '',
				prevText: ''
			});
		},
		buttons: {
			"<?php echo $this->translate('save'); ?>": function() {
				$( this ).dialog( "close" );
				$('#quick_status_change').submit();
			},
			"<?php echo $this->translate('cancel'); ?>": function() {
				$( this ).dialog( "close" );
			}
		}
	});


	$('.quick_approve').live('click', function(){
		$('#sgbv_quick_approve').dialog('open');

		$('#sgbv_id_edit').val($(this).attr('rel'));

		var status = $('#status_'+$(this).attr('rel')).val();
		var approve_date = $('#approve_'+$(this).attr('rel')).val();
		$('#sgbv_'+status).attr('checked', true);
		$('#approve_date_sgbv_txt').val(approve_date);
		$('#sgbv_initial_status').val(status);

		if(status == '5'){
			$('#approve_date_sgbv').show();
		} else {
			$('#approve_date_sgbv').hide();
		}
	});
	
	

	$('#sgbv_delete_block').dialog({
		autoOpen:false,
		modal: true,
		title: '<?php echo $this->translate('sgbv_delete'); ?>',
		width: '345',
		height: '150',
		resizable: false,
		buttons: {
			"<?php echo $this->translate('delete'); ?>": function() {
				if (! checkclientchanged()) {
					return false;
				}
				$( this ).dialog( "close" );
				$('#delete_sgbv_form').submit();
			},
			"<?php echo $this->translate('cancel'); ?>": function() {
				$( this ).dialog( "close" );
			}
		}
	});

	$('#sgbv_delete').live('click', function(){
		$('#sgbv_delete_block').dialog('open');
		$('#del_sgbv_id').val($(this).attr('rel'));
	});
	
	
	
	
	});

	function ConfirmDeletion(contact_id)
	{
		   jConfirm('<?php echo $this->translate('confirmdeleterecord'); ?>', '', function(r) {
				if(r)
				{
					location.href = "<?php echo APP_BASE ?>patient/editcontactperson?decid="+contact_id+"&id=<?php echo $this->pid?>";
				}
		});
		return false;
	}
	
	//add this in a js that is only included if module or box
	var tourplan_users_fetched = false;
	var tourplan_selectbox = {};
	
	function tourplan_fetch_users_callback(response){

				if (response === null || typeof response !== 'object'){
					return false;
				}

		
				tourplan_users_fetched = true;
				var text = "<select name='tourenplan_select' class='tourenplan_select'>" + "\n";
					text += "<option value='0' data-type='none' selected><?php echo $this->translate('please select');?></option>";
				
				if (response.grups != undefined)
				$.each(response.grups, function(i, value) {			
					$disabled_option = "";
					if (value.groupname == null){ value.groupname  = "<?php echo $this->translate('no_group'); ?>"; $disabled_option = "disabled";} 
					text += '<option class="group-result group-main" value="' + i + '" data-type="grups" '+$disabled_option+'>' + value.groupname + '</option>'+ "\n";
					$.each(value, function(k, v) {
						if(k!="groupname"){
							text += '<option class="opt" value="' + k + '" data-type="user">' + v + '</option>' + "\n";
						}
					});
				});
								
				var pseudo1 = "";
				var pseudo2 = "";		
				if (response.pseudogrups != undefined)
				$.each(response.pseudogrups, function(i, value) {										
					if (i=="groupname"){ 
						pseudo1 = '<option class="group-result group-main" value="pseudogrups" data-type="pseudogrups" disabled>' + value + '</option>'+ "\n";
					}
					else{
						pseudo2 += '<option class="opt" value="' + i + '" data-type="pseudogrups">' + value + '</option>' + "\n";
					}									
				});
				if (pseudo2!=""){
					text += pseudo1 + pseudo2;
				}		
				
				text += "</select>";
				tourplan_selectbox = $.parseHTML( text );	
	}//function tourplan_fetch_users_callback
	
	function tourplan_fetch_users(){
		$.ajax({
			dataType: "json",
			url : appbase+'user/getjsondatav2',
			success : function(response) {		
				tourplan_fetch_users_callback(response);
			},
			error : function(){
				alert("please refresh page or contact admin");
			}
		});
	}//function tourplan_fetch_users
	
	var row_counter = 0;
	function assign_tourenplan( visitor_id,  visitor_type,  days, is_disabled){
		
		row_counter++;
		
		var add_day = [];
		var input_disabled =  "";
		if (is_disabled =="1")  input_disabled =  " disabled=true ";
		
		add_day[1] = add_day[2] = add_day[3] = add_day[4] = add_day[5]= add_day[6] = add_day[7] = '<input type="text" style="width:18px; padding:1px; height: 26px;" '+input_disabled+'>';
		
		if ( days !== null && days !== undefined  && typeof days === 'object'){
			$.each(days, function(i, v){
				input_disabled = "";
				if (v != "0" && v!= ""){
					if (is_disabled =="1")  input_disabled =  " disabled=true ";
				
					add_day[i] = '<input value="'+v+'" type="text" style="width:18px; padding:1px; height: 26px;" '+input_disabled+'>';
				}
			});
		}
		

		var a_delete ='<a onclick="delete_tourenplan(\''+row_counter+'\')" href="javascript:void(0)" class="delete_row" ><img src="<?php echo RES_FILE_PATH;  ?>/images/action_delete.png" /></a>';
		
		$('#table_visits_per_day tbody').append('<tr id="visits_row_'+row_counter+'" data-row_counter="'+row_counter+'">'
												+'<td id="visits_select_'+row_counter+'"></td>'
												+'<td class="x_cross" data-day="1" title="<?php echo $this->translate('Monday') . $this->translate('visits_per_day');?>">'+ add_day[1] +'</td>'
												+'<td class="x_cross" data-day="2" title="<?php echo $this->translate('Tuesday') . $this->translate('visits_per_day');?>">'+ add_day[2] +'</td>'
												+'<td class="x_cross" data-day="3" title="<?php echo $this->translate('Wednesday') . $this->translate('visits_per_day');?>">'+ add_day[3] +'</td>'
												+'<td class="x_cross" data-day="4" title="<?php echo $this->translate('Thursday') . $this->translate('visits_per_day');?>">'+ add_day[4] +'</td>'
												+'<td class="x_cross" data-day="5" title="<?php echo $this->translate('Friday') . $this->translate('visits_per_day');?>">'+ add_day[5] +'</td>'
												+'<td class="x_cross" data-day="6" title="<?php echo $this->translate('Saturday') . $this->translate('visits_per_day');?>">'+ add_day[6] +'</td>'
												+'<td class="x_cross" data-day="7" title="<?php echo $this->translate('Sunday') . $this->translate('visits_per_day');?>">'+ add_day[7] +'</td>'
												+'<td title="<?php echo $this->translate('candelete')?>">' + a_delete + '</td>'
												+'</tr>');
		
		var clone_select = $(tourplan_selectbox).clone().prop('id', 'visits_selectbox_'+row_counter );
		
		$('#table_visits_per_day #visits_select_'+row_counter).append( clone_select );	
		if(visitor_id != "0" && visitor_type != "0") {
			$('#visits_selectbox_'+row_counter +' option[value="'+visitor_id+'"][data-type="'+visitor_type+'"]').attr('selected',true);
			
			$('#visits_selectbox_'+row_counter )
				.attr('data-lastSelected', visitor_id)
				.attr('data-lastType', visitor_type);
			
			if (is_disabled == "1"){
				$('#visits_selectbox_'+row_counter ).attr('disabled', 'disabled');
				$('#table_visits_per_day #visits_select_'+row_counter).append( "<br><span><?php echo $this->translate('user_cantvisit_or_inactive_label'); ?></span>" );
			}
		}
		
		//remove users that at this moment are disabled
		if (is_disabled != "1" && visits_settings_disabled_users.length >0 )
		{
			$.each(visits_settings_disabled_users, function(i,v){
				$('#visits_selectbox_'+row_counter+ " option[value='"+v+"']" ).remove();
			});		
		}
		
		
		$('#visits_selectbox_'+row_counter)
		.chosen({
			/*placeholder_text_single: "<?php echo $this->translate('please select'); ?>",*/
			multiple:0,
			inherit_select_classes: 1,
			"search_contains": true,
			/*no_results_text: "<?php echo $this->translate('noresultfound'); ?>",*/
			width: "145px"
		})
		.change(function(e, h){

			var newVal = $(this).val();
			var newId = $(this).attr('id');
			var data_type = $('option:selected', this).attr('data-type');
			
			var lastSelected =  $(this).attr('data-lastSelected');
			var lastType =  $(this).attr('data-lastType');
			
			if (lastSelected == undefined) {
				lastSelected = 0;
				lastType = "none";
				$(this).attr('data-lastSelected' , 0);
				$(this).attr('data-lastType' , 'none');
			}
			
			if (newVal!="0" )
			$("select[name='tourenplan_select']").each( function() {
				if ( $(this).attr('id') == newId) return true;			
				if ($(this).val() == newVal){
					newVal = lastSelected;
					return false;
				}
			});			
			
			if ( newVal == lastSelected ){
				//change back
				$('option[value="'+lastSelected+'"][data-type="'+lastType+'"]', this).attr('selected',true).trigger('chosen:updated');				
			}else{
				$(this).attr('data-lastSelected', newVal);
				$(this).attr('data-lastType', data_type);
				

				//make a post with new values
				//get all days
				var visit = {};
				var data_day = "";
				var visit_enabled = "";	
				var cnt = 0;
				$(".x_cross", $( this ).closest('tr')).each(function(){
					data_day = $( this ).attr("data-day");
					visit_enabled = $("input", this ) .val();
					visit[data_day] = visit_enabled;
					if (visit_enabled !="" && visit_enabled!="0")  cnt = 1; 
				});
				if(cnt > 0 ){
					//make the call
					var new_post = {};
					new_post['visit'] = visit;
					new_post['data_type'] = data_type;
					new_post['selectbox'] = newVal;
						
					if(lastSelected != 0){
						//set as isdeleted the old
						//oncomplete of this VISITOR-delete, perform assign of ne user	
						visits_ajax(0, lastType , lastSelected , 1 , new_post, row_counter);	
					}else{
												
						visits_ajax(visit, data_type , newVal , 0, null, row_counter);	
					}
					$("#visit_duration_table").show();
				}
				
				
			}		
		});		
		
		
		$("#visits_row_"+row_counter+ " .x_cross input")
			.focus(function() {
				$(this).attr("data-oldvalue", $(this).val());		
			})
			.blur(function() {

				var input_value =  $( this ).val();
				if (isNaN(input_value)) {
					$( this ).val($(this).attr("data-oldvalue"));
					return false;
				}
				//old value is the same
				if ( $(this).attr("data-oldvalue") == input_value ) return false;
				//no user selected			
				var data_type = $("select option:selected",$( this ).closest("tr")).attr('data-type');
				if (data_type == "none") return false;
				
				var selectbox = $("select", $( this ).closest("tr")).val();
				
				var visit_enabled = "";
				var data_day = $( this ).closest("td").attr("data-day");
				var visit = {};		
			
				visit[data_day] = input_value;
				
				var this_input_row_counter = $( this ).closest("tr").data('row_counter');
				visits_ajax(visit, data_type , selectbox , 0 , null, this_input_row_counter);	
				
				//show the visit duration table
				$("#visit_duration_table").show();
	   		});
		
		
	}//function assign_tourenplan
	
	
	function visits_ajax(visit, data_type , selectbox, isdeleted, new_post, row_counter){
		
		if (selectbox == "0") return false;
		if (! checkclientchanged()) {
			return false;
		}
		if (new_post === null || isdeleted == 1){
			$("#table_visits_per_day #visits_row_"+row_counter)
				.after("<tr class='visits_ajax_loading'><td colspan='9'>&nbsp;<?php echo $this->translate('loadingpleasewait');?></td></tr>")
				.find('*')
				.attr("disabled", true);
		}
			
		var nice_user = $("option[data-type='"+data_type+"'][value='"+selectbox+"']" , tourplan_selectbox).text();

		$.ajax({
			dataType: "json",
			method: "POST",
			type: "POST",
			url: appbase+'patient/updatepatientinfo?modname=VisitsSettings&patid=<?php echo $this->pat_enc_id; ?>',
			data: {
				'visit': visit,
				'visitor_type': data_type,
				'visitor_id': selectbox,
				'patid': "<?php echo $this->pat_enc_id; ?>",
				'id': "<?php echo $_REQUEST['id']; ?>",
				'modname': "VisitsSettings",
				'isdeleted': isdeleted,
				'formid': "grow43",
				'nice_user' : nice_user,
			},
			success:function(data){
				if (new_post!== null && typeof(new_post) == 'object'){
					
					$(".visits_ajax_loading").remove();
					visits_ajax(new_post.visit , new_post.data_type , new_post.selectbox , 0, null, row_counter);

				}else{
					$(".visits_ajax_loading").remove();
					$("#table_visits_per_day #visits_row_"+row_counter)
					.find('*')
					.attr("disabled", false);
				}
				
			},
			error : function(){}
			});
	}//function visits_ajax

	
	function delete_tourenplan(row_counter){

		var visitor_id = $('#visits_selectbox_'+row_counter).val();
		var visitor_type = $('#visits_selectbox_'+row_counter+' option:selected').attr('data-type');
			
		
		visits_ajax(0, visitor_type , visitor_id , 1);	
		$("#visits_row_"+row_counter).remove();
	
	}
	
	
<?php if ($this->displayvisitssettings == 1): ?>
/* set saved touren grow43*/
	$(document).ready(function(){
	
	<?php

		if( is_array($this->pat_visits_settings_visiting_users) && count($this->pat_visits_settings_visiting_users) > 0){
			echo "tourplan_fetch_users_callback( ". json_encode($this->pat_visits_settings_visiting_users)." );\r\n";
		}else{
			echo "tourplan_fetch_users();\r\n";
		}

		if( is_array($this->pat_visits_settings) && count($this->pat_visits_settings) > 0  ){		
			foreach($this->pat_visits_settings as $visitor_id => $types){
				foreach( $types as $visitor_type => $days ){
					
					if ($visitor_type == 'is_disabled') continue;
					$is_disabled = 0;
					if (isset($types['is_disabled']) && $types['is_disabled'] =="1") {
						//set this uservisit_plan as disabled and allow to deleteit
						$is_disabled = "1";
					}
					echo "assign_tourenplan('" . $visitor_id . "', '" . $visitor_type . "'," . json_encode($days) . " , " . $is_disabled . "); \r\n"; 
				}	
			}
			echo '$("#visit_duration_table").show();'."\r\n";
		}
	?>
	});
	
<?php endif; ?>	
	
	function prefill_contact_person() {
		<?php if (!empty($this->patientMasterData_array)) : ?>
			$( "#cnt_street1" ).val("<?php echo $this->escape($this->patientMasterData_array["street1"]); ?>");
			$( "#cnt_zip" ).val("<?php echo $this->escape($this->patientMasterData_array["zip"]); ?>");
			$( "#cnt_city" ).val("<?php echo $this->escape($this->patientMasterData_array["city"]); ?>");		
		<?php endif; ?>
		return false;
	}

	function orientation_changed(_this) {

	    if (_this.value == "communication restricted") {
	    	if (_this.checked) {
	    		 $("div.group_communication" , $(_this).parents('div.patientdragbox-content')).show();
	    	} else {
	            $("div.group_communication" , $(_this).parents('div.patientdragbox-content')).hide().find('input').each(function(){
	                $(this).prop( "checked", false );
	            });
	        }
	    }
	}
</script>

<script type="text/javascript"
src="<?php echo RES_FILE_PATH; ?>/javascript/livesearch/referredby.js"></script>

<style>
	

	
	#table_visits_per_day .x_cross{
		
		padding: 0;
		margin:0;
		font-family: 'Helvetica', 'Arial', sans-serif;
    font-size: 22px;
		line-height: 30px;
    font-weight: bold;
    text-align: center;
	}
.ui-accordion {
    width: 96%;
}
.ui-accordion .ui-accordion-content-active {
	height: auto!important;
	background: #fff;
}
.ui-accordion .ui-accordion-header{
	height: 20px;
	background: #B5BFD5;
	color:#20396B;
	border-color: #B5BFD5;
}
.accordion span.accordion_span_name {
	height: 27px;
	margin-left: 30px;
	font-weight: 400;
	font-size: 12px;
	line-height: 20px;
	color: #000;

}
.nonaccordion span.accordion_span_name {
	color: #000;
	font-size: 12px;
}

</style>
<div style="display: none;"><img id="calImg" src="<?php echo RES_FILE_PATH; ?>/images/calendar.png" alt="Popup" class="trigger"></div>
<?php echo $this->patientinfo ?>
<?php echo $this->tabmenus ?>
<div class="tab_container" id="patient_details_page">
	<div id="PatientDtls">
		<div class="err"><?php echo $this->error_message ?></div>
		<div id="PtDtls_left_conatiner"><!--daniel erster-->
			<div class="clearer"></div>
			
			<!-- ########### BOX 1: Patient details ############ -->
			<?php if ($this->displaypatientdet == 1) { ?>
				<div class="dragboxpatientdetails" id="block01">
					<h2 class=""><?php echo $this->translate('PtDetails_Patient'); ?></h2>
					<div style="display: none;" id="grow14" class="patientdragbox-content">

						<div id="PtDetails_first" class="dtbox">
							<div id="PtDtls_patient_edit" class="PatAndrer_link"><a href="patient/patientedit?id=<?php echo $this->pid ?>">[<?php echo $this->translate('update'); ?>]</a></div>
							<table>
								<tr>
									<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('firstname'); ?></td>
									<td class="patcontactscol2" valign="top"><?php echo $this->first_name ?></td>
								</tr>
								<tr>
									<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('lastname'); ?></td>
									<td class="patcontactscol2" valign="top"><?php echo $this->last_name ?></td>
								</tr>
								<tr>
									<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('street'); ?></td>
									<td class="patcontactscol2" valign="top"><?php echo $this->street1 ?></td>
								</tr>
								<tr>
									<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?>, <?php echo $this->translate('city'); ?></td>
									<td class="patcontactscol2" valign="top"><?php echo $this->zip ?> <?php echo $this->city ?></td>
								</tr>
								<tr>
									<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('birthd'); ?></td>
									<td class="patcontactscol2" valign="top"><?php echo $this->birthd ?></td>
								</tr>
								<tr>
									<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('birthname'); ?></td>
									<td class="patcontactscol2" valign="top"><?php echo $this->birth_name ?></td>
								</tr>
								<tr>
									<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('birthcity'); ?></td>
									<td class="patcontactscol2" valign="top"><?php echo $this->birth_city ?></td>
								</tr>
								<tr>
									<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('sex'); ?></td>
									<td class="patcontactscol2" valign="top"><?php echo $this->translate(strtolower($this->sex)) ?></td>
								</tr>
								<?php if ($this->show_height_detail == 1)	:?>
								<tr>
									<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('height_edit'); ?></td>
									<td class="patcontactscol2" valign="top"><?php echo $this->height ?></td>
								</tr>
								<?php endif;?>
								<tr>
									<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone'); ?></td>
									<td class="patcontactscol2" valign="top"><?php echo $this->phone ?></td>
								</tr>
								<tr>
									<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('mobile'); ?></td>
									<td class="patcontactscol2" valign="top"><?php echo $this->mobile ?></td>
								</tr>
								<tr>
									<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
									<!-- Maria:: Migration CISPC to ISPC 20.08.2020 -->
									<td class="patcontactscol2" valign="top">
										<?php if( strpos($this->email, '@') > 0): ?>
										<?php //if not encrypted, otherwise has no sense // ISPC-2633: Clickable e-mail-link, elena, 14.08.2020 ?>
										<a href="mailto:<?php echo $this->email ?>"><?php echo $this->email ?></a>
										<?php else:?>
										<?php echo $this->email ?>
										<?php endif;?>

									</td>
								</tr>
								<tr>
									<td class="colbold patcontactscol1" valign="top"></td>
									<td class="patcontactscol2" valign="top"></td>
								</tr>
							</table>
						 </div>
						<div class="clearer"></div>
					</div>
				</div>
			<?php } ?> 
			
			
			<!-- ###########  BOX 2a: Patient history ############ -->
			<?php if ($this->displaypatienthistory == 1){ ?>
				<div class="dragboxpatientdetails" id="block01">
					<h2 class=""><?php echo $this->translate('patienthistory'); ?></h2>
					<div style="display: none;" id="grow35" class="patientdragbox-content">
						<div class="curent_status_info">
							<b><?php echo $this->translate('current_status:'); ?></b>
							<?php if($this->isstandby):  ?>
								<span id="fdoc_message"> <?php echo $this->translate('standby'); ?></span>
							<?php elseif($this->isstandbydelete):  ?>
								<span id="fdoc_message"> <?php echo $this->translate('standby_deleted'); ?></span>
							<?php elseif($this->isdischarged == "1"):  ?>
								<span id="fdoc_message black"> <?php echo $this->translate('isdischarged'); ?></span>
							<?php else:  ?>
								<span id="fdoc_message black"> <?php echo $this->translate('isactive'); ?></span>
							<?php endif;  ?>
						</div>
						<div id="PtDetails_first" class="dtbox">
						
						
						
						<?php if($this->display_edit_history == "1" ):?>
							<!-- ###########  BOX 2a.1:  Patient history - with delete options ############ -->
							<?php if($this->allow_change == "1"):?>
								<table border="1">
									<tr>
										<td class="colbold patcontactscol1" style="width: 100px;" valign="top"><?php echo $this->translate('fall_type'); ?></td>
										<td class="colbold patcontactscol1" style="width: 110px;"  valign="top"><?php echo $this->translate('admissiondate'); ?></td>
										<td class="colbold patcontactscol1" style="width: 110px;"  valign="top"><?php echo $this->translate('dischargedate'); ?></td>
										<td valign="top"></td>
									</tr>
									
									<?php 
										$patient_falls = $this->patient_falls;
									$patient_adm_history = $this->patient_adm_history;
									$patient_history_full = $this->patient_history_full;
									
									if (end($patient_adm_history) == 1)
									{
										$last_adm_date = array_pop(array_keys($patient_adm_history));
									}
									else
									{
										$ar_keys = array_keys($patient_adm_history);
										end($ar_keys);
										prev($ar_keys);
										$last_adm_date = current($ar_keys);
									}

									if (end($patient_adm_history) == 2) {
										$last_discharge_date = array_pop(array_keys($patient_adm_history));
									}
								?>
									
									<?php foreach($patient_falls as $fall_nr => $fall_dates):?>
										<tr id="fall_<?php echo $fall_nr;?>">
											<?php foreach($fall_dates as $history_type => $history_date):?>
												<? 
												//echo $last_adm_date;
												$fald = 0;

												if($history_type == "1") {

													if($history_date == $last_adm_date) {
														$fald = 1;
													}

													if(isset($patient_falls[$fall_nr - 1]) && $patient_falls[$fall_nr - 1][0] != "discharge" ){
														if(isset($patient_falls[$fall_nr - 1]['2'])) {
															$previous_date = $patient_falls[$fall_nr - 1]['2']; // previous discharge date
														} else {
															$previous_date = '1900-01-01 00:00:00';
														}
													} elseif(isset($patient_falls[$fall_nr - 1]) && $patient_falls[$fall_nr - 1][0] == "discharge" ){
														if(isset($patient_falls[$fall_nr - 2]['2'])) {
															$previous_date = $patient_falls[$fall_nr - 2]['2']; // previous discharge date
														} else {
															$previous_date = '1900-01-01 00:00:00';
														}
													}


													if(isset($patient_falls[$fall_nr]['2'])) {
														$next_date =  $patient_falls[$fall_nr]['2']; // current discharge date
													} else {
														$next_date = date('Y-m-d ').'23:59:59';
													}

												} elseif($history_type == "2") {

													if($history_date == $last_discharge_date) {
														$fald = 1;
													}

													$previous_date = $patient_falls[$fall_nr]['1']; // current admission date

													if(isset($patient_falls[$fall_nr+1]) && $patient_falls[$fall_nr+1]['0'] != "discharge" ){
														if(isset($patient_falls[$fall_nr+1]['1'])) {
															$next_date =  $patient_falls[$fall_nr+1]['1']; // next admission date 
														} else {
															$next_date = date('Y-m-d ').'23:59:59';
														}
													} elseif(isset($patient_falls[$fall_nr+1]) && $patient_falls[$fall_nr+1]['0'] == "discharge" ){
														if(isset($patient_falls[$fall_nr+2]['1'])) {
															$next_date =  $patient_falls[$fall_nr+2]['1']; // next admission date 
														} else {
															$next_date = date('Y-m-d ').'23:59:59';
														}
													} 													

		
												} else {
													$period_status = $patient_falls[$fall_nr]['0'];// status 
	
												}


												$edit_string = $history_date.'|'.$history_type.'|'.$fald.'|'.date('d.m.Y', strtotime($history_date)).'|'.date('H:i', strtotime($history_date)).'|'.date('d.m.Y', strtotime($previous_date)).'|'.$previous_date.'|'.date('d.m.Y', strtotime($next_date)).'|'.$next_date.'|'.$period_status;
 
												$edit_string_data = '';
												$edit_string_data .= 'data-current_date_full="'.$history_date.'"'; 
												$edit_string_data .= 'data-date_type="'.$history_type.'"';
												$edit_string_data .= 'data-fald="'.$fald.'"'; 
												$edit_string_data .= 'data-current_date="'.date('d.m.Y', strtotime($history_date)).'"'; 
												$edit_string_data .= 'data-current_date_time="'.date('H:i', strtotime($history_date)).'"';
												$edit_string_data .= 'data-previous_date="'.date('d.m.Y', strtotime($previous_date)).'"'; 
												$edit_string_data .= 'data-previous_date_full="'.$previous_date.'"'; 
												$edit_string_data .= 'data-next_date="'.date('d.m.Y', strtotime($next_date)).'"'; 
												$edit_string_data .= 'data-next_date_full="'.$next_date.'"';
												$edit_string_data .= 'data-period_status="'.$period_status.'"';  
												$edit_string_data .= 'data-fall_nr="'.$fall_nr.'"';  


												
											$allow_remove_date = 0;




											// if fall is the last fall -  delete per date - only last date , and not first admission

											if($fall_nr == count($patient_falls) && $history_date != $this->first_admission_ever){
												//print_R("first");
												if($history_date == $last_adm_date && isset($patient_falls[$fall_nr]['2'])){
													// do not allow deletion for admission if discharge is set -->
													$allow_remove_date = 0;

												} else {

													if($history_date != $patient_falls[$fall_nr]['2']  &&  isset($patient_falls[$fall_nr]['2']))
													{
														$allow_remove_date = 0;
													} else {
														if($period_status == "discharge"){
															$allow_remove_date = 0;
														} else {												
															$allow_remove_date = 1;
			    										}
													}
			    								}
    										} elseif($history_date == $this->first_admission_ever && !isset($patient_falls[$fall_nr]['2']) && $this->isstandbydelete == "1"){
												//print_R("second");
				    							//first admission : move to standby
				    							$allow_remove_date = 0; 
				    														
    										} elseif($history_date == $this->first_admission_ever && !isset($patient_falls[$fall_nr]['2']) && $this->isstandby == "0"){
												//print_R("third");
				    							//first admission : move to standby
				    							$allow_remove_date = 1; 
				    														
    										} elseif($history_date == $this->first_admission_ever && !isset($patient_falls[$fall_nr]['2']) && $this->isstandby == "1"){
												 //print_R("forth");
				    							//first admission : move to standby
				    							$allow_remove_date = 0; 
				    														
    										} elseif($history_date == $last_adm_date && !isset($patient_falls[$fall_nr]['2'])){
												//print_R("fifth");
			    								//last standby admission : move to discharge
			    								$allow_remove_date = 1;
    										} else { 
												//print_R("sixth");
    											$allow_remove_date = 0;
    										}


											?>
											
											
												<? if($history_type == "0" ):?>
													<td class="fall_status_<?php echo $period_status; ?>" >
														<span><?php echo $this->translate('fall_status_'.$period_status); ?></span>
													</td>
												<? elseif($history_date  ):?>
													<td  class="fall_date_<?php echo $fall_nr;?>_<?php echo $history_type; ?> fall_status_<?php echo $period_status; ?>"   >
														<?php if($period_status == "discharge"):?>
															<?php  echo date("d.m.Y H:i",strtotime($history_date)); ?>
														<?php else:?>												
															<a href="javascript:void(0)" class="fall_edit" <?php echo $edit_string_data;?>  ><?php  echo date("d.m.Y H:i",strtotime($history_date)); ?></a>
														<?php endif;?>
	
	
														
														<?php if($allow_remove_date == "1"):?>
															<a href="javascript:void(0)" class="fall_date_delete"  <?php echo $edit_string_data;?>   data-fall_nr="<?php echo $fall_nr?>" data-fall_date="<?php echo $history_date; ?>" data-fall_date_type="<?php echo $history_type; ?>"   ><img border="0" src="<?php echo RES_FILE_PATH;  ?>/images/action_remove.png"></a>													
														<?php else:?>
																
														<?php endif;?>
														
													</td>
												<?php else: ?>
												<?php //elseif(!isset($patient_falls[$fall_nr]['2'])): ?>
													<?php if($history_type != "0"): ?>
														<td>
															-
														</td>
													<?php endif;?>
												<?php endif;?>
											<?php endforeach;?>
											<td>
												<?php  if(count($patient_falls) > "1" && $fall_nr != count($patient_falls)):?>
													<?php if($period_status == "discharge"): ?>
														<!-- do not allaw removal of discharge period -->
													<?php else: ?>
														<?php if(!isset($patient_falls[$fall_nr]['2'])):?>
	
														<?php else: ?>
															<a href="javascript:void(0)" class="fall_delete" data-fall_type="<?php echo $period_status; ?>" data-adm="<?php echo $patient_falls[$fall_nr]['1']; ?>" data-dis="<?php echo $patient_falls[$fall_nr]['2']; ?>" rel="<?php echo $fall_nr; ?>" title="<?php echo $this->translate('delete entire fall!'); ?>"><img border="0" src="<?php echo RES_FILE_PATH;  ?>/images/action_delete.png"></a>
														<?php endif;?>	
													<?php endif;?>	
												<?php endif;?>	
											</td>
										</tr>
									<?php endforeach;?>
								</table>
								 <!-- OLD VERSION -->
								 <table border="1" style="display: none;">
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('admissiondate'); ?></td>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('dischargedate'); ?></td>
										<td valign="top"></td>
									</tr>
									
									<?php 
										$patient_falls = $this->patient_falls;
									$patient_adm_history = $this->patient_adm_history;
									$patient_history_full = $this->patient_history_full;
									
									if (end($patient_adm_history) == 1)
									{
										$last_adm_date = array_pop(array_keys($patient_adm_history));
									}
									else
									{
										$ar_keys = array_keys($patient_adm_history);
										end($ar_keys);
										prev($ar_keys);
										$last_adm_date = current($ar_keys);
									}

									if (end($patient_adm_history) == 2) {
										$last_discharge_date = array_pop(array_keys($patient_adm_history));
									}
								?>
									
									<?php foreach($patient_falls as $fall_nr => $fall_dates):?>
										<tr id="fall_<?php echo $fall_nr;?>">
											<?php foreach($fall_dates as $history_type => $history_date):?>
												<? 
													$fald = 0;

												if($history_type == "1") {

													if($history_date == $last_adm_date) {
														$fald = 1;
													}
													if(isset($patient_falls[$fall_nr - 1]['2'])) {
														$previous_date = $patient_falls[$fall_nr - 1]['2']; // previous discharge date
													} else {
														$previous_date = '1900-01-01 00:00:00';
													}
													if(isset($patient_falls[$fall_nr]['2'])) {
														$next_date =  $patient_falls[$fall_nr]['2']; // current discharge date
													} else {
														$next_date = date('Y-m-d ').'23:59:59';
													}

												} else {

													if($history_date == $last_discharge_date) {
														$fald = 1;
													}

													$previous_date = $patient_falls[$fall_nr]['1']; // current admission date
													if(isset($patient_falls[$fall_nr+1]['1'])) {
														$next_date =  $patient_falls[$fall_nr+1]['1']; // next admission date 
													} else {
														$next_date = date('Y-m-d ').'23:59:59';
													}		
												}

												$edit_string = $history_date.'|'.$history_type.'|'.$fald.'|'.date('d.m.Y', strtotime($history_date)).'|'.date('H:i', strtotime($history_date)).'|'.date('d.m.Y', strtotime($previous_date)).'|'.$previous_date.'|'.date('d.m.Y', strtotime($next_date)).'|'.$next_date;
											?>
											
											
											
												<? if($history_date):?>
													<td class="fall_date_<?php echo $fall_nr;?>_<?php echo $history_type; ?>">
														<a href="javascript:void(0)" class="fall_edit" rel="<?php echo $edit_string; ?>"><?php  echo date("d.m.Y H:i",strtotime($history_date)); ?></a>
														<? // if fall is the last fall -  delete per date - only last date , and not first admission?>
														<?php if($fall_nr == count($patient_falls) && $history_date != $this->first_admission_ever):?>
															<?php if($history_date == $last_adm_date && isset($patient_falls[$fall_nr]['2'])):?>
																<!-- do not allow deletion for admission if discharge is set -->
															<?php else:?>												
																<a href="javascript:void(0)" class="fall_date_delete" rel="<?php echo $edit_string; ?>"  data-fall_nr="<?php echo $fall_nr?>" data-fall_date="<?php echo $history_date; ?>" data-fall_date_type="<?php echo $history_type; ?>"   ><img border="0" src="<?php echo RES_FILE_PATH;  ?>/images/action_remove.png"></a>
															<?php endif;?>
														<?php elseif($history_date == $this->first_admission_ever && !isset($patient_falls[$fall_nr]['2']) && $this->isstandby == "0"):?>
	<!-- 															first admission : move to standby  -->
																<a href="javascript:void(0)" class="fall_date_delete" rel="<?php echo $edit_string; ?>"  data-fall_nr="<?php echo $fall_nr?>" data-fall_date="<?php echo $history_date; ?>" data-fall_date_type="<?php echo $history_type; ?>"   ><img border="0" src="<?php echo RES_FILE_PATH;  ?>/images/action_remove.png"></a>
														<?php endif;?>
													</td>
												<?php else: ?>
												<?php //elseif(!isset($patient_falls[$fall_nr]['2'])): ?>
													<td>
														-
													</td>
												<?php endif;?>
											<?php endforeach;?>
											<td>
												<?php if(count($patient_falls) > "1" && $fall_nr != count($patient_falls)):?>
													<a href="javascript:void(0)" class="fall_delete" data-adm="<?php echo $patient_falls[$fall_nr]['1']; ?>" data-dis="<?php echo $patient_falls[$fall_nr]['2']; ?>" rel="<?php echo $fall_nr; ?>" title="<?php echo $this->translate('delete entire fall!'); ?>"><img border="0" src="<?php echo RES_FILE_PATH;  ?>/images/action_delete.png"></a>
												<?php endif;?>	
											</td>
										</tr>
									<?php endforeach;
								?>
								</table>  
							<?php else:  // NO allow_change?>
								<table border="1">
									<tr>
										<td class="colbold patcontactscol1" style="width: 100px;" valign="top"><?php echo $this->translate('fall_type'); ?></td>
										<td class="colbold patcontactscol1" style="width: 110px;"  valign="top"><?php echo $this->translate('admissiondate'); ?></td>
										<td class="colbold patcontactscol1" style="width: 110px;"  valign="top"><?php echo $this->translate('dischargedate'); ?></td>
										<td valign="top"></td>
									</tr>
								 <?
										$patient_falls = $this->patient_falls;
									$patient_adm_history = $this->patient_adm_history;
									$patient_history_full = $this->patient_history_full;
									
									if (end($patient_adm_history) == 1)
									{
										$last_adm_date = array_pop(array_keys($patient_adm_history));
									}
									else
									{
										$ar_keys = array_keys($patient_adm_history);
										end($ar_keys);
										prev($ar_keys);
										$last_adm_date = current($ar_keys);
									}

									if (end($patient_adm_history) == 2) {
										$last_discharge_date = array_pop(array_keys($patient_adm_history));
									}
								?>
									
									<?php foreach($patient_falls as $fall_nr => $fall_dates):?>
										<tr id="fall_<?php echo $fall_nr;?>">
											<?php foreach($fall_dates as $history_type => $history_date):?>
												<? 
												//echo $last_adm_date;
												$fald = 0;

												if($history_type == "1") {

													if($history_date == $last_adm_date) {
														$fald = 1;
													}

													if(isset($patient_falls[$fall_nr - 1]) && $patient_falls[$fall_nr - 1][0] != "discharge" ){
														if(isset($patient_falls[$fall_nr - 1]['2'])) {
															$previous_date = $patient_falls[$fall_nr - 1]['2']; // previous discharge date
														} else {
															$previous_date = '1900-01-01 00:00:00';
														}
													} elseif(isset($patient_falls[$fall_nr - 1]) && $patient_falls[$fall_nr - 1][0] == "discharge" ){
														if(isset($patient_falls[$fall_nr - 2]['2'])) {
															$previous_date = $patient_falls[$fall_nr - 2]['2']; // previous discharge date
														} else {
															$previous_date = '1900-01-01 00:00:00';
														}
													}


													if(isset($patient_falls[$fall_nr]['2'])) {
														$next_date =  $patient_falls[$fall_nr]['2']; // current discharge date
													} else {
														$next_date = date('Y-m-d ').'23:59:59';
													}

												} elseif($history_type == "2") {

													if($history_date == $last_discharge_date) {
														$fald = 1;
													}

													$previous_date = $patient_falls[$fall_nr]['1']; // current admission date

													if(isset($patient_falls[$fall_nr+1]) && $patient_falls[$fall_nr+1]['0'] != "discharge" ){
														if(isset($patient_falls[$fall_nr+1]['1'])) {
															$next_date =  $patient_falls[$fall_nr+1]['1']; // next admission date 
														} else {
															$next_date = date('Y-m-d ').'23:59:59';
														}
													} elseif(isset($patient_falls[$fall_nr+1]) && $patient_falls[$fall_nr+1]['0'] == "discharge" ){
														if(isset($patient_falls[$fall_nr+2]['1'])) {
															$next_date =  $patient_falls[$fall_nr+2]['1']; // next admission date 
														} else {
															$next_date = date('Y-m-d ').'23:59:59';
														}
													} 													

		
												} else {
													$period_status = $patient_falls[$fall_nr]['0'];// status 
	
												}

												$edit_string = $history_date.'|'.$history_type.'|'.$fald.'|'.date('d.m.Y', strtotime($history_date)).'|'.date('H:i', strtotime($history_date)).'|'.date('d.m.Y', strtotime($previous_date)).'|'.$previous_date.'|'.date('d.m.Y', strtotime($next_date)).'|'.$next_date.'|'.$period_status;

												
											$allow_remove_date = 0;




											// if fall is the last fall -  delete per date - only last date , and not first admission

											if($fall_nr == count($patient_falls) && $history_date != $this->first_admission_ever){
												//print_R("first");
												if($history_date == $last_adm_date && isset($patient_falls[$fall_nr]['2'])){

													// do not allow deletion for admission if discharge is set -->

												} else {
												
													if($period_status == "discharge"){
														$allow_remove_date = 0;
													} else {												
														$allow_remove_date = 1;
			    									}
			    								}
    										} elseif($history_date == $this->first_admission_ever && !isset($patient_falls[$fall_nr]['2']) && $this->isstandby == "0"){
												 //print_R("second");
				    							//first admission : move to standby
				    							$allow_remove_date = 1; 
				    														
    										} elseif($history_date == $this->first_admission_ever && !isset($patient_falls[$fall_nr]['2']) && $this->isstandby == "1"){
												 //print_R("third");
				    							//first admission : move to standby
				    							$allow_remove_date = 0; 
				    														
    										} elseif($history_date == $last_adm_date && !isset($patient_falls[$fall_nr]['2'])){
												 //print_R("forth");
			    								//last standby admission : move to discharge
			    								$allow_remove_date = 1;
    										} else { 
												 //print_R("fifth");
    											$allow_remove_date = 0;
    										}


											?>
											
											
												<? if($history_type == "0" ):?>
													<td class="fall_status_<?php echo $period_status; ?>" >
														<span><?php echo $this->translate('fall_status_'.$period_status); ?></span>
													</td>
												<? elseif($history_date  ):?>
													<td  class="fall_date_<?php echo $fall_nr;?>_<?php echo $history_type; ?> fall_status_<?php echo $period_status; ?>"   >
														<?php if($period_status == "discharge"):?>
															<?php  echo date("d.m.Y H:i",strtotime($history_date)); ?>
														<?php else:?>												
															<?php  echo date("d.m.Y H:i",strtotime($history_date)); ?>
														<?php endif;?>
														
														<?php if($allow_remove_date == "1"):?>
																												
														<?php else:?>
																
														<?php endif;?>
														
													</td>
												<?php else: ?>
												<?php //elseif(!isset($patient_falls[$fall_nr]['2'])): ?>
													<?php if($history_type != "0"): ?>
														<td>
															-
														</td>
													<?php endif;?>
												<?php endif;?>
											<?php endforeach;?>
											<td>
												<?php  if(count($patient_falls) > "1" && $fall_nr != count($patient_falls)):?>
													<?php if($period_status == "discharge"): ?>
														<!-- do not allaw removal of discharge period -->
													<?php else: ?>
														<?php if(!isset($patient_falls[$fall_nr]['2'])):?>
	
														<?php else: ?>
															
														<?php endif;?>	
													<?php endif;?>	
												<?php endif;?>	
											</td>
										</tr>
									<?php endforeach;?>
									
								</table>
							<?php endif; // END allow_change ?>
						<?php else: //  NO  display_edit_history ==  no manage falls?>
							<!-- ###########  BOX 2a.1:  Patient normal history ############ -->
							<table border="1">
									<tr>
										<td class="colbold patcontactscol1" style="width: 100px;" valign="top"><?php echo $this->translate('fall_type'); ?></td>
										<td class="colbold patcontactscol1" style="width: 110px;"  valign="top"><?php echo $this->translate('admissiondate'); ?></td>
										<td class="colbold patcontactscol1" style="width: 110px;"  valign="top"><?php echo $this->translate('dischargedate'); ?></td>
										<td valign="top"></td>
									</tr>
									
									<?php 
										$patient_falls = $this->patient_falls;
									$patient_adm_history = $this->patient_adm_history;
									$patient_history_full = $this->patient_history_full;
									
									if (end($patient_adm_history) == 1)
									{
										$last_adm_date = array_pop(array_keys($patient_adm_history));
									}
									else
									{
										$ar_keys = array_keys($patient_adm_history);
										end($ar_keys);
										prev($ar_keys);
										$last_adm_date = current($ar_keys);
									}

									if (end($patient_adm_history) == 2) {
										$last_discharge_date = array_pop(array_keys($patient_adm_history));
									}
								?>
									
									<?php foreach($patient_falls as $fall_nr => $fall_dates):?>
										<tr id="fall_<?php echo $fall_nr;?>">
											<?php foreach($fall_dates as $history_type => $history_date):?>
												<? 
												//echo $last_adm_date;
												$fald = 0;

												if($history_type == "1") {

													if($history_date == $last_adm_date) {
														$fald = 1;
													}

													if(isset($patient_falls[$fall_nr - 1]) && $patient_falls[$fall_nr - 1][0] != "discharge" ){
														if(isset($patient_falls[$fall_nr - 1]['2'])) {
															$previous_date = $patient_falls[$fall_nr - 1]['2']; // previous discharge date
														} else {
															$previous_date = '1900-01-01 00:00:00';
														}
													} elseif(isset($patient_falls[$fall_nr - 1]) && $patient_falls[$fall_nr - 1][0] == "discharge" ){
														if(isset($patient_falls[$fall_nr - 2]['2'])) {
															$previous_date = $patient_falls[$fall_nr - 2]['2']; // previous discharge date
														} else {
															$previous_date = '1900-01-01 00:00:00';
														}
													}


													if(isset($patient_falls[$fall_nr]['2'])) {
														$next_date =  $patient_falls[$fall_nr]['2']; // current discharge date
													} else {
														$next_date = date('Y-m-d ').'23:59:59';
													}

												} elseif($history_type == "2") {

													if($history_date == $last_discharge_date) {
														$fald = 1;
													}

													$previous_date = $patient_falls[$fall_nr]['1']; // current admission date

													if(isset($patient_falls[$fall_nr+1]) && $patient_falls[$fall_nr+1]['0'] != "discharge" ){
														if(isset($patient_falls[$fall_nr+1]['1'])) {
															$next_date =  $patient_falls[$fall_nr+1]['1']; // next admission date 
														} else {
															$next_date = date('Y-m-d ').'23:59:59';
														}
													} elseif(isset($patient_falls[$fall_nr+1]) && $patient_falls[$fall_nr+1]['0'] == "discharge" ){
														if(isset($patient_falls[$fall_nr+2]['1'])) {
															$next_date =  $patient_falls[$fall_nr+2]['1']; // next admission date 
														} else {
															$next_date = date('Y-m-d ').'23:59:59';
														}
													} 													

		
												} else {
													$period_status = $patient_falls[$fall_nr]['0'];// status 
	
												}


												$edit_string = $history_date.'|'.$history_type.'|'.$fald.'|'.date('d.m.Y', strtotime($history_date)).'|'.date('H:i', strtotime($history_date)).'|'.date('d.m.Y', strtotime($previous_date)).'|'.$previous_date.'|'.date('d.m.Y', strtotime($next_date)).'|'.$next_date.'|'.$period_status;
 
												$edit_string_data = '';
												$edit_string_data .= 'data-current_date_full="'.$history_date.'"'; 
												$edit_string_data .= 'data-date_type="'.$history_type.'"';
												$edit_string_data .= 'data-fald="'.$fald.'"'; 
												$edit_string_data .= 'data-current_date="'.date('d.m.Y', strtotime($history_date)).'"'; 
												$edit_string_data .= 'data-current_date_time="'.date('H:i', strtotime($history_date)).'"';
												$edit_string_data .= 'data-previous_date="'.date('d.m.Y', strtotime($previous_date)).'"'; 
												$edit_string_data .= 'data-previous_date_full="'.$previous_date.'"'; 
												$edit_string_data .= 'data-next_date="'.date('d.m.Y', strtotime($next_date)).'"'; 
												$edit_string_data .= 'data-next_date_full="'.$next_date.'"';
												$edit_string_data .= 'data-period_status="'.$period_status.'"';  
												$edit_string_data .= 'data-fall_nr="'.$fall_nr.'"';  


												
											$allow_remove_date = 0;




											// if fall is the last fall -  delete per date - only last date , and not first admission

											if($fall_nr == count($patient_falls) && $history_date != $this->first_admission_ever){
												//print_R("first");
												if($history_date == $last_adm_date && isset($patient_falls[$fall_nr]['2'])){
													// do not allow deletion for admission if discharge is set -->
													$allow_remove_date = 0;

												} else {

													if($history_date != $patient_falls[$fall_nr]['2']  &&  isset($patient_falls[$fall_nr]['2']))
													{
														$allow_remove_date = 0;
													} else {
														if($period_status == "discharge"){
															$allow_remove_date = 0;
														} else {												
															$allow_remove_date = 1;
			    										}
													}
			    								}
    										} elseif($history_date == $this->first_admission_ever && !isset($patient_falls[$fall_nr]['2']) && $this->isstandbydelete == "1"){
												//print_R("second");
				    							//first admission : move to standby
				    							$allow_remove_date = 0; 
				    														
    										} elseif($history_date == $this->first_admission_ever && !isset($patient_falls[$fall_nr]['2']) && $this->isstandby == "0"){
												//print_R("third");
				    							//first admission : move to standby
				    							$allow_remove_date = 1; 
				    														
    										} elseif($history_date == $this->first_admission_ever && !isset($patient_falls[$fall_nr]['2']) && $this->isstandby == "1"){
												 //print_R("forth");
				    							//first admission : move to standby
				    							$allow_remove_date = 0; 
				    														
    										} elseif($history_date == $last_adm_date && !isset($patient_falls[$fall_nr]['2'])){
												//print_R("fifth");
			    								//last standby admission : move to discharge
			    								$allow_remove_date = 1;
    										} else { 
												//print_R("sixth");
    											$allow_remove_date = 0;
    										}


											?>
											
											
												<? if($history_type == "0" ):?>
													<td class="fall_status_<?php echo $period_status; ?>" >
														<span><?php echo $this->translate('fall_status_'.$period_status); ?></span>
													</td>
												<? elseif($history_date  ):?>
													<td  class="fall_date_<?php echo $fall_nr;?>_<?php echo $history_type; ?> fall_status_<?php echo $period_status; ?>"   >
														<?php if($period_status == "discharge"):?>
															<?php  echo date("d.m.Y H:i",strtotime($history_date)); ?>
														<?php else:?>												
															<a href="javascript:void(0)" class="fall_edit" <?php echo $edit_string_data;?>  ><?php  echo date("d.m.Y H:i",strtotime($history_date)); ?></a>
														<?php endif;?>
	
	
														
														<?php if($allow_remove_date == "1"):?>
																												
														<?php else:?>
																
														<?php endif;?>
														
													</td>
												<?php else: ?>
												<?php //elseif(!isset($patient_falls[$fall_nr]['2'])): ?>
													<?php if($history_type != "0"): ?>
														<td>
															-
														</td>
													<?php endif;?>
												<?php endif;?>
											<?php endforeach;?>
											<td>
												<?php  if(count($patient_falls) > "1" && $fall_nr != count($patient_falls)):?>
													<?php if($period_status == "discharge"): ?>
														<!-- do not allaw removal of discharge period -->
													<?php else: ?>
														<?php if(!isset($patient_falls[$fall_nr]['2'])):?>
	
														<?php else: ?>
															
														<?php endif;?>	
													<?php endif;?>	
												<?php endif;?>	
											</td>
										</tr>
									<?php endforeach;?>
								</table>
						<?php endif; // END display_edit_history == manage falls?>
							
							<br />
 
							<!-- ###########  BOX 2b:  Patient VV history ############ -->
							<?php if ($this->displayvvhistory == 1)	{?>
								<h4 style="float: left;"><?php echo $this->translate('vvhistory'); ?></h4>
								<br />
								<table class="datatable_stammdaten">
									<tr>
										<td colspan="2" style="text-align: right;"></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('begindatedate'); ?></td>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('enddate'); ?></td>
									</tr>
									<tr>
									<?php
									$i = 0;
									$startHistoryDates = $this->startDatesHistory;
									$endHistoryDates = $this->endDatesHistory;
									
									$start_dates_ids = $this->start_dates_ids;
									$end_dates_ids = $this->end_dates_ids;
									
									//get previous end vv
									$patient_adm_history = $this->patient_adm_history;
									if (end($patient_adm_history) == 1)
									{
										$last_adm_date = array_pop(array_keys($patient_adm_history));
									}
									else
									{
										$ar_keys = array_keys($patient_adm_history);
										end($ar_keys);
										prev($ar_keys);
										$last_adm_date = current($ar_keys);
									}

									$history_count = count($startHistoryDates);
									if ($history_count > 0)
									{
										foreach ($startHistoryDates as $key => $historyvv_date)
										{
											echo '</tr><tr>';

											if (empty($endHistoryDates[$key]))
											{

												if (($key + 1) == $history_count)
												{
													$endDate = '<input type="button" name="Ende VV" value="' . $this->translate('end_vollversorgung') . '" id="end_sapv_button" rel="' . date('d.m.Y', strtotime($historyvv_date)) . '|' . date('d.m.Y', time()) . '|' . date('Y-m-d H:i:s', time()) . '" />';
												}
												else
												{
													$endDate = "-";
												}
											}
											else
											{
//												$endDate = date('d.m.Y', strtotime($endHistoryDates[$key]));
												$endDate = 'show_link';
											}
											
											//prev/next for start date
											if($endHistoryDates[($key - 1)])
											{
												$start_previous_date = date('d.m.Y', strtotime($endHistoryDates[($key - 1)]));
												$start_previous_date_full = date('Y-m-d H:i:s', strtotime($endHistoryDates[($key - 1)]));
											}
											else
											{
												$start_previous_date = date('d.m.Y', strtotime($last_adm_date));
												$start_previous_date_full = date('Y-m-d H:i:s', strtotime($last_adm_date));
											}

											if($endHistoryDates[$key])
											{
												$start_next_date = date('d.m.Y', strtotime($endHistoryDates[$key]));
												$start_next_date_full = date('Y-m-d H:i:s', strtotime($endHistoryDates[$key]));
											}
											else
											{
												$start_next_date = date('d.m.Y', time());
												$start_next_date_full = date('Y-m-d H:i:s', time());
											}
											
											//prev/next for end date
											if($startHistoryDates[$key])
											{
												$end_previous_date = date('d.m.Y', strtotime($startHistoryDates[$key]));
												$end_previous_date_full = date('Y-m-d H:i:s', strtotime($startHistoryDates[$key]));
											}
											else
											{
												$end_previous_date = '';
												$end_previous_date_full = '';
											}
											
											if($startHistoryDates[($key+1)])
											{
												$end_next_date = date('d.m.Y', strtotime($startHistoryDates[($key+1)]));
												$end_next_date_full = date('Y-m-d H:i:s', strtotime($startHistoryDates[($key+1)]));
											}
											else
											{
												if($last_discharge_date)
												{
													$end_next_date = $last_discharge_date;
													$end_next_date_full = date('Y-m-d H:i:s', strtotime($last_discharge_date));
												}
												else
												{
													$end_next_date = date('d.m.Y', time());
													$end_next_date_full = date('Y-m-d H:i:s', time());
												}
											}
											
//											curent date(d.m.y) | date_type | fall_id | previous_date | next_date | current_date full | previous_date_full | next_date_full
											$start_str = date('d.m.Y', strtotime($historyvv_date)).'|1|'.$start_dates_ids[$key].'|'.$start_previous_date.'|'.$start_next_date.'|'.$historyvv_date .'|' .$start_previous_date_full. '|'.$start_next_date_full;
											if($endDate == 'show_link')
											{
												$endDate = '<a href="javascript:void(0);" rel="'.date('d.m.Y', strtotime($endHistoryDates[$key])).'|2|'.$end_dates_ids[$key].'|'.$end_previous_date.'|'.$end_next_date.'|'.$endHistoryDates[$key].'|'.$end_previous_date_full.'|'.$end_next_date_full.'" class="vv_fall_edit">'.date('d.m.Y', strtotime($endHistoryDates[$key])).'</a>';
											}

											
											echo '<td><a href="javascript:void(0);" rel="'.$start_str.'" class="vv_fall_edit">' . date('d.m.Y', strtotime($historyvv_date)) . '</a></td><td>' . $endDate . '</td>';
											$i++;
											$last_end_vvhistory_date = $endHistoryDates[$key];
										}
										
										if(count($startHistoryDates) == count($endHistoryDates))
										{
											echo '</tr><tr><td><input type="button" name="Start VV" value="' . $this->translate('start_vollversorgung') . '" id="start_sapv_button" rel="' . date('d.m.Y', strtotime($last_end_vvhistory_date)) . '|' . date('d.m.Y', time()) . '|' . date('Y-m-d H:i:s', time()) . '" /></td><td> &nbsp; </td>';
										}
									}
									else
									{
										echo '<td><input type="button" name="Start VV" value="' . $this->translate('start_vollversorgung') . '" id="start_sapv_button" rel="' . date('d.m.Y', strtotime($last_adm_date)) . '|' . date('d.m.Y', time()) . '|' . date('Y-m-d H:i:s', time()) . '" /></td><td>-</td>';
									}
									?>
									</tr>
								</table>
						<?php } ?></div>
						<div class="clearer"></div>
					</div>
				</div>
			<?php } ?> 
			
			
			<!-- ###########  BOX 3a: Family doctor ############ -->
			<?php if ($this->displayfamilydoc == 1)	{ ?>
				<div class="dragboxpatientdetails" id="block02">
					<?php if ($this->displayspecialists == 1): ?>
					<h2 class=""><?php echo $this->translate('familydoc_specialists'); ?></h2>
					<?php else:?>
					<h2 class=""><?php echo $this->translate('familydoc'); ?></h2>
					<?php endif; ?>
					<div style="display: none;" id="grow9" class="patientdragbox-content">
						<div id="PtDetails_second" class="dtbox">
						<div  class="family_doc_block">
						
						<?php if ($this->isdoc != 1) : ?>
							<h3><span><?php echo $this->translate('family_doc')?></span> <a href="patient/familydocedit?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></h3>
						<?php endif;?>
							<div id="fdoc_message"><?php echo $this->fdocmsg ?></div>
							
							<?php if ($this->isdoc == 1): ?>
							<div class="patient_familydoctor">
								<h3><span><?php echo $this->translate('familydoc')?></span> <a href="patient/familydocedit?id=<?php echo $this->pid ?>">[<?php echo $this->translate('update'); ?>]</a></h3>
							</div>
								<table>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('name'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->title ?> <?php echo $this->doc_lastname ?>, <?php echo $this->doc_firstname ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('salutation'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->doc_salutation; ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('street1'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->doc_street1 ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->doc_zip ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->doc_city ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('practice_phone'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->doc_phone_practice ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top">Handy Nummer</td>
										<td class="patcontactscol2" valign="top"><?php echo $this->doc_phone_private ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('fax'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->doc_fax ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('LANR'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->doc_number ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('bsnr'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->doc_bsnr ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"></td>
										<td class="patcontactscol2" valign="top"></td>
									</tr>
								</table>
 						 <?php endif; ?></div>
						<br />
					</div>

					
			<!-- ########### BOX 3b: Specialists  ############ -->
			<?php if ($this->displayspecialists == 1): ?>
	       <div  class="patient_specialists">
		       <h3><span><?php echo $this->translate('specialists')?></span> <a href="patient/specialists?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></h3>

			<div id="fdoc_message"><?php echo $this->specialistsmsg; ?></div>
			<?php if($this->isspecialist == '1'):?>
		       <?php if(!empty($this->patient_specialists_array)):?>

			       <?php foreach($this->patient_specialists_array as $key=>$specialist): ?>
			       <table>
				       <tr>
					       <td></td>
					       <td class="specialists_link"><a href="patient/specialists?id=<?php echo $this->pid ?>&sp_id=<?php echo $specialist['id']; ?>">[<?php echo $this->translate('update'); ?>]</a></td>
				       </tr>
				       <tr>
					       <td  class="specialists_label"><?php echo $this->translate('practice')?></td>
					       <td  class="specialists_value"><?php echo $specialist['practice']; ?></td>
				       </tr>
				       <tr>
					       <td  class="specialists_label"><?php echo $this->translate('firstname')?></td>
					       <td  class="specialists_value"><?php echo $specialist['first_name']; ?></td>
				       </tr>
				       <tr>
					       <td  class="specialists_label"><?php echo $this->translate('lastname')?></td>
					       <td  class="specialists_value"><?php echo $specialist['last_name']; ?></td>
				       </tr>
				       <tr>
					       <td  class="specialists_label"><?php echo $this->translate('specialist_type')?></td>
					       <td  class="specialists_value"><?php echo $specialists_types[$specialist['medical_speciality']]; ?></td>
				       </tr>
				       <tr>
					       <td class="specialists_label"><?php echo $this->translate('salutation')?></td>
					       <td class="specialists_value"><?php echo $specialist['salutation']; ?></td>
				       </tr>
				       <tr>
					       <td class="specialists_label"><?php echo $this->translate('address')?></td>
					       <td class="specialists_value"><?php echo $specialist['street1']; ?><br/><?php echo $specialist['zip']; ?> <?php echo $specialist['city']; ?></td>
				       </tr>
				       <?php if( !empty($specialist['phone_practice']) ): ?>
					       <tr>
						       <td class="specialists_label"><?php echo $this->translate('phone')?></td>
						       <td class="specialists_value"><?php echo $specialist['phone_practice']; ?></td>
					       </tr>
				       <?php endif; ?>
				       <?php if( !empty($specialist['phone_cell']) ): ?>
				          <tr>
						       <td class="specialists_label"><?php echo $this->translate('phone2')?></td>
						       <td class="specialists_value"><?php echo $specialist['phone_cell']; ?></td>
					       </tr>
					    <?php endif; ?>

			       </table>
			       <?php endforeach; ?>
		       <?php endif;?>
			<?php endif;?>
	       </div>
			<?php endif;?>
						<div class="clearer"></div>
					</div>
				</div>
		<?php } ?>


			<!-- ########### BOX 4a: Verordnung subdivisions  ############ -->
			<?php if ($this->newsapv == 1): ?>
			<?php if ($this->displaysapv == 1):?>
				<div class="dragboxpatientdetails" id="block03">
					<h2 class=""><?php echo $this->translate('Verordnung'); ?></h2>
					<div style="display: none;" id="grow11" class="patientdragbox-content">
						<div id="PtDetails_second" class="dtbox">
						<?php if(count($this->sapv_subdivizions) == 1):?>
							 <div class="nonaccordion">
							 	<?php if(in_array('1',$this->sapv_subdivizions)) :  // SAPV ?>
									<h3><span class="accordion_span_name">SAPV</span></h3>
									<div>
										<br/><div id="PtDtls_famdoc_edit" class="PatAndrer_link" style="margin-bottom: 10px;"><a href="patient/sapvverordnungadd?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></div>
										<div id="fdoc_message"><?php echo $this->vercountmsg ?></div>
										<!-- ISPC - 2084 <?php if ($this->vercount == 1) : ?>
												<table>
													<tr>
														<td class="colbold patcontactscol1" valign="top"></td>
														<td class="patcontactscol2" valign="top"><a href="patient/sapvverordnungedit?id=<?php echo $this->pid ?>&vid=<?php echo $this->vid ?>" style="float: right;">[<?php echo $this->translate('update'); ?>]</a></td>
													</tr>
													<tr>
														<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('verordnetvon'); ?></td>
														<td class="patcontactscol2" valign="top"><?php echo $this->verordnet_von ?></td>
													</tr>
													<tr>
														<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('verordnungam'); ?></td>
														<td class="patcontactscol2" valign="top"><?php echo $this->verordnungam ?></td>
													</tr>
													<tr>
														<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('verordnungbis'); ?></td>
														<td class="patcontactscol2" valign="top"><?php echo $this->verordnungbis ?></td>
													</tr>
													<tr>
														<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('verordnet'); ?></td>
														<td class="patcontactscol2" valign="top"><?php echo $this->verordnet ?></td>
													</tr>
													<tr>
														<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('status'); ?></td>
														<td class="patcontactscol2" valign="top"><?php echo $this->status ?></td>
													</tr>
													
													<?php if($this->sapv_bra_options):?>
														<tr>
															<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('Sapv bra options'); ?></td>
															<td class="patcontactscol2" valign="top"><?php echo $this->bra_options ?></td>
														</tr>
													<?php endif;?>

													<tr>
														<td class="colbold patcontactscol1" valign="top"></td>
														<td class="patcontactscol2" valign="top"></td>
													</tr>
												</table>

										<?php endif; ?> -->
										<?php if ($this->savpcount > 0) : ?>
											<div id="patientdetrail_HausOuter" style="margin-right: 15px;" class="dtbox">
												<div id="patientdetrail_HausDTbl" class="grid"><?php echo $this->sapvverordnunglist ?></div>
												<div class="ClrBoth"></div>
											</div>
										<?php endif; ?>
									</div>
								<?php endif?>
						<?php else:?>
							 <div class="accordion">
							 	<?php if(in_array('1',$this->sapv_subdivizions)) :  // SAPV ?>
									<h3><span class="accordion_span_name">SAPV</span></h3>
									<div style="padding-left: 5px !important; padding-right: 0px !important;">
										<br/><div id="PtDtls_famdoc_edit" class="PatAndrer_link" style="margin-bottom: 10px;"><a href="patient/sapvverordnungadd?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></div>
										<div id="fdoc_message"><?php echo $this->vercountmsg ?></div>
										<!-- ISPC - 2084 <?php if ($this->vercount == 1) : ?>
												<table>
													<tr>
														<td class="colbold patcontactscol1" valign="top"></td>
														<td class="patcontactscol2" valign="top"><a href="patient/sapvverordnungedit?id=<?php echo $this->pid ?>&vid=<?php echo $this->vid ?>" style="float: right;">[<?php echo $this->translate('update'); ?>]</a></td>
													</tr>
													<tr>
														<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('verordnetvon'); ?></td>
														<td class="patcontactscol2" valign="top"><?php echo $this->verordnet_von ?></td>
													</tr>
													<tr>
														<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('verordnungam'); ?></td>
														<td class="patcontactscol2" valign="top"><?php echo $this->verordnungam ?></td>
													</tr>
													<tr>
														<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('verordnungbis'); ?></td>
														<td class="patcontactscol2" valign="top"><?php echo $this->verordnungbis ?></td>
													</tr>
													<tr>
														<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('verordnet'); ?></td>
														<td class="patcontactscol2" valign="top"><?php echo $this->verordnet ?></td>
													</tr>
													<tr>
														<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('status'); ?></td>
														<td class="patcontactscol2" valign="top"><?php echo $this->status ?></td>
													</tr>
													
													<?php if($this->sapv_bra_options):?>
														<tr>
															<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('Sapv bra options'); ?></td>
															<td class="patcontactscol2" valign="top"><?php echo $this->bra_options ?></td>
														</tr>
													<?php endif;?>

													<tr>
														<td class="colbold patcontactscol1" valign="top"></td>
														<td class="patcontactscol2" valign="top"></td>
													</tr>
												</table>

										<?php endif; ?> -->
										<?php if ($this->savpcount > 0) : ?>
											<div id="patientdetrail_HausOuter" style="margin-right: 5px;" class="dtbox">
												<div id="patientdetrail_HausDTbl" class="grid"><?php echo $this->sapvverordnunglist ?></div>
												<div class="ClrBoth"></div>
											</div>
										<?php endif; ?>
									</div>
								<?php endif?>
						<?php endif;?>



								<?php if(in_array('2',$this->sapv_subdivizions)) :  // SGBV ?>
									<h3><span class="accordion_span_name">SGBV</span></h3>
									<div style="padding: 0px!important;">
										<a href="patient/sgbvverordnung?id=<?php echo $this->pid ?>"  class="sgbv_add_link">[<?php echo $this->translate('add') ?>]</a>
										<?php if( !empty($this->patient_sgbv) ):?>
										<?php $sgbv_actions = $this->patient_sgbv_actions; ?>

 										<table  class="sgbv_details">
											<tr>
												<th colspan="2"><?php echo $this->translate('SGB V Verordnung')?></th>
												<th><?php echo $this->translate('details')?></th>
												<th><?php echo $this->translate('action')?></th>
											</tr>

											<?php $i = 1; foreach($this->patient_sgbv as $sgbv_id =>$sgbv_details):?>
 											<tr>
 												<td onclick="openSgbv('patient/sgbvverordnung?id=<?php echo $this->pid?>&sgbv_form_id=<?php echo $sgbv_id; ?>' )"   width="5%">#</td>
 												<td class="sgbv_show_actions"  onclick="openSgbv('patient/sgbvverordnung?id=<?php echo $this->pid?>&sgbv_form_id=<?php echo $sgbv_id; ?>' )"   width="55%">
													<ul class="sgbv_name">
 													<?php foreach ($sgbv_actions[$sgbv_id] as $ka=>$valuea):?>
 															<li>
 																<a href="patient/sgbvverordnung?id=<?php echo $this->pid?>&sgbv_form_id=<?php echo $sgbv_id; ?>" 	<?php if($this->patient_sgbv_actions_foc[$sgbv_id][$ka] == '1'):?>	style="color: red;"	<?php endif;?>><?php echo $valuea; ?>;</a>
 															</li>
 													<?php endforeach;?>
 													</ul>
												</td>
 												<td class="sgbv_show_actions"   onclick="openSgbv('patient/sgbvverordnung?id=<?php echo $this->pid?>&sgbv_form_id=<?php echo $sgbv_id; ?>' )" width="30%" >
 													<b><a href="patient/sgbvverordnung?id=<?php echo $this->pid?>&sgbv_form_id=<?php echo $sgbv_id; ?>"><?php echo $this->translate('validfrom');?>:</b> <?php echo date('d.m.Y',strtotime($sgbv_details['valid_from']));?></a><br/>
 													<b><a href="patient/sgbvverordnung?id=<?php echo $this->pid?>&sgbv_form_id=<?php echo $sgbv_id; ?>"><?php echo $this->translate('validtill');?>:</b> <?php echo date('d.m.Y',strtotime($sgbv_details['valid_till']))?></a><br/>
 													<b><a href="patient/sgbvverordnung?id=<?php echo $this->pid?>&sgbv_form_id=<?php echo $sgbv_id; ?>"><?php echo $this->translate('status');?>:</b> <?php echo $this->sgbv_status[$sgbv_details['status']]; ?></a><br/>
 												</td>
												<td style="vertical-align: top!important;" width="10%">
													<a href="javascript:void(0);" class="sgbv_edit quick_approve" id="quick_approve" rel="<?php echo $sgbv_id?>" title="<?php echo $this->translate('quick approve'); ?>"><?php echo $this->translate('update') ?></a>
													<input type="hidden" value="<?php echo $sgbv_details['status'];  ?>" id="status_<?php echo $sgbv_id?>" />
													<input type="hidden" value="<?php if($sgbv_details['approved_limit'] != '0000-00-00 00:00:00'): echo date('d.m.Y', strtotime($sgbv_details['approved_limit'])); else:  echo date('d.m.Y', time()); endif;  ?>" id="approve_<?php echo $sgbv_id?>" />

													<a href="javascript:void(0);" class="sgbv_delete" id="sgbv_delete" rel="<?php echo $sgbv_id?>" title="<?php echo $this->translate('delete sgbv'); ?>"><?php echo $this->translate('delete') ?></a>												</td>
 											</tr>

 											<?php $i++; endforeach; ?>
 										</table>
 										<?php else:?>
 											<span class="sgbv_msg"><?php echo $this->translate('no sgbv added')?></span>
 										<?php endif;?>
									</div>
								<?php endif?>
								<?php if(in_array('3',$this->sapv_subdivizions)) :  // SGBXI ?>
									<h3><span class="accordion_span_name">Pflegevertrag nach SGBXI</span></h3>
									<div>
 										Pflegevertrag nach SGBXI
									</div>
								<?php endif?>
								<?php if(in_array('4',$this->sapv_subdivizions)) :  // Leistung ?>
									<h3><span class="accordion_span_name">Überweisungsschein für ärztliche Leistung</span></h3>
									<div>
 										Überweisungsschein für ärztliche Leistung
									</div>
								<?php endif?>
								<?php if(in_array('5',$this->sapv_subdivizions)) :  // Pflegebesuche - care visits P1,P2,P3 ?>
									<h3><span class="accordion_span_name">Pflegebesuche</span></h3>
									<div>
 										<table>

	 										<tr>
	 											<td>
	 												<input type="radio" name="visit_type" value="p1" class="visit_type_approved"  id="p1_approved" <?php if($this->approved_visit_type == "p1"):?> checked = "checked" <?php endif;?>  />
	 											</td>
	 											<td>

	 												<label for="p1_approved"> P1 genehmigt</label>
	 												<input type="hidden"  name="new_visti_type" value="" id="new_visti_type" />
	 												<input type="hidden"  name="old_visti_type" value="<?php echo $this->approved_visit_type; ?>" id="old_visti_type" />

	 											</td>
	 										</tr>

	 										<tr>
	 											<td>
	 												<input type="radio" name="visit_type" value="p2"  class="visit_type_approved"  id="p2_approved"  <?php if($this->approved_visit_type == "p2"):?> checked = "checked" <?php endif;?> />
	 											</td>
	 											<td>
	 												<label for="p2_approved"> P2 genehmigt</label>
	 											</td>
	 										</tr>

	 										<tr>
	 											<td>
	 												<input type="radio" name="visit_type" value="p3"  class="visit_type_approved"  id="p3_approved"  <?php if($this->approved_visit_type == "p3"):?> checked = "checked" <?php endif;?>   />
	 											</td>
	 											<td>
	 												<label for="p3_approved"> P3 genehmigt</label>
	 											</td>
	 										</tr>


	 									</table>

	 									<?php if($this->approved_visit_type_history && $this->only_default != 1):?>

	 									<table class="PatientDetail_datatable">
	 									<tr>
	 										<th><b><?php echo $this->translate('Pflegebesuche')?></b></th>
	 										<th><b><?php echo $this->translate('validfrom')?></b></th>
	 										<th><b><?php echo $this->translate('validtill')?></b></th>
	 										<th><b><?php echo $this->translate('actions')?></b></th>
	 									</tr>

										<?php foreach($this->approved_visit_type_history as $kes=>$vas): ?>
											<tr>
												<td><?php echo $vas['visit_type']; ?></td>
												<td><?php echo $vas['start_date']; ?> <input type="hidden" id="pavt_start_<?php echo $vas['id']; ?>"  value="<?php echo $vas['start_date']; ?>" /></td>
												<td><?php echo $vas['end_date']; ?> <input type="hidden" id="pavt_end_<?php echo $vas['id']; ?>"  value="<?php echo $vas['end_date']; ?>" /></td>
												<td>
													<a href="javascript:void(0)" class="edit_pavt" alt="<?php echo $vas['id']; ?>"><img border="0" src="<?php echo RES_FILE_PATH;  ?>/images/edit.png"></a>
													<a href="javascript:void(0)" class="delete_pavt" alt="<?php echo $vas['id']; ?>"><img border="0" src="<?php echo RES_FILE_PATH;  ?>/images/action_delete.png"></a>
												</td>
											</tr>

										<?php endforeach;?>

	 									</table>
	 									<?php endif;?>


									</div>
								<?php endif?>
							</div>
						</div>
						<div class="clearer"></div>
					</div>
				</div>
				<?php endif; ?>
				<?php else:?>
				
				<!-- ########### BOX 4b: Verordnung  ############ -->
				<?php if ($this->displaysapv == 1) { ?>
				<div class="dragboxpatientdetails" id="block03">
					<h2 class=""><?php echo $this->translate('sapvverordnungttl'); ?></h2>
					<div style="display: none;" id="grow11" class="patientdragbox-content">
						<div id="PtDetails_second" class="dtbox">
							<div id="PtDtls_famdoc_edit" class="PatAndrer_link"><a href="patient/sapvverordnungadd?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></div>
							<div id="fdoc_message"><?php echo $this->vercountmsg ?></div>
								<?php if ($this->vercount == 1){ ?>
								<div id="patientdetailLink" class="PatDetLink"><a href="patient/sapvverordnungedit?id=<?php echo $this->pid ?>&vid=<?php echo $this->vid ?>">[<?php echo $this->translate('update'); ?>]</a></div>
								<table>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('verordnetvon'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->verordnet_von ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('verordnungam'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->verordnungam ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('verordnungbis'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->verordnungbis ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('verordnet'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->verordnet ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('status'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->status ?></td>
									</tr>

									<tr>
										<td class="colbold patcontactscol1" valign="top"></td>
										<td class="patcontactscol2" valign="top"></td>
									</tr>
								</table>
							<?}?>
							
							<?	if ($this->savpcount > 0)	{?>
								<div id="patientdetrail_HausOuter" class="dtbox">
									<div id="patientdetrail_HausDTbl" class="grid"><?php echo $this->sapvverordnunglist ?></div>
									<div class="ClrBoth"></div>
								</div>
							<?php } ?></div>
						<div class="clearer"></div>
					</div>
				</div>
				<?php } ?>
				<?php endif;?>
			<div class="clearer"></div>
			
			<!-- ########### BOX 5: Health insurance  ############ -->
				<?php if ($this->displayhealthinsurance == 1) { ?>
				<div class="dragboxpatientdetails" id="block04">
					<h2 class=""><?php echo $this->translate('patient_health_insurance'); ?></h2>
					<div style="display: none;" id="grow10" class="patientdragbox-content">

						<div id="PtDetails_third" class="dtbox">
							<div id="PtDtls_healthinsurance_edit" class="PatAndrer_link"><a href="patient/patienthealthedit?id=<?php echo $this->pid ?>">[<?php echo $this->translate('update'); ?>]</a></div>

							<?php if($this->divisions === false):?>
						 		<div class="nonaccordion">
							<?php else:?>
						 	<div class="accordion">
								<h3><span class="accordion_span_name"><?php echo $this->translate('patient_health_insurance'); ?></span></h3>
							<?php endif;?>
								<div>
								<table>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('company_name'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->company_name ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('insurance_provider'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->ins_insurance_provider ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('insuranceno'); ?></td>
										<td class="patcontactscol2" valign="top"><?php if (!empty($this->insurance_no)){	echo $this->insurance_no; }	else{	} ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('kassenno'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->kvk_no ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top">Institutskennzeichen (IK)</td>
										<td class="patcontactscol2" valign="top"><?php echo $this->institutskennzeichen; ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('insurancestatus'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->insurance_status ?></td>
									</tr>
									
									<?php if($this->show_debtor_number == 1):?>									
										<tr>
											<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('debtor_number'); ?></td>
											<td class="patcontactscol2" valign="top"><?php echo $this->ins_debtor_number ?></td>
										</tr>
									<?php endif; ?>
									
									<tr>
										<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->comment ?></td>
									</tr>
									<tr>
										<td class="colbold patcontactscol1 redtext" valign="top"><?php echo $this->reze; ?></td>
										<td class="patcontactscol2" valign="top"><?php echo $this->exemption_till_date ?></td> <!-- ISPC - 2079 -->
									</tr>
								<?php if($this->private != '') { ?>
									<tr>
										<td class="colbold patcontactscol1 redtext" valign="top"><?php echo $this->private; ?></td>
									</tr>
								<?php } ?>
									<?php if($this->direct_billing != '') { ?>
									<tr>
										<td class="colbold patcontactscol1 redtext" valign="top"><?php echo $this->direct_billing; ?></td>
									</tr>
								<?php } ?>
								 <?php if($this->bg_patient != '') { ?>
									<tr>
										<td class="colbold patcontactscol1 redtext" valign="top"><?php echo $this->bg_patient; ?></td>
									</tr>
								<?php } ?>
								</table>
								</div>


			<?php foreach($this->divisions as $dk=>$subdiv):?>
								<h3><span class="accordion_span_name"><?php echo $subdiv['subdivision_name']?></span></h3>
								<div>
									<?php if($this->subdivizion_details[$subdiv['subdiv_id']]):?>
										<table class="patdetails_tabs_content">
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('name'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['name']?></td>
											</tr>
				
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('insurance_provider'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['insurance_provider']?></td>
											</tr>
				
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('contactperson'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['contact_person']?></td>
											</tr>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('street'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['street1']?></td>
											</tr>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('zip'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['zip']?></td>
											</tr>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('city'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['city']?></td>
											</tr>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('phone1'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['phone']?></td>
											</tr>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('Telefon 2'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['phone2']?></td>
											</tr>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('post_office_box'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['post_office_box']?></td>
											</tr>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('post_office_box_location'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['post_office_box_location']?></td>
											</tr>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('zip_mailbox'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['zip_mailbox']?></td>
											</tr>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('fax'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['fax']?></td>
											</tr>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('email'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['email']?></td>
											</tr>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('kvnumber'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['kvnumber']?></td>
											</tr>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('iknumber'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['iknumber']?></td>
											</tr>
											<?php if($subdiv['subdiv_id'] == "3"): ?>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('lbl_billing_ik'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['ikbilling']?></td>
											</tr>
											<?php endif; ?>
											
											<?php if($this->show_debtor_number == 1):?>							
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('debtor_number'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['debtor_number']?></td>
											</tr>
											<?php endif; ?>
											<tr>
												<td class="hi_tabs_label"><span><?php echo $this->translate('comment'); ?></span></td>
												<td><?php echo $this->subdivizion_details[$subdiv['subdiv_id']]['comments']?></td>
											</tr>
										</table>
									<?php else:?>
										<div id="fdoc_message"><?php echo $this->translate('no information added')?></div>
									<?php endif;?>
								</div>
							<?php endforeach; ?>
						</div>
					</div>
					<div class="clearer"></div>
					</div>
				</div>
				<?php } ?>
			<div class="clearer"></div>
			
			<!-- ########### BOX 6: Contact persons  ############ -->
			<?php	if ($this->displaycontactp == 1){?>
				<div class="dragboxpatientdetails" id="block05">
					<h2 class=""><?php echo $this->translate('contactperson'); ?> </h2>
					<div style="display: none;" id="grow12" class="patientdragbox-content">

						<div id="PtDetails_fourth" class="dtbox">
							<div class="contact_person_add PatAndrer_link"><a class="contactclass">[<?php echo $this->translate('add'); ?>]</a></div>
							<div id="FormDiv">
								<form action="<?php echo $this->act ?>" name="frmcontact" id="frmcontact" method="post"><label id="contact_first_name" for="cnt_first_name"><?php echo $this->translate('firstname') ?></label>
									<div id="contact_first_name_content"><input type="text" name="cnt_first_name" id="cnt_first_name" value="<?php echo $this->cnt_first_name ?>"> <input
											type="hidden" name="openhidediv" id="openhidediv" value="<?php echo $this->openhidediv ?>"></div>
									<div class="clearer"></div>
									<div class="error"><?php echo $this->error_cnt_first_name ?></div>
									<label id="contact_lastname" for="cnt_last_name"><?php echo $this->translate('lastname') ?></label>
									<div id="contact_lastname_content"><input type="text" name="cnt_last_name" id="cnt_last_name" value="<?php echo $this->cnt_last_name ?>"></div>
									
									
									<label id="contact_street1" for="cnt_street1">
										<?php echo $this->translate('street') ?>
										<button type="button" onclick="javascript: return prefill_contact_person();" class="prefill_contact_person_btn" title="<?php echo $this->translate('prefill_with_contact_person'); ?>" ></button>	
									</label>
									
									<div id="contact_street1_content">
										<input type="text" name="cnt_street1" id="cnt_street1" value="<?php echo $this->cnt_street1 ?>">
									</div>
									<div class="clearer"></div>
									
									<label id="contact_zip" for="cnt_zip"><?php echo $this->translate('zip') ?></label>
									<div id="contact_zip_content">
									     <input type="text" name="cnt_zip" id="cnt_zip" value="<?php echo $this->cnt_zip ?>">
									</div>
									
									<label id="contact_street1" for="cnt_street1"><?php echo $this->translate('city') ?></label>
									<div id="contact_street1_content">
										<input type="text" name="cnt_city" id="cnt_city" value="<?php echo $this->cnt_city ?>">
									</div>

									<label id="contact_phone" for="cnt_phone"><?php echo $this->translate('phone1') ?></label>
									<div id="contact_phone_content"><input type="text" name="cnt_phone" id="cnt_phone" value="<?php echo $this->cnt_phone ?>">
										<div class="clearer"></div>
										<span class="error1"><?php echo $this->error_cnt_phone ?></span></div>
									<label id="contact_mobile" for="cnt_mobile"><?php echo $this->translate('phone2') ?></label>
									<div id="contact_mobile_content"><input type="text" name="cnt_mobile" id="cnt_mobile" value="<?php echo $this->cnt_mobile ?>">
										<div class="clearer"></div>
										<span class="error1"><?php echo $this->error_cnt_mobile ?></span></div>

									<label id="contact_email" for="cnt_email"><?php echo $this->translate('cnt_email') ?></label>
									<div id="contact_email_content"><input type="text" name="cnt_email" id="cnt_email" value="<?php echo $this->cnt_email ?>">
										<div class="clearer"></div>
										<span class="error1"><?php echo $this->error_cnt_email ?></span></div>

									<!-- 	
									<label id="contact_hatversorgungsvollmacht" for="cnt_hatversorgungsvollmacht"><?php echo $this->translate('hatversorgungsvollmacht') ?></label>
									<div id="contact_hatversorgungsvollmacht">
										<?php echo $this->formCheckbox('cnt_hatversorgungsvollmacht', $_POST['cnt_hatversorgungsvollmacht'], null, array ('1')); ?>
										<div class="clearer"></div>
										<span class="error"><?php echo $this->error_cnt_hatversorgungsvollmacht ?></span></div>
									-->				
									<label id="contact_legalguardien" for="cnt_legalguardian">Gesetzlicher Betreuer</label>
									<div id="contact_legalguardian">
										<?php echo $this->formCheckbox('cnt_legalguardian', $_POST['cnt_legalguardian'], null, array ('1')); ?>
										<div class="clearer"></div>
										<span class="error"><?php echo $this->error_cnt_legualguardian ?></span>
									</div>

									<label for="real_contact_number" class="stm_realknt_label">ist die Kontakt-Telefonnummer</label>
									<div id="contact_kontactnumber" class="stm_realknt_dinput"><input type="checkbox" id="real_contact_number" name="real_contact_number" value="1" />
										<div class="clearer"></div>
									</div>
									<div class="clearer">&nbsp;</div>

									<label id="contact_notify_funeral" for="notify_funeral" class="stm_realknt_label"><?php echo $this->translate('notify_funeral');  ?></label>
									<div id="contact_notify_funeral" class="stm_realknt_dinput">
										<?php echo $this->formCheckbox('notify_funeral', $_POST['notify_funeral'], null, array ('1')); ?>
										<div class="clearer"></div>
										<span class="error"><?php echo $this->error_cnt_notify_funeral ?></span>
									</div>
									<div class="clearer">&nbsp;</div>
									<label id="contact_quality_control" for="quality_control" class="stm_realknt_label"><?php echo $this->translate('quality_control');  ?></label>
									<div id="contact_quality_control" class="stm_realknt_dinput">
										<?php echo $this->formCheckbox('quality_control', $_POST['quality_control'], null, array ('1')); ?>
										<div class="clearer"></div>
										<span class="error"><?php echo $this->error_cnt_notify_funeral ?></span>
									</div>
									<div class="clearer">&nbsp;</div>
									<br />


									<label for="cnt_familydegree_id" id="contact_family_degree_id"><?php echo $this->translate('patientrelationship') ?></label> <?php echo $this->formSelect('cnt_familydegree_id', $_POST['cnt_familydegree_id'], null, $this->familydegree) ?>
									<div class="clearer"></div>
									
									
									<?php if($this->modul_custody == 1): ?>
									<label id="contact_email" for="cnt_email"><?php echo $this->translate('custody') ?></label>
									<div id="contact_email_content"><input type="text" name="cnt_custody" id="cnt_custody" value="<?php echo $this->cnt_custody ?>">
									<div class="clearer"></div>
									<span class="error1"><?php echo $this->error_cnt_email ?></span></div>
									<?php  endif; ?>
									
									<label for="cnt_comment" id="contact_comment"><?php echo $this->translate('comment') ?></label>
									<div id="contact_comment_content"><textarea name="cnt_comment" id="cnt_comment" cols="25" rows="5"></textarea></div>
									<input type="button" name="btnsubmit" id="btnsubmit-save" value="<?php echo $this->translate('submit') ?>" class="button" onclick="checkdischargednew('frmcontact')"></form>
							</div>

							<?php echo $this->patient_contacts ?>

							<div class="clearer"></div>
						</div>
						<div class="clearer"></div>
					</div>

				</div>
			<?php } ?>
			<div class="clearer"></div>
		</div>
		
		
		<!-- ########### RIGHT CONTAINER  ############ -->
		<div id="PtDtls_right_conatiner">
			<!-- ########### BOX 7: Medipump  ############ -->
			<?php if ($this->displaymedipumpe == 1) { ?>
			<div class="dragboxpatientdetails" id="block06">
				<h2 class=""><?php echo $this->translate('medipumpe_box') ?></h2>
				<div style="display: none;" id="grow06" class="patientdragbox-content">
					<div id="patdetAufontort">
				<?php if (count($this->patientmedipumpe) > 0) { ?>
						<div id="PtDtls_famdoc_edit">
							<a href="javascript:void(0);" id="add_new_medipumps"><?php echo $this->translate('addnewpatientmedipump') ?></a>
						</div>
						<div class="dtbox patdetaillocTbl">
							<table class="patient_medipumps_details">
								<tbody>
									<tr>
										<th><?php echo $this->translate('medipumps_name');  ?></th>
										<th><?php echo $this->translate('start_time');  ?></th>
										<th><?php echo $this->translate('end_time');  ?></th>
										<th><?php echo $this->translate('action');  ?></th>
									</tr>
									<?php foreach ($this->patientmedipumpe as $k_patient_pump => $v_patient_pump): ?>
										<tr>
											<td>
												<?php echo $this->client_medipumps[$v_patient_pump['medipump']]['medipump']; ?>
												<input type="hidden" id="medipumpe_id_<?php echo $v_patient_pump['id']; ?>" value="<?php echo $v_patient_pump['medipump']; ?>" />
											</td>
											<td>
												<input type="hidden" id="medipumpe_start_<?php echo $v_patient_pump['id']; ?>" value="<?php echo date('d.m.Y', strtotime($v_patient_pump['start_date'])); ?>"/>
												<?php echo date('d.m.Y', strtotime($v_patient_pump['start_date'])); ?>
											</td>
											<td>
												<?php if($v_patient_pump['end_date'] !='0000-00-00 00:00:00'):  ?>
													<input type="hidden" id="medipumpe_end_<?php echo $v_patient_pump['id']; ?>" value="<?php echo date('d.m.Y', strtotime($v_patient_pump['end_date'])); ?>"/>
													<?php echo date('d.m.Y', strtotime($v_patient_pump['end_date'])); ?>
												<?php else:  ?>
													-
													<input type="hidden" id="medipumpe_end_<?php echo $v_patient_pump['id']; ?>" value="<?php echo date('d.m.Y');?>"/>
												<?php endif;  ?>
											</td>
											<td>
												<a href="javascript:void(0)" class="edit_medipumps" alt="<?php echo $v_patient_pump['id']; ?>"><img border="0" src="<?php echo RES_FILE_PATH;  ?>/images/edit.png"></a>
												<a href="javascript:void(0)" class="delete_medipumps" alt="<?php echo $v_patient_pump['id']; ?>"><img border="0" src="<?php echo RES_FILE_PATH;  ?>/images/action_delete.png"></a>
											</td>
										</tr>
									<?php endforeach; ?>
								</tbody>
							</table>
						</div>
				<?php } else { ?>
						<div id="PtDtls_famdoc_edit" class="PatAndrer_link">
							<a href="javascript:void(0);" id="add_new_medipumps"><?php echo $this->translate('addnewpatientmedipump') ?></a>
						</div>
						<div class="dtbox patdetaillocTbl redtext"><?php echo "&nbsp;"; ?>
							<div class="clearer"></div>
						</div>
				<?php } ?>
						<div class="clearer"></div>
					</div>
					<div class="clearer"></div>
				</div>
			</div>
			<?php } ?>




			<!-- ########### BOX 8: Locations  ############ -->
			<?php if ($this->displayaufenthaltsort == 1) { ?>
			<div class="dragboxpatientdetails" id="block06">
				<h2 class=""><?php echo $this->translate('patientlocation') ?></h2>
				<div style="display: none;" id="grow13" class="patientdragbox-content">
					<div id="patdetAufontort">
					<?php if ($this->locationcount > 0) { ?>
						<div id="PtDtls_famdoc_edit"><a href="patient/patientlocationlistedit?id=<?php echo $this->pid ?>"><?php echo $this->translate('changelocation') ?></a></div>
						<div class="dtbox patdetaillocTbl">
							<?php echo $this->locations; ?>
							<div class="clearer"></div>
							<?php echo $this->contact_checkbox; ?>
						</div>
				<?php } else { ?>
						<div id="PtDtls_famdoc_edit" class="PatAndrer_link">
							<a href="patient/patientlocationadd?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a>
						</div>
						<div class="dtbox patdetaillocTbl redtext"><?php echo "&nbsp;"; ?>
							<div class="clearer"></div>
						</div>
				<?php } ?>
						<div class="clearer"></div>
					</div>
					<div class="clearer"></div>
				</div>
			</div>
			<?php } ?>
			<div class="clearer"></div>
			
			
			
		 
			<!-- ########### BOX 8.1: Hilfsmittel2  ############ -->
				<?php if ($this->displayhilfsmittelII == 1) {  ?>
			<div class="dragboxpatientdetails" id="block09">
				<h2 class=""><?php echo $this->translate('Patient_tool') ?></h2>
				<div style="display: none;" id="grow49" class="patientdragbox-content">
					<div id="patdetAufontort">
					<?php if ($this->remds > 0) { ?>
						<div id="PtDtls_famdoc_edit"><a href="patient/patienttoollistedit?id=<?php echo $this->pid ?>"><?php echo $this->translate('Patient_tool_edit') ?></a></div>
						<div class="dtbox patdetaillocTbl">
							<table  class="PatientDetail_datatable" width="85%" align="left" border="0" cellpadding="0" cellspacing="0">
							    <tr>
							      <th valign="top" height="20"  align="left"><strong><?php echo $this->translate('Patient_tool') ?></strong></th>
							      <th  valign="top" align="left"><strong><?php echo $this->translate('supplies')?></strong></th>
							    </tr>
							   
							       <?php foreach($this->remds as $key => $value){?>
							       <tr>
							          <td><?php echo $value['remedis']; ?></td>
							          <td><?php echo $value['supplier']; ?></td>
							       </tr>
							       <?php }?>    
							</table>
							<div class="clearer"></div>
						</div>
				<?php } else { ?>
						<div id="PtDtls_famdoc_edit" class="PatAndrer_link">
							<a href="patient/patienttoollistedit?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a>
						</div>
						<div class="dtbox patdetaillocTbl redtext"><?php echo "&nbsp;"; ?>
							<div class="clearer"></div>
						</div>
				<?php } ?>
						<div class="clearer"></div>
					</div>
					<div class="clearer"></div>
				</div>
			</div>
			<?php } ?>
			<div class="clearer"></div>
				
				<!-- ########### BOX 9: Pflegedienst - nursing  ############ -->
				<?php if ($this->displaypflegedienst == 1)	{ ?>
				<div class="dragboxpatientdetails" id="block07">
					<h2 class="">Pflegedienste &amp; Sanitätshaus</h2>
					<div style="display: none;" id="grow15" class="patientdragbox-content">
						<div id="PtDetails_second" class="dtbox">
							<div id="PtDtls_famdoc_edit" class="PatAndrer_link"><a href="patient/pflegedienste?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></div>
							 <div id="fdoc_message"><?php echo  $this->pflegemsg?></div>
							<?php if ($this->ispflege == 1):?>
								<?php echo $this->patient_pflegedienstes; ?>
							<?php endif; ?>
						 <br />
					<?php if ($this->displaysupplies == 1): ?>
							<div  class="patient_supplies">
								<h3><span><?php echo $this->translate('supplies')?></span> <a href="patient/supplies?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></h3>
											<div id="fdoc_message"><?php echo $this->suppliesmsg ?></div>
							 <?php if($this->issupplies == '1'):?>
								<?php if(!empty($this->patient_supplies_array)):?>
									<?php foreach($this->patient_supplies_array as $key=>$supplier_item): ?>
									<table>
										<tr>
											<td></td>
											<td class="supplies_link"><a href="patient/supplies?id=<?php echo $this->pid ?>&supplier_id=<?php echo $supplier_item['id']; ?>">[<?php echo $this->translate('update'); ?>]</a></td>
										</tr>
										<tr>
											<td  class="supplies_label"><?php echo $this->translate('supplies')?></td>
											<td  class="supplies_value"><?php echo $supplier_item['m_supplier']; ?></td>
										</tr>
										<tr>
											<td class="supplies_label"><?php echo $this->translate('salutation')?></td>
											<td class="supplies_value"><?php echo $supplier_item['salutation']; ?></td>
										</tr>
										<tr>
											<td class="supplies_label"><?php echo $this->translate('address')?></td>
											<td class="supplies_value"><?php echo $supplier_item['m_supplier_street']; ?><br/><?php echo $supplier_item['m_supplier_zip']; ?> <?php echo $supplier_item['m_supplier_city']; ?></td>
										</tr>
										<?php if( !empty($supplier_item['m_supplier_phone']) ): ?>
											<tr>
												<td class="supplies_label"><?php echo $this->translate('phone')?></td>
												<td class="supplies_value"><?php echo $supplier_item['m_supplier_phone']; ?></td>
											</tr>
										<?php endif; ?>

									</table>
									<?php endforeach; ?>
								<?php endif;?>
							 <?php endif;?>
							</div>
					 <?php endif;?>
						</div>
						<div class="clearer"></div>
					</div>
				</div>
			<?php } ?>
			<div class="clearer"></div>
			
				
				<!-- ########### BOX 10: Ehrenamtliche - voluntary workers   ############ -->
				<?php if ($this->displayvoluntary == 1)	{ ?>
				<div class="dragboxpatientdetails" id="block07">
					<h2 class="">Ehrenamtliche</h2>
					<div style="display: none;" id="grow38" class="patientdragbox-content">
						<div id="PtDetails_second" class="dtbox">
							<div id="PtDtls_famdoc_edit" class="PatAndrer_link"><a href="patient/voluntaryworkers?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a>
							</div>
							<div id="fdoc_message"><?php echo $this->pvwmsg ?></div>
							<?php if ($this->ispvw == 1)
							{ ?> <?php echo $this->patient_voluntaryworkers; ?> <?php } ?></div>
								<div class="clearer"></div>
							</div>
						</div>
					<?php } ?>


				<!-- ########### BOX 11: Pharmacy    ############ -->
				<?php if ($this->displaypharmacy == 1)	{ ?>
				<div class="dragboxpatientdetails" id="block08">
					<h2 class=""><?php echo $this->translate('pharmacy_box'); ?></h2>
					<div style="display: none;" id="grow26" class="patientdragbox-content">
						<div id="PtDetails_second" class="dtbox">
							<div id="PtDtls_famdoc_edit" class="PatAndrer_link"><a href="patient/pharmacyedit?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></div>
							<div id="fdoc_message"><?php echo $this->pharmacymsg; ?></div>
							<?php if ($this->ispharmacy == 1)
							{ ?> <?php echo $this->patient_pharmacy; ?> <?php } ?>
							
							<br/>
							<!--Versorger-->
							<?php if ($this->displayversorger == 1): ?>
							<div  class="patient_supplies">
								<h3><span><?php echo $this->translate('suppliers')?></span> <a href="patient/suppliers?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></h3>
								<div id="fdoc_message"><?php echo $this->suppliersmsg ?></div>
							 <?php if($this->issupplier == '1'):?>
								<?php if(!empty($this->patient_suppliers_array)):?>
									<?php foreach($this->patient_suppliers_array as $key=>$suppliers_item): ?>
									<table>
										<tr>
											<td></td>
											<td class="supplies_link"><a href="patient/suppliers?id=<?php echo $this->pid ?>&supplier_id=<?php echo $suppliers_item['id']; ?>">[<?php echo $this->translate('update'); ?>]</a></td>
										</tr>
										<tr>
											<td  class="supplies_label patcontactscol1"><?php echo $this->translate('suppliers')?></td>
											<td  class="supplies_value patcontactscol2"><?php echo $suppliers_item['m_supplier']; ?></td>
										</tr>
										<?php if(strlen($suppliers_item['salutation'])>'0'): ?>
										<tr>
											<td  class="supplies_label patcontactscol1"><?php echo $this->translate('salutation')?></td>
											<td  class="supplies_value patcontactscol2"><?php echo $suppliers_item['salutation']; ?></td>
										</tr>
										<?php endif; ?>
										<?php if(strlen($suppliers_item['type'])>'0'): ?>
										<tr>
											<td  class="supplies_label patcontactscol1"><?php echo $this->translate('supplier_type')?></td>
											<td  class="supplies_value patcontactscol2"><?php echo $suppliers_item['type']; ?></td>
										</tr>
										<?php endif; ?>
										<tr>
											<td class="supplies_label patcontactscol1"><?php echo $this->translate('address')?></td>
											<td class="supplies_value patcontactscol2"><?php echo $suppliers_item['m_supplier_street']; ?><br/><?php echo $suppliers_item['m_supplier_zip']; ?> <?php echo $suppliers_item['m_supplier_city']; ?></td>
										</tr>
										<?php if( !empty($suppliers_item['m_supplier_phone']) ): ?>
											<tr>
												<td class="supplies_label patcontactscol1"><?php echo $this->translate('phone')?></td>
												<td class="supplies_value patcontactscol2"><?php echo $suppliers_item['m_supplier_phone']; ?></td>
											</tr>
										<?php endif; ?>

									</table>
									<?php endforeach; ?>
								<?php endif;?>
							 <?php endif;?>
							</div>
					 <?php endif;?>
							</div>
							<div class="clearer"></div>
						</div>
						</div>
				<?php } ?>

			<!-- ########### BOX 12: Physiotherapist   ############ -->
				<?php if ($this->displayphysiotherapist == 1)	{ ?>
				<div class="dragboxpatientdetails" id="block07">
					<h2 class="">Physiotherapeuten</h2>
					<div style="display: none;" id="grow15" class="patientdragbox-content">
						<div id="PtDetails_second" class="dtbox">
							<div id="PtDtls_famdoc_edit" class="PatAndrer_link"><a href="patient/physiotherapist?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></div>
							 <div id="fdoc_message"><?php echo  $this->physiomsg?></div>
							<?php if ($this->isphysio == 1):?>
								<?php echo $this->patient_physiotherapist; ?>
							<?php endif; ?>
						</div>
						<div class="clearer"></div>
					</div>
				</div>
			<?php } ?>
			<div class="clearer"></div>
			
			<!-- ########### BOX 13: Homecare   ############ -->
				<?php if ($this->displayhomecare == 1)	{ ?>
				<div class="dragboxpatientdetails" id="block07">
					<h2 class="">Homecare</h2>
					<div style="display: none;" id="grow15" class="patientdragbox-content">
						<div id="PtDetails_second" class="dtbox">
							<div id="PtDtls_famdoc_edit" class="PatAndrer_link"><a href="patient/homecares?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></div>
							 <div id="fdoc_message"><?php echo  $this->homemsg?></div>
							<?php if ($this->ishome == 1):?>
								<?php echo $this->patient_homecare; ?>
							<?php endif; ?>
						</div>
						<div class="clearer"></div>
					</div>
				</div>
			<?php } ?>
			<div class="clearer"></div>

				<!-- ########### BOX 14: Vorausschauende Therapieplanung - treatment planning   ############ -->
				<?php if ($this->displayplanning == 1){?>
				<div class="dragboxpatientdetails" id="block01">
					<h2 class=""><?php echo $this->translate('treatmentplanning'); ?></h2>
					<div style="display: none;" id="grow37" class="patientdragbox-content">

						<div id="PtDetails_first" class="dtbox">
							<table width="100%">

								<tr>
									<td width="30px" valign="top"><?php echo $this->formCheckbox('ernahrungstherapie', $this->ernahrungstherapie, array ('onclick' => 'updatePatientInformation(\'Therapieplanung\',\'ernahrungstherapie\',\'grow37\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?></td>
									<td valign="top"><label for="ernahrungstherapie"> <?php echo $this->translate('ernahrungstherapie') ?></label></td>
								</tr>
								<tr>
									<td width="30px" valign="top"><?php echo $this->formCheckbox('infusionstherapie', $this->infusionstherapie, array ('onclick' => 'updatePatientInformation(\'Therapieplanung\',\'infusionstherapie\',\'grow37\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?></td>
									<td valign="top"><label for="infusionstherapie"> <?php echo $this->translate('infusionstherapie') ?></label></td>
								</tr>
								<tr>
									<td width="30px" valign="top"><?php echo $this->formCheckbox('antibiose_bei_pneumonie', $this->antibiose_bei_pneumonie, array ('onclick' => 'updatePatientInformation(\'Therapieplanung\',\'antibiose_bei_pneumonie\',\'grow37\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?></td>
									<td valign="top"><label for="antibiose_bei_pneumonie"> <?php echo $this->translate('antibiose_bei_pneumonie') ?></label></td>
								</tr>
								<tr>
									<td width="30px" valign="top"><?php echo $this->formCheckbox('antibiose_bei_HWI', $this->antibiose_bei_HWI, array ('onclick' => 'updatePatientInformation(\'Therapieplanung\',\'antibiose_bei_HWI\',\'grow37\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?></td>
									<td valign="top"><label for="antibiose_bei_HWI"> <?php echo $this->translate('antibiose_bei_HWI') ?></label></td>
								</tr>
								<tr>
									<td width="30px" valign="top"><?php echo $this->formCheckbox('tumorreduktionstherapie_chemo', $this->tumorreduktionstherapie_chemo, array ('onclick' => 'updatePatientInformation(\'Therapieplanung\',\'tumorreduktionstherapie_chemo\',\'grow37\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?></td>
									<td valign="top"><label for=tumorreduktionstherapie_chemo> <?php echo $this->translate('tumorreduktionstherapie_chemo') ?></label></td>
								</tr>
								<tr>
									<td width="30px" valign="top"><?php echo $this->formCheckbox('krankenhausverlegung', $this->krankenhausverlegung, array ('onclick' => 'updatePatientInformation(\'Therapieplanung\',\'krankenhausverlegung\',\'grow37\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?></td>
									<td valign="top"><label for="krankenhausverlegung"> <?php echo $this->translate('krankenhausverlegung') ?></label></td>
								</tr>
								<tr>
									<td width="30px" valign="top"><?php echo $this->formCheckbox('lagerung_durch_pflege', $this->lagerung_durch_pflege, array ('onclick' => 'updatePatientInformation(\'Therapieplanung\',\'lagerung_durch_pflege\',\'grow37\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?></td>
									<td valign="top"><label for="lagerung_durch_pflege"> <?php echo $this->translate('lagerung_durch_pflege') ?></label></td>
								</tr>
								<tr>
									<td width="30px" valign="top"><?php echo $this->formCheckbox('orale_medikation_mehr', $this->orale_medikation_mehr, array ('onclick' => 'updatePatientInformation(\'Therapieplanung\',\'orale_medikation_mehr\',\'grow37\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?></td>
									<td valign="top"><label for="orale_medikation_mehr"> <?php echo $this->translate('orale_medikation_mehr') ?></label></td>
								</tr>
								<tr>
									<td width="30px" valign="top"><?php echo $this->formCheckbox('blut_volumenersatztherapie', $this->blut_volumenersatztherapie, array ('onclick' => 'updatePatientInformation(\'Therapieplanung\',\'blut_volumenersatztherapie\',\'grow37\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?></td>
									<td valign="top"><label for="volumenersatztherapie"> <?php echo $this->translate('blut_volumenersatztherapie') ?></label></td>
								</tr>
								<tr>
									<td width="30px" valign="top"><?php echo $this->formCheckbox('palliative', $this->palliative, array ('onclick' => 'updatePatientInformation(\'Therapieplanung\',\'palliative\',\'grow37\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?></td>
									<td valign="top"><label for="palliative"> <?php echo $this->translate('palliative') ?></label></td>
								</tr>
								<tr>
									<td colspan="2" valign="top"><input type="text" id="vvfreetext" name="freetext" value="<?php echo $this->freetext ?>" /></td>
								</tr>
							</table>
						</div>
						<div class="clearer"></div>
					</div>
				</div>
			<?php } ?>

			<!-- ########### BOX 15: Hospizverein - hospiz message   ############ -->	
			 <?php if ($this->displayhospizverein == 1) {?>
				<div class="dragboxpatientdetails" id="block01">
					<h2 class=""><?php echo $this->translate('Hospizverein'); ?></h2>
					<div style="display: none;" id="grow39" class="patientdragbox-content">

						<div id="PtDetails_first" class="dtbox">

							<form action="<?php echo $this->act ?>" name="frmhospiz" id="frmhospiz" method="post">
								<table width="100%">
									<?php if ($this->displayhospizverein_special == 1) : ?>
										<tr>
											<td colspan="4" valign="top"><b>Hospizverein verständigen?</b></td>
										</tr>
										<tr>
											<td width="30px" valign="top"><input type="radio" name="hospizverein" value="1" <?php if ($this->hospizverein == '1')
											{
												echo 'checked="checked"';
											} ?> /></td>
											<td valign="top"><label> Ja </label></td>
											<td width="30px" valign="top"><input type="radio" name="hospizverein" value="2" <?php if ($this->hospizverein == '2')
											{
												echo 'checked="checked"';
											} ?> /></td>
											<td valign="top"><label> Nein</label></td>
										</tr>

										<tr>
											<td colspan="4" valign="top">&nbsp;</td>
										</tr>
										<tr>
											<td colspan="4" valign="top"><b>anderer Hospizdienst bereits aktiv?</b></td>
										</tr>
										<?php endif; ?>
									<tr>
										<td colspan="4" valign="top"><textarea name="hospizverein_txt" cols="" rows="" style="width: 92%;"><?php echo $this->hospizverein_txt; ?></textarea></td>
									</tr>
									<tr>
										<td colspan="4" valign="top"><input type="hidden" name="hospizval" value="1" /> 
											<input type="button" name="btnsubmit" id="btnsubmit-save-h"  value="<?php echo $this->translate('submit') ?>" class="button" onclick="checkdischargednew('frmhospiz')">
										</td>
									</tr>
								</table>
							</form>
						</div>
						<div class="clearer"></div>
					</div>
				</div>
			<?php } ?>


			<!-- ########### BOX 16: Hospiz - Hospizverein - SAPV/AAPV - hospiz status   ############ -->	
			<?php if ($this->displayhospizhospizverein == 1){ ?>
				<div class="dragboxpatientdetails" id="block01">
					<h2 class=""><?php echo $this->translate('hospizhospizverein'); ?></h2>
					<div style="display: none;" id="grow40" class="patientdragbox-content">

						<div id="PtDetails_first" class="dtbox">
							<table width="100%">

								<tr>
									<td width="30px" valign="top">
										<input type="checkbox" id="aapvsapv" name="aapvsapv" value="1" checked="checked"/></td>
									<td valign="top"><label for="aapvsapv"> <?php echo $this->translate('AAPV / SAPV') ?></label></td>
								</tr>
								<tr>
									<td width="30px" valign="top">
								<?php echo $this->formCheckbox('ishospiz', $this->ishospiz, array ('onclick' => 'updatePatientInformation(\'Master\',\'ishospiz\',\'grow40\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
									</td>
									<td valign="top"><label for="ishospiz"> <?php echo $this->translate('Hospiz') ?></label></td>
								</tr>
								<tr>
									<td width="30px" valign="top">
									<?php echo $this->formCheckbox('ishospizverein', $this->ishospizverein, array ('onclick' => 'updatePatientInformation(\'Master\',\'ishospizverein\',\'grow40\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
									</td>
									<td valign="top"><label for="ishospizverein"> <?php echo $this->translate('Hospizverein') ?></label></td>
								</tr>
							</table>
						</div>
						<div class="clearer"></div>
					</div>
				</div>
			<?php } ?>
			<div class="clearer"></div>


				<!-- ########### BOX 17: Hospizdienst - hospize association   ############ -->	
				<?php if ($this->displayhospiceservice == 1): ?>
				<div class="dragboxpatientdetails" id="block42">
					<h2 class="">Hospizdienst</h2>
					<div style="display: none;" id="grow42" class="patientdragbox-content">
						<div id="PtDetails_second" class="dtbox">
							<div id="PtDtls_famdoc_edit" class="PatAndrer_link"><a href="patient/hospiceassociation?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></div>
						 <div  class="patient_h_association">
							 <?php if($this->has_hp_assoc == '1'):?>
								<?php if(!empty($this->patient_hospiceassociations)):?>
									<?php foreach($this->patient_hospiceassociations as $key=>$hp_assoc): ?>
									<table>
										<tr>
											<td></td>
											<td class="h_association_link" style="float: right;"><a href="patient/hospiceassociation?id=<?php echo $this->pid ?>&h_association_id=<?php echo $hp_assoc['id']; ?>">[<?php echo $this->translate('update'); ?>]</a></td>
										</tr>
										<tr>
											<td  class="h_association_label"><?php echo $this->translate('Hospizdienst')?></td>
											<td  class="h_association_value"><?php echo $hp_assoc['h_association']; ?></td>
										</tr>
										<?php if(strlen($hp_assoc['salutation'])): ?>
										<tr>
											<td  class="h_association_label"><?php echo $this->translate('salutation')?></td>
											<td  class="h_association_value"><?php echo $hp_assoc['salutation']; ?></td>
										</tr>
										<?php endif; ?>
										<tr>
											<td class="h_association_label"><?php echo $this->translate('address')?></td>
											<td class="h_association_value"><?php echo $hp_assoc['h_association_street']; ?><br/><?php echo $hp_assoc['h_association_zip']; ?> <?php echo $hp_assoc['h_association_city']; ?></td>
										</tr>
										<?php if( !empty($hp_assoc['h_association_phone_practice']) ): ?>
											<tr>
												<td class="h_association_label"><?php echo $this->translate('phone')?></td>
												<td class="h_association_value"><?php echo $hp_assoc['h_association_phone_practice']; ?></td>
											</tr>
										<?php endif; ?>
										<?php if( !empty($hp_assoc['h_association_phone_emergency']) ): ?>
											<tr>
												<td class="h_association_label"><?php echo $this->translate('emergency_phone')?></td>
												<td class="h_association_value"><?php echo $hp_assoc['h_association_phone_emergency']; ?></td>
											</tr>
										<?php endif; ?>

									</table>
									<?php endforeach; ?>
								<?php endif;?>
							 <?php else:  ?>
								 <div id="fdoc_message"><?php echo  $this->hospiceassociationmsg; ?></div>
							 <?php endif;?>
							</div>
						</div>
						<div class="clearer"></div>
					</div>
				</div>
				<?php endif ?>
				<div class="clearer"></div>

				
				
				<!-- ########### BOX 18: Tourenplanung  - visits settings  ############ -->
				<?php if ($this->displayvisitssettings == 1): ?>
				<div class="dragboxpatientdetails" id="block43">
					<h2 class=""><?php echo $this->translate('displayvisitssettings')?></h2>
					<div style="display: none;" id="grow43" class="patientdragbox-content">
						<div id="PtDetails_second" class="dtbox">
							
							<table class="PatientDetail_datatable table_grow43" id="table_visits_per_day" style="width:350px;">
								<thead>
								<tr>
									<th><?php echo $this->translate('users')?></th>
									<th width="18px" title="<?php echo $this->translate('Monday')?>"><?php echo $this->translate('short_Monday')?></th>
									<th width="18px" title="<?php echo $this->translate('Tuesday')?>"><?php echo $this->translate('short_Tuesday')?></th>
									<th width="18px" title="<?php echo $this->translate('Wednesday')?>"><?php echo $this->translate('short_Wednesday')?></th>
									<th width="18px" title="<?php echo $this->translate('Thursday')?>"><?php echo $this->translate('short_Thursday')?></th>
									<th width="18px" title="<?php echo $this->translate('Friday')?>"><?php echo $this->translate('short_Friday')?></th>
									<th width="18px" title="<?php echo $this->translate('Saturday')?>"><?php echo $this->translate('short_Saturday')?></th>
									<th width="18px" title="<?php echo $this->translate('Sunday')?>"><?php echo $this->translate('short_Sunday')?></th>
									<th width="18px" title="<?php echo $this->translate('delete')?>"></th>
								</tr>
								</thead>
								
								<tbody>
									
									
								</tbody>
								
							</table>
							<a onclick="assign_tourenplan(0,0)" href="javascript:void(0);" id="assign_tourenplan" style="padding:5px; float:left;" >
								<img src="<?php echo APP_BASE . 'images/btttt_plus.png' ?>" title="<?php echo $this->translate('displayvisitssettings'); ?>" />
							</a>
							<div class="clearer"></div>
							
							
		 						<table id="visit_duration_table" style="display:none;">
		 						<!--  
		 							<tr>
		 								<td><label for="visits_per_day"><?php echo $this->translate('visits_per_day')?></label></td>
		 								<td>&nbsp;</td>
		 								<td><input type="text" name="visits_per_day" id="visits_per_day" value="<?php echo $this->visits_per_day ?>" /></td>
		 								<td>&nbsp;</td>
		 							</tr>
		 						-->
		 							<tr>
		 								<td><label for="visit_duration"><?php echo $this->translate('visit_duration')?></label></td>
		 								<td>&nbsp;</td>
		 								<td><input type="text" name="visit_duration" id="visit_duration" value="<?php echo $this->visit_duration ?>" /></td>
		 								<td> </td>
		 							</tr>
		 						</table>
							
								<a href="javascript:;" class="log" id="1" style="padding:5px;float:left;"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a> 
						</div>
						<div class="clearer"></div>
					</div>
				</div>
				<?php endif ?>
				<div class="clearer"></div>
				
				
			<!-- ########### BOX 19: System Sync  ############ -->
			<?php if ($this->displaysystemsync == 1): ?>
				<div class="dragboxpatientdetails" id="block46">
					<h2 class="">Sync</h2>
					<script>
						$('document').ready(function(){
							$("#grow46 .dtbox").load('Systemssync/patientinfo?patid=<?php echo $this->patid2;?>');
						});
					</script>
					<div style="display: none;" id="grow46" class="patientdragbox-content">
						<div id="PtDetails_second" class="dtbox">
						</div>
						<div class="clearer"></div>
					</div>
				</div>
			<?php endif ?>
			<div class="clearer"></div>
			
			<!-- ########### BOX 20: Churches  ############ -->
				<?php if ($this->displaychurch == 1)	{ ?>
				<div class="dragboxpatientdetails" id="block47">
					<h2 class="">Pfarreien</h2>
					<div style="display: none;" id="grow47" class="patientdragbox-content">
						<div id="PtDetails_second" class="dtbox">
							<div id="PtDtls_famdoc_edit" class="PatAndrer_link"><a href="patient/church?id=<?php echo $this->pid ?>">[<?php echo $this->translate('add'); ?>]</a></div>
							 <div id="fdoc_message"><?php echo  $this->churchmsg?></div>
							<?php if ($this->ischurch == 1):?>
								<?php echo $this->patient_churches; ?>
							<?php endif; ?>
						 <br />					
						</div>
						<div class="clearer"></div>
					</div>
				</div>
			<?php } ?>
			<div class="clearer"></div>
			
			
					
								
								<!-- ########### BIG BOX grow6 ACP ############ -->
								<?php if ( (int)($this->displaylivingwill) === 1) { ?>
								<?php 
									$box_id		= 'grow6';
									$box_name	= 'acp_box';
									$box_val	= $this->{$box_name};  //values
									$radio_val	= $box_val['defaults']['radio_values'];
									$contact_p	= $box_val['defaults']['ContactPersonMaster'];
									$box_lang	= $this->translate('acp_box_lang');
									
								?> 
								    <div style="position: relative; opacity: 1; left: 0px; top: 0px;" class="dragboxpatientdetails">
								        <h2><?php echo $box_lang['box_title'] ?></h2>
								        
								        <div style="display: none;" id="<?php echo $box_id; ?>" class="patientdragbox-content">
								        
								        <div class="accordion">
								        	<?php 
												$box_division = 'living_will';
											?>
							    			<h3><span class="accordion_span_name"><?php echo $box_lang['living_will']; ?></span></h3>									
								    		<div data-division_tab="<?php echo $box_division;?>" class="living_will parent_container " style="padding:5px; margin-right: 2px;">
								    			<div>
								    			<?php
													echo $this->formRadio(
														$box_division, 
														isset($box_val[$box_division]['active']) ? $box_val[$box_division]['active'] : null, 
														array(
															'class'=>'living_will_radio',
															'onclick' => 'updatePatientInformation(\'Acp\',\'active\',\''.$box_id.'\',this,\'' . $this->pat_enc_id . '\')'
														),
														$radio_val,
														'<div class="clearer"></div>'); 
												?>
												
													<div class="extra_options" style="<?php if ($box_val[$box_division]['active'] != 'yes') { echo 'display:none';} ?>"" >
														<label>
														<?php 
															echo '<span class="acp_lbl_txt">'.$box_lang['where deposited'].'</span>';
															echo $this->formText('comments', $box_val[$box_division]['comments'], array('style'=>'width: 140px;', 'class'=>'comments' , 'id'=> 'comments_' . $box_division));
														?>
														</label>
														<br />
														<label>
														<?php 
															echo '<span class="acp_lbl_txt">'.$box_lang['from when'].'</span>';
															echo $this->formText('file_date', null, array('style'=>'width: 120px;', 'class'=>'file_date' , 'id'=> 'file_date_' . $box_division)); 
														?>
														</label>
														<br />
														<label>
														<?php 
															echo $this->translate('Upload new template'); 
														?>
															<div id="acp_file_<?php echo $box_division;?>" class="qq_file_uploader"><noscript>' . $this->translate('Please enable JavaScript to use file uploader.') . '</noscript></div>
														</label>
														
														<?php  if ( ! empty($box_val[$box_division]['files'])) : /*list all files*/ ?>
														<label><?php echo $box_lang['file download']; ?></label>
														<ul style="font-size:12px;">
														<?php 
															$latest_file = array_shift($box_val[$box_division]['files']);
															echo '<li><a href="stats/patientfileupload?doc_id='.$latest_file['id'].'&id='.$this->pat_enc_id.'">' . date("d.m.Y", strtotime($latest_file['file_date'])) . ' '. $latest_file['title'] . "</a></li>";
															
															foreach ($box_val[$box_division]['files'] as $old_file) {
																echo '<li><a style="color:gray;font-size:10px;" href="stats/patientfileupload?doc_id='.$old_file['id'].'&id='.$this->pat_enc_id.'">'. $box_lang['old version'] . " ". date("d.m.Y", strtotime($old_file['file_date'])). "</a></li>";
															}
														?>
														</ul>
														<?php endif; /*eo files*/?>
													</div>
												</div>
								    		</div>

											<?php 
												$box_division = 'care_orders';
											?>
							    			<h3><span class="accordion_span_name"><?php echo $box_lang[$box_division] ?></span></h3>	
								    		<div data-division_tab="<?php echo $box_division;?>" class="<?php echo $box_division;?> parent_container" style="padding:5px; margin-right: 2px;">
								    			<div>
								    			<?php
													echo $this->formRadio(
														$box_division, 
														isset($box_val[$box_division]['active']) ? $box_val[$box_division]['active'] : null, 
														array(
															'class'=>'living_will_radio',
															'onclick' => 'updatePatientInformation(\'Acp\',\'active\',\''.$box_id.'\',this,\'' . $this->pat_enc_id . '\')'
														),
														$radio_val,
														'<div class="clearer"></div>'); 
												?>
													<div class="extra_options" style="<?php if ($box_val[$box_division]['active'] != 'yes') { echo 'display:none';} ?>"" >
														<?php if ( ! empty($contact_p)) : ?>
														<label>
														<?php 
															echo '<span class="acp_lbl_txt">'.$box_lang['contact person in charge'].'</span>';
															echo $this->formSelect('contactperson_master_id', $box_val[$box_division]['contactperson_master_id'], array('class'=>'contactperson', 'id'=> 'contactperson_' . $box_division, 'style'=>'width: 140px;') , $contact_p); 
 														?>	
														</label>
														<br />
														<?php endif; ?>
								
														<label>
														<?php 
															echo '<span class="acp_lbl_txt">'.$box_lang['where deposited'].'</span>';
															echo $this->formText('comments', $box_val[$box_division]['comments'], array('style'=>'width: 140px;', 'class'=>'comments' , 'id'=> 'comments_' . $box_division));
														?>
														</label>
														<br />
														
														<label>
														<?php 
															echo '<span class="acp_lbl_txt">'.$box_lang['from when'].'</span>';
															echo $this->formText('file_date', null, array('style'=>'width: 120px;', 'class'=>'file_date' ,'id'=> 'file_date_' . $box_division)); 
														?>
														</label>

														<br />
														<label>
															<?php echo $this->translate('Upload new template'); ?>
															<div id="acp_file_<?php echo $box_division;?>" class="qq_file_uploader"><noscript>' . $this->translate('Please enable JavaScript to use file uploader.') . '</noscript></div>
														</label>
														
														<?php  if ( ! empty($box_val[$box_division]['files'])) : /*list all files*/ ?>
														<label><?php echo $box_lang['file download']; ?></label>
														<ul style="font-size:12px;">
														<?php 
															$latest_file = array_shift($box_val[$box_division]['files']);
															echo '<li><a href="stats/patientfileupload?doc_id='.$latest_file['id'].'&id='.$this->pat_enc_id.'">' . date("d.m.Y", strtotime($latest_file['file_date'])) . ' '. $latest_file['title'] . "</a></li>";
															
															foreach ($box_val[$box_division]['files'] as $old_file) {
																echo '<li><a style="color:gray;font-size:10px;" href="stats/patientfileupload?doc_id='.$old_file['id'].'&id='.$this->pat_enc_id.'">'. $box_lang['old version'] . " ". date("d.m.Y", strtotime($old_file['file_date'])). "</a></li>";
															}
														?>
														</ul>
														<?php endif; /*eo files*/?>
													</div>
												</div>
								    		</div>
								    		
								    		<?php 
												$box_division = 'healthcare_proxy';
											?>
								    		<h3><span class="accordion_span_name"><?php echo $box_lang[$box_division] ?></span></h3>
								    		<div data-division_tab="<?php echo $box_division;?>" class="<?php echo $box_division;?> parent_container " style="padding:5px; margin-right: 2px;">
								    			<div>
								    			<?php
													echo $this->formRadio(
														$box_division, 
														isset($box_val[$box_division]['active']) ? $box_val[$box_division]['active'] : null,
														array(
															'class'=>'living_will_radio',
															'onclick' => 'updatePatientInformation(\'Acp\',\'active\',\''.$box_id.'\',this,\'' . $this->pat_enc_id . '\')'
														),
														$radio_val,
														'<div class="clearer"></div>'); 
												?>
													<div class="extra_options" style="<?php if ($box_val[$box_division]['active'] != 'yes') { echo 'display:none';} ?>"" >
														
														<?php if ( ! empty($contact_p)) : ?>
														<label>
														<?php 
															echo '<span class="acp_lbl_txt">'.$box_lang['contact person in charge'].'</span>';
															echo $this->formSelect('contactperson_master_id', $box_val[$box_division]['contactperson_master_id'], array('class'=>'contactperson', 'id'=> 'contactperson_' . $box_division, 'style'=>'width: 140px;') , $contact_p); 
 													?>	
														</label>
														<br />
														<?php endif; ?>
														
														<label>
														<?php 
															echo '<span class="acp_lbl_txt">'.$box_lang['where deposited'].'</span>';
															echo $this->formText('comments', $box_val[$box_division]['comments'], array('style'=>'width: 140px;', 'class'=>'comments' , 'id'=> 'comments_' . $box_division));
														?>
														</label>
														<br />
														
														<label>
														<?php 
															echo '<span class="acp_lbl_txt">'.$box_lang['from when'].'</span>';
															echo $this->formText('file_date', null, array('style'=>'width: 120px;', 'class'=>'file_date' ,'id'=> 'file_date_' . $box_division)); 
														?>
														</label>
														<br />
														<label>
															<?php echo $this->translate('Upload new template'); ?>
															<div id="acp_file_<?php echo $box_division;?>" class="qq_file_uploader"><noscript>' . $this->translate('Please enable JavaScript to use file uploader.') . '</noscript></div>
														</label>
														
														<?php  if ( ! empty($box_val[$box_division]['files'])) : /*list all files*/ ?>
														<label><?php echo $box_lang['file download']; ?></label>
														<ul style="font-size:12px;">
														<?php 
															$latest_file = array_shift($box_val[$box_division]['files']);
															echo '<li><a href="stats/patientfileupload?doc_id='.$latest_file['id'].'&id='.$this->pat_enc_id.'">' . date("d.m.Y", strtotime($latest_file['file_date'])) . ' '. $latest_file['title'] . "</a></li>";
															
															foreach ($box_val[$box_division]['files'] as $old_file) {
																echo '<li><a style="color:gray;font-size:10px;" href="stats/patientfileupload?doc_id='.$old_file['id'].'&id='.$this->pat_enc_id.'">'. $box_lang['old version'] . " ". date("d.m.Y", strtotime($old_file['file_date'])). "</a></li>";
															}
														?>
														</ul>
														<?php endif; /*eo files*/?>
													</div>
												</div>
								    		</div>
								    		</div>							    	    
								    	    
								    	    <div>
								    	    <a href="javascript:;" class="log" id="6"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a>
								    	    </div>
								        </div>
								    </div>
								    <div class="clearer"></div>
								<?php } //eo ACP Livingwill  ?>
								
			
			
			
			
			<div class="clearer"></div>
            
            
                    
                                
            <!-- ########### BIG BOX Orientation II ############ -->
                                <?php if ( (int)($this->displayOrientationII) === 1) {?>
                                <?php 
                                    $box_id     = 'grow171120';
                                    $box_name   = 'orientationII_box';
                                    $box_val    = $this->{$box_name};  //values
                                    $radio_val  = $box_val['defaults']['radio_values'];
                                    $cb_val     = $box_val['defaults']['cb_values'];
                                    $active_val = $box_val['active'];
                                    $box_lang   = $this->translate('orientationII_box_lang');
                                    
                                ?> 
                                    <div style="position: relative; opacity: 1; left: 0px; top: 0px;" class="dragboxpatientdetails">
                                        <h2><?php echo $box_lang['box_title']; ?></h2>
                                        
                                        <div style="display: none;" id="<?php echo $box_id; ?>" class="patientdragbox-content">
			
                                            <div class='patDetReligradio'>
                                                <?php
                                                    echo $this->formMultiCheckbox(
                                                        $box_name.'[]', 
                                                        $active_val,
                                                        array(
                                                            'class'=>'living_will_radio',
                                                            'onclick' => 'orientation_changed(this);',
                                                            'onchange' => 'updatePatientInformation(\'Orientation2\',\'orientation\',\''.$box_id.'\',this,\'' . $this->pat_enc_id . '\')',

                                                        ),
                                                        $radio_val,
                                                        '<div class="clearer"></div>'); 
                                                ?>
                                                <div class='group_communication' style="padding-left:15px; <?php if ( ! in_array('communication restricted', $active_val)) echo 'display:none;'?>">
                                                <?php
                                                    echo $this->formMultiCheckbox(
                                                        $box_name.'[]', 
                                                        $active_val,
                                                        array(
                                                            'class'=>'living_will_radio',
                                                            'onclick' => 'updatePatientInformation(\'Orientation2\',\'orientation\',\''.$box_id.'\',this,\'' . $this->pat_enc_id . '\')'
                                                        ),
                                                        $cb_val,
                                                        '<div class="clearer"></div>'); 
                                                ?>
                                                </div>
                                            </div>
                                            
                                            <a href="javascript:;" class="log" id="171120"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a>
                                        </div>
                                        
                                    </div>
			<?php } //eo Orientation II  ?>
            
            <div class="clearer"></div>
			
				
			<div class="rightcontent left dtbox" id="patiLocn_outer">
				<div class="rightcontentOuter" id="patiLocn">
					<div style="width: 100%;" id="Patdetail_contentInfdenPa">
						<div style="-moz-user-select: none;" unselectable="on" class="patientcolumndetails ui-sortable" id="column1">
												
						
						<!-- ########### SMALL BOX 1  ############ -->
						<?php if ($this->displaypatientlives == 1)	{?>
								<div class="dragboxpatientdetails" id="item_1">
									<h2 class=""><?php echo $this->translate('lives') ?></h2>
									<div style="display: none;" id="grow1" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8">
											<label for="alone"> 
												<?php echo $this->formCheckbox('alone', $this->alone, array ('onclick' => 'updatePatientInformation(\'Lives\',\'alone\',\'grow1\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
												<?php echo $this->translate('alone') ?> 
											</label>
											<div class="clearer"></div>

											<label for="house_of_relatives">
												<?php echo $this->formCheckbox('house_of_relatives', $this->house_of_relatives, array ('onclick' => 'updatePatientInformation(\'Lives\',\'house_of_relatives\',\'grow1\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
												<?php echo $this->translate('houseofrelatives') ?> 
											</label>
											<div class="clearer"></div>

											<label for="apartment"> 
												<?php echo $this->formCheckbox('apartment', $this->apartment, array ('onclick' => 'updatePatientInformation(\'Lives\',\'apartment\',\'grow1\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
												<?php echo $this->translate('apartment') ?>
											</label>
											<div class="clearer"></div>

											<label for="home"> 
												<?php echo $this->formCheckbox('home', $this->home, array ('onclick' => 'updatePatientInformation(\'Lives\',\'home\',\'grow1\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
												<?php echo $this->translate('home') ?> 
											</label>
											<div class="clearer"></div>

											<label for="hospiz"> 
												<?php echo $this->formCheckbox('hospiz', $this->hospiz, array ('onclick' => 'updatePatientInformation(\'Lives\',\'hospiz\',\'grow1\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
												Hospiz 
											</label>
											<div class="clearer"></div>

											<label for="with_partner"> 
												<?php echo $this->formCheckbox('with_partner', $this->with_partner, array ('onclick' => 'updatePatientInformation(\'Lives\',\'with_partner\',\'grow1\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
												 mit Partner 
											</label>
											<div class="clearer"></div>

											<label for="with_child"> 
												<?php echo $this->formCheckbox('with_child', $this->with_child, array ('onclick' => 'updatePatientInformation(\'Lives\',\'with_child\',\'grow1\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
												mit Kindern 
											</label>
											<div class="clearer"></div>

											<label id="patiLocn_left_hme_lbl" for="sonstiges"> 
												<?php echo $this->formCheckbox('sonstiges', $this->sonstiges, array ('onclick' => 'updatePatientInformation(\'Lives\',\'sonstiges\',\'grow1\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
												Sonstiges 
											</label>
											<div class="clearer"></div>
											</div>
										<div class="clearer"></div>
										<br />
										<a href="javascript:;" class="log" id="1"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								</div>
							<?php } ?> <!-- Stamdaten left start --> 
							
							
							<!-- ########### SMALL BOX 2  ############ -->
							<?php if ($this->displayfamilienstand == 1){	?>
								<div class="dragboxpatientdetails" id="item_8">
									<h2 class="">Familienstand</h2>
									<div style="display: none;" id="grow16" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8"><?php echo $this->formRadio('familienstand', $this->familienstand, array ('onclick' => 'updatePatientInformation(\'Familienstand\',\'familienstand\',\'grow16\',this,\'' . $this->pat_enc_id . '\',\'fam\')'), $this->familienstands, '<div class="clearer"></div>'); ?>
										</div>
										<div class="clearer"></div>
										<br />
										<a href="javascript:;" class="log" id="16"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								</div>
							<?php } ?> 
							
							<!-- ########### SMALL BOX 3  ############ -->
							<?php if ($this->displayernahrung == 1) { ?>
								<div style="position: relative; opacity: 1; left: 0px; top: 0px;" class="dragboxpatientdetails" id="item_10">
									<h2 class="">Ern&#228;hrung</h2>
									<div style="display: none;" id="grow20" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8">
										
											<?php echo $this->formMultiCheckbox('ernahrung[]', $this->ernahrung, array ('onclick' => 'updatePatientInformation(\'Ernahrung\',\'ernahrung\',\'grow20\',this,\'' . $this->pat_enc_id . '\', \'ern\')'), $this->ernahrungs, '<div class="clearer"></div>'); ?>
											<div class="clearer"></div>
											<label for="peg">
												<?php echo $this->formCheckbox('peg', $this->peg, array ('onclick' => 'updatePatientInformation(\'MoreInfo\',\'peg\',\'grow20\',this,\'' . $this->pat_enc_id . '\',\'pegmorediv\')'), array ('1')); ?>
												<?php echo $this->translate('peg') ?>
											</label> 
											<div class="clearer"></div>
											<div id="pegmorediv" style="display: none;"><label id="patiLocn_mobcar_mob_gble4" for="pegmore">Ablauf PEG:</label><input type="text" id="pegmore" name="pegmore" value="<?php echo $this->pegmore ?>" /></div>
											<div class="clearer"></div>
											
											
											<label id="patiLocn_morinfon_portlbl" for="port"> 
												<?php echo $this->formCheckbox('port', $this->port, array ('onclick' => 'updatePatientInformation(\'MoreInfo\',\'port\',\'grow20\',this,\'' . $this->pat_enc_id . '\',\'portmorediv\')'), array ('1')); ?>
												<?php echo $this->translate('port') ?>
											</label>
											<div class="clearer"></div>
											<div id="portmorediv" style="display: none;"><label id="patiLocn_mobcar_mob_gble4" for="portmore">Ablauf Port:</label><input type="text" id="portmore" name="portmore" value="<?php echo $this->portmore ?>" /></div>
											<div class="clearer"></div>


											<label id="patiLocn_morinfon_zvklbl" for="zvk"> 
												<?php echo $this->formCheckbox('zvk', $this->zvk, array ('onclick' => 'updatePatientInformation(\'MoreInfo\',\'zvk\',\'grow20\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
												<?php echo $this->translate('zvk') ?> 
											</label>
											<div class="clearer"></div>
											
											<label for="magensonde"> 
												<?php echo $this->formCheckbox('magensonde', $this->magensonde, array ('onclick' => 'updatePatientInformation(\'MoreInfo\',\'magensonde\',\'grow20\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
												<?php echo $this->translate('magensonde') ?> 
											</label>
											<div class="clearer"></div>											
											</div>
										<div class="clearer"></div>
										<br />
										<a href="javascript:;" class="log" id="20"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								</div>
							<?php } ?> 
							
							<!-- ########### SMALL BOX 4  ############ -->
							<?php if ($this->displaystaatszugehorigkeit == 1) { ?>
								<div class="dragboxpatientdetails" id="item_12">
									<h2 class=""><?php echo $this->translate('staatszugehorigkeit') ?></h2>
									<div style="display: none;" id="grow17" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8"><?php echo $this->formRadio('stastszugehorigkeit', $this->stastszugehorigkeit, array ('onclick' => 'updatePatientInformation(\'Stastszugehorigkeit\',\'stastszugehorigkeit\',\'grow17\',this,\'' . $this->pat_enc_id . '\', \'sta\')'), $this->stastszugehorigkeits, '<div class="clearer"></div>'); ?>
										<div class="clearer"></div>
										<input type="text" id="anderefree" name="anderefree" value="<?php echo $this->anderefree ?>" class="anderefree" style="width: 140px;" /></div>

										<div class="clearer"></div>
										<br />
										<a href="javascript:;" class="log" id="17"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								</div>
							<?php } ?>
							
							 <!-- ########### SMALL BOX 5  ############ -->
							<?php if ($this->displayausscheidung == 1) { ?>
								<div class="dragboxpatientdetails" id="item_16">
									<h2 class="">Ausscheidung</h2>
									<div style="display: none;" id="grow21" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8">
										<?php echo $this->formMultiCheckbox('ausscheidung[]', $this->ausscheidung, array ('onclick' => 'updatePatientInformation(\'Ausscheidung\',\'ausscheidung\',\'grow21\',this,\'' . $this->pat_enc_id . '\', \'aus\')'), $this->ausscheidungs, '<div class="clearer"></div>'); ?>
										<?php if( ! 1 ) : //flower-power, will i fix this or not ?? ispc-2070 ?>
                                        <div class="clearer"></div>
										<label for="dk">
											<?php echo $this->formCheckbox('dk', $this->dk, array ('onclick' => 'updatePatientInformation(\'MoreInfo\',\'dk\',\'grow21\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
											<?php echo $this->translate('dk') ?>
										</label>
                                        <?php endif; ?>
                                        
										<div class="clearer"></div>
										</div>
										<div class="clearer">
											<div id="log_content_grow21"></div>
											<br />
											<a href="javascript:;" class="log" id="21"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>

									</div>
								</div>
								<?php } ?> 
								<!-- Stamdaten left end -->
								
								<!-- ########### SMALL BOX 6  ############ --> 
								<?php if ($this->displaysupply == 1){	?>
								<div class="dragboxpatientdetails" id="item_3">
									<h2 class=""><?php echo $this->translate('supply') ?></h2>
									<div style="display: none;" id="grow4" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8"><label for="even"> <?php echo $this->formCheckbox('even', $this->even, array ('onclick' => 'updatePatientInformation(\'Supply\',\'even\',\'grow4\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
										<?php echo $this->translate('even') ?> </label> <br />
										<label for="spouse"> <?php echo $this->formCheckbox('spouse', $this->spouse, array ('onclick' => 'updatePatientInformation(\'Supply\',\'spouse\',\'grow4\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
										<?php echo $this->translate('spouse') ?> </label> <br />
										<label for="member"> <?php echo $this->formCheckbox('member', $this->member, array ('onclick' => 'updatePatientInformation(\'Supply\',\'member\',\'grow4\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
										<?php echo $this->translate('supply_member') ?> </label> <br />
										<label for="private_support"> <?php echo $this->formCheckbox('private_support', $this->private_support, array ('onclick' => 'updatePatientInformation(\'Supply\',\'private_support\',\'grow4\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
										<?php echo $this->translate('support') ?> </label> <br />
										<label for="nursing"> <?php echo $this->formCheckbox('nursing', $this->nursing, array ('onclick' => 'updatePatientInformation(\'Supply\',\'nursing\',\'grow4\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
										<?php echo $this->translate('nursing') ?> </label> <br />
										<label for="palliativpflegedienst"> <?php echo $this->formCheckbox('palliativpflegedienst', $this->palliativpflegedienst, array ('onclick' => 'updatePatientInformation(\'Supply\',\'palliativpflegedienst\',\'grow4\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
										<?php echo $this->translate('palliativpflegedienst') ?> </label> <br />
										<label for="heimpersonal"> <?php echo $this->formCheckbox('heimpersonal', $this->heimpersonal, array ('onclick' => 'updatePatientInformation(\'Supply\',\'heimpersonal\',\'grow4\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
										Heimpersonal </label>
										<div style="clear: both;"></div>
										</div>
										<div style="clear: both;"></div>
										<br />
										<a href="javascript:;" class="log" id="4"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								</div>
								<?php } ?>
								
								<!-- ########### SMALL BOX 7  ############ --> 
								<?php if ($this->displaymobility == 1) { ?>
								<div style="position: relative; opacity: 1; left: 0px; top: 0px;" class="dragboxpatientdetails" id="item_5">
									<h2 class=""><?php echo $this->translate('mobility') ?></h2>
									<div style="display: none;" id="grow5" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8">
											<label for="bed">
												<?php echo $this->formCheckbox('bed', $this->bed, array ('onclick' => 'updatePatientInformation(\'Mobility\',\'bed\',\'grow5\',this,\'' . $this->pat_enc_id . '\',\'bedmorediv\')'), array ('1')); ?>
												<?php echo $this->translate('bed') ?>
											</label>
											<div class="LebtLeftDiv left" id="bedmorediv" style="display: none"><input type="text" name="bedmore" id="bedmore" value="<?php echo $this->bedmore ?>" /></div>
											<div class="clearer"></div>
											<label for="walker"> <?php echo $this->formCheckbox('walker', $this->walker, array ('onclick' => 'updatePatientInformation(\'Mobility\',\'walker\',\'grow5\',this,\'' . $this->pat_enc_id . '\',\'walkermorediv\')'), array ('1')); ?>
											<?php echo $this->translate('walker') ?> </label>
											<div class="LebtLeftDiv left" id="walkermorediv" style="display: none"><input type="text" name="walkermore" id="walkermore"
																										   value="<?php echo $this->walkermore; ?>" /></div>

											<div class="clearer"></div>
											<label for="wheelchair"> <?php echo $this->formCheckbox('wheelchair', $this->wheelchair, array ('onclick' => 'updatePatientInformation(\'Mobility\',\'wheelchair\',\'grow5\',this,\'' . $this->pat_enc_id . '\',\'wheelchairmorediv\')'), array ('1')); ?>
											<?php echo $this->translate('wheelchair') ?> </label>
											<div class="LebtLeftDiv left" id="wheelchairmorediv" style="display: none;"><input type="text" id="wheelchairmore" name="wheelchairmore"
																											   value="<?php echo $this->wheelchairmore ?>" /></div>
											<div class="clearer"></div>
											<label for="goable"> <?php echo $this->formCheckbox('goable', $this->goable, array ('onclick' => 'updatePatientInformation(\'Mobility\',\'goable\',\'grow5\',this,\'' . $this->pat_enc_id . '\',\'goablemorediv\')'), array ('1')); ?>
											<?php echo $this->translate('goable') ?> </label>
											<div class="LebtLeftDiv left" id="goablemorediv" style="display: none;"><input type="text" id="goablemore" name="goablemore"
																										    value="<?php echo $this->goablemore ?>" /></div>
											<div class="clearer"></div>
											<label for="nachtstuhl"> <?php echo $this->formCheckbox('nachtstuhl', $this->nachtstuhl, array ('onclick' => 'updatePatientInformation(\'Mobility\',\'nachtstuhl\',\'grow5\',this,\'' . $this->pat_enc_id . '\',\'nachtstuhlmorediv\')'), array ('1')); ?>
												Nachtstuhl </label>
											<div class="LebtLeftDiv left" id="nachtstuhlmorediv" style="display: none;"><input type="text" id="nachtstuhlmore" name="nachtstuhlmore"
																											   value="<?php echo $this->nachtstuhlmore ?>" /></div>
											<div class="clearer"></div>
											<label for="wechseldruckmatraze"> <?php echo $this->formCheckbox('wechseldruckmatraze', $this->wechseldruckmatraze, array ('onclick' => 'updatePatientInformation(\'Mobility\',\'wechseldruckmatraze\',\'grow5\',this,\'' . $this->pat_enc_id . '\',\'wechseldruckmatrazemorediv\')'), array ('1')); ?>
												Wechseldruckmatratze </label>
											<div class="LebtLeftDiv left" id="wechseldruckmatrazemorediv" style="display: none;"><input type="text" id="wechseldruckmatrazemore"
																													  name="wechseldruckmatrazemore" value="<?php echo $this->wechseldruckmatrazemore ?>" /></div>
										</div>
										<div style="clear: both;"></div>
										<br />
										<a href="javascript:;" class="log" id="5"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								</div>
								<?php } //Mobilityblock  ?> 


								<!-- ########### SMALL BOX 8 - new grow6 was added, this is now !1 ############ -->
								<?php if ( ! 1 && $this->displaylivingwill == 1) { ?>
								    <div style="position: relative; opacity: 1; left: 0px; top: 0px;" class="dragboxpatientdetails" id="item_7">
								        <h2 id="InfoDenPatie_paverg"><?php echo $this->translate('livingwill') ?></h2>
								        <div style="display: none;" id="grow6" class="patientdragbox-content">
								    	<div class="patDetReligradio" id="stmDaertRadio8">
									    <label id="patiLocn_liviwi_yeslbl" for="living_will">
										<?php echo $this->formRadio('living_will', $this->living_will, array('class'=>'living_will_radio','onclick' => 'updatePatientInformation(\'Master\',\'living_will\',\'grow6\',this,\'' . $this->pat_enc_id . '\', \'living_willmorediv\')'), $this->living_will_r, '<div class="clearer"></div>'); ?>
									    </label>
									    <br />
								    	    <div id="living_willmorediv" style="display: none;">
								    		<div style="clear: both;"></div>
								    		<label for="living_will_from">von wann </label>
										<input type="text" name="living_will_from" id="living_will_from" value="<?php echo $this->living_will_from ?>" style="width: 142px;" />
								
										<div style="clear: both;"></div>
								    		<br />
								
										<label for="living_will_deposited">wo hinterlegt </label>
										<input type="text" name="living_will_deposited" id="living_will_deposited" value="<?php echo $this->living_will_deposited ?>" />
									    </div>
								    	    <div style="clear: both;"></div>
								    	    <br />
								    	    <a href="javascript:;" class="log" id="6"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								        </div>
								    </div>
								<?php } //Livingwill  ?>
								
								
						
								
								
								<!-- ########### SMALL BOX Keimbesiedelung = Germination = Bacteria  ############ -->
								<?php if ($this->displaygermination == 1) { ?>
								    <div style="position: relative; opacity: 1; left: 0px; top: 0px;" class="dragboxpatientdetails" id="item_<?php echo $this->germination['id']; ?>">
								        <h2><?php echo $this->translate('germination') ?></h2>
								        <div style="display: none;" id="grow<?php echo $this->germination['id']; ?>" class="patientdragbox-content">
									    	<div>
											    <label>
											    	<?php echo $this->formCheckbox('germination_cbox', $this->germination['germination_cbox'], array ('onclick' => 'updatePatientInformation(\'Germination\',\'germination_cbox\',\'grow' . $this->germination['id'].'\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
													<?php echo $this->translate('germination_cbox_label') ?>
											    </label>
											    
											    <?php echo $this->formText('germination_text', $this->germination['germination_text'], array('onchange' => 'updatePatientInformation(\'Germination\',\'germination_text\',\'grow' . $this->germination['id'] . '\',this,\'' . $this->pat_enc_id . '\')')); ?>
											    
											   
									    	    <div style="clear: both;"></div>
									    	    <br />
									    	    <a  class="log" id="<?php echo $this->germination['id']; ?>"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a>
									    	</div>
								    	</div>
									</div>
							<?php } //germination, Keimbesiedelung, Bacteria  ?>
						</div>



						<div style="-moz-user-select: none;" unselectable="on" class="patientcolumndetails ui-sortable" id="column2">
						
						<!-- ########### SMALL BOX 9  ############ -->
						<?php if ($this->displayreligions == 1) {?>
								<div class="dragboxpatientdetails" id="item_2">
									<h2 class="">Religionszugeh&#246;rigkeit</h2>
									<div style="display: none;" id="grow8" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8"><?php echo $this->formRadio('religion', $this->religion, array ('onclick' => 'updatePatientInformation(\'Religions\',\'religion\',\'grow8\',this,\'' . $this->pat_enc_id . '\',\'rad\')'), $this->religions, '<div class="clearer"></div>'); ?></div>
										<div class="clearer"></div>
										<div id="log_content_grow8"></div>
										<br />
										<a href="javascript:;" class="log" id="8"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								</div>
							<?php } // Religionblock ?> <!-- Stamdaten right start	--> 
							
							
							
							<!-- ########### SMALL BOX 10  ############ -->
							<?php if ($this->displayhilfsmittel == 1) { ?>
								<div class="dragboxpatientdetails" id="item_14">
									<h2 class="">Hilfsmittel</h2>
									<div style="display: none;" id="grow24" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8">
											<?php echo $this->formMultiCheckbox('hilfsmittel[]', $this->hilfsmittel, array ('onclick' => 'updatePatientInformation(\'Hilfsmittel\',\'hilfsmittel\',\'grow24\',this,\'' . $this->pat_enc_id . '\', \'hil\')'), $this->hilfsmittels, '<div class="clearer"></div>'); ?>

											<div class="clearer"></div>
											<label for="pumps">
												<?php echo $this->formCheckbox('pumps', $this->pumps, array ('onclick' => 'updatePatientInformation(\'MoreInfo\',\'pumps\',\'grow24\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
												<?php echo $this->translate('pumps') ?>
											</label>
										</div>
										<div class="clearer"></div>
										<div id="log_content_grow24"></div>
										<br />
										<a href="javascript:;" class="log" id="24"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								</div>
							<?php } ?> 
							
							
							<!-- ########### SMALL BOX 11  ############ -->
							<?php if ($this->displaywunsch == 1) {?>
								<div class="dragboxpatientdetails" id="item_15">
									<h2 class="">Wunsch des Patienten</h2>

									<div style="display: none;" id="grow25" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8"><?php echo $this->formMultiCheckbox('wunsch[]', $this->wunsch, array ('onclick' => 'updatePatientInformation(\'Wunsch\',\'wunsch\',\'grow25\',this,\'' . $this->pat_enc_id . '\', \'wun\')'), $this->wunschs, '<div class="clearer"></div>'); ?>
											<div id="wmorediv"><input type="text" name="wmore" id="wmore" value="<?php echo $this->wunschmore ?>" /></div>
										</div>
										<div class="clearer"></div>
										<br />
										<a href="javascript:;" class="log" id="25"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								</div>
							<?php } ?>
							 
							 <!-- ########### SMALL BOX 12  ############ -->
							<?php if ($this->displayvigilanz == 1) {?>
								<div class="dragboxpatientdetails" id="item_9">
									<h2 class="">Vigilanz</h2>
									<div style="display: none;" id="grow18" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8"><?php echo $this->formRadio('vigilanz', $this->vigilanz, array ('onclick' => 'updatePatientInformation(\'Vigilanz\',\'vigilanz\',\'grow18\',this,\'' . $this->pat_enc_id . '\',\'vig\')'), $this->vigilanzs, '<div class="clearer"></div>'); ?>
										</div>
										<div class="clearer"></div>
										<div id="log_content_grow18"></div>
										<br />
										<a href="javascript:;" class="log" id="18"> <img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								</div>
							<?php } ?> 

							<!-- ########### SMALL BOX 13  ############ -->
							<?php if ($this->displaykunstliche == 1) { ?>
								<div style="position: relative; opacity: 1; left: 0px; top: 0px;" class="dragboxpatientdetails" id="item_11">
									<h2 id="InfoDenPatie_paverg">K&#252;nstliche Ausg&#228;nge</h2>
									<div style="display: none;" id="grow22" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8">
											<?php echo $this->formMultiCheckbox('kunstliche[]', $this->kunstliche, array ('onclick' => 'updatePatientInformation(\'Kunstliche\',\'kunstliche\',\'grow22\',this,\'' . $this->pat_enc_id . '\', \'kun\')'), $this->kunstliches, '<div class="clearer"></div>'); ?>
											<div class="clearer"></div>
											<div id="kunstlichemorediv">
												<input type="text" id="kunstlichemore"	name="kunstlichemore" value="<?php echo $this->kunstlichemore ?>" />
											</div>

											<div class="clearer"></div>
										</div>
										<div class="clearer"></div>
										<div id="log_content_grow22"></div>
										<br />
										<a href="javascript:;" class="log" id="22"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								</div>
							<?php } ?> 
							
							<!-- ########### SMALL BOX 14  ############ -->
							<?php if ($this->displayorientierung == 1) { ?>
								<div class="dragboxpatientdetails" id="item_13">
									<h2 class="">Orientierung</h2>
									<div style="display: none;" id="grow19" class="patientdragbox-content">
										<div class="patDetReligradio" id="stmDaertRadio8"><?php echo $this->formMultiCheckbox('orientierung[]', $this->orientierung, array ('onclick' => 'updatePatientInformation(\'Orientierung\',\'orientierung\',\'grow19\',this,\'' . $this->pat_enc_id . '\', \'ori\')'), $this->orientierungs, '<div class="clearer"></div>'); ?>
										</div>
										<div class="clearer"></div>
										<div class="patDetReligradio" id="stmDaertRadio8">
											<div class="marginLeft20">
												<label id="patineDetaOrilsbl1" for="checkbox01"> 
													<?php echo $this->formCheckbox('sprachlich', $this->sprachlich, array ("class" => "toggleDiv", "id" => "checkbox01", 'onclick' => 'updatePatientInformation(\'Orientierung\',\'sprachlich\',\'grow19\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
													sprachlich 
												</label>
												<div class="clearer"></div>
												<label id="patineDetaOrilsbl2" for="checkbox02"> 
													<?php echo $this->formCheckbox('kognitiv', $this->kognitiv, array ("class" => "toggleDiv", "id" => "checkbox02", 'onclick' => 'updatePatientInformation(\'Orientierung\',\'kognitiv\',\'grow19\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
													kognitiv 
												</label>
												<div class="clearer"></div>
												<label id="patineDetaOrilsbl3" for="checkbox03"> 
													<?php echo $this->formCheckbox('horprobleme', $this->horprobleme, array ("class" => "toggleDiv", "id" => "checkbox03", 'onclick' => 'updatePatientInformation(\'Orientierung\',\'horprobleme\',\'grow19\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?>
													H&#246;rprobleme 
												</label>
												<div class="clearer"></div>
												</div>
										</div>
										<div id="log_content_grow19"></div>
										<br />
										<a href="javascript:;" class="log" id="19"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
								</div>
							<?php } ?>
 							<!-- Stamdaten right end	--> 
							
							
							<!-- ########### SMALL BOX 14  ############ -->
							<?php if ($this->displaycarelevel) { ?>
								<div class="dragboxpatientdetails" id="item_6">
									<h2 class=""><?php echo $this->translate('carelevel') ?></h2>
									<div style="display: none;" id="grow7" class="patientdragbox-content">
										<a href="patientnew/maintenancestage?id=<?php echo $this->pid ?>" class="maintenancestage_addlink">[<?php echo $this->translate('add'); ?>]</a>
										<div class="patDetReligradio" id="stmDaertRadio8">
											<div class="LebtLeftDiv left" id="patiLocn_calel_inpt"  style="width: 100%;" >
												<div class="oldpflege" style="display: none;">
													<select style="width: 150px;" class="combo" id="stage" name="stage" onchange="updatePatientInformation('MaintainanceStage','stage','grow7',this,'<?php echo $this->pat_enc_id ?>','drop')">
														
														<!-- old Pflegestufe that was abolished on 2016.12.31
														<option value="" id="patiLocn_calel_op1"><?php echo $this->translate('pleaseselect') ?>...</option>
														<option value="1" id="patiLocn_calel_op2" <?php if ($this->stage == "1"){	echo "selected='selected'";	} ?>>1</option>
														<option value="2" id="patiLocn_calel_op3" <?php if ($this->stage == "2"){	echo "selected='selected'";	} ?>>2</option>
														<option value="3" id="patiLocn_calel_op4" <?php if ($this->stage == "3"){	echo "selected='selected'"; } ?>>3</option>
														<option value="3+" id="patiLocn_calel_op4" <?php if ($this->stage == "3+")	{ echo "selected='selected'"; } ?>>3+</option>
														<option value="keine" id="patiLocn_calel_op4" <?php if ($this->stage == "keine"){	echo "selected='selected'";	} ?>>Keine</option>
														-->
														<!-- new Pflegegrade values as of 2017 -->
														<option value=""><?php echo $this->translate('pleaseselect') ?>...</option>
														<option value="keine" <?php if ($this->stage == "keine"){	echo "selected='selected'";	} ?>>Keine</option>
														<option value="1" <?php if ($this->stage == "1"){	echo "selected='selected'";	} ?>>1</option>
														<option value="2" <?php if ($this->stage == "2"){	echo "selected='selected'";	} ?>>2</option>
														<option value="3" <?php if ($this->stage == "3"){	echo "selected='selected'"; } ?>>3</option>
														<option value="4" <?php if ($this->stage == "4"){	echo "selected='selected'"; } ?>>4</option>
														<option value="5" <?php if ($this->stage == "5"){	echo "selected='selected'"; } ?>>5</option>
													</select>
													
													
													<?php echo $this->formText('fromdate', null, array('style'=>'width: 120px;', 'class'=>'mstage_date' , 'id'=> 'mstage_fromdate')); ?> 
												</div>
											</div>
											<div style="clear: both;"></div>
											<div class="oldpflege" style="display: none;">
												<label for="erstantrag"> 
												<?php echo $this->formCheckbox('erstantrag', $this->erstantrag, array ('onclick' => 'updatePatientInformation(\'MaintainanceStage\',\'erstantrag\',\'grow7\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?> Erstantrag </label>
												<?php echo $this->formText('e_fromdate', null, array('style'=>'width: 120px;', 'class'=>'mstage_date' , 'id'=> 'mstage_e_fromdate')); ?>
												<div style="clear: both;"></div>
	
												<label for="horherstufung"> 
												<?php echo $this->formCheckbox('horherstufung', $this->horherstufung, array ('onclick' => 'updatePatientInformation(\'MaintainanceStage\',\'horherstufung\',\'grow7\',this,\'' . $this->pat_enc_id . '\')'), array ('1')); ?> Höherstufung beantragt </label>
												<?php echo $this->formText('h_fromdate', null, array('style'=>'width: 120px;', 'class'=>'mstage_date' , 'id'=> 'mstage_h_fromdate')); ?>
												<div style="clear: both;"></div>
											</div>
										</div>
										
										<div id="listcarelevel" class="grid"><?php echo $this->carelevellist ?></div>
										
										<div class="oldpflege" style="display: none;">
											<div id="log_content_grow7"></div>
											<br />
											<a href="javascript:;" class="log" id="7"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a></div>
										</div>
										
										
								</div>
						<?php }//Carelevel  ?>
                        
                        
                        
                        
                        
                        
                        <!-- ########### SMALL BOX Mobility II ############ -->
                        <?php if ( (int)($this->displayMobilityII) === 1) {?>
                        <?php 
                            $box_id     = 'grow171121';
                            $box_name   = 'mobilityII_box';
                            $box_val    = $this->{$box_name};  //values
                            //$radio_val  = $box_val['defaults']['radio_values'];
                            $cb_val     = $box_val['defaults']['cb_values'];
                            $active_val = $box_val['active'];
                            $box_lang   = $this->translate('mobilityII_box_lang');
                                    
                        ?> 
                        <div class="dragboxpatientdetails">
                            <h2><?php echo $box_lang['box_title']; ?></h2>
                            <div style="display: none;" id="<?php echo $box_id; ?>" class="patientdragbox-content">
                                <div class='patDetReligradio'>
                                <?php
                                    echo $this->formMultiCheckbox(
                                                    $box_name.'[]', 
                                                    $active_val,
                                                    array(
                                                        //'class'=>'living_will_radio',
                                                        'onclick' => 'updatePatientInformation(\'Mobility2\',\'mobility\',\''.$box_id.'\',this,\'' . $this->pat_enc_id . '\')'
                                                    ),
                                                    $cb_val,
                                                    '<div class="clearer"></div>'); 
                                ?>
                                </div>
                                <a href="javascript:;" class="log" id="171121"><img src="<?php echo RES_FILE_PATH; ?>/images/history.png" /></a>
                            </div>  
                        </div>
            <?php } //eo Mobility II  ?>
                        
                        
                        
                        
                        
                        
						</div>
						<div class="clearer"></div>
					</div>


					<div class="Lebt left" id="patiLocn_left">
						<div class="Versorgung left" id="patiLocn_right"><br />
						</div>
						<div style="clear: both;"></div>
					</div>

					<div id="patientDet_Infor_denPat" class="dtbox" style="display: none">
						<h4 class="LineHeading"><?php echo $this->translate('carelevellist') ?></h4>
						
						<div class="ClrBoth"></div>
					</div>
				</div>
			</div>
		</div>



		<div id="popupContact"><a id="popupContactClose">x</a>
			<p id="contactArea"><iframe id='add_family_doc' frameborder='0' src='' scrolling="vertical" style="margin: 0 auto; overflow-x: hidden; width: 600px;"></iframe>
			</p>
		</div>
		<div id="backgroundPopup"></div>

		<script type="text/javascript">
					if($('#peg:checked').length==1){$("#pegmorediv").show();} else {$("#pegmorediv").hide();}
					if($('#port:checked').length==1){$("#portmorediv").show();} else {$("#portmorediv").hide();}
					if($('#kunstliche-5:checked').length==1){$("#kunstlichemorediv").show();} else {$("#kunstlichemorediv").hide();$('#kunstlichemore').val("");}
					/* if($('input[name="living_will"]:checked').val()==1){$("#living_willmorediv").show();} else {$("#living_willmorediv").hide();} */

					if($('#bed:checked').length==1){$("#bedmorediv").show();}
					if($('#wunsch-13:checked').length==1){$("#wmorediv").show();}
					if($('#walker:checked').length==1){$("#walkermorediv").show();}
					if($('#wheelchair:checked').length==1){$("#wheelchairmorediv").show();}
					if($('#goable:checked').length==1){$("#goablemorediv").show();}
					if($('#nachtstuhl:checked').length==1){$("#nachtstuhlmorediv").show();}
					if($('#wechseldruckmatraze:checked').length==1){$("#wechseldruckmatrazemorediv").show();}

					$('#FormDiv').hide();
					if($('#openhidediv').val()==1)
					{
						$('#FormDiv').show();
					}
		</script>
		
		<div class="clearer"></div>
		<div id="logs" style="display: none;">
			<div id="logs_title">Geschichte:</div>
			<div id="logs_content"></div>
		</div>
		
		<div id="sethospizvis" >
			<div class="hsusers">
				<form action="<?php echo $this->act ?>" name="sethospizvisform" id="sethospizvisform" method="post">
					<input type="hidden" name="ishospizset" value="1"/>

					<table class="datatable"  cellpadding="0" cellspacing="0" border="0" style="width:300px!important;">
						<tr><th colspan="2"><h4> Hospiz Gruppe </h4></th></tr>
						<tr>
							<th width="50px"><input type="checkbox" class="parent-<?php echo $this->hospizgroup_id; ?>" name="group_id" value="<?php echo $this->hospizgroup_id; ?>" <?php if ($this->hospiz_group == 1){echo 'checked="checked"';} ?>  /></th>
							<th>Hospiz</th>
						</tr>
					</table>
					
					<table class="datatable"  cellpadding="0" cellspacing="0" border="0" style="width:300px!important;">
						<tr><th colspan="2"><h4>Alle Hospiz Benutzer </h4></th></tr>
							<?php foreach ($this->hospiz_users as $val): ?>
							<tr>
								<th width="50px"><input type="checkbox" class="child-<?php echo $this->hospizgroup_id; ?>" name="user_id[]" value="<?php echo $val['uid'] ?>"  <?php if (in_array($val['uid'], $this->assignedusers)){ echo 'checked="checked"';	} ?>/></th>
								<th><?php echo $val['name']; ?></th>
							</tr>
							<?php endforeach; ?>
					</table>
				</form>
			</div>
			<div class="loadingdiv" align="center"><img src="<?php echo RES_FILE_PATH; ?>/images/ajax-loader.gif"><br />	<?php echo $this->translate('loadingpleasewait') ?></div>
		</div>


		<div id="removehospizusers" >
			<b class="removeus"><?php echo $this->translate('removeassignedusershospizv'); ?></b>
			<form action="<?php echo $this->act ?>" name="removehospizform" id="removehospizform" method="post">
				<input type="hidden" name="removehsusers" value="1"/>
			</form>
			<div class="loadingdiv" align="center"><img src="<?php echo RES_FILE_PATH; ?>/images/ajax-loader.gif"><br />	<?php echo $this->translate('loadingpleasewait') ?></div>
		</div>



		<div id="sethospizverein" >
			<div class="hvusers">
				<form action="<?php echo $this->act ?>" name="sethospizvereinform" id="sethospizvereinform" method="post">
					<input type="hidden" name="ishospizvereinset" value="1"/>
					<table class="datatable"  cellpadding="0" cellspacing="0" border="0" style="width:300px!important;">
						<tr><th colspan="2"><h4> Hospizverein Gruppe </h4></th></tr>
						<tr>
							<th width="50px"><input type="checkbox" class="parent-<?php echo $this->hospizvereingroup_id; ?>" name="group_id" value="<?php echo $this->hospizvereingroup_id; ?>" <?php if ($this->hospizverein_group == 1){ echo 'checked="checked"';} ?> /></th>							
							<th>Hospizverein</th>
						</tr>
					</table>
					<table class="datatable"  cellpadding="0" cellspacing="0" border="0" style="width:300px!important;">
						<tr><th colspan="2"><h4>Alle Hospizverein Benutzer </h4></th></tr>
							<?php foreach ($this->hospizverein_users as $vval): ?>
							<tr>
								<th width="50px">
								<input type="checkbox" class="child-<?php echo $this->hospizvereingroup_id; ?>" name="user_id[]" value="<?php echo $vval['uid'] ?>"  <?php if (in_array($vval['uid'], $this->assignedusers))	{echo 'checked="checked"';} ?>/></th>
								<th><?php echo $vval['name']; ?></th>
							</tr>
							<?php endforeach; ?>
					</table>
				</form>
			</div>
			<div class="loadingdiv" align="center"><img src="<?php echo RES_FILE_PATH; ?>/images/ajax-loader.gif"><br />	<?php echo $this->translate('loadingpleasewait') ?></div>
		</div>
		
		<div id="removehospizvereinusers" >
			<b class="removeus"><?php echo $this->translate('removeassignedusershospizv'); ?></b>
			<form action="<?php echo $this->act ?>" name="removehospizvereinform" id="removehospizvereinform" method="post">
				<input type="hidden" name="removehvusers" value="1"/>
			</form>
			<div class="loadingdiv" align="center"><img src="<?php echo RES_FILE_PATH; ?>/images/ajax-loader.gif"><br />	<?php echo $this->translate('loadingpleasewait') ?></div>
		</div>
		
		<div id="assignhospizusers" >
			<b><?php echo $this->translate('wishassignedusershospizv'); ?></b>
		</div>
		
		<div id="assignhospizvereinusers" >
			<b><?php echo $this->translate('wishassignedusershospizv'); ?></b>
		</div>

		<a href="patient/printpatientdetails?id=<?php echo $this->pid ?>" target="_blank"><img src="images/print.gif" /></a>
		<a href="patient/patientdetails?id=<?php echo $this->pid ?>&pdf=1" target="_blank"><img src="images/doc_pdf.png" /></a>
	</div>
</div>

<div id="info2"></div>
<div id="fall_edit-dialog" style="width:200px; height: 100px;" title="Datum ändern">
	<p id="date_edit">
	<form action="patient/patientdetails?id=<?php echo $this->pid ?>" name="edit" id="edit" method="post" onsumit="return checkclientchanged();">
	    <input type="hidden" name="date_type" id="date_type" value="" />
	    <input type="hidden" name="previous_date" id="previous_date" value="" />
	    <input type="hidden" name="current_date" id="current_date" value="" />
	    <input type="hidden" name="next_date" id="next_date" value="" />
	    <input type="hidden" name="fald" id="fald" value="" />
	    <input type="hidden" name="fall_type" id="fall_type" value="" />
	    <input type="hidden" name="fall_nr" id="fall_nr" value="" />
	     <input type="text" style="width: 90px" name="edit_date" id="edit_date" value="" readonly="readonly" />
	     <input type="text" style="width: 35px" name="edit_time" id="edit_time" value="" readonly="readonly"  />
	    <input type="submit" value="<?php echo $this->translate('submit')?>" id="check_fall_history" />
	    
	    <div class="fall_err"><span id="fall_alert"></span></div>
	</form>
	</p>
</div>


<div id="vv_fall_start-dialog" style="width:200px; height: 100px;" title="Starten Vollversorgung"><!-- //ISPC-2703, elena, 04.01.2021 -->
	<p id="vv_ende">
		<form action="patient/patientdetails?id=<?php echo $this->pid ?>&mode=vv&" name="start_vv" id="start_vv" method="post" onsubmit="return checkclientchanged();">
			<input type="hidden" name="vv_previous_date" id="vv_previous_date" value="" />
			<input type="hidden" name="vv_next_date" id="vv_next_date" value="" />
			<input type="text" style="width: 150px" name="start_vv_date" id="start_vv_date" value="" autocomplete="off" />
			<input type="submit" value="<?php echo $this->translate('submit')?>" />
		</form>
	</p>
</div>
<div id="vv_fall_end-dialog" style="width:200px; height: 100px;" title="Ende vollversorgung">
	<p id="vv_ende">
		<form action="patient/patientdetails?id=<?php echo $this->pid ?>&mode=vv" name="ende_vv" id="ende_vv" method="post" onsubmit="return checkclientchanged();">
			<input type="hidden" name="vv_previous_date" id="vv_previous_date" value="" />
			<input type="hidden" name="vv_next_date" id="vv_next_date" value="" />
			<input type="text" style="width: 150px" name="end_vv_date" id="end_vv_date" value="" autocomplete="off" />
			<input type="submit" value="<?php echo $this->translate('submit')?>" />
		</form>
	</p>
</div>

<div id="sgbv_quick_approve">
	<form name="quick_status" method="POST" action="" id="quick_status_change">
		<div>
			<?php
			$status_data = Pms_CommonData::getSgbvStatusRadio();
			foreach ($status_data as $k_status => $v_status):
				?>
				<div class="status_modal">
					<label for="sgbv_<?php echo $k_status; ?>"><?php echo $v_status; ?></label>
					<input type="radio" name="status_sgbv" value="<?php echo $k_status ?>" id="sgbv_<?php echo $k_status; ?>" class="status_sgbv_radio"  />
				</div>
			<?php endforeach; ?>
			<div class="status_modal_datepicker" id="approve_date_sgbv">
				<input type="text" value="" name="approve_date" id="approve_date_sgbv_txt" />
			</div>
			<input type="hidden" name="sgbv_id_edit" id="sgbv_id_edit" value="" />
			<input type="hidden" name="sgbv_initial_status" id="sgbv_initial_status" value="" />

		</div>
	</form>
</div>

<div id="sgbv_delete_block">
	<form name="delete_sgbv_form" method="POST" action="" id="delete_sgbv_form">
		<p>
			<?php echo $this->translate('are you sure you want to delete this sgbv entry?');  ?>
		</p>
		<input type="hidden" name="deletion_of_sgbv" id="deletion_of_sgbv" value="1" />
		<input type="hidden" name="del_sgbv_id" id="del_sgbv_id" value="" />
	</form>
</div>

<div id="medipump_add">
	<form name="add_patient_medipumps" method="POST" action="" id="add_patient_medipumps" >
		<div>
			<select name="medipump" id="medipump">
				<option value="0"><?php echo $this->translate('select_medipumps');  ?></option>
				<?php foreach($this->client_medipumps as $k_client_mp => $v_client_mp):  ?>
				<option value="<?php echo $k_client_mp; ?>"><?php  if(!empty($v_client_mp['shortcut'])): echo $v_client_mp['shortcut']. ' - ';  endif; ?> <?php echo $v_client_mp['medipump']; ?></option>
				<?php endforeach;  ?>
			</select>
			<div class="status_modal_datepicker" id="medipumps_period">
				<input type="text" name="medipump_date_start" value="" id="medipump_date_start" />
				<input type="text" name="medipump_date_end" value="" id="medipump_date_end" />
			</div>
			<input type="hidden" name="add_medipump" id="edit_medipump" value="1" />

		</div>
		<div style="display:none;"  id="medipump_ajax_load">
			<img src="<?php echo RES_FILE_PATH;  ?>/images/loading-transp.gif" style="width:16px;"/>
		</div>
	</form>
</div>


<div id="medipump_edit">
	<form name="edit_patient_medipumps" method="POST" action="" id="edit_patient_medipumps" onsubmit="return checkclientchanged();">
		<div>
			<select name="medipump" id="medipump_edit_select">
				<option value="0"><?php echo $this->translate('select_medipumps');  ?></option>
				<?php foreach($this->client_medipumps as $k_client_mp => $v_client_mp):  ?>
				<option value="<?php echo $k_client_mp; ?>"><?php  if(!empty($v_client_mp['shortcut'])): echo $v_client_mp['shortcut']. ' - ';  endif; ?> <?php echo $v_client_mp['medipump']; ?></option>
				<?php endforeach;  ?>
			</select>

			<div class="status_modal_datepicker" id="medipumps_period">
				<input type="text" name="medipump_edit_start" value="" id="medipump_edit_start" />
				<input type="text" name="medipump_edit_end" value="" id="medipump_edit_end" />
			</div>
			
			<div id="error_div_edit">
			</div>
			<input type="hidden" name="edit_medipump" id="edit_medipump" value="1" />
			<input type="hidden" name="edit_medipump_id" id="edit_medipump_id" value="" />
		</div>
		
		<div style="display:none;"  id="medipump_ajax_load_edt">
			<img src="<?php echo RES_FILE_PATH;  ?>/images/loading-transp.gif" style="width:16px;"/>
		</div>
		
	</form>
</div>



<div id="medipump_delete">
	<form name="del_patient_medipumps" method="POST" action="" id="del_patient_medipumps"  onsubmit="return checkclientchanged();">
		<p>
			<?php echo $this->translate('medipumps_modal_delete');  ?>
		</p>
		<input type="hidden" name="del_medipump" id="del_medipump" value="1" />
		<input type="hidden" name="del_medipump_id" id="del_medipump_id" value="" />
	</form>
</div>

<div id="medipumps_overlapped">
	<p>
		<?php echo $this->translate('medipump_overlapping_message'); ?>
	</p>
</div>
		<div id="approved_visit_name"></div>


<div id="approve_visit_overlapped">
	<p>
		<?php echo $this->translate('approved visits types are overlapping'); ?>
	</p>
</div>


<div id="approve_visit_block">
	<form name="approved_visits_type" method="POST" action="" id="approved_visits_type" >
		<input type="hidden" name="visit_type" value=""  id="approved_visit"  />
		<input type="hidden" name="pavt_default[start_date]" value="<?php echo $this->pavt_default['start_date'];?>" />
		<input type="hidden" name="pavt_default[visit_type]" value="<?php echo $this->pavt_default['visit_type']?>"  />
		<div id="approved_visit_name"></div>
		<br/>

		<div class="vt_approved_date">
			<label><?php echo $this->translate('validfrom')?>:</label>
			<input type="text" name="start_date" value="" id="approved_from"   />
		</div>

		<div class="vt_approved_date">
			<label><?php echo $this->translate('validtill')?>:</label>
			<input type="text" name="end_date" value="" id="approved_until"/>
		</div>

		<div style="display:none;"  id="medipump_ajax_load">
			<img src="<?php echo RES_FILE_PATH;  ?>/images/loading-transp.gif" style="width:16px;"/>
		</div>

	</form>
</div>



<div id="approve_visit_block_edit">
	<form name="edit_approved_visits_type" method="POST" action="" id="edit_approved_visits_type">

		<div id="edit_pavt_name"></div>
		<br/>

		<div class="vt_approved_date">
			<label><?php echo $this->translate('validfrom')?>:</label>
			<input type="text" name="pavt_edit[start_date]" value="" id="pavt_edit_start"   />
		</div>

		<div class="vt_approved_date">
			<label><?php echo $this->translate('validtill')?>:</label>
			<input type="text" name="pavt_edit[end_date]" value="" id="pavt_edit_end"/>
		</div>

		<input type="hidden" name="pavt_edit[id]" id="pavt_edit_id" value="" />
	</form>
</div>



<div id="pavt_delete">
	<form name="del_pavt" method="POST" action="" id="del_pavt">
		<p>
			<?php echo $this->translate('pavt_modal_delete');  ?>
		</p>

		<input type="hidden" name="del_pavt" id="del_pavt" value="1" />
		<input type="hidden" name="del_pavt_id" id="del_pavt_id" value="" />
	</form>
</div>
<div id="vv_fall_edit_dialog" style="width:200px; height: 100px;" title="Datum ändern">
	<p id="date_edit">
	<form  method="post" action="patient/patientdetails?id=<?php echo $this->pid ?>&mode=vv_edit" name="vv_edit" id="vv_edit" onsubmit="return checkclientchanged();">
	    <input type="text" style="width: 90px" name="vv_edit_date" id="vv_edit_date" value="" readonly="readonly" />
	    <input type="hidden" name="vv_date_type" id="vv_date_type" value="" />
	    <input type="hidden" name="vv_previous_date" id="vv_previous_date" value="" />
	    <input type="hidden" name="vv_current_date" id="vv_current_date" value="" />
	    <input type="hidden" name="vv_next_date" id="vv_next_date" value="" />
	    <input type="hidden" name="vv_fallid" id="vv_fallid" value="" />
	    <input type="hidden" name="vv_current_date_full" id="vv_current_date_full" value="" />
	    <input type="hidden" name="vv_previous_date_full" id="vv_previous_date_full" value="" />
	    <input type="hidden" name="vv_next_date_full" id="vv_next_date_full" value="" />
	    <input type="submit" value="<?php echo $this->translate('submit')?>" id="check_vv_fall_history" />
	    
	    <div class="vv_fall_err"><span id="vv_fall_alert"></span></div>
	</form>
	</p>
</div>