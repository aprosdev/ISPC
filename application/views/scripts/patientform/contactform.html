<?php
$this->headLink()->appendStylesheet(RES_FILE_PATH.'/css/pharmaindex/medi_pharmaindex.css');
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/pharmaindex/medi_pharmaindex.js');
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/medicationnew_edit.css');
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/selectize/selectize.css');

	

$this->headLink()->appendStylesheet(RES_FILE_PATH.'/css/page-css/contact_form_style.css');
//$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/autogrow/jquery.elastic.js');
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/autogrow/jquery.elastic.source_new.js');
$this->headScript()->appendFile(RES_FILE_PATH . '/javascript/dragdiv/dragdivpatient.js');
//$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/jquery.blockUI.js');
//ISPC-2813,Elena,29.01.2021
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/tinymce5/js/tinymce/tinymce.min.js');
 

$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/selectize/selectize.min.js');

//ISPC-2666 Lore 18.09.2020 
$this->headScript()->appendFile( RES_FILE_PATH . '/javascript/livesearch/getzipcities.js' );
$this->headScript()->appendFile( RES_FILE_PATH . '/javascript/livesearch/gethealthinsurance.js' );



$this->headScript()
->appendFile(RES_FILE_PATH . '/javascript/inputmask-3.x/dist/jquery.inputmask.bundle.js')
->appendFile(RES_FILE_PATH . '/javascript/pms/jquery.sum.js')
->appendFile(RES_FILE_PATH . '/javascript/dateUtil.js');



$contact_form_lang = $this->translate('contact_form_lang');


$allowed_blocks = $this->allowed_blocks;
//Maria:: Migration CISPC to ISPC 22.07.2020 :: Start
if(in_array('fileupload',$allowed_blocks)){
//add file uploader
//echo 'uploader';
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/qtip/jquery.qtip.min.css?' . date('Ymd'));
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/tags_editor/jquery.tag-editor.css?' . date('Ymd'));
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/patientfile.css?' . date('Ymd'));
$this->headScript()->appendFile(RES_FILE_PATH . '/javascript/qtip/jquery.qtip.min.js?' . date('Ymd'));
$this->headScript()->appendFile(RES_FILE_PATH . '/javascript/tags_editor/jquery.tag-editor.js?' . date('Ymd'));
$this->headScript()->appendFile(APP_BASE.'javascript/fine-uploader/fine-uploader.min.js');
$this->headLink()->appendStylesheet(APP_BASE.'javascript/fine-uploader/fine-uploader.css');

$newview = new Zend_View();
$newview->setScriptPath(APPLICATION_PATH."/views/scripts/templates/");
$qqtemplate=$newview->render('qq_fileupload_template_small_2017_09.html');
//print_r($qqtemplate);
$this->headScript()->setAllowArbitraryAttributes(true)->appendScript($qqtemplate, 'text/template', array("id" => "qq-template", "noescape" => true));
//rendered-add the fine-uploader file-uploader template
//$qqtemplate = $this->render("templates/qq_fileupload_template_small_2017_09.html");
//$qqtemplate = Pms_Template::createTemplate(array(), 'templates/qq_fileupload_template_2018_08.html');
//$this->headScript()->setAllowArbitraryAttributes(true)->appendScript($qqtemplate, 'text/template', array("id" => "qq-template", "noescape" => true));


}
//Maria:: Migration CISPC to ISPC 22.07.2020:: END


$sapv_only_blocks = $this->sapv_only_blocks;
$contact_form_details = $this->contact_form_details;
$patient_befund_values = $this->patient_befund_values;
$patient_ebm_values = $this->patient_ebm_values;

$patient_ebmi_values = $this->patient_ebmi_values;
$patient_ebmii_values = $this->patient_ebmii_values;

$patient_goa_values = $this->patient_goa_values;

$patient_goai_values = $this->patient_goai_values;
$patient_goaii_values = $this->patient_goaii_values;
$patient_xbdt_goaii_values = $this->patient_xbdt_goaii_values;
$patient_xbdt_ebmii_values = $this->patient_xbdt_ebmii_values;

$patient_measures_values = $this->patient_measures_values;
$patient_coordinator_actions_values = $this->patient_coordinator_actions_values;//ISPC-2487 Ancuta 27.11.2019
$last_patient_coordinator_actions_values = $this->last_patient_coordinator_actions_values;//ISPC-2487 Ancuta 27.11.2019

$patient_sgbxi_actions_values = $this->patient_sgbxi_actions_values;
$patient_ebm_ber_values = $this->patient_ebm_ber_values;
$patient_classification_values = $this->patient_classification_values;
$patient_bra_sapv_values = $this->patient_bra_sapv_values;

$patient_bowel_movement_values = $this->patient_bowel_movement_values;



$patient_client_symptoms = $this->patient_client_symptoms;

$opened_blocks = $this->opened_blocks;
$vital_signs_arr = $this->vital_signs_arr;

$kvno_visit_type = $this->kvno_visit_type;




	$client_users = $this->client_users;
	$additional_users = $this->additional_users;
	$form_create_user = $this->form_create_user;




 
$patient_ipos_values = $this->patient_ipos_values;

$patient_pflegeipos_values = $this->patient_pflegeipos_values;
$patient_talkwith_values = $this->patient_talkwith_values;
$patient_soap_values = $this->patient_soap_values;
$patient_soap_pflege_values = $this->patient_soap_pflege_values;
$patient_soap_soza_values = $this->patient_soap_soza_values;
$patient_procedures_values = $this->patient_procedures_values;

//$patient_todos_values = $this->patient_todos_values;

$patient_talkback_values = $this->patient_talkback_values;
$patient_lmu_physmed_documentation_values = $this->patient_lmu_physmed_documentation_values;
$patient_lmu_psydoc_values = $this->patient_lmu_psydoc_values;
$patient_lmu_spirit_values = $this->patient_lmu_spirit_values;
$patient_lmu_phone_values = $this->patient_lmu_phone_values;
$patient_lmu_documentation_values = $this->patient_lmu_documentation_values;

if(in_array('med_time_dosage',$allowed_blocks)) {
	$this->headScript()
		->appendFile(RES_FILE_PATH.'/javascript/views/patientnew/medicationeditblocks.js?'.date('Ymd'))
		->appendFile(RES_FILE_PATH.'/javascript/views/patientnew/medicationedit.js?'.date('Ymd'))
		->appendFile(RES_FILE_PATH.'/javascript/jquery.tablesorter.js');	
} 

if(in_array('todos',$allowed_blocks)) {
	//$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/chosen_v1.6.2/chosen.jquery.js');
	//$this->headLink()->appendStylesheet(RES_FILE_PATH.'/javascript/chosen_v1.6.2/chosen_2016.09.22.css');
}
//ISPC-2629 Carmen 10.08.2020 - change div['id'] == 'grow..' with a new condition for open 

?>

<script type="text/javascript">
	var jscount = '0';
	var jsmedcount = '0';
	var medcount = '<?php echo $this->mcntr + 1 ?>';
	var medcount_s = '<?php echo $this->mcntr_s + 1 ?>';
	var jcount = '<?php echo $this->jscount + 1 ?>';
	var dcntr = '<?php echo $this->dcntr ?>';
	var medblur = Array();
	var jsusers = <?php echo $this->jsusers; ?>;
	var detailscookies = '<?php echo $this->detailscookies; ?>';
	var sapv_box_ids = '<?php echo json_encode($sapv_only_blocks); ?>';
	//ISPC-2672 
	var allowed_blocks = '<?php echo json_encode($allowed_blocks); ?>';
	//--
	var cl_sym_count = '<?php echo count($patient_client_symptoms) + 1 ?>';
	
	var contactform_default_visit_length = '<?php echo $this->contactform_default_visit_length ?>';

	// required for don't leave page
	var submited = false;
	var changes = false;
	var route_error = "<?php echo $this->route_error; ?>";// TODO-1211
	var med_time_dosage_allowed = true; //ISPC-2430 Carmen 16.12.2019
	
	
	//TODO-4069 Ancuta 23.04.2021
	<?php if ($this->companion_time_tracking == 1) : ?>
	var companion_time_tracking = 1; 	//TODO-4069 Ancuta 14.05.2021
	<? else:?>
	var companion_time_tracking = 0;//TODO-4069 Ancuta 14.05.2021
	<? endif ;?>	
	//--- 
	
	
	//for medication block II
	var loadmediblocks = false;
	//for medication block II

	<?php if( ! in_array('med_time_dosage',$allowed_blocks)) : ?>
	med_time_dosage_allowed = false;
	
	//medications
	function selectMedications(mid, row)
	{
		$('#medication'+row).val($('#medi_me_'+mid).val());
		$('#comment'+row).val($('#medi_comment_'+mid).val());
		$('#hidd_medication'+row).val($('#medi_id_'+mid).val());
	}
	function reset_medications(input_row)
	{
		if($('#hidd_medication'+input_row).val()){
			$('#hidd_medication'+input_row).val('');
			//$('#drid'+input_row).val('');
		}
	}

	<?php endif; ?>
	
	function createnewmedic()
	{
		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}

		var userdrop = '<select name="add[verordnetvon]['+medcount+']">'+usrstr+'</select>';
		var trInnerHtml = $('<tr id="medadd'+medcount+'"><td align="left" valign="top"></td><td align="left" valign="top"><input name="add[medication]['+medcount+']" value="" id="medication'+medcount+'" type="text" class="livesearchmedinp med"><input name="add[hidd_medication]['+medcount+']" value="" id="hidd_medication'+medcount+'" type="hidden"></td><td align="left" valign="top"><input  name="add[dosage]['+medcount+']" id="dosage" class="dosage" value=""  /></td><td align="left" valign="top"><input  name="add[comments]['+medcount+']" value=""  id="comment'+medcount+'"  /></td><td></td><td valign="top">'+userdrop+'</td><td align="left" valign="top"><a href="javascript:void(0)" onclick="removeElem(\'#medadd'+medcount+'\')"><img src="images/action_delete.png" border="0" /></a></td></tr>');

		$('#listpatientmedicationedit_medicationtable').append(trInnerHtml);

		$('#medication'+medcount).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});
		medcount++;
		
	}

	function createnewmedicrowbedarf()
	{

		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}



		var userdrop = '<select name="verordnetvon['+medcount+']">'+usrstr+'</select>';

		var trInnerHtml = $('<tr id="medadd'+medcount+'"><td></td><td align="left" valign="top"><input name="addbedarf[medication]['+medcount+']" value="" id="medication'+medcount+'" type="text" class="livesearchmedinp med"><input name="addbedarf[hidd_medication]['+medcount+']" value="" id="hidd_medication'+medcount+'" type="hidden"><div id="medidropdown'+medcount+'" style="position:absolute;display:none;" class="listPatMedEd livesearchdropdown"></div></td><td align="left" valign="top"><input  name="addbedarf[dosage]['+medcount+']" id="dosage" class="dosage" value=""  /></td><td align="left" valign="top"><input  name="addbedarf[comments]['+medcount+']" value=""  id="comment'+medcount+'"   /></td><td></td><td align="left" valign="top">'+userdrop+'</td><td align="left" valign="top"><a href="javascript:void(0)" onclick="removeElem(\'#medadd'+medcount+'\')"><img src="<?php echo RES_FILE_PATH; ?>/images/action_delete.png" border="0" /></a></td></tr>');
		$('#listpatientmedicationedit_bedarfsmedicationtable').append(trInnerHtml);


		$('#medication'+medcount).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('keydown paste', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});
		medcount++;
	}
	//Maria:: Migration CISPC to ISPC 22.07.2020
	function createnewmedicrowcrisis()
	{

		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}



		var userdrop = '<select name="verordnetvon['+medcount+']">'+usrstr+'</select>';

		var trInnerHtml = $('<tr id="medadd'+medcount+'"><td></td><td align="left" valign="top"><input name="addcrisis[medication]['+medcount+']" value="" id="medication'+medcount+'" type="text" class="livesearchmedinp med"><input name="addcrisis[hidd_medication]['+medcount+']" value="" id="hidd_medication'+medcount+'" type="hidden"><div id="medidropdown'+medcount+'" style="position:absolute;display:none;" class="listPatMedEd livesearchdropdown"></div></td><td align="left" valign="top"><input  name="addcrisis[dosage]['+medcount+']" id="dosage" class="dosage" value=""  /></td><td align="left" valign="top"><input  name="addcrisis[comments]['+medcount+']" value=""  id="comment'+medcount+'"   /></td><td></td><td align="left" valign="top">'+userdrop+'</td><td align="left" valign="top"><a href="javascript:void(0)" onclick="removeElem(\'#medadd'+medcount+'\')"><img src="<?php echo RES_FILE_PATH; ?>/images/action_delete.png" border="0" /></a></td></tr>');
		$('#listpatientmedicationedit_crisismedicationtable').append(trInnerHtml);


		$('#medication'+medcount).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('keydown paste', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});
		medcount++;
	}
	function createnewmedicrowiv()
	{

		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}



		var userdrop = '<select name="verordnetvon['+medcount+']">'+usrstr+'</select>';

		var trInnerHtml = $('<tr id="medaddiv'+medcount+'"><td></td><td align="left" valign="top"><input name="addiv[medication]['+medcount+']" value="" id="medication'+medcount+'" type="text" class="livesearchmedinp med"><input name="addiv[hidd_medication]['+medcount+']" value="" id="hidd_medication'+medcount+'" type="hidden"><div id="medidropdown'+medcount+'" style="position:absolute;display:none;" class="listPatMedEd livesearchdropdown"></div></td><td align="left" valign="top"><input  name="addiv[dosage]['+medcount+']" id="dosage" class="dosage" value=""  /></td><td align="left" valign="top"><input  name="addiv[comments]['+medcount+']" value=""   id="comment'+medcount+'"  /></td><td></td><td align="left" valign="top">'+userdrop+'</td><td align="left" valign="top"><a href="javascript:void(0)" onclick="removeElem(\'#medaddiv'+medcount+'\')"><img src="<?php echo RES_FILE_PATH; ?>/images/action_delete.png" border="0" /></a></td></tr>');

		$('#listpatientmedicationedit_ivmedicationtable').append(trInnerHtml);

		$('#medication'+medcount).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});
		medcount++;
	}
	function createnewschmerzpumpe()
	{
		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}



		var userdrop = '<select name="add_schmerze[verordnetvon]['+medcount+']">'+usrstr+'</select>';

		var trInnerHtml = $('<tr id="medadd_schmerze'+medcount+'"><td align="left" valign="top"><input name="add_schmerze[medication]['+medcount+']" value="" id="medication'+medcount+'" type="text" class="livesearchmedinp med"><input name="add_schmerze[hidd_medication]['+medcount+']" value="" id="hidd_medication'+medcount+'" type="hidden"><div id="medidropdown'+medcount+'" style="position:absolute;display:none;" class="listPatMedEd livesearchdropdown"></div></td><td align="left" valign="top"><input  name="add_schmerze[dosage]['+medcount+']" id="dosage" class="dosage" value=""  /></td><td align="left" valign="top">'+userdrop+'</td><td align="left" valign="top"><a href="javascript:void(0)" onclick="removeElem(\'#medadd_schmerze'+medcount+'\')"><img src="<?php echo RES_FILE_PATH; ?>/images/action_delete.png" border="0" /></a></td></tr>');

		$('#medaddtable_schmerze').append(trInnerHtml);


		$('#medication'+medcount).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});

		medcount++;
	}

	function createnewschmerzpumpeedit()
	{
		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}

		var userdrop = '<select name="add_schmerze[verordnetvon]['+medcount_s+']">'+usrstr+'</select>';

		var trInnerHtml = $('<tr id="medadd_schmerze'+medcount_s+'"><td></td><td align="left" valign="top"><input name="add_schmerze[medication]['+medcount_s+']" value="" id="medication'+medcount_s+'" type="text" class="livesearchmedinp med"><input name="add_schmerze[hidd_medication]['+medcount_s+']" value="" id="hidd_medication'+medcount_s+'" type="hidden"><div id="medidropdown'+medcount_s+'" style="position:absolute;display:none;" class="listPatMedEd livesearchdropdown"></div></td><td align="left" valign="top"><input  name="add_schmerze[dosage]['+medcount_s+']" id="dosage" class="dosage" value=""  /></td><td></td><td align="left" valign="top">'+userdrop+'</td><td align="left" valign="top"><a href="javascript:void(0)" onclick="removeElem(\'#medadd_schmerze'+medcount_s+'\')"><img src="<?php echo RES_FILE_PATH; ?>/images/action_delete.png" border="0" /></a></td></tr>');

		$(trInnerHtml).insertBefore('#cDetails');

		$('#medication'+medcount_s).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});

		medcount_s++;
	}
	
	

	
	function create_new_symptom_item()
	{
		var sym_row_class = "";
		if(cl_sym_count % 2){
			sym_row_class = " cl_sym_row_odd";
		} else{
			sym_row_class = " cl_sym_row_even";
		}
		
		

		<?php
				
            //TODO-1296
            if(is_array($this->client_syms) && count($this->client_syms)>1) {
                usort($this->client_syms, array(new Pms_Sorter('name'), "_strcmp"));
            }
		
			$sel_str ="";
			$sel_str .= '<option value=""></option>';
			foreach($this->client_syms  as $group_id => $group_details) {
				//TODO-1296
				if(is_array($group_details['symps']) && count($group_details['symps'])>1) {
                    usort($group_details['symps'], array(new Pms_Sorter('description'), "_strcmp"));
                }
				
				$sel_str .= '<optgroup label="'.$group_details['name'].'">';
				foreach($group_details['symps'] as $k=>$syms){
					$sel_str .= '<option value="'.$syms['id'].'">'.$syms['description'].'</option>';
				}
				$sel_str .= '</optgroup>';
			}
		?>
 
		// Erorr fixed by Alex 13.07.2019  - - if new line was contain in sym -  the js was broken. 
		var _sel_str = '<?php echo str_replace(array("\n","\r"),"",$sel_str);?>';  
	 	 
		var symptom_name_drop = '<select name="clientsymptoms['+cl_sym_count+'][symptom_id]"  class="sym_name_drop" >' + _sel_str +'</select>';
		var severity_drop = '<select name="clientsymptoms['+cl_sym_count+'][severity]" class="sym_severety"><option value=""></option><option value="0">kein</option><option value="4">leicht</option><option value="7">mittel</option><option value="10">schwer</option></select>';
		var sorrowfully_options = '<input type="radio"  name="clientsymptoms['+cl_sym_count+'][sorrowfully]" value="1"/><label>Ja</label><input type="radio"  name="clientsymptoms['+cl_sym_count+'][sorrowfully]" value="2"/><label>Nein</label>';
		//var sym_comment = '<input type="text"   name="clientsymptoms['+cl_sym_count+'][comment]" value=""   class="sym_comment" />';
		var sym_comment = '<textarea  name="clientsymptoms['+cl_sym_count+'][comment]" value=""   class="sym_comment" rows=1 style="height:20px;"></textarea>';
		var sym_care_instruction = '<textarea  cols="" rows=""  class="sym_care_instruction" name="clientsymptoms['+cl_sym_count+'][care_specifications]"></textarea>';
		var sym_custom = '<input type="hidden" name="clientsymptoms['+cl_sym_count+'][custom]"  value="1"> ';

		var tr_start = '<tr id="cl_sym'+cl_sym_count+'"  data-cl_line="'+cl_sym_count+'" class="sym_default_row '+sym_row_class+'">';
//		var td_symptom_count='<td> # '+cl_sym_count+'</td>'
		var td_symptom_count='<td> # </td>'
		var td_symptom_name='<td>'+symptom_name_drop+'</td>'
		var td_symptom_severity='<td align="center">'+severity_drop+'</td>'
		var td_symptom_sorrowfully='<td align="center">'+sorrowfully_options+'</td>'
		var td_symptom_comment='<td align="center">'+sym_comment+'</td>'
		var td_symptom_remove='<td align="left" valign="top"><a href="javascript:void(0)" onclick="remove_sym_line(\''+cl_sym_count+'\')"><img src="images/action_delete.png" border="0" /></a></td>'
		var tr_end = '</tr>';

		var td_symptom_care_line='<tr id="care_cl_sym'+cl_sym_count+'"  class="sym_default_row bbotttom '+sym_row_class+'"><td colspan="6"><b><?php echo $this->translate("Sym care instructions: "); ?></b><br/>'+sym_care_instruction+sym_custom+'</td> <td></td> </tr>'

		var new_line = ""; 
		 	new_line += tr_start 
			new_line += td_symptom_count 
			new_line += td_symptom_name 
			new_line += td_symptom_severity 
			new_line += td_symptom_sorrowfully 
			new_line += td_symptom_comment 
			new_line += td_symptom_remove 
			new_line += tr_end;
			new_line += td_symptom_care_line;
		 	
		var line_obj = $('.client_symptomatics').append(new_line);
		line_obj.find('textarea.sym_comment').elastic();
		
		cl_sym_count++;
	}
	
	
	function removeElem(ids) {
		$(ids).remove();
	}

	function remove_sym_line(line_id) {
		
		$("#cl_sym"+line_id).remove();
		$("#care_cl_sym"+line_id).remove(); 
		//cl_sym_count--;
	}
	
	function removeSchmerzeMedication(mid,pid)
	{
		if(mid>0)
		{
			ajaxCallserver({
				url:'patient/patientmedication?mid='+mid+'&id='+pid+'&act=del&noredir=1'
						+ '&_deleted_medis_contactform_cid=<?= ! empty($_REQUEST['cid']) ? (int)$_REQUEST['cid'] : 0 ;?>'
						+ "&_cfhiddennounce=" + $("#cfhiddennounce").val()
			});
		}
		$("#medadd_schmerze"+mid).remove();
	}

	function removeMedicationKvno(mid,pid)
	{
		if(mid>0)
		{
			ajaxCallserver({
				url:'patient/patientmedication?mid='+mid+'&id='+pid+'&act=del&noredir=1'
						+ '&_deleted_medis_contactform_cid=<?= ! empty($_REQUEST['cid']) ? (int)$_REQUEST['cid'] : 0 ;?>'
						+ "&_cfhiddennounce=" + $("#cfhiddennounce").val()
			});
		}
		$("#line_"+mid).remove();
	}

	function delmedicationRow(did,patidencrypted)
	{

		if(did)
		{

			ajaxCallserver({
				url:'patient/patientmedication?id='+patidencrypted+'&delid='+did+'&mid='+did+'&act=del&noredir=1' //mid for trigger when deleteing the row
						+ '&_deleted_medis_contactform_cid=<?= ! empty($_REQUEST['cid']) ? (int)$_REQUEST['cid'] : 0 ;?>'
						+ "&_cfhiddennounce=" + $("#cfhiddennounce").val()
			});
		}
	}

	var deleted_medis_contactform_cid_patientcourse_id = function (pc_ids) {
		//"THIS PC ID MUST BE LINKED WITH THIS NEW CF"
		$.each(pc_ids, function (i, pc_id) {
			$('<input>', {
                'type'  : "hidden",
                'name'  : "deleted_medis_contactform_cid_patientcourse_id[]",
                'value' : pc_id
            }).prependTo("form#contact_form");
		});
	}
	
	
	
	function renewMedicationKvno(mid,pid)
	{
		if(mid>0){
			ajaxCallserver({
				url:'patient/patientmedication?mid='+mid+'&id='+pid+'&act=rnw&noredir=1'
    				+ '&_deleted_medis_contactform_cid=<?= ! empty($_REQUEST['cid']) ? (int)$_REQUEST['cid'] : 0 ;?>'
                    + "&_cfhiddennounce=" + $("#cfhiddennounce").val()
			});
		}
		$("#line_r_"+mid).remove();
	}

	// make the textarea grow
	  $(function() {
		  
		 
		  <?php if (APPLICATION_ENV != 'production') : ?>
		  /*
           * DEBUG ONLY, will be removed after testing
           */
           
		  /*  
		  var _debug_googleapis_distace = <?=$this->debug_googleapis_distace?>;
		    
			jConfirm(  _debug_googleapis_distace.join("<br/><br/>\n"), "message only for debug, will be removed after testing", function(r) {
				return false;
            }); 
			*/
		 <?php endif; ?>
		  
		 $.getmedicationblocks = function() {
				
				var url = '<?php echo APP_BASE; ?>patientnew/medicationeditblocks?id=<?php echo $_REQUEST["id"]; ?>';

				//show a loading gif
				$('.medication_new').html('<br/><div class="loadingdiv" align="center"><img src="<?php echo RES_FILE_PATH; ?>/images/ajax-loader.gif"><br /><?php echo $this->translate(loadingpleasewait); ?></div><br/>');

				
				xhr = $.ajax({
					url : url,
					cache : false,
					success : function(response) {
						$('.medication_new').html(response);
						//ISPC-2629 Carmen 10.08.2020
						<?php if($_REQUEST['openinmodal'] == '1') { ?>
							$('#openinmodal .medication_new :input').attr('disabled', true);
							$('#openinmodal .medication_new a').remove();
							$("#openinmodal .medication_new img").hide();
						<?php } ?>
						//--
						medicationeditblocks_ready();
						
							
					}
				});
			}
			
		 	<?php if(in_array('med_time_dosage',$allowed_blocks)) : ?> 
				 
				$.getmedicationblocks();
			
			<?php endif; ?>
				
		$('input.livesearchmedinp, input.med_date, input.dosage, input.comment, input.med, select.user_selector, select.user_selector_schmerze').live('change keyup', function(){

		      if($(this).hasClass('livesearchmedinp')){
			      var input_row = parseInt($(this).attr('id').substr(('medication').length)); //med name
		      } else if($(this).hasClass('med_date')) {
			      var input_row = parseInt($(this).attr('id').substr(('med_date').length)); //change date
		      } else if($(this).hasClass('dosage')) {
			      var input_row = parseInt($(this).attr('id').substr(('dosage').length)); //dosage
		      } else if($(this).hasClass('comment') || $(this).hasClass('med')) {
			      var input_row = parseInt($(this).attr('id').substr(('comment').length)); //comment
		      } else if ($(this).hasClass('user_selector')) {
			      var input_row = parseInt($(this).attr('id').substr(('verordnetvon-').length)); //user selector
		      } else if ($(this).hasClass('user_selector_schmerze')) {
			      var input_row = parseInt($(this).attr('id').substr(('add_schmerze-verordnetvon-').length)); //user selector schmerzepumpe
		      }
		      $('#edited' + input_row).val('1');
	      });

		$('.med_date').datepicker({
			dateFormat: 'dd.mm.yy',
			buttonImageOnly: true,
			changeMonth: true,
			changeYear: true,
			nextText: '',
			prevText: '',
			onSelect: function(){
				var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
				$('#edited' + input_row).val('1');
				
			 changes = true;
			}
		});

		$(".med_date").mask("99.99.9999");
		
		<?php
			//removed by @cla.. there was the same line on line ~850 = // make the textarea grow 
    	    //$('textarea').elastic();
		?>

		//livesearch medications
		$('.livesearchmedinp').live('change', function() {
			var input_row = parseInt($(this).attr('id').substr(('medication').length));
			reset_medications(input_row);
			
		}).liveSearch({
			url: 'ajax/medications?q=',
			id: 'livesearch_admission_medications',
			aditionalWidth: '300',
			noResultsDelay: '900',
			typeDelay: '900',
			returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length)); }
		
		});

		$(".renew_ajx, .renew_ajx_bedarfs, .renew_ajx_ivmeds, .renew_ajx_schmerz").live('click', function(e){

			e.preventDefault();
			medcount++;
			//get row id
			var tridrn = $(this).closest('tr').attr('id');

			//get medication edit count rows
			var cntren = Number(medcount) +1;
			//split row id and get numeric medis id
			var id = tridrn.split('_');
			var that = $(this);
			$("#"+tridrn).each(function() {
				var dateren = "<?php echo date('d.m.Y')?>";
				var medsren = $(this).find(".medsrn_"+id[2]).text();
				var pid = "<?php echo $_GET['id']; ?>";
				var dsgren = $(this).find(".dsgrn_"+id[2]).text();
				var commren = $(this).find(".commrn_"+id[2]).text();
				var usrnameren = $(this).find(".usrnamern_"+id[2]).text();
				var usr_addren = $(this).find(".usr_id_add_"+id[2]).text();
				var hidd_medisren = $(this).find(".hidd_medicationrn_"+id[2]).text();
				var usrren = $(this).find(".usrid_"+id[2]).text();
				var users = <?php echo  $this->jsusers; ?>;
				var options = '';
				var i = 1;

				$.each(users, function(key, value){
					if(key == usrren){
						options += "<option selected=\"selected\" value=\""+key+"\">"+value+"</option>"
					} else {
						options += "<option value=\""+key+"\">"+value+"</option>"
					}
				});

				/*========= MEDICATION RENEW =============*/
				if($(that).hasClass('renew_ajx')) {
					var trrenewNou = "<tr id=\"line_"+id[2]+"\" alt=\""+cntren+"\"><td align=\"left\" class=\"date_line_"+id[2]+"\" valign=\"top\">\n\
							<input name=\"medication_change["+cntren+"]\" id=\"medication_change_"+id[2]+"\" class=\"med_date date_line_"+id[2]+"\" value=\""+dateren+"\"  rel=\"med_date"+cntren+"\" >\n\
							<input name=\"replace_with["+cntren+"]\"   value=\"change\" type=\"hidden\"></td><td align=\"left\" valign=\"top\">\n\
							<input name=\"medication["+cntren+"]\" value=\""+medsren+"\" id=\"medication"+cntren+"\" type=\"text\" class=\"livesearchmedinp med meds_line_"+id[2]+"\">\n\
							<input name=\"hidd_medication["+cntren+"]\" value=\""+hidd_medisren+"\" id=\"hidd_medication"+cntren+"\" type=\"hidden\">\n\
							<input type=\"hidden\" id=\"drid\" name=\"drid["+cntren+"]\" value=\""+id[2]+"\">\n\
							<input type=\"hidden\" id=\"edited"+cntren+"\" name=\"edited["+cntren+"]\" value=\"0\" /></td><td align=\"left\" valign=\"top\">\n\
							<input name=\"dosage["+cntren+"]\" id=\"dosage"+cntren+"\" class=\"dosage dsg_line_"+id[2]+"\" value=\""+dsgren+"\"></td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
							<input name=\"comments["+cntren+"]\" class=\"med comm_line_"+id[2]+"\" value=\""+commren+"\" id=\"comment"+cntren+"\"></td><td width=\"120\" id=\"line_"+id[2]+"_row\" align=\"left\" valign=\"top\" class=\"usrname_line_"+id[2]+"\">"+usrnameren+"</td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
							<select name=\"verordnetvon["+cntren+"]\" id=\"verordnetvon-"+cntren+"\" class=\"user_selector\">"+options+"</select>\n\
							</td><td align=\"left\" valign=\"top\"><div style=\"float:left;\"><a href=\"javascript:void(0)\" class=\"remove_tr\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_delete.png\"  border=\"0\"></a></div></td></tr>";
					var ls_field_id = cntren;
					$("#listpatientmedicationedit_medicationtable").append(trrenewNou);
					$('#medication_change_'+id[2]).datepicker({
						dateFormat: 'dd.mm.yy',
						buttonImageOnly: true,
						changeMonth: true,
						changeYear: true,
						nextText: '',
						prevText: '',
						onSelect: function(){
							var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
							$('#edited' + input_row).val('1');
							changes = true;
						}
					});

				/*========= BEDARF MEDICATION RENEW =============*/

				} else if($(that).hasClass('renew_ajx_bedarfs')) {
					var trrenewNou = "<tr id=\"line_"+id[2]+"\" alt=\""+cntren+"\"><td align=\"left\" class=\"date_line_"+id[2]+"\" valign=\"top\">\n\
					<input name=\"medication_change["+cntren+"]\" id=\"medication_b_change_"+id[2]+"\" class=\"med_date date_line_"+id[2]+"\" value=\""+dateren+"\" rel=\"med_date"+cntren+"\" >\n\
					<input name=\"replace_with["+cntren+"]\"   value=\"change\" type=\"hidden\"></td><td align=\"left\" valign=\"top\">\n\
					<input name=\"medication["+cntren+"]\" value=\""+medsren+"\" id=\"medication"+cntren+"\" type=\"text\" class=\"livesearchmedinp med meds_line_"+id[2]+"\">\n\
					<input name=\"hidd_medication["+cntren+"]\" value=\""+hidd_medisren+"\" id=\"hidd_medication"+cntren+"\" type=\"hidden\">\n\
					<input type=\"hidden\" id=\"drid\" name=\"drid["+cntren+"]\" value=\""+id[2]+"\">\n\
					<input type=\"hidden\" id=\"edited"+cntren+"\" name=\"edited["+cntren+"]\" value=\"0\" /></td><td align=\"left\" valign=\"top\">\n\
					<input name=\"dosage["+cntren+"]\" id=\"dosage"+cntren+"\" class=\"dosage dsg_line_"+id[2]+"\" value=\""+dsgren+"\"></td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
					<input name=\"comments["+cntren+"]\" class=\"med comm_line_"+id[2]+"\" value=\""+commren+"\" id=\"comment"+cntren+"\"></td><td width=\"120\" id=\"line_"+id[2]+"_row\" align=\"left\" valign=\"top\" class=\"usrname_line_"+id[2]+"\">"+usrnameren+"</td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
					<select name=\"verordnetvon["+cntren+"]\" id=\"verordnetvon-"+cntren+"\" class=\"user_selector\">"+options+"</select></td><td align=\"left\" valign=\"top\"><div style=\"float:left;\"><a href=\"javascript:void(0)\" class=\"remove_tr_bedarf\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_delete.png\"  border=\"0\"></a></div></td></tr>";
					var ls_field_id = cntren;

					$("#listpatientmedicationedit_bedarfsmedicationtable").append(trrenewNou);
					$('#medication_b_change_'+id[2]).datepicker({
						dateFormat: 'dd.mm.yy',
						buttonImageOnly: true,
						changeMonth: true,
						changeYear: true,
						nextText: '',
						prevText: '',
						onSelect: function(){
							var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
							$('#edited' + input_row).val('1');
							changes = true;
						}
					});
				}else if($(that).hasClass('renew_ajx_crisis')) {
					//Maria:: Migration CISPC to ISPC 22.07.2020
					var trrenewNou = "<tr id=\"line_"+id[2]+"\" alt=\""+cntren+"\"><td align=\"left\" class=\"date_line_"+id[2]+"\" valign=\"top\">\n\
					<input name=\"medication_change["+cntren+"]\" id=\"medication_b_change_"+id[2]+"\" class=\"med_date date_line_"+id[2]+"\" value=\""+dateren+"\" rel=\"med_date"+cntren+"\" >\n\
					<input name=\"replace_with["+cntren+"]\"   value=\"change\" type=\"hidden\"></td><td align=\"left\" valign=\"top\">\n\
					<input name=\"medication["+cntren+"]\" value=\""+medsren+"\" id=\"medication"+cntren+"\" type=\"text\" class=\"livesearchmedinp med meds_line_"+id[2]+"\">\n\
					<input name=\"hidd_medication["+cntren+"]\" value=\""+hidd_medisren+"\" id=\"hidd_medication"+cntren+"\" type=\"hidden\">\n\
					<input type=\"hidden\" id=\"drid\" name=\"drid["+cntren+"]\" value=\""+id[2]+"\">\n\
					<input type=\"hidden\" id=\"edited"+cntren+"\" name=\"edited["+cntren+"]\" value=\"0\" /></td><td align=\"left\" valign=\"top\">\n\
					<input name=\"dosage["+cntren+"]\" id=\"dosage"+cntren+"\" class=\"dosage dsg_line_"+id[2]+"\" value=\""+dsgren+"\"></td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
					<input name=\"comments["+cntren+"]\" class=\"med comm_line_"+id[2]+"\" value=\""+commren+"\" id=\"comment"+cntren+"\"></td><td width=\"120\" id=\"line_"+id[2]+"_row\" align=\"left\" valign=\"top\" class=\"usrname_line_"+id[2]+"\">"+usrnameren+"</td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
					<select name=\"verordnetvon["+cntren+"]\" id=\"verordnetvon-"+cntren+"\" class=\"user_selector\">"+options+"</select></td><td align=\"left\" valign=\"top\"><div style=\"float:left;\"><a href=\"javascript:void(0)\" class=\"remove_tr_bedarf\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_delete.png\"  border=\"0\"></a></div></td></tr>";
					var ls_field_id = cntren;

					$("#listpatientmedicationedit_crisismedicationtable").append(trrenewNou);
					$('#medication_b_change_'+id[2]).datepicker({
						dateFormat: 'dd.mm.yy',
						buttonImageOnly: true,
						changeMonth: true,
						changeYear: true,
						nextText: '',
						prevText: '',
						onSelect: function(){
							var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
							$('#edited' + input_row).val('1');
							changes = true;
						}
					});

				/*========= SCHMERZ MEDICATION RENEW =============*/
				} else if($(that).hasClass('renew_ajx_schmerz')) {
					var trrenewNou = "<tr id=\"medadd_schmerze"+id[2]+"\" alt=\""+id[2]+"\">\n\
				<td align=\"left\" class=\"date_medadd_schmerze"+id[2]+"\" valign=\"top\">\n\
				<input name=\"add_schmerze[medication_change]["+id[2]+"]\" id=\"medication_sc_change_"+id[2]+"\" class=\"med_date date_line_"+id[2]+"\" value=\""+dateren+"\" rel=\"med_date"+cntren+"\" >\n\
				<input name=\"add_schmerze[replace_with]["+id[2]+"]\" value=\"change\" rel=\"med_date"+cntren+"\" type=\"hidden\"></td>\n\
				<td align=\"left\" valign=\"top\">\n\
					<input name=\"add_schmerze[medication]["+id[2]+"]\" value=\""+medsren+"\" id=\"medication"+id[2]+"\" type=\"text\" class=\"livesearchmedinp med meds_medadd_schmerze"+id[2]+"\" rel=\""+cntren+"\">\n\
					<input name=\"add_schmerze[hidd_medication]["+id[2]+"]\" value=\""+hidd_medisren+"\" id=\"hidd_medication"+id[2]+"\" type=\"hidden\">\n\
					<input type=\"hidden\" id=\"drid"+id[2]+"\" name=\"add_schmerze[drid]["+id[2]+"]\" value=\""+id[2]+"\">\n\
					<input type=\"hidden\" id=\"edited"+cntren+"\" name=\"edited["+cntren+"]\" value=\"0\" /></td>\n\
				<td align=\"left\" valign=\"top\">\n\
					<input name=\"add_schmerze[dosage]["+id[2]+"]\" id=\"dosage"+cntren+"\" class=\"dosage dsg_medadd_schmerze"+id[2]+"\" value=\""+dsgren+"\">\n\
				</td>\n\
				<td width=\"120\" align=\"left\" valign=\"top\" class=\"usrname_medadd_schmerze"+id[2]+"\">"+usrnameren+"</td>\n\
				<td align=\"left\" valign=\"top\"><select name=\"verordnetvon["+id[2]+"]\" id=\"add_schmerze-verordnetvon-"+id[2]+"\" class=\"user_selector\">"+options+"</select></td>\n\<td><a href=\"javascript:void(0)\" onclick=\"delmedicationRow('"+id[2]+"', '"+idpd+"')\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_delete.png\" border=\"0\" class=\"remove_tr_schmerze\" /></a>\n\
				</td>\n\
				</tr>";
					$(trrenewNou).insertBefore('#cDetails');

					var ls_field_id = id[2];
					$('#medication_sc_change_'+id[2]).datepicker({
						dateFormat: 'dd.mm.yy',
						buttonImageOnly: true,
						changeMonth: true,
						changeYear: true,
						nextText: '',
						prevText: '',
						onSelect: function(){
							var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
							$('#edited' + input_row).val('1');
							changes = true;
						}
					});

				/*========= IV MEDICATION RENEW =============*/


				} else if($(that).hasClass('renew_ajx_ivmeds')) {
					var trrenewNou = "<tr id=\"line_"+id[2]+"\" alt=\""+cntren+"\"><td align=\"left\" class=\"date_line_"+id[2]+"\" valign=\"top\">\n\
							<input name=\"medication_change["+cntren+"]\" id=\"medication_iv_change_"+id[2]+"\" class=\"med_date date_line_"+id[2]+"\" value=\""+dateren+"\"  rel=\"med_date"+cntren+"\" >\n\
							<input name=\"replace_with["+cntren+"]\"   value=\"change\" type=\"hidden\"></td><td align=\"left\" valign=\"top\">\n\
							<input name=\"medication["+cntren+"]\" value=\""+medsren+"\" id=\"medication"+cntren+"\" type=\"text\" class=\"livesearchmedinp med meds_line_"+id[2]+"\">\n\
							<input name=\"hidd_medication["+cntren+"]\" value=\""+hidd_medisren+"\" id=\"hidd_medication"+cntren+"\" type=\"hidden\">\n\
							<input type=\"hidden\" id=\"drid\" name=\"drid["+cntren+"]\" value=\""+id[2]+"\">\n\
							<input type=\"hidden\" id=\"edited"+cntren+"\" name=\"edited["+cntren+"]\" value=\"0\" /></td><td align=\"left\" valign=\"top\">\n\
							<input name=\"dosage["+cntren+"]\" id=\"dosage"+cntren+"\" class=\"dosage dsg_line_"+id[2]+"\" value=\""+dsgren+"\"></td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
							<input name=\"comments["+cntren+"]\" class=\"med comm_line_"+id[2]+"\" value=\""+commren+"\" id=\"comment"+cntren+"\" /></td><td width=\"120\" id=\"line_"+id[2]+"_row\" align=\"left\" valign=\"top\" class=\"usrname_line_"+id[2]+"\">"+usrnameren+"</td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
							<select name=\"verordnetvon["+cntren+"]\" id=\"verordnetvon-"+cntren+"\" class=\"user_selector\" >"+options+"</select></td><td align=\"left\" valign=\"top\"><div style=\"float:left;\"><a href=\"javascript:void(0)\" class=\"remove_tr_iv\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_delete.png\"  border=\"0\"></a></div></td></tr>";
					$("#listpatientmedicationedit_ivmedicationtable").append(trrenewNou);
					var ls_field_id = cntren;
					$('#medication_iv_change_'+id[2]).datepicker({
						dateFormat: 'dd.mm.yy',
						buttonImageOnly: true,
						changeMonth: true,
						changeYear: true,
						nextText: '',
						prevText: '',
						onSelect: function(){
							var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
							$('#edited' + input_row).val('1');
							changes = true;
						}
					});
				}

				$('#medication'+ls_field_id).bind('keyup keydown change paste',function(){
					//livesearch medications ls
					$(this).live('keydown paste', function() {
						var input_row = parseInt($(this).attr('id').substr(('medication').length));
						reset_medications(input_row);
					}).liveSearch({
						url: 'ajax/medications?q=',
						id: 'livesearch_admission_medications',
						aditionalWidth: '300',
						noResultsDelay: '900',
						typeDelay: '900',
						returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
					});
				});

				$('#jsmedadd').val(cntren);
				renewMedicationKvno(id[2], pid);
				var medsren = '';
			});
		});



		/*========= REMOVE MEDICATION RENEW =============*/
		$(".remove_tr").live('click', function(){
			var trid = $(this).closest('tr').attr('id');
			var cnt = $("#"+trid).attr('alt');
			var id = trid.split('_');
			var pid = "<?php echo $_GET['id']; ?>";

			$("#"+trid).each(function() {
				var date = "<?php echo date('d.m.Y')?>";
				var meds = $(this).find(".meds_"+trid).val();
				var dsg = $(this).find(".dsg_"+trid).val();
				var comm = $(this).find(".comm_"+trid).val();
				var hidd_medis = $(this).find("#hidd_medication"+cnt).val();
				var usr_add = $(this).find(".usrname_"+trid).text();
				var usr = $(this).find("#verordnetvon-"+cnt+" option:selected").text();
				var usr_id = $(this).find("#verordnetvon-"+cnt+" option:selected").val();
				var trnou = "<tr class=\"row\" id=\"line_r_"+id[1]+"\"><td height=\"20\" align=\"left\" class=\"datern_"+id[1]+"\" valign=\"top\">"+date+"</td><td height=\"20\" align=\"left\" valign=\"top\" class=\"hidd_medicationrn_"+id[1]+"\" style=\"display: none;\">"+hidd_medis+"</td><td align=\"left\" valign=\"top\" class=\"medsrn_"+id[1]+"\"><font color=\"#777777\">"+meds+"</font> </td><td align=\"left\" valign=\"top\" class=\"dsgrn_"+id[1]+"\">"+dsg+"</td><td align=\"left\" valign=\"top\" class=\"commrn_"+id[1]+"\">"+comm+"</td><td align=\"left\" valign=\"top\"><a href=\"javascript:void(0)\" class=\"renew_ajx\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_renew.png\" border=\"0\"></a></td><td height=\"20\" align=\"left\" valign=\"top\" class=\"usrnamern_"+id[1]+"\">"+usr_add+"</td><td height=\"20\" align=\"left\" valign=\"top\">"+usr+"</td><td valign=\"top\" height=\"20\" align=\"left\" class=\"usrid_"+id[1]+"\" style=\"display:none;\">"+usr_id+"</td></tr>";
				$("#listpatientmedication_contenttabel").append(trnou);
				removeMedicationKvno(id[1],pid);
			});

		});

		/*======================= REMOVE IV MEDICATION ROW ======================================*/
		$(".remove_tr_iv").live('click', function(){
			var trid = $(this).closest('tr').attr('id');
			var cnt = $("#"+trid).attr('alt');
			var id = trid.split('_');
			var pid = "<?php echo $_GET['id']; ?>";

			$("#"+trid).each(function() {
				var date = "<?php echo date('d.m.Y')?>";
				var meds = $(this).find(".meds_"+trid).val();
				var dsg = $(this).find(".dsg_"+trid).val();
				var comm = $(this).find(".comm_"+trid).val();
				var hidd_medis = $(this).find("#hidd_medication"+cnt).val();
				var usr_add = $(this).find(".usrname_"+trid).text();
				var usr = $(this).find("#verordnetvon-"+cnt+" option:selected").text();
				var usr_id = $(this).find("#verordnetvon-"+cnt+" option:selected").val();

				var trnou = "<tr class=\"row\" id=\"line_r_"+id[1]+"\"><td height=\"20\" align=\"left\" class=\"datern_"+id[1]+"\" valign=\"top\">"+date+"</td><td height=\"20\" align=\"left\" valign=\"top\" class=\"hidd_medicationrn_"+id[1]+"\" style=\"display: none;\">"+hidd_medis+"</td><td align=\"left\" valign=\"top\" class=\"medsrn_"+id[1]+"\"><font color=\"#777777\">"+meds+"</font> </td><td align=\"left\" valign=\"top\" class=\"dsgrn_"+id[1]+"\">"+dsg+"</td><td align=\"left\" valign=\"top\" class=\"commrn_"+id[1]+"\">"+comm+"</td><td align=\"left\" valign=\"top\"><a href=\"javascript:void(0)\" class=\"renew_ajx_ivmeds\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_renew.png\" border=\"0\"></a></td><td height=\"20\" align=\"left\" valign=\"top\" class=\"usrnamern_"+id[1]+"\">"+usr_add+"</td><td height=\"20\" align=\"left\" valign=\"top\">"+usr+"</td><td valign=\"top\" height=\"20\" align=\"left\" class=\"usrid_"+id[1]+"\" style=\"display:none;\">"+usr_id+"</td></tr>";
				$("#listpatientmedication_contenttabel").append(trnou);
				removeMedicationKvno(id[1],pid);
			});

		});



		/*======================= REMOVE BEDARF MEDICATION ROW ======================================*/
		$(".remove_tr_bedarf").live('click', function(){
			var trid = $(this).closest('tr').attr('id');
			var cnt = $("#"+trid).attr('alt');
			var id = trid.split('_');
			var pid = "<?php echo $_GET['id']; ?>";

			$("#"+trid).each(function() {
				var date = "<?php echo date('d.m.Y')?>";
				var meds = $(this).find(".meds_"+trid).val();
				var dsg = $(this).find(".dsg_"+trid).val();
				var comm = $(this).find(".comm_"+trid).val();
				var hidd_medis = $(this).find("#hidd_medication"+cnt).val();
				var usr_add = $(this).find(".usrname_"+trid).text();
				var usr = $(this).find("#verordnetvon-"+cnt+" option:selected").text();
				var usr_id = $(this).find("#verordnetvon-"+cnt+" option:selected").val();

				var trnou = "<tr class=\"row\" id=\"line_r_"+id[1]+"\"><td height=\"20\" align=\"left\" class=\"datern_"+id[1]+"\" valign=\"top\">"+date+"</td><td height=\"20\" align=\"left\" valign=\"top\" class=\"hidd_medicationrn_"+id[1]+"\" style=\"display: none;\">"+hidd_medis+"</td><td align=\"left\" valign=\"top\" class=\"medsrn_"+id[1]+"\"><font color=\"#777777\">"+meds+"</font> </td><td align=\"left\" valign=\"top\" class=\"dsgrn_"+id[1]+"\">"+dsg+"</td><td align=\"left\" valign=\"top\" class=\"commrn_"+id[1]+"\">"+comm+"</td><td align=\"left\" valign=\"top\"><a href=\"javascript:void(0)\" class=\"renew_ajx_bedarfs\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_renew.png\" border=\"0\"></a></td><td height=\"20\" align=\"left\" valign=\"top\" class=\"usrnamern_"+id[1]+"\">"+usr_add+"</td><td height=\"20\" align=\"left\" valign=\"top\">"+usr+"</td><td valign=\"top\" height=\"20\" align=\"left\" class=\"usrid_"+id[1]+"\" style=\"display:none;\">"+usr_id+"</td></tr>";
				$("#listpatientmedication_contenttabel").append(trnou);
				removeMedicationKvno(id[1],pid);
			});

		});

		/*======================= REMOVE CRISIS MEDICATION ROW , IM-119 ======================================*/
			//Maria:: Migration CISPC to ISPC 22.07.2020
		$(".remove_tr_crisis").live('click', function(){
			var trid = $(this).closest('tr').attr('id');
			var cnt = $("#"+trid).attr('alt');
			var id = trid.split('_');
			var pid = "<?php echo $_GET['id']; ?>";

			$("#"+trid).each(function() {
				var date = "<?php echo date('d.m.Y')?>";
				var meds = $(this).find(".meds_"+trid).val();
				var dsg = $(this).find(".dsg_"+trid).val();
				var comm = $(this).find(".comm_"+trid).val();
				var hidd_medis = $(this).find("#hidd_medication"+cnt).val();
				var usr_add = $(this).find(".usrname_"+trid).text();
				var usr = $(this).find("#verordnetvon-"+cnt+" option:selected").text();
				var usr_id = $(this).find("#verordnetvon-"+cnt+" option:selected").val();

				var trnou = "<tr class=\"row\" id=\"line_r_"+id[1]+"\"><td height=\"20\" align=\"left\" class=\"datern_"+id[1]+"\" valign=\"top\">"+date+"</td><td height=\"20\" align=\"left\" valign=\"top\" class=\"hidd_medicationrn_"+id[1]+"\" style=\"display: none;\">"+hidd_medis+"</td><td align=\"left\" valign=\"top\" class=\"medsrn_"+id[1]+"\"><font color=\"#777777\">"+meds+"</font> </td><td align=\"left\" valign=\"top\" class=\"dsgrn_"+id[1]+"\">"+dsg+"</td><td align=\"left\" valign=\"top\" class=\"commrn_"+id[1]+"\">"+comm+"</td><td align=\"left\" valign=\"top\"><a href=\"javascript:void(0)\" class=\"renew_ajx_crisis\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_renew.png\" border=\"0\"></a></td><td height=\"20\" align=\"left\" valign=\"top\" class=\"usrnamern_"+id[1]+"\">"+usr_add+"</td><td height=\"20\" align=\"left\" valign=\"top\">"+usr+"</td><td valign=\"top\" height=\"20\" align=\"left\" class=\"usrid_"+id[1]+"\" style=\"display:none;\">"+usr_id+"</td></tr>";
				$("#listpatientmedication_contenttabel").append(trnou);
				removeMedicationKvno(id[1],pid);
			});

		});


		/*======================= REMOVE SCHMERZPUMP MEDICATION ROW ======================================*/
		$(".remove_tr_schmerze").live('click', function(){
			var trid = $(this).closest('tr').attr('id');
			var cnt = $("#"+trid).attr('alt');
			var id = trid.split('medadd_schmerze');

			var pid = "<?php echo $_REQUEST['id']; ?>";


			$("#"+trid).each(function() {
				var date = "<?php echo date('d.m.Y')?>";
				var meds = $(this).find(".meds_"+trid).val();
				var dsg = $(this).find(".dsg_"+trid).val();

				var comm = '';
				var hidd_medis = $(this).find("#hidd_medication"+cnt).val();
				var drid = $(this).find("#drid"+cnt).val();
				var usr_add = $(this).find(".usrname_"+trid).text();
				var usr = $(this).find("#add_schmerze-verordnetvon-"+cnt+" option:selected").text();
				var usr_id = $(this).find("#add_schmerze-verordnetvon-"+cnt+" option:selected").val();

				var trnou = "<tr class=\"row\" id=\"line_r_"+drid+"\"><td height=\"20\" align=\"left\" class=\"datern_"+drid+"\" valign=\"top\">"+date+"</td><td height=\"20\" align=\"left\" valign=\"top\" class=\"hidd_medicationrn_"+drid+"\" style=\"display: none;\">"+hidd_medis+"</td>\n\
						<td class=\"drid"+drid+"\" style=\"display: none;\">"+drid+"</td>\n\
						<td align=\"left\" valign=\"top\" class=\"medsrn_"+drid+"\"><font color=\"#777777\">"+meds+"</font> </td><td align=\"left\" valign=\"top\" class=\"dsgrn_"+drid+"\">"+dsg+"</td><td align=\"left\" valign=\"top\" class=\"commrn_"+drid+"\">"+comm+"</td><td align=\"left\" valign=\"top\"><a href=\"javascript:void(0)\" class=\"renew_ajx_schmerz\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_renew.png\" border=\"0\"></a></td><td height=\"20\" align=\"left\" valign=\"top\" class=\"usrnamern_"+drid+"\">"+usr_add+"</td><td height=\"20\" align=\"left\" valign=\"top\">"+usr+"</td><td valign=\"top\" height=\"20\" align=\"left\" class=\"usrid_"+drid+"\" style=\"display:none;\">"+usr_id+"</td></tr>";
				$("#listpatientmedication_contenttabel").append(trnou);
				$("#medadd_schmerze"+id[1]).remove();
			});
		});
    });
//medications


	// make the textarea grow
	$(function() {
		$('textarea').elastic();
	});

	function getSelected(dbvalue,fieldname)
	{
		var fieldarray = document.getElementsByName(fieldname);
		for(i=0; i<fieldarray.length;i++)
		{
			if(fieldarray[i].value==dbvalue)
			{
				fieldarray[i].checked = true;
			}
		}
	}

	function showbox(val)
	{
		if(val.value=="4")
		{
			$("#otherdivid").show();
		}else{
			$("#otherdivid").hide();
		}
	}

	function isInteger(k)
	{
	 	var s = document.getElementById('input_value'+k).value;
	 	var chars = "0123456789";

	 	if(s>10)
	 	{
			document.getElementById('input_value'+k).value = "";
			return false;
	 	}

	 	var i;
	 	s = s.toString();
		for (i = 0; i < s.length; i++)
		{
			var c = s.charAt(i);
			if (chars.indexOf(c)==-1)
			{
	 			document.getElementById('input_value'+k).value = "";
	 			return false;
			}
		}
		return true;
	}

	function isIntegerServices(k)
	{
	 	var s = document.getElementById('inputvalue'+k).value;
	 	var chars = "0123456789";

	 	if(s>10)
	 	{
			document.getElementById('inputvalue'+k).value = "";
			return false;
	 	}

	 	var i;
	 	s = s.toString();
		for (i = 0; i < s.length; i++)
		{
			var c = s.charAt(i);
			if (chars.indexOf(c)==-1)
			{
	 			document.getElementById('inputvalue'+k).value = "";
	 			return false;
			}
		}
		return true;
	}
	
	//weird "leave page" function
	var dontLeave = function(e) {
        if($('#generate_bericht_preview').length>0 && $('#generate_bericht_preview').val()) {
            return;
        }
        if($('#generate_bericht').length>0 && $('#generate_bericht').val()) {
            return;
        }
        if($('#generate_bericht_preview').length==0 || $('#generate_bericht_preview').val()=="") {
		if (changes === true && submited === false) {
			return "<?php echo $this->translate('no_save_leave_alert'); ?>";
		}
	}
	}

	window.onbeforeunload = dontLeave;

	$(document).ready(function(){
		//ISPC-2663 Carmen 02.09.2020
		$(".talkwithitem option[value='_']").attr('disabled', true); 
		//--
		
		// TODO-1211
 		if(route_error == 1){
 			alert('<?php echo $this->translate('route_calculation_error'); ?>')
 		}
		
		//allow submit without "leave page" alert
		$('#submitform,#pdfexport').live('click', function() {
			submited = true;
			changes = false;
		});
		
		//ISPC-2882 Ancuta 22.04.2021
		$('#submitform_go_2_anlage2kinder').live('click', function() {
			submited = true;
			changes = false;
		});
		//--
		
		 $('input,textarea,select').live('change',function(){
			//console.log($(this).val());
		submited = false;
		changes = true;
		}) ;
		
		 $( ".datepick" ).datepicker({
				dateFormat: 'dd.mm.yy',
				showOn: "both",
				buttonImage: $('#calImg').attr('src'),
				buttonImageOnly: true,
				changeMonth: true,
				changeYear: true,
				nextText: '',
				prevText: ''
			}).mask("99.99.9999");
		 
		$("#date").mask("99.99.9999");
		//init sapv checking with loaded data
		check_sapv();
		date_validations();
		
		$('*').keypress(function(event){
		        if(event.keyCode == 13 && event.target.nodeName!='TEXTAREA')
		        {
				event.preventDefault();
				return false;
		        }
		});
		
		//km distance validation
		if($('#fahrtstreke_km').length > 0)
		{
			$('#fahrtstreke_km').val($('#fahrtstreke_km').val().replace(',', '.').replace(/[^\d.]/g, ''));

			$('#fahrtstreke_km').keyup(function() {
				var $this = $(this);
				var $final_var = $this.val().replace(',', '.').replace(/[^\d.]/ig, '');
				if($final_var >= '0')
				{
					$this.val($final_var);
				}
				else
				{
					$this.val('');
				}
			});
		}
		if($('#fahrtstreke_km1').length > 0)
		{
			$('#fahrtstreke_km1').val($('#fahrtstreke_km1').val().replace(',', '.').replace(/[^\d.]/g, ''));

			$('#fahrtstreke_km1').keyup(function() {
				var $this = $(this);
				var $final_var = $this.val().replace(',', '.').replace(/[^\d.]/ig, '');
				if($final_var >= '0')
				{
					$this.val($final_var);
				}
				else
				{
					$this.val('');
				}
			});
		}

		//**********************last checkbox row ***********************//

		var somatisch   =   ["1","2","4","5","6","7","8","10"];
		var koord   =   ["11","16","17"];
		var psycho   =   ["9","12","13","14","15"];
		var checkme = '';

	<?php if (empty($_REQUEST['cid'])): ?>
		$('#koord').attr('checked', true);
	<?php endif; ?>

		$(".kvnosymp_input").blur(function(){
			var sympid = $(this).attr('id').replace('input_value','');
			var somatisch_chk = 0;
			var koord_chk = 0;
			var psycho_chk = 0;

			$.each(somatisch, function(i, obj) {
				if($('#input_value' + obj).val() > 2){
					somatisch_chk = 1;
				}
			});


			$.each(psycho, function(i, obj) {
				if($('#input_value' + obj).val() > 2){
					psycho_chk = 1;
				}
			});

			$.each(koord, function(i, obj) {
				if($('#input_value' + obj).val() > 2){
					koord_chk = 1;
				}
			});

			if(somatisch_chk == 0 && psycho_chk == 0){
				koord_chk = 1;
			}

			if(somatisch_chk == 1){
				$('#somatisch').attr('checked', true)
				$('#koord').attr('checked', false)
			} else {
				$('#somatisch').attr('checked', false)
			}

			if(psycho_chk == 1){
				$('#psycho').attr('checked', true)
				$('#koord').attr('checked', false)
			} else {
				$('#psycho').attr('checked', false)
			}

			if(koord_chk == 1){
				$('#koord').attr('checked', true)
			}
		});

	$('#psycho').bind('click',function(){
		if($('#psycho').attr('checked') == true) {
			$('#koord').attr('checked', false)
		}
	});

	$('#ethisch').bind('click',function(){
		if($('#ethisch').attr('checked') == true) {
			$('#koord').attr('checked', false)
		}
	});

	$('#somatisch').bind('click',function(){
		if($('#somatisch').attr('checked') == true) {
			$('#koord').attr('checked', false)
		}
	});
//**********************last checkbox row end ***********************//


//**************************************** befund radio *********************************//
	if($('#kopfb:checked').val() == 2){
		$('#kopf_textdiv').show();
	}

	if($('#thoraxb:checked').val() == 2){
		$('#thorax_textdiv').show();
	}

	if($('#abdomenb:checked').val() == 2){
		$('#abdomen_textdiv').show();
	}

	if($('#extremitatenb:checked').val() == 2){
		$('#extremitaten_textdiv').show();
	}

	if($('#haut_wundenb:checked').val() == 2){
		$('#haut_wunden_textdiv').show();
	}

	if($('#neurologisch_psychiatrischb:checked').val() == 2){
		$('#neurologisch_psychiatrisch_textdiv').show();
	}

	$("input[name=kopf]").bind('click',function() {

		if($(this).val() == 2){
			$('#kopf_textdiv').show();
		} else {
			$('#kopf_text').val("");
			$('#kopf_textdiv').hide();
		}
	});
	$("input[name=thorax]").bind('click',function() {
		if($(this).val() == 2){
			$('#thorax_textdiv').show();
		} else {
			$('#thorax_text').val("");
			$('#thorax_textdiv').hide();
		}
	});
	$("input[name=abdomen]").bind('click',function() {
		if($(this).val() == 2){
			$('#abdomen_textdiv').show();
		} else {
			$('#abdomen_text').val("");
			$('#abdomen_textdiv').hide();
		}
	});
	$("input[name=extremitaten]").bind('click',function() {
		if($(this).val() == 2){
			$('#extremitaten_textdiv').show();
		} else {
			$('#extremitaten_text').val("");
			$('#extremitaten_textdiv').hide();
		}
	});
	$("input[name=haut_wunden]").bind('click',function() {
		if($(this).val() == 2){
			$('#haut_wunden_textdiv').show();
		} else {
			$('#haut_wunden_text').val("");
			$('#haut_wunden_textdiv').hide();
		}
	});
	$("input[name=neurologisch_psychiatrisch]").bind('click',function() {
		if($(this).val() == 2){
			$('#neurologisch_psychiatrisch_textdiv').show();
		} else {
			$('#neurologisch_psychiatrisch_text').val("");
			$('#neurologisch_psychiatrisch_textdiv').hide();
		}
	});
//***************************************** befund radio end ***********************************//

//**************************************** Stammdaten checkboxes *********************************//
            // port
	    if($('#kvno_port_notok:checked').val() == 2){
				$('#kvno_port_textdiv').show();
			}

			$("input[name=kvno_port]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_port_textdiv').show();
				} else {
					$('#kvno_port_text').val("");
					$('#kvno_port_textdiv').hide();
				}
			});

			// besonderer Aus-/ Eingang
			if($('#kvno_kunstliche_notok:checked').val() == 2){
				$('#kvno_kunstliche_textdiv').show();
			}

			$("input[name=kvno_kunstliche]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_kunstliche_textdiv').show();
				} else {
					$('#kvno_kunstliche_text').val("");
					$('#kvno_kunstliche_textdiv').hide();
				}
			});

			//Pumps
			if($('#kvno_pumpe_notok:checked').val() == 2){
				$('#kvno_pumps_textdiv').show();
			}

			$("input[name=kvno_pumps]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_pumps_textdiv').show();
				} else {
					$('#kvno_pumps_text').val("");
					$('#kvno_pumps_textdiv').hide();
				}
			});

			//DK
			if($('#kvno_dauerkatheter_notok:checked').val() == 2){
				$('#kvno_dk_textdiv').show();
			}

			$("input[name=kvno_dk]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_dk_textdiv').show();
				} else {
					$('#kvno_dk_text').val("");
					$('#kvno_dk_textdiv').hide();
				}
			});

			// Peg
			if($('#kvno_peg_notok:checked').val() == 2){
				$('#kvno_peg_textdiv').show();
			}

			$("input[name=kvno_peg]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_peg_textdiv').show();
				} else {
					$('#kvno_peg_text').val("");
					$('#kvno_peg_textdiv').hide();
				}
			});

			// Darm
			if($('#kvno_darm_notok:checked').val() == 2){
				$('#kvno_darm_textdiv').show();
			}

			$("input[name=kvno_darm]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_darm_textdiv').show();
				} else {
					$('#kvno_darm_text').val("");
					$('#kvno_darm_textdiv').hide();
				}
			});

			//Blase
			if($('#kvno_blase_notok:checked').val() == 2){
				$('#kvno_blase_textdiv').show();
			}

			$("input[name=kvno_blase]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_blase_textdiv').show();
				} else {
					$('#kvno_blase_text').val("");
					$('#kvno_blase_textdiv').hide();
				}
			});

			//Luftrohre
			if($('#kvno_luftrohre_notok:checked').val() == 2){
				$('#kvno_luftrohre_textdiv').show();
			}

			$("input[name=kvno_luftrohre]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_luftrohre_textdiv').show();
				} else {
					$('#kvno_luftrohre_text').val("");
					$('#kvno_luftrohre_textdiv').hide();
				}
			});

			//Ablaufsonde
			if($('#kvno_ablaufsonde_notok:checked').val() == 2){
				$('#kvno_ablaufsonde_textdiv').show();
			}

			$("input[name=kvno_ablaufsonde]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_ablaufsonde_textdiv').show();
				} else {
					$('#kvno_ablaufsonde_text').val("");
					$('#kvno_ablaufsonde_textdiv').hide();
				}
			});
//*****************************************Stammdaten checkboxes  end ***********************************//


//*****************************************Duplicate visits ***********************************//
		$('#duplicate_visits').dialog({
			autoOpen: false,
			title: '<?php echo $this->translate('overlapping_event_modal_title'); ?>',
			modal: true,
			buttons: {
				"<?php echo $this->translate('noconfirm'); ?>": function() {
					$('#submitform').attr('disabled',false);
					$('#submitform_go_2_anlage2kinder').attr('disabled',false);
					$( this ).dialog( "close" );
				},
				"<?php echo $this->translate('yesconfirm'); ?>": function() {
					$('#submitform').attr('disabled',true);
					$('#submitform_go_2_anlage2kinder').attr('disabled',true);

					 $('.asubmitform').attr('disabled',true);
					 
					 $(".ui-button:first").attr("disabled", true)
					 .addClass("ui-state-disabled").next("button").attr("disabled", true)
					 .addClass("ui-state-disabled");
					 
					 $(":button:contains('Ja')").attr("disabled",true).addClass( 'ui-state-disabled' );
					 $(":button:contains('Nein')").remove();
					 $(":button:contains('Ja')").remove();
					 
					 var nein = '<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-disabled" role="button" disabled="disabled"><span class="ui-button-text">Nein</span></button>';
					 var ja = '<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-disabled" role="button" disabled="disabled"><span class="ui-button-text">Ja</span></button>';
					$('.ui-dialog-buttonpane').html('<div class="ui-dialog-buttonset">'+nein+ja+'</div>');
					
					$('#contact_form').submit();
				}
			},
			create:function () {
		        $(this).closest(".ui-dialog")
		            .find(".ui-button:first") // the first button
		            .addClass("asubmitform");
		    },
		    close:function () {
		    	$('.asubmitform').attr('disabled',false),
				 $(".ui-button:first").attr("disabled", false)
				 .removeClass("ui-state-disabled").next("button").attr("disabled", false)
				 .removeClass("ui-state-disabled");
		    }
		});

		function rowBuilder(that) {
			return '<tr>'
				+'<td>'+that.id+'</td>'
				+'<td>'+that.user_details.first_name+ ' ' + that.user_details.last_name +'</td>'
				+'<td>'+that.start_date+'</td>'
				+'<td>'+that.end_date+'</td>'
				+'</tr>';
		}

		$('#pdfexport').bind('click', function() {
			setTimeout(function () {$('input[type=submit]').attr('disabled', true);}, 150);
			setTimeout(function () {$('input[type=submit]').attr('disabled', false);}, 8000);
		});

		
		
		$('#pdfexport').bind('click', function(event) {
			event.preventDefault();
			$(document).userSession().checksession('abort', function(result) { // new function
				if(result === false) {
					event.stopImmediatePropagation(); //stop going forward
				} else {
					//ISPC-2430 Carmen 26.11.2019
					if(med_time_dosage_allowed)
					{
						if ( ! validateForm_edit()) {
							event.stopImmediatePropagation(); //stop going forward
						}
						else if($('#vs_error').val() != '0') {
							event.stopImmediatePropagation(); //stop going forward
							alert('Vital signs errors');
						}
						else
						{
							$('#generate_pdf').val('1');
							
							$('#submitform').attr('disabled',true);
							$('#submitform_go_2_anlage2kinder').attr('disabled',true);
							$('#save_create_doctorletter').attr('disabled',true);
							$('#save_visit_edit_letter').attr('disabled',true);
							$('#pdfexport').attr('disabled',true);
							$('#contact_form').submit();
						}
					}
					else
					{
						if($('#vs_error').val() != '0') {
							event.stopImmediatePropagation(); //stop going forward
							alert('Vital signs errors');
						}
						else
						{
							$('#generate_pdf').val('1');
							
							$('#submitform').attr('disabled',true);
							$('#submitform_go_2_anlage2kinder').attr('disabled',true);
							$('#save_create_doctorletter').attr('disabled',true);
							$('#save_visit_edit_letter').attr('disabled',true);
							$('#pdfexport').attr('disabled',true);
							$('#contact_form').submit();
						}
					}
					
				}
			}); // new function end
		});
		
		$('#pdfexport').bind('click', function() {
			setTimeout(function () {$('button[type=button]').attr('disabled', true);}, 150);
			setTimeout(function () {
				$('button[type=button]').attr('disabled', false);
				$('#generate_pdf').val('');
			}, 6000);
		});
		
		
		
		$('#submitform').bind('click', function(event) { //new function
		
			event.preventDefault();
			$(document).userSession().checksession('abort', function(result) {
				if(result === false) {
					event.stopImmediatePropagation(); //stop going forward
				} else {
					date_validations();
					
					//TODO-4069 Ancuta 26.04.2021
					var error_involved_users = 0;

					if(companion_time_tracking == 1 ) {//TODO-4069 Ancuta 14.05.2021
						error_involved_users = check_sum_lines();
					}
					//-- 
					var error = 0;
					var ajax_done = 0;
		
					$("input[name=kvno_medizini_a]:checked").each(function(){
						if($(this).val() ==  3){
							if($("textarea[name=kvno_sonstiges]").val().length == 0){
								error = 1;
							}
						}
					});
					
					//ISPC-2430 Carmen 26.11.2019
					if(med_time_dosage_allowed)
					{
						if ( ! validateForm_edit()) {
							error = 1;
						}
					}
					
					if($('#vs_error').val() != '0') {
						error = 1;
						alert('Vital signs errors');
					}


					//Maria:: Migration CISPC to ISPC 22.07.2020
					var diagnosisCorrectFilled = true;
					$('#block-clinic_diagnosis_content #fieldset-clinic_diagnosis table tr.icd_holder_row').each(function(){
						countChecked = 0;
						textfieldsFilled = false;
						$(this).find('input:text').each(function(){
							if($(this).val() !== ''){
								textfieldsFilled = true;
							}
						})
						if(textfieldsFilled){
							$(this).find('input:radio:checked').each(function(){
								console.log($(this).val());
								countChecked++;

							})
							//console.log(countChecked);
							if(diagnosisCorrectFilled && countChecked == 0){
								error = 1;
								diagnosisCorrectFilled = false;
								jAlert('<?php echo $this->translate("diagnose_cat_fill"); ?>');
							}

						}

					});
                    //IM-147
					if($('#pcoc_errors .pcoc_error').length>0) {
                        error = 1;
                        alert('PCOC ist nicht vollstäündig.');
                    }
					// --

					
					
					
		
// 					if($('#begin_date_h').val() > $('#end_date_h').val()) {
// 						error = 2;
// 					}
		
		
// 					if($('#begin_date_h').val() == $('#end_date_h').val()) {
// 						if($('#begin_date_m').val() >= $('#end_date_m').val()) {
// 							error = 3;
// 						}
// 					}
		
		
// 					if($('#date').val() == '') {
// 						error = 4;
// 					}
		
// 					if($('#begin_date_h').val() == "" || $('#end_date_h').val() == "" || $('#begin_date_m').val() == "" || $('#end_date_m').val() == "") {
// 						error = 5;
// 					}
		
// 					if(error == 1) {
// 						jAlert('Bitte füllen Sonstiges / Kommentar');
// 						return false;
// 					} else if(error == 2) {
// 						jAlert('Die Zeit der Beendigung des Besuchs sollte später sein als die Anfangszeit.');
// 						return false;
// 					} else if(error == 3) {
// 						jAlert('Die Zeit der Beendigung des Besuchs sollte später sein als die Anfangszeit.');
// 						return false;
// 					} else if(error == 4) {
// 						jAlert('Bitte füllen Beginn datum');
// 						return false;
// 					}else if(error == 5) {
// 						jAlert('Bitte füllen zeit');
// 						return false;
// 					}
		
		
					if(error == '0' && error_involved_users == 0){ //TODO-4069 Ancuta 26.04.2021 - added error_involved_users condition
					
						$.ajax({
							type: 'POST',
							url: 'ajax/overlappingcheck?id=<?php echo $_REQUEST['id']; ?>&uid=<?php echo $this->user_id;?>',
							data: {
								visit_type: 'CF',
								begin_h: $('#begin_date_h').val(),
								begin_m: $('#begin_date_m').val(),
								end_h: $('#end_date_h').val(),
								end_m: $('#end_date_m').val(),
								visit_start: $('#date').val(),
								over_midnight: $('#over_midnight').val(),
								edit_id: '<?php if (!empty($_REQUEST['cid'])): echo $_REQUEST['cid']; else: echo '0';	endif; ?>'
		
							},
							beforeSend:function(){
								//				loading image
								$('#submitform').attr('disabled',true);
								$('#submitform').addClass('loading_button');
								$('#submitform_go_2_anlage2kinder').attr('disabled',true);
								$('#submitform_go_2_anlage2kinder').addClass('loading_button');
								$('#pdfexport').attr('disabled',true);
								$('#pdfexport').addClass('loading_button');
								
								$('#save_visit').val(''); //just precaution
								$('#generate_pdf').val('');
							},
							success:function(data){
								$('button#submitform').removeClass('loading_button');
								$('button#submitform_go_2_anlage2kinder').removeClass('loading_button');
								$('div.error_fetching').remove();
								$('#submitform').attr('disabled',false);
								$('#submitform_go_2_anlage2kinder').attr('disabled',false);
								$('#pdfexport').attr('disabled',false);
								$('button#pdfexport').removeClass('loading_button');
		
								$('#save_visit').val('1');
								$('#generate_pdf').val('');
								
								var visitdata = jQuery.parseJSON(data);
		
								$('#visits_body').html(''); //reset table tbody
								

								if(visitdata.error != 0)
								{
									jAlert(visitdata.error);
									return false;
								} 
								else if(visitdata.error == 0 && visitdata.confirmation != 0)
								{
									jConfirm(visitdata.confirmation, '<?php echo $this->translate("atention"); ?>', function(r) {
										if(r)
										{
											
											$('#over_midnight').val('1');
											$('#submitform').attr('disabled',true);
											$('#submitform_go_2_anlage2kinder').attr('disabled',true);
											$('#pdfexport').attr('disabled',true);
											$('#contact_form').submit();		
										} 
										else 
										{
											$('#over_midnight').val('0');
											$('.billable_days_option').hide();
											$('.billable_days_option').html('');
											jAlert(visitdata.denied_confirmation);
											return false;
										}
									}); 
								} 
								else
								{
									if(visitdata.intersected == 1){
										$('#duplicate_visits').dialog('open');
										return false; // used with modal
			
									} else {
										$('#submitform').attr('disabled',true);
										$('#submitform_go_2_anlage2kinder').attr('disabled',true);
										$('#pdfexport').attr('disabled',true);
										$('#contact_form').submit();
									}
								}									
							},
							error:function(){
								ajax_done = 1;
								// failed request; give feedback to user
							}
						});
					}
				}
			});
		});
		
		
		$('#submitform_go_2_anlage2kinder').bind('click', function(event) { //new function
		
			event.preventDefault();
			$(document).userSession().checksession('abort', function(result) {
				if(result === false) {
					event.stopImmediatePropagation(); //stop going forward
				} else {
					date_validations()
					var error = 0;
					var ajax_done = 0;
					
					//TODO-4069 Ancuta 26.04.2021
					var error_involved_users = 0;
					if(companion_time_tracking == 1) {
						error_involved_users = check_sum_lines();
					}
					//-- 
					
		
					$("input[name=kvno_medizini_a]:checked").each(function(){
						if($(this).val() ==  3){
							if($("textarea[name=kvno_sonstiges]").val().length == 0){
								error = 1;
							}
						}
					});
					
					//ISPC-2430 Carmen 26.11.2019
					if(med_time_dosage_allowed)
					{
						if ( ! validateForm_edit()) {
							error = 1;
						}
					}
					
					if($('#vs_error').val() != '0') {
						error = 1;
						alert('Vital signs errors');
					}


					//Maria:: Migration CISPC to ISPC 22.07.2020
					var diagnosisCorrectFilled = true;
					$('#block-clinic_diagnosis_content #fieldset-clinic_diagnosis table tr.icd_holder_row').each(function(){
						countChecked = 0;
						textfieldsFilled = false;
						$(this).find('input:text').each(function(){
							if($(this).val() !== ''){
								textfieldsFilled = true;
							}
						})
						if(textfieldsFilled){
							$(this).find('input:radio:checked').each(function(){
								console.log($(this).val());
								countChecked++;

							})
							//console.log(countChecked);
							if(diagnosisCorrectFilled && countChecked == 0){
								error = 1;
								diagnosisCorrectFilled = false;
								jAlert('<?php echo $this->translate("diagnose_cat_fill"); ?>');
							}

						}

					});
                    //IM-147
					if($('#pcoc_errors .pcoc_error').length>0) {
                        error = 1;
                        alert('PCOC ist nicht vollstäündig.');
                    }
					// --
					
					if(error == '0' && error_involved_users == '0'){//TODO-4069 Ancuta 26.04.2021 - added error_involved_users condition
						$.ajax({
							type: 'POST',
							url: 'ajax/overlappingcheck?id=<?php echo $_REQUEST['id']; ?>&uid=<?php echo $this->user_id;?>',
							data: {
								visit_type: 'CF',
								begin_h: $('#begin_date_h').val(),
								begin_m: $('#begin_date_m').val(),
								end_h: $('#end_date_h').val(),
								end_m: $('#end_date_m').val(),
								visit_start: $('#date').val(),
								over_midnight: $('#over_midnight').val(),
								edit_id: '<?php if (!empty($_REQUEST['cid'])): echo $_REQUEST['cid']; else: echo '0';	endif; ?>'
		
							},
							beforeSend:function(){
								//				loading image
								$('#submitform').attr('disabled',true);
								$('#submitform_go_2_anlage2kinder').attr('disabled',true);
								$('#submitform').addClass('loading_button');
								$('#pdfexport').attr('disabled',true);
								$('#pdfexport').addClass('loading_button');
								
								$('#save_visit').val(''); //just precaution
								$('#generate_pdf').val('');
							},
							success:function(data){
								$('button#submitform').removeClass('loading_button');
								$('button#submitform_go_2_anlage2kinder').removeClass('loading_button');
								$('div.error_fetching').remove();
								$('#submitform').attr('disabled',false);
								$('#submitform_go_2_anlage2kinder').attr('disabled',false);
								$('#pdfexport').attr('disabled',false);
								$('button#pdfexport').removeClass('loading_button');
		
								$('#save_visit').val('1');
								$('#go_2_anlage2kinder').val('1');
								$('#generate_pdf').val('');
								
								var visitdata = jQuery.parseJSON(data);
		
								$('#visits_body').html(''); //reset table tbody
								

								if(visitdata.error != 0)
								{
									jAlert(visitdata.error);
									return false;
								} 
								else if(visitdata.error == 0 && visitdata.confirmation != 0)
								{
									jConfirm(visitdata.confirmation, '<?php echo $this->translate("atention"); ?>', function(r) {
										if(r)
										{
											
											$('#over_midnight').val('1');
											$('#submitform').attr('disabled',true);
											$('#submitform_go_2_anlage2kinder').attr('disabled',true);
											$('#pdfexport').attr('disabled',true);
											$('#contact_form').submit();		
										} 
										else 
										{
											$('#over_midnight').val('0');
											$('.billable_days_option').hide();
											$('.billable_days_option').html('');
											jAlert(visitdata.denied_confirmation);
											return false;
										}
									}); 
								} 
								else
								{
									if(visitdata.intersected == 1){
										$('#duplicate_visits').dialog('open');
										return false; // used with modal
			
									} else {
										$('#submitform').attr('disabled',true);
										$('#submitform_go_2_anlage2kinder').attr('disabled',true);
										$('#pdfexport').attr('disabled',true);
										$('#contact_form').submit();
									}
								}									
							},
							error:function(){
								ajax_done = 1;
								// failed request; give feedback to user
							}
						});
					}
				}
			});
		});

		$('select').change(function(){
			$('#submitform').attr('disabled',false);
			$('#submitform_go_2_anlage2kinder').attr('disabled',false);
		});

		//TODO-4069 Ancuta 26.04.2021 - added error_involved_users condition
        function check_sum_lines(){
            var sums =[];
            $('.timelog-mins_row_sum').each(function(){
                sums.push($(this).val()); 
            });

            if (sums.length === 0) {
                alert('Die Zeit muss dokumentiert werden.');
				var error_has_users = 1;
            } else{
				var error_has_users = 0;
            } 
            return  error_has_users;
        }
        //--
		/*--------------------------------------------------------------------------------------------------------*/
		/*---------------------------------------------------EBM------------------------------------------------*/
		/*----------------------------------------------------------------------------------------------------------*/
		function date_validations(){
			var  begin_date_h = $('#begin_date_h').val();
			var  begin_date_m = $('#begin_date_m').val();
			var  end_date_h = $('#end_date_h').val();
			var  end_date_m = $('#end_date_m').val();
			var  date =  $('#date').val();
			
// 			alert($('#begin_date_h').val());
// 			alert($('#end_date_h').val());
			
			if( begin_date_h  > end_date_h) 
			{
				$('#over_midnight').val('1');
			}
			else
			{
				$('#over_midnight').val('0');
			}
			
		}
		
		function midnight_validations_old(){ //TODO-4069 Ancuta 15.06.2021 - Funtion renamed - and moved outside   document ready
			var  begin_date_h = $('#begin_date_h').val();
			var  begin_date_m = $('#begin_date_m').val();
			var  end_date_h = $('#end_date_h').val();
			var  end_date_m = $('#end_date_m').val();
			var  date =  $('#date').val();
			
			
			if( begin_date_h  > end_date_h) 
			{
				$('#over_midnight').val('1');
			}
			else
			{
				$('#over_midnight').val('0');
				$('.billable_days_option').hide();
				$('.billable_days_option').html('');
			}	

			$.ajax({
					type: 'POST',
					url: 'ajax/overmidnightcheck?id=<?php echo $_REQUEST['id']; ?>&uid=<?php echo $this->user_id;?>',
					data: {
						visit_type: 'CF',
						begin_h: $('#begin_date_h').val(),
						begin_m: $('#begin_date_m').val(),
						end_h: $('#end_date_h').val(),
						end_m: $('#end_date_m').val(),
						visit_start: $('#date').val(),
						over_midnight: $('#over_midnight').val(),
						edit_id: '<?php if (!empty($_REQUEST['cid'])): echo $_REQUEST['cid']; else: echo '0';	endif; ?>'

					},
				 
					success:function(data){
						var visitdata = jQuery.parseJSON(data);

						$('.billable_days_option').html(''); //reset table tbody
						

						if(visitdata.error != 0)
						{
							jAlert(visitdata.error);
							return false;
						} 
						else if(visitdata.error == 0  && $('#over_midnight').val() == "1")
						{
							$('.billable_days_option').show();
							var over_midnight_label = '<span><?php echo $contact_form_lang['please select the billable date']; ?></span>'
									var div_start = "<div>";
							var start = '<label><input type="radio" name="billable_date"  '+visitdata.start_checked+'  value="start">'+visitdata.start_date_dmy+'</label>'
							var end = '<label><input type="radio"  name="billable_date" '+visitdata.end_checked+' value="end">'+visitdata.end_date_dmy+'</label>'
									var div_end = "</div>";
// 							var start = '<label><input type="radio" name="billable_date"  '+visitdata.start_checked+'  value="'+visitdata.start_date+'">'+visitdata.start_date_dmy+'</label>'
// 							var end = '<label><input type="radio"  name="billable_date" '+visitdata.end_checked+' value="'+visitdata.end_date+'">'+visitdata.end_date_dmy+'</label>'
							$('.billable_days_option').html(over_midnight_label+div_start+start+end+div_end);
						} 
						else
						{
							$('.billable_days_option').hide();
						}									
					},
					error:function(){
						ajax_done = 1;
						// failed request; give feedback to user
					}
				});
		}

		$(".date_change").live('change',function(){
				date_validations();
				midnight_validations();
		});
		/*--------------------------------------------------------------------------------------------------------*/
		/*---------------------------------------------------EBM------------------------------------------------*/
		/*----------------------------------------------------------------------------------------------------------*/
		function ebmconditions(){
			$.ajax({
				type: 'POST',
				url: 'ajax/ebmblockconditions?id=<?php echo $_REQUEST['id']; ?>',
				data: {
 					begin_date_h: $('#begin_date_h').val(),
 					begin_date_m: $('#begin_date_m').val(),
 					end_date_h: $('#end_date_h').val(),
 					end_date_m: $('#end_date_m').val(),
					date: $('#date').val()
				},

				success:function(data){
					var conditionsdata = jQuery.parseJSON(data);

					if(conditionsdata.unforseen_i == 1){
						$('#unforseen_i').attr('checked', true)
					} else {
						$('#unforseen_i').attr('checked', false)
					}
					if(conditionsdata.unforseen_ii == 1){
						$('#unforseen_ii').attr('checked', true)
					} else {
						$('#unforseen_ii').attr('checked', false)
					}

				},
				error:function(){
					ajax_done = 1;
				}
			});
		}

		$(".ebmconditions").live('change',function(){
				ebmconditions();
				goaconditions();
		});

		$(function() {
			$('#date').datepicker({
				dateFormat: 'dd.mm.yy',
				showOn: "both",
				buttonImage: $('#calImg').attr('src'),
				buttonImageOnly: true,
				changeMonth: true,
				changeYear: true,
				nextText: '',
				prevText: '',
				maxDate: '<?php echo date('d.m.Y'); ?>',
				onSelect: function(){
					load_sgbv_actions($(this).val());
					load_goaii_actions($(this).val());
					load_ebmii_actions($(this).val());
					ebmconditions();
					goaconditions();
					check_sapv();
					midnight_validations();
					changes = true;
					formdate_haschanged(this);
				}
			});
			<?php if(strlen($_REQUEST['cid'])==0): ?>
			load_goaii_actions();
			load_ebmii_actions();
			ebmconditions();
			<?php endif; ?>
		});

		/*-------------------------------------------------------------------------------------------------------*/
		/*---------------------------------------------------GOA------------------------------------------------*/
		/*-------------------------------------------------------------------------------------------------------*/

		$('#charge_i_y1').live('click',function(){
			if($('#charge_i_y1:checked').is(':checked') ){
				$('#charge_i_y1').attr('checked', true);
				$('#charge_i_y2').attr('checked', false);
			} else{
				$('#charge_i_y1').attr('checked', false);
			}
		});

		$('#charge_ii_y1').live('click',function(){
			if($('#charge_ii_y1:checked').is(':checked') ){
				$('#charge_ii_y1').attr('checked', true);
				$('#charge_ii_y2').attr('checked', false);
			} else{
				$('#charge_ii_y1').attr('checked', false);
			}
		});

		$('#charge_i_y2').live('click',function(){
			if($('#charge_i_y2:checked').is(':checked') ){
				$('#charge_i_y2').attr('checked', true);
				$('#charge_i_y1').attr('checked', false);
			} else{
				$('#charge_i_y2').attr('checked', false);
			}
		});

		$('#charge_ii_y2').live('click',function(){
			if($('#charge_ii_y2:checked').is(':checked') ){
				$('#charge_ii_y2').attr('checked', true);
				$('#charge_ii_y1').attr('checked', false);
			} else{
				$('#charge_ii_y2').attr('checked', false);
			}
		});

		function goaconditions(){

			if($('#consultation:checked').is(':checked') ){
				var consulting = 1;
			} else{
				var consulting = 0;
			}
			if($('#recipe_transfer:checked').is(':checked') ){
				var recipe_transfer = 1;
			} else{
				var recipe_transfer = 0;
			}
			if($('#expert_advice:checked').is(':checked') ){
				var expert_advice = 1;
			} else{
				var expert_advice = 0;
			}

			if($('#discussion_of_impact:checked').is(':checked') ){
				var discussion_of_impact = 1;
			} else{
				var discussion_of_impact = 0;
			}
			if($('#consultant_discussion:checked').is(':checked') ){
				var consultant_discussion = 1;
			} else{
				var consultant_discussion = 0;
			}
			if($('#detailed_report:checked').is(':checked') ){
				var detailed_report = 1;
			} else{
				var detailed_report = 0;
			}

			$.ajax({
				type: 'POST',
				url: 'ajax/goablockconditions?id=<?php echo $_REQUEST['id']; ?>',
				data: {
					consulting: consulting,
					recipe_transfer: recipe_transfer,
					expert_advice: expert_advice,

					discussion_of_impact: discussion_of_impact,
					consultant_discussion: consultant_discussion,
					detailed_report: detailed_report,

					begin_date_h: $('#begin_date_h').val(),
 					begin_date_m: $('#begin_date_m').val(),
 					end_date_h: $('#end_date_h').val(),
 					end_date_m: $('#end_date_m').val(),
					date: $('#date').val()
				},

				success:function(data){
					var conditionsdata = jQuery.parseJSON(data);

					if(conditionsdata){

					if(conditionsdata.charge_i_y1 == 1){
						$('#charge_i_y1').attr('checked', true)
						$('#charge_i_y2').attr('checked', false)
					} else {
						$('#charge_i_y1').attr('checked', false)
					}
					if(conditionsdata.charge_i_y2 == 1){
						$('#charge_i_y2').attr('checked', true)
						$('#charge_i_y1').attr('checked', false)
					} else {
						$('#charge_i_y2').attr('checked', false)
					}
					if(conditionsdata.charge_i_y3 == 1){
						$('#charge_i_y3').attr('checked', true)
					} else {
						$('#charge_i_y3').attr('checked', false)
					}

					if(conditionsdata.charge_ii_y1 == 1){
						$('#charge_ii_y1').attr('checked', true)
						$('#charge_ii_y2').attr('checked', false)
					} else {
						$('#charge_ii_y1').attr('checked', false)
					}
					if(conditionsdata.charge_ii_y2 == 1){
						$('#charge_ii_y2').attr('checked', true)
						$('#charge_ii_y1').attr('checked', false)
					} else {
						$('#charge_ii_y2').attr('checked', false)
					}
					if(conditionsdata.charge_ii_y3 == 1){
						$('#charge_ii_y3').attr('checked', true)
					} else {
						$('#charge_ii_y3').attr('checked', false)
					}

					}
				},
				error:function(){
					ajax_done = 1;
				}
			});

		}

		$(".goa_conditions").live('click',function(){
			goaconditions();
	});

		/*--------------------------------------------------------------------------------------------------------------------*/
		/*---------------------------------------------------SGBV-------------------------------------------------------------*/
		/*--------------------------------------------------------------------------------------------------------------------*/

		$('.add_action').live('click',function(){
			 $('#add_action_block').dialog('open');
		 });

		$('#add_action_block').dialog({
		    autoOpen: false,
		    modal: true,
		    width: 350,
		   	height: 200,
		   	title:  "<?php echo $this->translate('custom action add'); ?>",
		   	open: function(){
		   		$('#action_name').val('');
		   	},
		    buttons:{
			"<?php echo $this->translate('save'); ?>": function(){

				$('.asubmitform').attr('disabled',true);
				 $(".ui-button:first").attr("disabled", true)
				 .addClass("ui-state-disabled").next("button").attr("disabled", true)
				 .addClass("ui-state-disabled");


				var error = 0;
				var ajax_done = 0;

					$.ajax({
						type: 'POST',
						url: 'ajax/savecusomaction?id=<?php echo $_REQUEST['id']; ?>',
						data: {
							action_name: $('#action_name').val()
						},

						success:function(data){
							var actionsdata = jQuery.parseJSON(data);
							$('#social_actions_table').append('<tr class="custom_action"><td><input type="checkbox" name="social_action['+actionsdata.action_id+']"  id="social_action['+actionsdata.action_id+']"  value="1" /></td><td><label for="social_action['+actionsdata.action_id+']">'+actionsdata.action_name+'</label></td></tr>')
							$('#add_action_block').dialog('close');

						},
						error:function(){
							ajax_done = 1;
						}
					});

			},
			"<?php echo $this->translate('cancel'); ?>": function(){
				$('#action_name').val('');
				$('#add_action_block').dialog('close');
			}
		    },


			create:function () {
		        $(this).closest(".ui-dialog")
		            .find(".ui-button:first") // the first button
		            .addClass("asubmitform");
		    },
		    close:function () {
		    	$('.asubmitform').attr('disabled',false),
				 $(".ui-button:first").attr("disabled", false)
				 .removeClass("ui-state-disabled").next("button").attr("disabled", false)
				 .removeClass("ui-state-disabled");
		    }
		});

		$('.delete_action').live('click',function(){
		 	var action_id = $(this).attr('rel');
			$('#delete_action_id').val(action_id);


			 $('#delete_action_block').dialog('open');
		 });

		$('#delete_action_block').dialog({
		    autoOpen: false,
		    modal: true,
		    width: 350,
		   	height: 200,
		   	title:  "<?php echo $this->translate('delete action'); ?>",
		   	open: function(){
		   	},
		    buttons:{
			"<?php echo $this->translate('delete'); ?>": function(){

				var error = 0;
				var ajax_done = 0;

					$.ajax({
						type: 'POST',
						url: 'ajax/deletecusomaction?id=<?php echo $_REQUEST['id']; ?>',
						data: {
							delete_action_id: $('#delete_action_id').val()
						},

						success:function(data){
							var actionsdata = jQuery.parseJSON(data);

							$('#social_actions_table tr#action_row_'+actionsdata.delete_action_id).remove();

							$('#delete_action_block').dialog('close');

						},
						error:function(){
							ajax_done = 1;
						}
					});
			},

			"<?php echo $this->translate('cancel'); ?>": function(){
				$('#delete_action_id').val('');
				$('#delete_action_block').dialog('close');
			}
		    }
		});
		
		//remove custom items
		$('.remove_item').live('click', function(){
			$(this).parent().parent().hide('slow').remove();
		});
		
		//2017.04.13
		link_contacty_with_contactn();

		
		
		//ISPC-2487
		$('.coordinator_actions_info').live('click', function(){
			var ca_action_id =  $(this).data('action_id');
			$('#cahb_'+ca_action_id).toggle();
// 			$(this).parent().parent().hide('slow').remove();
			
		});
		
		//ISPC-2508 Carmen 31.01.2020 new design
		//Ancuta added to Clinic ISPC (CISPC)  on 18.03.2020
		//edit patient artificial entries exits from contactform
		 $(".edit_patient_artificial_setting").on('click',function(event){
		 	var patient_id = '<?php echo $_REQUEST['id']; ?>';
			var artset_id = $(this).data("setting_id");
			var action = $(this).data("action");
			
		/* if(action == 'edit')
			{ */ //ISPC-2508 Carmen 26.05.2020 new design 
			$('#edit_artificial_setting').dialog({
				    autoOpen: true,
				    modal: true,
				    width: 620,
				   	height: 300,
				   	title:  "<?php echo $this->translate('edit patient artificial setting'); ?>",
				   	open: function(){
				   		$.ajax({
							type: 'POST',
							url: 'ajax/editartificialsetting',
							data: {
								artset_id: artset_id
							},

							success:function(data){
							
								$('#edit_artificial_setting').html(data);

								$('.time')
				        		.timepicker({
				        			minutes: {
				        				interval: 5
				        			},
				        			showPeriodLabels: false,
				        			rows: 4,
				        			hourText: 'Stunde',
				        			minuteText: 'Minute'
				        		})
				        		.mask("99:99")
				        		;
						   		
						   		$( ".date" ).datepicker({
									dateFormat: 'dd.mm.yy',
									showOn: "both",
									buttonImage: $('#calImg').attr('src'),
									buttonImageOnly: true,
									changeMonth: true,
									changeYear: true,
									nextText: '',
									prevText: '',
									maxDate: '<?php echo date('d.m.Y'); ?>',
								}).mask("99.99.9999");

							},
							error:function(){
								
							}
						});
				   		
				   		
				   	},
				    buttons:{
				    
					"save": 
						
						{
						'class' : "rightButton",
						click: function(){
						
							
							    
							    var data = $('.create_form_artificial_entries_exits tr').map(function() {
							    	var artset = {};
							    	$(this).find(':input').each(function() {
							        	artset[this.name] = $(this).val();
							        });
							        return artset;
							    }).get();
							    
							  	if(artset_id == "")
							    {
							  		if($("#no_entries").length > 0)
							  		{
							  			 $("#artificial_content").find("tr:eq(0)").remove();
							  		}
							    	var parent_form = 'FormBlockArtificialEntriesExits[artificial_content]';
									
									$.get(appbase + 'ajax/createformblockartificialentryexitrow?parent_form='+parent_form, function(result) {
									//var newFieldset =  $(result).insertAfter($('#artificial_content tr:last'));
										var newFieldset =  $('#artificial_content tr:last').before(result);
										if(data[2].option_name != '')
									    {
											var new_row = $(result).attr('id').substring(6);
											
										    $('#option_id_'+new_row).val(data[1].option_id);
										    $('#action_'+new_row).val(action);
										    $('#option_date_'+new_row).val(data[3].option_date + ' ' + data[3].option_time);
										    $('#option_localization_'+new_row).val(data[4].option_localization);
										    $("#fpart_"+new_row).find("td:eq(0) span").text(data[2].option_name);
										    $("#fpart_"+new_row).find("td:eq(1)").text(data[3].option_date);
										    
										    //calculate option age
										    var date_arr = data[3].option_date.split('.');
										    var time_arr = data[3].option_time.split(':');
										    
										    var start = new Date(date_arr[2], date_arr[1]-1, date_arr[0], time_arr[0], time_arr[1], '0', '0');
										    var end = new Date();
										    var days = (end - start) / 1000 / 60 / 60 / 24;
										    //console.log(end);
										    
										    // which you need to offset as below because of daylight savings
										    days = Math.round(days - (end.getTimezoneOffset() - start.getTimezoneOffset()) / (60 * 24));
										    //console.log(days);
										    if(days == 0)
										    {
										    	$("#fpart_"+new_row).find("td:eq(2)").text(translate('today new'));
										    }
										    else if(days < 0)
										    {
										    	$("#fpart_"+data[0].id).find("td:eq(2)").text('');
										    }
										    else
										    {
										    	$("#fpart_"+new_row).find("td:eq(2)").text(days + ' ' + translate('days'));
										    }
										    
									    }
									});
							    }
							  	else
							  	{
								    if(data[2].option_name != '')
								    {
									    $('#option_id_'+data[0].id).val(data[1].option_id);
									    $('#action_'+data[0].id).val(action);
									    $('#option_date_'+data[0].id).val(data[3].option_date + ' ' + data[3].option_time);
									    $('#option_localization_'+data[0].id).val(data[4].option_localization);
									    $("#fpart_"+data[0].id).find("td:eq(0) span").text(data[2].option_name);
									    $("#fpart_"+data[0].id).find("td:eq(1)").text(data[3].option_date);
									    var days_val = parseInt($("#option_availability_"+artset_id).val(), 10);
									    //calculate option age
									    var date_arr = data[3].option_date.split('.');
									    var time_arr = data[3].option_time.split(':');
									    
									    var start = new Date(date_arr[2], date_arr[1]-1, date_arr[0], time_arr[0], time_arr[1], '0', '0');
									    var end = new Date();
									    var days = (end - start) / 1000 / 60 / 60 / 24;
									    //console.log(end);
									    // which you need to offset as below because of daylight savings
									    days = Math.round(days - (end.getTimezoneOffset() - start.getTimezoneOffset()) / (60 * 24));
									    //console.log(days);
									    if(days == 0)
									    {
									    	$("#fpart_"+data[0].id).find("td:eq(2)").text(translate('today new'));
									    }
									    else if(days < 0)
									    {
									    	$("#fpart_"+data[0].id).find("td:eq(2)").text('');
									    }
									    else
									    {
									    	if(days > days_val && days_val != 0)
									    	{
									    		$("#fpart_"+data[0].id).find("td:eq(2)").html('<font style="color:red;">!</font>'+days + ' ' + translate('days'));
									    	}
									    	else
									    	{
									    		$("#fpart_"+data[0].id).find("td:eq(2)").text(days + ' ' + translate('days'));
									    	}
									    }
								    }
								    else
								    {
								    	var days_val = parseInt($("#option_availability_"+artset_id).val(), 10);
								    	var date_arr = data[3].option_date.split('.');
									    var time_arr = data[3].option_time.split(':');
									    
									    var start = new Date(date_arr[2], date_arr[1]-1, date_arr[0], time_arr[0], time_arr[1], '0', '0');
									    var end = new Date();
									    var days = (end - start) / 1000 / 60 / 60 / 24;
									    //console.log(end);
									    
									    // which you need to offset as below because of daylight savings
									    days = Math.round(days - (end.getTimezoneOffset() - start.getTimezoneOffset()) / (60 * 24));
									    
									    //console.log(days);
									    $('#option_date_'+data[0].id).val(data[3].option_date + ' ' + data[3].option_time);
									    $('#action_'+data[0].id).val(action);
									    $('#option_localization_'+data[0].id).val(data[4].option_localization);
									    $("#fpart_"+data[0].id).find("td:eq(1)").text(data[3].option_date);
									    if(days == 0)
									    {
									    	$("#fpart_"+data[0].id).find("td:eq(2)").text(translate('today new'));
									    }
									    else if(days < 0)
									    {
									    	$("#fpart_"+data[0].id).find("td:eq(2)").text('');
									    }
									    else
									    {
									    	if(days > days_val && days_val != 0)
									    	{
									    		$("#fpart_"+data[0].id).find("td:eq(2)").html('<font style="color:red;">!</font>'+days + ' ' + translate('days'));
									    	}
									    	else
									    	{
									    		$("#fpart_"+data[0].id).find("td:eq(2)").text(days + ' ' + translate('days'));
									    	}
									    	
									    }
									    
								    }
							  	}
							    
							    //console.log(JSON.stringify(data));
								
							
							 
						
								$('#edit_artificial_setting').dialog('close');							
							},
							text: "<?php echo $this->translate('save'); ?>"
						},

					"cancel": 
						{
						'class' : "rightButton",
						click: function(){
					
							$('#edit_artificial_setting').dialog('close');
							},
						text: "<?php echo $this->translate('cancel'); ?>",
						}
				    }
				});	
			//} 
		//ISPC-2508 Carmen 26.05.2020 new design
		/* else if(action == 'refresh')
				{
				jConfirm(translate('[Are you sure you want to '+action +' this artificial entry/exit ?]'), translate('confirmdeletetitle'), function(r) {
					if(r) {
						$('#action_'+artset_id).val(action);
						var option_date = new Date($("#option_date_"+artset_id).val()),
				        days = parseInt($("#option_availability_"+artset_id).val(), 10);
						var days_val = parseInt($("#option_availability_"+artset_id).val(), 10);
						var option_date = new Date();
				        if(!isNaN(option_date.getTime())){				            
				            var yyyy = option_date.getFullYear().toString();
				            var mm = (option_date.getMonth()+1).toString(); // getMonth() is zero-based
				            var dd  = option_date.getDate().toString();
				            option_date = (dd[1]?dd:"0"+dd[0]) +  "."  + (mm[1]?mm:"0"+mm[0]) +  "."  + yyyy;
				            
				            $("#fpart_"+artset_id).find("td:eq(1)").text(option_date);
				            
				            //calculate age
				            var date_arr = option_date.split('.');
						    //var time_arr = data[3].option_time.split(':');
						    
						    var start = new Date();
						    var end = new Date();
						    var days = (end - start) / 1000 / 60 / 60 / 24;
						    
						    //console.log(end);
						    
						    // which you need to offset as below because of daylight savings
						    days = Math.round(days - (end.getTimezoneOffset() - start.getTimezoneOffset()) / (60 * 24));
						    $('#option_date_'+artset_id).val(option_date);
						    if(days == 0)
						    {
						    	$("#fpart_"+artset_id).find("td:eq(2)").text(translate('today new'));
						    }
						    else if(days < 0)
						    {
						    	$("#fpart_"+artset_id).find("td:eq(2)").text('');
						    }
						    else
						    {
						    	if(days > days_val && days_val != 0)
						    	{
						    		$("#fpart_"+artset_id).find("td:eq(2)").html('<font style="color:red;">!</font>'+days + ' ' + translate('days'));
						    	}
						    	else
						    	{
						    		$("#fpart_"+artset_id).find("td:eq(2)").text(days + ' ' + translate('days'));
						    	}
						    	
						    }
						   
				        } else {
				            alert("Invalid Date");  
				        }
					 }
				});
				
				} */
		    
			});
		
		//set patient artificial entries exits from contactform
		//ISPC-2508 Carmen 26.05.2020 new design
		/* $(".set_fromform_patient_artificial_setting").on('click',function(event){
		 	var patient_id = '<?php echo $_REQUEST['id']; ?>';
			var artset_id = $(this).data("setting_id");
			var action = $(this).data("action");
			
			jConfirm(translate('[Are you sure you want to '+action +' this artificial entry/exit ?]'), translate('confirmdeletetitle'), function(r) {
			    if(r) {
			    	
			    	$('#action_'+artset_id).val(action);
			    	
					setTimeout(function () {
						$('#fpart_'+artset_id).hide();
					}, 800);								
				}
			});
						
		    
			}); */
		
		//delete new artificial entry exit add from contactform
		$(document).on('click', '.delete_new_entry_exit', function(){
			$(this).closest("tr").remove();
		}); 
	//Ancuta added to Clinic ISPC (CISPC)  on 18.03.2020 (end)
		

		
		
		//ISPC-2515 Carmen 16.04.2020  allow a decimal value (no limitation - just decimal like 888,44)
		$('input', '#vital_signs').on('click', function (){
			if($(this).val() == "0.00")$(this).val("");
			//$(this).parent().parent().addClass("yellow_bg");


		});

		$('input', '#vital_signs').on('keydown', function (e) {
			// Allow: backspace, delete, tab, escape, enter and .
			if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190, 188]) !== -1 ||
				// Allow: home, end, left, right
				(e.keyCode >= 35 && e.keyCode <= 39)) 
			{
				// let it happen, don't do anything
				return;
			}

			
			// Ensure that it is a number and stop the keypress
			if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
				e.preventDefault();
			}
		});
		
		$('input', '#vital_signs').each(function(){
			$(this).val().replace(/\./g, ',');
		});
		//--
		
		//ISPC-2508 Carmen 19.05.2020 new design		
		$('.patient_contactform_actions_modal_button').live('click', function() {
			$('#patient_charts_actions_modal').data('recid', $(this).data('recid')).data('openfrom', 'contactform').dialog('open');
		});
		
		
	}); //$(document).ready END

	
		//TODO-4069 Ancuta 15.06.2021 moved - function
		function midnight_validations(){
			var  begin_date_h = $('#begin_date_h').val();
			var  begin_date_m = $('#begin_date_m').val();
			var  end_date_h = $('#end_date_h').val();
			var  end_date_m = $('#end_date_m').val();
			var  date =  $('#date').val();
			
			//TODO-4069 Ancuta 15.06.2021
			if(companion_time_tracking == 1){
				var sums =[];
	            $('.timelog-mins_row_sum').each(function(){
	                sums.push($(this).val()); 
	            });

	            if (sums.length === 0) {
					return;
	            }
            }
			//-- 
					
			
			
			
			if( begin_date_h  > end_date_h) 
			{
				$('#over_midnight').val('1');
			}
			else
			{
				$('#over_midnight').val('0');
				$('.billable_days_option').hide();
				$('.billable_days_option').html('');
			}	

			$.ajax({
					type: 'POST',
					url: 'ajax/overmidnightcheck?id=<?php echo $_REQUEST['id']; ?>&uid=<?php echo $this->user_id;?>',
					data: {
						visit_type: 'CF',
						begin_h: $('#begin_date_h').val(),
						begin_m: $('#begin_date_m').val(),
						end_h: $('#end_date_h').val(),
						end_m: $('#end_date_m').val(),
						visit_start: $('#date').val(),
						over_midnight: $('#over_midnight').val(),
						edit_id: '<?php if (!empty($_REQUEST['cid'])): echo $_REQUEST['cid']; else: echo '0';	endif; ?>'

					},
				 
					success:function(data){
						var visitdata = jQuery.parseJSON(data);

						$('.billable_days_option').html(''); //reset table tbody
						

						if(visitdata.error != 0)
						{
							jAlert(visitdata.error);
							return false;
						} 
						else if(visitdata.error == 0  && $('#over_midnight').val() == "1")
						{
							$('.billable_days_option').show();
							var over_midnight_label = '<span><?php echo $contact_form_lang['please select the billable date']; ?></span>'
									var div_start = "<div>";
							var start = '<label><input type="radio" name="billable_date"  '+visitdata.start_checked+'  value="start">'+visitdata.start_date_dmy+'</label>'
							var end = '<label><input type="radio"  name="billable_date" '+visitdata.end_checked+' value="end">'+visitdata.end_date_dmy+'</label>'
									var div_end = "</div>";
// 							var start = '<label><input type="radio" name="billable_date"  '+visitdata.start_checked+'  value="'+visitdata.start_date+'">'+visitdata.start_date_dmy+'</label>'
// 							var end = '<label><input type="radio"  name="billable_date" '+visitdata.end_checked+' value="'+visitdata.end_date+'">'+visitdata.end_date_dmy+'</label>'
							$('.billable_days_option').html(over_midnight_label+div_start+start+end+div_end);
						} 
						else
						{
							$('.billable_days_option').hide();
						}									
					},
					error:function(){
						ajax_done = 1;
						// failed request; give feedback to user
					}
				});
		}
	
	//--
	
	//2017.04.13 - linkem without radio
	function link_contacty_with_contactn() {
		$(".link_contacty_with_contactn").change(function() {
		    var checked = $(this).is(':checked');
		    $(".link_contacty_with_contactn" , $(this).parent()).prop('checked',false);
		    if(checked) {
		        $(this).prop('checked',true);
		    }
		});
	}
	
	
	function check_sapv(){
		$.ajax({
			type: 'POST',
			url: appbase+'ajax/checksapv?id=<?php echo $_REQUEST['id']; ?>',
			data: {
				date: $('#date').val()
			},
			success:function(data){
				var returned_data = jQuery.parseJSON(data);
				$('#has_sapv').val(returned_data.result);

				if(returned_data.result == '0'){
					$.each(jQuery.parseJSON(sapv_box_ids), function(index, value) {
						$('#'+index).hide();

					});
				} else {
					$('.contactform_dragvbox').show();
				}
			},
			error:function(){
				var ajax_done = 1;
			}
		});
	}

	function load_sgbv_actions(date)
	{
		var table = '';

		if($('#grow16').is(':visible')) {
			$('#sgbv').block({
				css: {
					border: 'none',
					padding: '5px',
					backgroundColor: '#000',
					'-webkit-border-radius': '5px',
					'-moz-border-radius': '5px',
					opacity: .5,
					color: '#fff',
					height: 'auto'
				},
				message: '<h1 style="padding:5px;">Verarbeitung</h1><img src="<?php echo RES_FILE_PATH.'/images/ajax-loader-bar.gif'; ?>">'
			});
		}



		$.ajax({
			type: 'POST',
			url: 'ajax/loadsgbvactions',
			data: {
				id: '<?php echo $_REQUEST['id']; ?>',
				formid: '<?php echo $_REQUEST['cid']; ?>',
				type: 'cf',
				date: date
			},
			success:function(data){
				$('#social_actions_table').replaceWith(data);
				$('#sgbv').unblock();

			},
			error:function(){
				var ajax_done = 1;
			}
		});
	}
	
	
	function load_goaii_actions(date)
	{
		var table = '';

		if($('#grow15').is(':visible')) {
			$('#goaii').block({
				css: {
					border: 'none',
					padding: '5px',
					backgroundColor: '#000',
					'-webkit-border-radius': '5px',
					'-moz-border-radius': '5px',
					opacity: .5,
					color: '#fff',
					height: 'auto'
				},
				message: '<h1 style="padding:5px;">Verarbeitung</h1><img src="<?php echo RES_FILE_PATH.'/images/ajax-loader-bar.gif'; ?>">'
			});
		}



		$.ajax({
			type: 'POST',
			url: 'ajax/loadxbdtgoaiiactions',
			data: {
				id: '<?php echo $_REQUEST['id']; ?>',
				formid: '<?php echo $_REQUEST['cid']; ?>',
				type: 'cf',
				date: date
			},
			success:function(data){
				$('#goaii_actions').replaceWith(data);
				$('#goaii').unblock();

			},
			error:function(){
				var ajax_done = 1;
			}
		});
	}
	
	function load_ebmii_actions(date)
	{
		var table = '';

		if($('#grow13').is(':visible')) {
			$('#ebmii').block({
				css: {
					border: 'none',
					padding: '5px',
					backgroundColor: '#000',
					'-webkit-border-radius': '5px',
					'-moz-border-radius': '5px',
					opacity: .5,
					color: '#fff',
					height: 'auto'
				},
				message: '<h1 style="padding:5px;">Verarbeitung</h1><img src="<?php echo RES_FILE_PATH.'/images/ajax-loader-bar.gif'; ?>">'
			});
		}



		$.ajax({
			type: 'POST',
			url: 'ajax/loadxbdtebmiiactions',
			data: {
				id: '<?php echo $_REQUEST['id']; ?>',
				formid: '<?php echo $_REQUEST['cid']; ?>',
				type: 'cf',
				date: date
			},
			success:function(data){
				$('#ebmii_actions').replaceWith(data);
				$('#ebmii').unblock();

			},
			error:function(){
				var ajax_done = 1;
			}
		});
	}

	
	function createnewitem(set_id,sympt_id)
	{
		var trInnerHtml ='';
		var complex_zapv_select = <?php echo json_encode($this->complex_zapv_select); ?>
		
		trInnerHtml ='<tr>';
		trInnerHtml+='<td><select name="symp['+set_id+'][details_multiple_select]['+sympt_id+'][]" class="sympt_details_select">';
		trInnerHtml+='<option value="0"> <?php echo $this->translate("select details"); ?> </option>';
			$.each(complex_zapv_select[sympt_id], function(select_key, select_value){
				trInnerHtml+='<option value="'+select_key+'">'+select_value+'</option>';
			});
		trInnerHtml+='</select></td>';
		trInnerHtml+='<td><a href="javascript:void(0)" class="remove_item"  ><img src="<?php echo RES_FILE_PATH; ?>/images/action_delete.png" border="0"></a></td>';
		trInnerHtml+='</tr>';
		
		$('#add_new_medi_'+sympt_id).before(trInnerHtml);
 
	}

	
	
	// ---------------- Sapvfb3 ------------------------------


	function saveCheckboxes(chkbx,elname,category)
	{

		if(chkbx.checked)
		{
			var cmt = category+"  :  "+elname;

			$("<input type='hidden' name='comments_l[]' id='comment_"+chkbx.value+"' value='"+cmt+"' />").appendTo("#contact_form");
		}
		else
		{
			$("#comment_"+chkbx.value).remove();
		}

	}

	function updateCheckboxes(chkbx,elname,category,valid)
	{

		if(chkbx.checked)
		{
			var cmt = category+"  :  "+elname;

			$("<input type='hidden' name='upcomments["+valid+"]["+chkbx.value+"]' id='upcomments_"+chkbx.value+"' value='"+cmt+"' />").appendTo("#contact_form");
		}
		else
		{
			var cmt = category+"  :  "+elname;
			$("<input type='hidden' name='upcomments["+valid+"]["+chkbx.value+"]' id='upcomments_"+chkbx.value+"' value='"+cmt+"' />").appendTo("#contact_form");
		}

	}
	
//TODO-4069 Ancuta  04.06.2021 - moved outside concact form id condition empty($_REQUEST['cid']  	
	function addMinutes(time, minsToAdd) {
		function D(J){ return (J<10? '0':'') + J};

		var piece = time.split(':');

		var mins = piece[0]*60 + +piece[1] + +minsToAdd;

		return D(mins%(24*60)/60 | 0) + ':' + D(mins%60);  
	}

	function set_end_time(end_time) {
		if(end_time !== 'undefined') {
			var end_time_split = end_time.split(':');

			$('#end_date_h').val(end_time_split[0]);
			$('#end_date_m').val(end_time_split[1]);
		}
		//TODO-4069 Ancuta 15.06.2021
		<?php if($this->companion_time_tracking == 1 ):?>
		midnight_validations();
		<? endif; ?>
	}
// -- 	

	
	<?php if(empty($_REQUEST['cid'])  || $this->companion_time_tracking == 1 ): 
	//TODO-4069 Ancuta 15.06.2021
	?>
		
		/*
		//TODO-4069 Ancuta  04.06.2021 - moved outside concact form id condition empty($_REQUEST['cid']  	
		function addMinutes(time, minsToAdd) {
			function D(J){ return (J<10? '0':'') + J};

			var piece = time.split(':');

			var mins = piece[0]*60 + +piece[1] + +minsToAdd;

			return D(mins%(24*60)/60 | 0) + ':' + D(mins%60);  
		}

		function set_end_time(end_time) {
			if(end_time !== 'undefined') {
				var end_time_split = end_time.split(':');

				$('#end_date_h').val(end_time_split[0]);
				$('#end_date_m').val(end_time_split[1]);
			}
		}
		*/

		$(document).on('change', '#begin_date_h, #begin_date_m', function(){
			var current_time = $('#begin_date_h').val()+":"+$('#begin_date_m').val()+":00";
			
			//TODO-4069 Ancuta 23.04.2021

			if(companion_time_tracking == 1){//TODO-4069 Ancuta 14.05.2021
				get_highest_sum();
			}  else {
				set_end_time(addMinutes(current_time, contactform_default_visit_length));
			}
			//--
			
			$('#time_division_remain').val(calculate_time_diff());
			$('#mambo_time_division_remain').val(calculate_time_diff());
		});
	<?php endif; ?>
	

	var chks;
	var formid;
	function updatePatientInformation(modname,fldname,formid,chk,patid,drp)
	{
		if(chk.checked == true && drp != "kontactnumber" && fldname != 'living_will'){
			chks = 1;
		} else {
			chks = 0;
		}
		
		if(fldname=="living_will"){
			togglediv(drp,chk.value);
			ajaxcall(modname,fldname,chk.value,patid,formid);
			$("#living_will_from").val('');
			$("#living_will_deposited").val('');
		}

		if(drp=='drop' || drp=='rad' || drp == 'fam' || drp == 'vig' || drp == 'sta' || drp == "kontactnumber")
		{
			chks = chk.value;

			if(drp == "kontactnumber" && chk.checked == false){
				chks = "";
			}
		}

		if(drp == "ern"){
			var values = new Array();
			$.each($("input[name='ernahrung[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		
		if(drp == "kun"){
			var values = new Array();
			$.each($("input[name='kunstliche[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		
		if(drp == "ori"){
			var values = new Array();
			$.each($("input[name='orientierung[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		
		if(drp == "aus"){
			var values = new Array();
			$.each($("input[name='ausscheidung[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		if(drp == "hil"){
			var values = new Array();
			$.each($("input[name='hilfsmittel[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		if(drp == "wun"){
			var values = new Array();
			$.each($("input[name='wunsch[]']:checked"), function() {
				values.push($(this).val());
				chks = values;
			});
		}

		if(fldname=="peg" || fldname=="port" || fldname=="bed" || fldname=="walker" || fldname=="wheelchair" || fldname=="goable" || fldname=="nachtstuhl" || fldname=="wechseldruckmatraze")
		{
			var len = $("#"+fldname+'more').val().length;
			if(chks==0 && len >0)
			{
				jConfirm('<?php echo $this->translate('wantstouncheck'); ?>', '', function(r) {
					if(r)
					{
						togglediv(drp,chks);
						ajaxcall(modname,fldname,chks,patid,formid);
						$("#"+fldname+'more').val('');
					}
					else
					{
						chk.checked = true;
					}

				});
				return false;
			}
			else
			{
				togglediv(drp,chks);
				ajaxcall(modname,fldname,chks,patid,formid);
			}
		}
		else
		{
		    if(fldname != 'living_will'){
			ajaxcall(modname,fldname,chks,patid,formid);
		    }
		}
	}

	
	function ajaxcall(modname,fldname,chks,patid,formid){
		if(isdischarged==1){
			jConfirm('<?php echo $this->translate('dischargealert'); ?>', '', function(r) {
				if(r){


					if (fldname =='ishospiz'){
						if($("#ishospiz").is(":checked")){
							if(hospiz_users_nr > 0){
								$( "#assignhospizusers" ).dialog('open');
							}
						}else if(!$("#ishospiz").is(":checked")){
							if(hospiz_assusers > 0){
								$( "#removehospizusers" ).dialog('open');
							}
						}

					}
					if (fldname =='ishospizverein'){
						if($("#ishospizverein").is(":checked")){
							if(hospizverein_users_nr > 0){
								$( "#assignhospizvereinusers" ).dialog('open');
							}
						}else if(!$("#ishospizverein").is(":checked")){
							if(hospizverein_assusers > 0){
								$( "#removehospizvereinusers" ).dialog('open');
							}
						}
					}
					ajaxCallserver({url:appbase+'patient/updatepatientinfo?modname='+modname+'&fldname='+fldname+'&chkval='+encodeURIComponent(chks)+'&patid='+patid+'&formid='+formid});
				}
			});

			return false;
		} else {

			if (fldname =='ishospiz'){
				if($("#ishospiz").is(":checked")){
					if(hospiz_users_nr > 0){
						$( "#assignhospizusers" ).dialog('open');
					}
				}else if(!$("#ishospiz").is(":checked")){
					if(hospiz_assusers > 0){
						$( "#removehospizusers" ).dialog('open');
					}
				}

			}
			if (fldname =='ishospizverein'){
				if($("#ishospizverein").is(":checked")){
					if(hospizverein_users_nr > 0){
						$( "#assignhospizvereinusers" ).dialog('open');
					}
				}else if(!$("#ishospizverein").is(":checked")){
					if(hospizverein_assusers > 0){
						$( "#removehospizvereinusers" ).dialog('open');
					}
				}
			}
			ajaxCallserver({url:appbase+'patient/updatepatientinfo?modname='+modname+'&fldname='+fldname+'&chkval='+encodeURIComponent(chks)+'&patid='+patid+'&formid='+formid});
		}
	}


function calculate_time_diff(){
	var  begin_date_h = parseInt($('#begin_date_h').val());
	var  begin_date_m = parseInt($('#begin_date_m').val());
	var  end_date_h = parseInt($('#end_date_h').val());
	var  end_date_m = parseInt($('#end_date_m').val());
	var  minutes = 0;	
	var  hours = 0;	

	if( begin_date_h  > end_date_h) 
	{
		hours = (24 - begin_date_h) + end_date_h;
	}
	else
	{
		hours = end_date_h - begin_date_h
	}	
	minutes = hours*60  - begin_date_m + end_date_m;
	if (minutes<0) minutes=0;
	return parseInt(minutes) || 0;
}
	
	
function signs_haschanged ( _this )
{
	$(_this).data("haschanged", "1");
}

function formdate_haschanged ( _this )
{
	var haschanged = false;
	
	if ( ! $(".signs_haschanged").length ) {
		return false;
	}
	
	$(".signs_haschanged").each(function(){
		if($(_this).data("haschanged") == "1") {
			haschanged = true;
			return false;
		}
	});
	
	if ( ! haschanged ) {
		
		switch($(_this).attr("id")) {
		
			case "begin_date_h":
				$("#signs_date_h").val( $(_this).val() );
			break;
			
			case "begin_date_m":
				$("#signs_date_m").val( $(_this).val() );
			break;
			
			case "date":
				$("#kvno_signs_date").val( $(_this).val() );
			break;
		}
	}
	//ISPC-2508 Carmen 27.01.2020
	//Ancuta added to Clinic ISPC (CISPC)  on 18.03.2020
	$('.contactformdate').each(function() {
		$(this).text( $(_this).val());
	});
}

//ISPC-2508 Carmen 27.01.2020
function clientSettings(opt_id, client_options)
{
	var cl_set;
	$.each(client_options, function(key, option){
		cl_set = {};
		if(option.id == opt_id)
		{
			cl_set['localization_available'] = option.localization_available;
			cl_set['name'] = option.name;
			cl_set['days_availability'] = option.days_availability;
			return false;
		}
	});
	return cl_set;
}
//ISPC-2508 Carmen 27.01.2020

//ISPC-2515 Lore+Carmen 10.04.2020
//ISPC-2661 Ancuta 16.09.2020
function check_values(textfiels,textvalue) {
	//alert(textvalue.value);
	if(textfiels == 'puls'){
		if(Number(textvalue.value)>220 || Number(textvalue.value)<0){
			alert('Puls (pulse) <?php echo $this->translate('must be between'); ?> 0-220 Schläge/min!');
			//$(textvalue).val("");
			if($(textvalue).css("color") !== 'rgb(255, 0, 0)')
			{
				$(textvalue).css("color", 'red');
				$("#vs_error").val(parseInt($("#vs_error").val())+1);
			}
		}
		else
		{
			if($(textvalue).css("color") === 'rgb(255, 0, 0)')
			{
				$(textvalue).css("color", '#000');
				$("#vs_error").val(parseInt($("#vs_error").val())-1);
			}
		}
	}
	if(textfiels == 'temperature'){
		if((Number(textvalue.value)>43 || Number(textvalue.value)<34) &&  Number(textvalue.value) > 0){
			alert('Temperatur <?php echo $this->translate('must be between'); ?>  34-43 °C !');
			//$(textvalue).val("");
			if($(textvalue).css("color") !== 'rgb(255, 0, 0)')
			{
				$(textvalue).css("color", 'red');
				$("#vs_error").val(parseInt($("#vs_error").val())+1);
			}
		}
		else
		{
			if($(textvalue).css("color") === 'rgb(255, 0, 0)')
			{
				$(textvalue).css("color", '#000');
				$("#vs_error").val(parseInt($("#vs_error").val())-1);
			}
		}
	}
	if(textfiels == 'blood_pressure'){
		if(Number(textvalue.value)>300 || Number(textvalue.value)<0){
			alert('Blutdruck <?php echo $this->translate('must be between'); ?>  0-300 mmHg !');
			//$(textvalue).val("");
			if($(textvalue).css("color") !== 'rgb(255, 0, 0)')
			{
				$(textvalue).css("color", 'red');
				$("#vs_error").val(parseInt($("#vs_error").val())+1);
			}
		}
		else
		{
			if($(textvalue).css("color") === 'rgb(255, 0, 0)')
			{
				$(textvalue).css("color", '#000');
				$("#vs_error").val(parseInt($("#vs_error").val())-1);
			}
		}
	}
	if(textfiels == 'respiratory_frequency'){
		if(Number(textvalue.value)>150 || Number(textvalue.value)<0 ){
			alert('Atemfrequenz <?php echo $this->translate('must be between'); ?>  0-150 Atemzüge/min!');
			//$(textvalue).val("");
			if($(textvalue).css("color") !== 'rgb(255, 0, 0)')
			{
				$(textvalue).css("color", 'red');
				$("#vs_error").val(parseInt($("#vs_error").val())+1);
			}
		}
		else
		{
			if($(textvalue).css("color") === 'rgb(255, 0, 0)')
			{
				$(textvalue).css("color", '#000');
				$("#vs_error").val(parseInt($("#vs_error").val())-1);
			}
		}
	}
	if(textfiels == 'blood_sugar'){
		if(Number(textvalue.value)>800 || Number(textvalue.value)<0){			//ISPC-2780 Lore 04.01.2021
			alert('Blutzucker <?php echo $this->translate('must be between'); ?>  0-800 mg/dl !');
			//$(textvalue).val("");
			if($(textvalue).css("color") !== 'rgb(255, 0, 0)')
			{
				$(textvalue).css("color", 'red');
				$("#vs_error").val(parseInt($("#vs_error").val())+1);
			}
		}
		else
		{
			if($(textvalue).css("color") === 'rgb(255, 0, 0)')
			{
				$(textvalue).css("color", '#000');
				$("#vs_error").val(parseInt($("#vs_error").val())-1);
			}
		}
	}
	if(textfiels == 'oxygen_saturation'){
		if(Number(textvalue.value)>100 || Number(textvalue.value)<0 ){
			alert('Sauerstoffsättigung (O2) <?php echo $this->translate('must be between'); ?>  0-100 % !');
			//$(textvalue).val("");
			if($(textvalue).css("color") !== 'rgb(255, 0, 0)')
			{
				$(textvalue).css("color", 'red');
				$("#vs_error").val(parseInt($("#vs_error").val())+1);
			}
		}
		else
		{
			if($(textvalue).css("color") === 'rgb(255, 0, 0)')
			{
				$(textvalue).css("color", '#000');
				$("#vs_error").val(parseInt($("#vs_error").val())-1);
			}
		}
	}  
}

</script>
 <style>
 .medication_block{
 	float: none!important;
    width: 100% !important;
 }
 
 .medication_edit_table{
 	width: 100%!important;
 }
 /*//ISPC-2926,Elena,17.05.2021*/
 .selectize-dropdown, .selectize-input, .selectize-input input {
	 color: #303030;
	 font-family: inherit;
	 font-size: 12px;
	 line-height: 18px;
	 font-smoothing: inherit;
 }

 </style>
<form action="" name="contact_form" method="post" id="contact_form">

<?= $this->formHidden('cfhiddennounce', md5(mt_rand(1,1000000). 'cf_salt' .  mt_rand(1,1000000)) , array('id'=> 'cfhiddennounce'));?>
<?= $this->formHidden('cfhiddencid', (int)$_REQUEST['cid'] , array('id'=> 'cfhiddencid'));?>

<input type="hidden" name="has_sapv" id="has_sapv" value="0" />
  <div style="display: none"> <img id="calImg" src="<?php echo RES_FILE_PATH;  ?>/images/calendar.png" alt="Popup" class="trigger"> </div>
  <div id="Einzel" class="tab_container"> <br />
<div class="kvno_header"><span><?php echo $this->translate('contact_form_name');  ?> - <?php echo $this->formtype_name;  ?></span></div>
<div id="Kvno_MainContenOuter" class="anfrageMainOuter Black_border">

<div class="visit_patient_information">
<table>
	<tr>
		<td><?php echo $this->lastname.', '.$this->firstname;?></td>
		<td style="border-top: 0;"  width="30%" >&nbsp;</td>
		<td><?php echo $this->epid;?></td>
	</tr>
	<tr>
		<td style="border-top: 1px solid #000;"><i>Name, Vorname</i></td>
		<td style="border-top: 0;"  width="30%" >&nbsp;</td>
		<td style="border-top: 1px solid #000;"><i>Patientennummer</i></td>
	</tr>
	<tr>
		<td colspan="3">&nbsp;</td>
	</tr>
	<tr>
		<td><?php echo $this->street.', '.$this->zip.' '.$this->patcity;?></td>
		<td></td>
		<td><?php echo $this->birth;?></td>
	</tr>
	<tr>
		<td style="border-top: 1px solid #000;"><i>Adresse</i></td>
		<td></td>
		<td style="border-top: 1px solid #000;"><i>Geb.-Datum</i></td>
	</tr>
</table>
</div>


 <div class="kvno_doctor_form">



<?php
$contact_form_files = $this->form_files;
$users_data = $this->users_data;
$form_blocks_order = $this->blocks_order;

if(count($form_blocks_order[0]['box_order'])>0)
{
	$box_order = explode(',', $form_blocks_order[0]['box_order']);
}
else
{
	$box_order = Pms_CommonData::contact_form_blocks();
}

$ebm_goa_blocks = $this->ebm_goa_blocks;
$measures_blocks = $this->measures_blocks;
$coordinator_actions_blocks = $this->coordinator_actions_blocks;// ISPC-2487 Ancuta 27.11.2019 
$sgbxi_actions_blocks = $this->sgbxi_actions_blocks;
$ebm_ber_blocks = $this->ebm_ber_blocks;

$ebm_ber_categories = $this->ebm_ber_categories;


?>
	<div class="clearer"></div>
<?php if(count($contact_form_files)>0):  ?>
<!--  ############################################################################## -->
<!--  ################################  FILES  ##################################### -->
<!--  ############################################################################## -->
<br/>&nbsp;
<br/>&nbsp;
<div class="contactform_dragvbox" id="files">
		<h2> +  <?php echo $this->translate('file_history'); ?></h2>
		<div class="contactform_dragvbox_content" style="display: none;">
			<table class="datatable">
				<tr>
					<th>#</th>
					<th><?php echo $this->translate('title'); ?></th>
					<th style="width:55px;"><?php echo $this->translate('filetype'); ?></th>
					<th><?php echo $this->translate('user'); ?></th>
					<th style="width:80px;"><?php echo $this->translate('date'); ?></th>
				</tr>
				<?php $i = 1;
				foreach ($contact_form_files as $k_contact_file => $v_contact_file): ?>
					<tr>
						<td><a href="<?php echo APP_BASE . 'stats/patientfileupload?doc_id='.$v_contact_file['id'].'&id='.$_REQUEST['id'];?>"><?php echo $i; ?></a></td>
						<td><a href="<?php echo APP_BASE . 'stats/patientfileupload?doc_id='.$v_contact_file['id'].'&id='.$_REQUEST['id'];?>"><?php echo $v_contact_file['title']; ?></a></td>
						<td><a href="<?php echo APP_BASE . 'stats/patientfileupload?doc_id='.$v_contact_file['id'].'&id='.$_REQUEST['id'];?>"><?php echo $v_contact_file['file_type']; ?></a></td>
						<td><a href="<?php echo APP_BASE . 'stats/patientfileupload?doc_id='.$v_contact_file['id'].'&id='.$_REQUEST['id'];?>"><?php echo $users_data[$v_contact_file['create_user']]['first_name'].', '.$users_data[$v_contact_file['create_user']]['last_name']; ?></a></td>
						<td><a href="<?php echo APP_BASE . 'stats/patientfileupload?doc_id='.$v_contact_file['id'].'&id='.$_REQUEST['id'];?>"><?php echo date('d.m.Y', strtotime($v_contact_file['create_date'])); ?></a></td>
					</tr>
				<?php $i++; endforeach; ?>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;  ?>

<?php foreach($box_order as $k_box=>$v_box):?>
<?php if($v_box == 'time'): ?>
<!--  ############################################################################## -->
<!--  ######################### Time Block  ####################################### -->
<!--  ############################################################################## -->
<div class="time_block">
	<label>Beginn :</label>
		<select name="begin_date_h" id="begin_date_h" class="ebmconditions date_change" onchange="formdate_haschanged(this)">
			<option value="00">00</option>
			<?php for ($i=1; $i<=23; $i++){?>
				 <option value="<?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?>" <?php if(str_pad($i, 2, "0", STR_PAD_LEFT) == $contact_form_details['begin_date_h'] ){ echo 'selected="selected"';}?>><?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?></option>
			<?php }?>
		</select>


		<select name="begin_date_m" id="begin_date_m"  class="ebmconditions date_change" onchange="formdate_haschanged(this)">
		<option value="00">00</option>
			<?php for ($i=1; $i<=59; $i++){?>
			 	<option value="<?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?>" <?php if(str_pad($i, 2, "0", STR_PAD_LEFT) == $contact_form_details['begin_date_m'] ){ echo 'selected="selected"';}?>><?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?></option>
			<?php }?>
		</select>

<!-- TODO-4069 Ancuta 23.04.2021 -- added span with display none 		 -->
<span <?php if($this->companion_time_tracking == 1):?> style="display: none" <?php endif; ?> >

	<label>Ende:</label>
		<select name="end_date_h"  id="end_date_h"  class="ebmconditions date_change">
			<option value="00">00</option>
			<?php for ($i=1; $i<=23; $i++){?>
				 <option value="<?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?>" <?php if(str_pad($i, 2, "0", STR_PAD_LEFT) == $contact_form_details['end_date_h'] ){ echo 'selected="selected"';}?>><?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?></option>
			<?php }?>
		</select>

		<select name="end_date_m"  id="end_date_m"  class="ebmconditions date_change">
			<option value="00">00</option>
			<?php for ($i=1; $i<=59; $i++){?>
				 <option value="<?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?>" <?php if(str_pad($i, 2, "0", STR_PAD_LEFT) == $contact_form_details['end_date_m'] ){ echo 'selected="selected"';}?>><?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?></option>
			<?php }?>
		</select>
</span>	


	
		<input type="text" name="date" id="date"  style="width:80px; margin: 2px 0 -2px 10px;" value="<?php echo $contact_form_details['date'] ?>"   class="embconditions" onchange="formdate_haschanged(this)"/>
		
<input type="hidden" id="over_midnight" name="over_midnight" value="<?php echo $contact_form_details['over_midnight']?>">
 
<div class="billable_days_option <?php if($contact_form_details['over_midnight'] == "1"): ?>  visible_div<?else:?> hidden_div<?php endif;?>"  >
<span><?php echo $contact_form_lang['please select the billable date']; ?></span>
	<div>	
		<label><input name="billable_date" value="start" type="radio" <?php if( date('d.m.Y',strtotime($contact_form_details['billable_date'])) == date('d.m.Y',strtotime($contact_form_details['start_date']))  ): ?> checked="checked" <?php endif;?>  /> <?php echo date('d.m.Y',strtotime($contact_form_details['start_date']));?> </label>
		<label><input name="billable_date" value="end" type="radio"  <?php if( date('d.m.Y',strtotime($contact_form_details['billable_date'])) == date('d.m.Y',strtotime($contact_form_details['end_date']))): ?> checked="checked" <?php endif;?>  /> <?php echo date('d.m.Y',strtotime($contact_form_details['end_date']));?> </label>
	</div>
</div>
		
	</div>
	<br style="clear: both"/>
<!--  ############################################################################## -->
<?php endif;?>

<?php if(in_array('drivetime',$allowed_blocks) && $v_box == 'drivetime'): ?>
<!--  ############################################################################## -->
<!--  ################ driving time and kilometers   ############################## -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="drivetime">
		<h2> + <?php echo $this->translate('block_drivetime') ?></h2>
		<div class="contactform_dragvbox_content" id="grow1" style="display:<?php if($_REQUEST['openinmodal'] == '1') { if($contact_form_details['fahrtzeit'] != '0' || $contact_form_details['fahrtstreke_km'] != '' || !empty($contact_form_details['expert_accompanied'])) { echo 'block';} else { echo 'none';}} else {if($opened_blocks[$v_box] == '1') { echo 'block';} else { echo 'none'; }}?>;" >
			<label class="kvno_top_labels">Fahrtzeit: </label>
			<select name="fahrtzeit">
				<option value="--">--</option>
				<?php for ($i=1; $i<=$this->driving_time_limit; $i++){?>
					<option value="<?php echo $i; ?>" <?php if($i == $contact_form_details['fahrtzeit']){ echo 'selected="selected"';}?>><?php echo $i; ?></option>
				<?php }?>
			</select>
			<?php echo '<!--'.$contact_form_details['fahrtzeit'].'-->';?>
			<br/><br/>
			<label class="kvno_top_labels">Fahrtstrecke (Km):</label>
            <input type="text" name="fahrtstreke_km" id="fahrtstreke_km" value="<?php echo $contact_form_details['fahrtstreke_km'];?>" />
            <br/><br/>
            
            <?php if ($this->clientModules[182]) : ?>
                <label class="kvno_top_labels" ><?=$this->translate('Accompanied by a Ligetis expert?')?></label>
                <?=$this->formRadio('expert_accompanied', $contact_form_details['expert_accompanied'], [], ['yes' => 'Ja', 'no'=> 'Nein']);?>
            <?php endif;?>
            <br/>
            
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php if(in_array('drivetime_doc',$allowed_blocks) && $v_box == 'drivetime_doc'): ?>
<!--  ############################################################################## -->
<!--  ################ driving time documentation  and kilometers   ############################## -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="drivetime">
		<h2> + <?php echo $this->translate('block_drivetime_doc') ?></h2>
		<div class="contactform_dragvbox_content" id="grow1" style="display:<?php if($_REQUEST['openinmodal'] == '1') { if($this->drivetime_doc['fahrtzeit1'] != '0' || $this->drivetime_doc['fahrtstreke_km1'] != '' || $this->drivetime_doc['fahrt_doc1'] != '0') { echo 'block';} else { echo 'none';}} else {if($opened_blocks[$v_box] == '1') { echo 'block';} else { echo 'none'; }}?>;" >
			<table class="datatable" >
				<tr>
				     <td width="30%">
						<label for="import">Fahrtzeit:</label>
					 </td>
					  <td>
						     <select name="fahrtzeit1">
				              <option value="--">--</option>
				             <?php for ($i=1; $i<=$this->driving_time_limit; $i++){?>
					         <option value="<?php echo $i; ?>" <?php if($i == $this-> drivetime_doc['fahrtzeit1']){ echo 'selected="selected"';}?>><?php echo $i; ?></option>
				             <?php }?>
			                 </select>
					 </td>
				</tr>
				<tr>
				    <td width="30%">
						<label for="export">Fahrtstrecke (Km):</label>
					</td>
					<td>
						<input type="text" name="fahrtstreke_km1"  id="fahrtstreke_km1" value="<?php if(empty($this->drivetime_doc['fahrtstreke_km1'])) {echo ''; } else {echo $this->drivetime_doc['fahrtstreke_km1']; }?>"> 
					</td>
				</tr>
				<tr>
				   <td width="30%">
						<label for="export">Dokumentationszeit:</label>
					</td>
					<td>
						<input type="text" name="fahrt_doc1" id = "fahrt_doc1"  value="<?php if(empty($this->drivetime_doc['fahrt_doc1'])) {echo ''; } else {echo $this->drivetime_doc['fahrt_doc1']; }?>"> 
					</td>
				</tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>




<?php if(in_array('visitplan',$allowed_blocks)  && $v_box == 'visitplan'): ?>
<!--  ############################################################################## -->
<!--  ########################## Besuch war   ###################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="visitplan">
		<h2> + <?php echo $this->translate('block_visitplan') ?></h2>
		<div class="contactform_dragvbox_content" id="grow2"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($contact_form_details['quality'] != '0'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
				<div class="visit_quality">
					<label class="kvno_top_labels">Besuch war:</label>
					<ul>
						<li>
							<input type="radio" id="visit_planned" name="quality" value="1" <?php if($contact_form_details['quality'] == '1'): ?> checked="checked" <?php endif; ?> />
							<label for="visit_planned">geplant</label>
						</li>
						<li>
							<input type="radio" id="visit_unplanned" name="quality" value="2"  <?php if($contact_form_details['quality'] == '2'): ?> checked="checked" <?php endif; ?>  />
							<label for="visit_unplanned">ungeplant</label>
						</li>
						<li>
							<input type="radio" id="visit_acute" name="quality" value="3"  <?php if($contact_form_details['quality'] == '3'): ?> checked="checked" <?php endif; ?>  />
							<label for="visit_acute">akut</label>
						</li>
						<li>
							<input type="radio" id="visit_sapv_emergeny" name="quality" value="4"  <?php if($contact_form_details['quality'] == '4'): ?> checked="checked" <?php endif; ?>  />
							<label for="visit_sapv_emergeny">SAPV-Notdienst</label>
						</li>
					</ul>
				</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>



<?php if(in_array('symp',$allowed_blocks) && $v_box == 'symp'): ?>
<?php $set_id = 1; ?>
 <!--  ############################################################################## -->
 <!--  #############################  Symptomatics   ################################ -->
 <!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="symp">
		<h2> + <?php echo $this->translate('block_symp') ?></h2>
		<div class="contactform_dragvbox_content" id="grow3"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($this->sympt_hasvalues)) {echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1') { echo 'block';} else { echo 'none'; }}?>;" >
			<table  border="0" cellpadding="2" cellspacing="2" class="kvno_symptomatics" width="100%">
				<tr style="border-bottom:1px solid #ccc;  line-height: 30px">
					<th width="35%"><b>Item</b></th>
					<th width="10%" style="text-align: center;"><b>Letzter Wert</b></th>
					<th width="13%" style="text-align: center;"><b>Aktueller Wert</b></th>
					<th width="40%"><b>Kommentar</b></th>
				</tr>

				<?php if($this->sympt_view_select == 'a'): ?>
					<?php
					$none = array(0);
					$weak = array(1,2,3,4);
					$average = array(5,6,7);
					$strong = array(8,9,10);
					$atributes_values = array(0=>'kein',1=>'leicht',2=>'leicht',3=>'leicht',4=>'leicht',5=>'mittel',6=>'mittel',7=>'mittel',8=>'schwer',9=>'schwer',10=>'schwer');
				?>

				 	<?php foreach($this->symptomarr as $value):	?>
						<tr  style=" border-bottom:1px dotted #ccc">
							<td ><?php echo ($value['sym_description'])?></td>
							<td style="text-align: center; "><span><?php echo $atributes_values [$value['input_value']];?></span>
								<input type="hidden" name="symp[<?php echo $set_id;?>][current_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<select name="symp[<?php echo $set_id;?>][input_value][<?php echo $value['symptomid']?>]"   id="input_value<?php echo $value['symptomid']?>"    class="symp_input">
									<option value="0" <?php if( in_array($value['entered_value'],$none)):?> selected="selected" <?php endif; ?>  >kein</option>
									<option value="4" <?php if( in_array($value['entered_value'],$weak)):?> selected="selected" <?php endif; ?> >leicht</option>
									<option value="7" <?php if( in_array($value['entered_value'],$average)):?> selected="selected" <?php endif; ?> >mittel</option>
									<option value="10" <?php if( in_array($value['entered_value'],$strong)):?> selected="selected" <?php endif; ?> >schwer</option>
									<option value="" <?php if( $value['entered_value'] == NULL ){echo 'selected="selected"'; } else{}     ?>  ></option>
								</select>
								<input type="hidden" name="symp[<?php echo $set_id;?>][setid]" value="1" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][complex]" value="0" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][alias]" value="no" />
								</td>
							<td class="kvno_komentinput"><input type="text" name="symp[<?php echo $set_id;?>][comment][<?php echo $value['symptomid']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>

				 <?php else: ?>

					<?php foreach($this->symptomarr as $value):?>
						<tr  style=" border-bottom:1px dotted #ccc">
							<td ><?php echo ($value['sym_description'])?></td>
							<td style="text-align: center; "><span><?php echo $value['input_value'];?></span>
								<input type="hidden" name="symp[<?php echo $set_id;?>][current_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<input type="text" name="symp[<?php echo $set_id;?>][input_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['entered_value']?>" class="kvnosymp_input" id="input_value<?php echo $value['symptomid']?>" onkeyup="isInteger([<?php echo $value['symptomid']?>])" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][setid]" value="1" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][complex]" value="0" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][alias]" value="no" />
							</td>
							<td class="kvno_komentinput"><input type="text" name="symp[<?php echo $set_id;?>][comment][<?php echo $value['symptomid']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>
				<?php endif;?>
				<tr>
				<td  colspan="4">&nbsp;</td>
				</tr>
				<tr></tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>

<?php if(in_array('service_entry',$allowed_blocks) && $v_box == 'service_entry'): ?>

 <!--  ############################################################################## -->
 <!--  #############################  Service Entry  ################################ -->
 <!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="service_entry">
		<h2> + <?php echo $this->translate('block_service_entry') ?></h2>
		<div class="contactform_dragvbox_content" id="grow3"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($this->servarrclose)) { echo 'block';} else { echo 'none';} } else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table  border="0" cellpadding="2" cellspacing="2" class="kvno_symptomatics" width="100%">
				<tr style="border-bottom:1px solid #ccc;  line-height: 30px">
					<th width="35%"><b>Item</b></th>
					<th width="10%" style="text-align: center;"><b>Letzter Wert</b></th>
					<th width="13%" style="text-align: center;"><b>Aktueller Wert</b></th>
					<th width="40%"><b>Kommentar</b></th>
				</tr>
         <?php 
         ?>
					<?php foreach($this->servarr as $value):?>
						<tr  style=" border-bottom:1px dotted #ccc">
							<td ><?php echo ($value['item_name'])?></td>
							<td style="text-align: center; "><span><?php echo $value['input_value'];?></span>
								<input type="hidden" name="services[curent_value][<?php echo $value['service_id']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<input type="text" name="services[input_value][<?php echo $value['service_id']?>]" value="<?php echo $value['entered_value']?>" class="kvnosymp_input" 
								id="inputvalue<?php echo $value['service_id']?>" onkeyup="isIntegerServices([<?php echo $value['service_id']?>])" />
								
							</td>
							<td class="kvno_komentinput"><input type="text" name="services[comment][<?php echo $value['service_id']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>
				
				<tr>
				<td  colspan="4">&nbsp;</td>
				</tr>
				<tr></tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>

<?php if(in_array('symp_zapv',$allowed_blocks) && $v_box == 'symp_zapv'): ?>
<?php $set_id = 4; ?>
 <!--  ############################################################################## -->
 <!--  #############################  Symptomatics ZAPV  ################################ -->
 <!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="symp_zapv">
		<h2> + <?php echo $this->translate('block_symp_zapv') ?></h2>
		<div class="contactform_dragvbox_content" id="grow3"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($this->symptzapv_hasvalues)) {echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1') { echo 'block';} else { echo 'none'; }}?>;" >
			<table  border="0" cellpadding="2" cellspacing="2" class="kvno_symptomatics" width="100%">
				<tr style="border-bottom:1px solid #ccc;  line-height: 30px">
					<th width="35%"><b>Item</b></th>
					<th width="10%" style="text-align: center;"><b>Letzter Wert</b></th>
					<th width="13%" style="text-align: center;"><b>Aktueller Wert</b></th>
					<th width="40%"><b>Kommentar</b></th>
				</tr>

				<?php if($this->sympt_view_select == 'a'): ?>
					<?php
					$none = array(0);
					$weak = array(1,2,3,4);
					$average = array(5,6,7);
					$strong = array(8,9,10);
					$atributes_values = array(0=>'kein',1=>'leicht',2=>'leicht',3=>'leicht',4=>'leicht',5=>'mittel',6=>'mittel',7=>'mittel',8=>'schwer',9=>'schwer',10=>'schwer');
				?>

				 	<?php foreach($this->symptomarr_zapv as $value):	?>
						<tr  style=" border-bottom:1px dotted #ccc">
							<td ><?php echo ($value['sym_description'])?></td>
							<td style="text-align: center; "><span><?php echo $atributes_values [$value['input_value']];?></span>
								<input type="hidden" name="symp[<?php echo $set_id;?>][current_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<select name="symp[<?php echo $set_id;?>][input_value][<?php echo $value['symptomid']?>]"   id="input_value<?php echo $value['symptomid']?>"    class="symp_input">
									<option value="0" <?php if( in_array($value['entered_value'],$none)):?> selected="selected" <?php endif; ?>  >kein</option>
									<option value="4" <?php if( in_array($value['entered_value'],$weak)):?> selected="selected" <?php endif; ?> >leicht</option>
									<option value="7" <?php if( in_array($value['entered_value'],$average)):?> selected="selected" <?php endif; ?> >mittel</option>
									<option value="10" <?php if( in_array($value['entered_value'],$strong)):?> selected="selected" <?php endif; ?> >schwer</option>
									<option value="" <?php if( $value['entered_value'] == NULL ){echo 'selected="selected"'; } else{}     ?>  ></option>
								</select>
								<input type="hidden" name="symp[<?php echo $set_id;?>][setid]" value="4" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][complex]" value="0" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][alias]" value="other_alias" />
							</td>
							<td class="kvno_komentinput"><input type="text" name="symp[<?php echo $set_id;?>][comment][<?php echo $value['symptomid']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>

				 <?php else: ?>

					<?php foreach($this->symptomarr_zapv as $value):?>
						<tr  style=" border-bottom:1px dotted #ccc">
							<td ><?php echo ($value['sym_description'])?></td>
							<td style="text-align: center; "><span><?php echo $value['input_value'];?></span>
								<input type="hidden" name="symp[<?php echo $set_id;?>][current_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<input type="text" name="symp[<?php echo $set_id;?>][input_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['entered_value']?>" class="kvnosymp_input" id="input_value<?php echo $value['symptomid']?>" onkeyup="isInteger([<?php echo $value['symptomid']?>])" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][setid]" value="4" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][complex]" value="0" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][alias]" value="other_alias" />
							</td>
							<td class="kvno_komentinput"><input type="text" name="symp[<?php echo $set_id;?>][comment][<?php echo $value['symptomid']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>
				<?php endif;?>
				<tr>
				<td  colspan="4">&nbsp;</td>
				</tr>
				<tr></tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>

<?php if(in_array('symp_zapv_complex',$allowed_blocks) && $v_box == 'symp_zapv_complex'): ?>
<?php $set_id = 4; ?>
 <!--  ############################################################################## -->
 <!--  #############################  Symptomatics ZAPV Complex  ################################ -->
 <!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="symp_zapv_complex">
		<h2> + <?php echo $this->translate('block_symp_zapv_complex') ?></h2>
		<div class="contactform_dragvbox_content" id="grow3"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($this->symptzapvcomplex_hasvalues)) {echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1') { echo 'block';} else { echo 'none'; }}?>;" >
			<table  border="0" cellpadding="2" cellspacing="2" class="kvno_symptomatics" width="100%">
				<tr style="border-bottom:1px solid #ccc;  line-height: 30px">
					<th width="28%"><b>Item</b></th>
					<th width="25%" style="text-align: center;"><b></b></th>
					<th width="10%" style="text-align: center;"><b>Letzter<br/>Wert</b></th>
					<th width="10%" style="text-align: center;"><b>Aktueller<br/> Wert</b></th>
					<th width="27%"><b>Kommentar</b></th>
				</tr>

				<?php if($this->sympt_view_select == 'a'): ?>
					<?php
					$none = array(0);
					$weak = array(1,2,3,4);
					$average = array(5,6,7);
					$strong = array(8,9,10);
					$atributes_values = array(0=>'kein',1=>'leicht',2=>'leicht',3=>'leicht',4=>'leicht',5=>'mittel',6=>'mittel',7=>'mittel',8=>'schwer',9=>'schwer',10=>'schwer');
				?>

				 	<?php foreach($this->symptomarr_zapv_complex as $value):	?>
						<tr  style=" border-bottom:1px dotted #ccc">
							<td valign="top"><?php echo ($value['sym_description'])?>
							<br/>
							<a href="javascript:createnewitem(<?php echo $set_id;?>,<?php echo $value['symptomid']?>)">
									<img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="20" height="20" />
								</a>
							</td>
							<td>
							<table class="symptom_details">
							<? if(!empty($value['details'])):?>
								<? foreach($value['details'] as $dk=>$d_value) :?>
								<tr>
									<td>
										<select name="symp[<?php echo $set_id;?>][details_multiple_select][<?php echo $value['symptomid']?>][]" class="sympt_details_select">
											<option value="0"> <?php echo $this->translate('select details'); ?> </option>
												<?php foreach($value['zapv_select'] as $det_id => $det_val): ?>
											<option value="<?php echo $det_id; ?>" <?php if($d_value == $det_id):?> selected="selected"  <?php endif;?> >  <?php echo $det_val; ?> </option>
											<?php endforeach; ?>
										</select>
									</td>
									<td>
										<?php if(count($value['details']) > 1 && $dk != 0):?>
										<a class="remove_item"><img src="<?php echo RES_FILE_PATH;  ?>/images/action_delete.png"></a>
										<? endif;?>
									</td>
									</tr>
								<? endforeach; ?>
							<? else:?>
								<tr>
									<td>
									<select name="symp[<?php echo $set_id;?>][details_multiple_select][<?php echo $value['symptomid']?>][]" class="sympt_details_select">
										<option value="0"> <?php echo $this->translate('select details'); ?> </option>
											<?php foreach($value['zapv_select'] as $det_id => $det_val): ?>
										<option value="<?php echo $det_id; ?>" <?php if($value['details'] == $det_id):?> selected="selected"  <?php endif;?> >  <?php echo $det_val; ?> </option>
										<?php endforeach; ?>
									</select>
									</td>
									<td>
									
									</td>
								</tr>
							<? endif; ?>	
								
							<tr id="add_new_medi_<?php echo $value['symptomid']?>">
								<td colspan="2"></td>
							</tr>
							</table>
								<input type="hidden" name="symp[<?php echo $set_id;?>][details_select][<?php echo $value['symptomid']?>]" value="<?php echo $value['details_select']?>" />
							</td>

							<td style="text-align: center; "><span><?php echo $atributes_values [$value['input_value']];?></span>
								<input type="hidden" name="symp[<?php echo $set_id;?>][current_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<select name="symp[<?php echo $set_id;?>][input_value][<?php echo $value['symptomid']?>]"   id="input_value<?php echo $value['symptomid']?>"    class="symp_input">
									<option value="0" <?php if( in_array($value['entered_value'],$none)):?> selected="selected" <?php endif; ?>  >kein</option>
									<option value="4" <?php if( in_array($value['entered_value'],$weak)):?> selected="selected" <?php endif; ?> >leicht</option>
									<option value="7" <?php if( in_array($value['entered_value'],$average)):?> selected="selected" <?php endif; ?> >mittel</option>
									<option value="10" <?php if( in_array($value['entered_value'],$strong)):?> selected="selected" <?php endif; ?> >schwer</option>
									<option value="" <?php if( $value['entered_value'] == NULL ){echo 'selected="selected"'; } else{}     ?>  ></option>
								</select>
								<input type="hidden" name="symp[<?php echo $set_id;?>][setid]" value="4" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][complex]" value="1" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][alias]" value="alias" />
							</td>
							<td class="kvno_komentinput"><input type="text" name="symp[<?php echo $set_id;?>][comment][<?php echo $value['symptomid']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>

				 <?php else: ?>

					<?php foreach($this->symptomarr_zapv_complex as $value):?>
						<tr style=" border-bottom:1px dotted #ccc">
							<td >
								<?php echo ($value['sym_description'])?>
								<br/>
								<a href="javascript:createnewitem(<?php echo $set_id;?>,<?php echo $value['symptomid']?>)">
									<img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="20" height="20" />
								</a>
							</td>
							<td>
							<table class="symptom_details">
							<? if(!empty($value['details'])):?>
								<? foreach($value['details'] as $dk=>$d_value) :?>
								<tr>
									<td>
										<select name="symp[<?php echo $set_id;?>][details_multiple_select][<?php echo $value['symptomid']?>][]" class="sympt_details_select">
											<option value="0"> <?php echo $this->translate('select details'); ?> </option>
												<?php foreach($value['zapv_select'] as $det_id => $det_val): ?>
											<option value="<?php echo $det_id; ?>" <?php if($d_value == $det_id):?> selected="selected"  <?php endif;?> >  <?php echo $det_val; ?> </option>
											<?php endforeach; ?>
										</select>
									</td>
									<td>
										<?php if(count($value['details']) > 1 && $dk != 0):?>
										<a class="remove_item"><img src="<?php echo RES_FILE_PATH;  ?>/images/action_delete.png"></a>
										<? endif;?>
									</td>
									</tr>
								<? endforeach; ?>
							<? else:?>
								<tr>
									<td>
									<select name="symp[<?php echo $set_id;?>][details_multiple_select][<?php echo $value['symptomid']?>][]" class="sympt_details_select">
										<option value="0"> <?php echo $this->translate('select details'); ?> </option>
											<?php foreach($value['zapv_select'] as $det_id => $det_val): ?>
										<option value="<?php echo $det_id; ?>" <?php if($value['details'] == $det_id):?> selected="selected"  <?php endif;?> >  <?php echo $det_val; ?> </option>
										<?php endforeach; ?>
									</select>
									</td>
									<td>
								
									</td>
								</tr>
							<? endif; ?>	
								
							<tr id="add_new_medi_<?php echo $value['symptomid']?>">
								<td colspan="2">
								
								</td>
							</tr>
							</table>
								<input type="hidden" name="symp[<?php echo $set_id;?>][details_select][<?php echo $value['symptomid']?>]" value="<?php echo $value['details_select']?>" />
							</td>
							<td style="text-align: center; "><span><?php echo $value['input_value'];?></span>
								<input type="hidden" name="symp[<?php echo $set_id;?>][current_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<input type="text" name="symp[<?php echo $set_id;?>][input_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['entered_value']?>" class="kvnosymp_input" id="input_value<?php echo $value['symptomid']?>" onkeyup="isInteger([<?php echo $value['symptomid']?>])" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][setid]" value="4" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][complex]" value="1" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][alias]" value="alias" />
							</td>
							<td class="kvno_komentinput"><input type="text" name="symp[<?php echo $set_id;?>][comment][<?php echo $value['symptomid']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>
				<?php endif;?>
				<tr>
				<td  colspan="4">&nbsp;</td>
				</tr>
				<tr></tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>



<?php if(in_array('med',$allowed_blocks) && $v_box == 'med'): ?>
<!--  ############################################################################## -->
<!--  #############################  Medication   ################################ -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="med">
		<h2> + <?php echo $this->translate('block_med')?></h2>
		<div class="contactform_dragvbox_content" id="grow4"  style="display:<?php if($_REQUEST['openinmodal'] == '1') { echo  block; } else {if($opened_blocks[$v_box] == '1'): echo 'block'; else: echo 'none'; endif;}?>;" >
			<div>
				<div class="medication_type_block">
					<div class="medication_container" >
						<?php echo $this->medications; ?>
						<div class="add_new_medi">
							<a href="javascript:createnewmedic()">
								<img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="20" height="20" />
								<div class="add_new_medi_link"><?php echo $this->translate('addnewmedication'); ?></div>
							</a>
						</div>
					</div>
				<div class="clearer"></div>
				</div>

				<div class="medication_type_block">
					<div class="medication_container" >
						<?php echo $this->bedarfsmedications; ?>
						<div class="add_new_medi">
							<a href="javascript:createnewmedicrowbedarf();">
								<img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="20" height="20" />
								<div class="add_new_medi_link"><?php echo $this->translate('addnewmedication'); ?></div>
							</a>
						</div>
					</div>
				<div class="clearer"></div>
				</div>
				 <!--  Maria:: Migration CISPC to ISPC 22.07.2020 -->
				<div class="medication_type_block">
					<div class="medication_container" >
						<?php echo $this->crisismedications; ?>
						<div class="add_new_medi">
							<a href="javascript:createnewmedicrowcrisis();">
								<img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="20" height="20" />
								<div class="add_new_medi_link"><?php echo $this->translate('addnewmedication'); ?></div>
							</a>
						</div>
					</div>
				<div class="clearer"></div>
				</div>

				<div class="medication_type_block">
					<div class="medication_container" >
						<?php echo $this->ivmedications; ?>
						<div class="add_new_medi">
							<a href="javascript:createnewmedicrowiv();">
								<img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="20" height="20" />
								<div class="add_new_medi_link"><?php echo $this->translate('addnewmedication'); ?></div>
							</a>
						</div>
					</div>
				<div class="clearer"></div>
				</div>

				<div class="medication_type_block">
					<div class="medication_container" >
						<p><b>Schmerzpumpe Medikation:</b></p>
						<?php echo $this->schmerze_medicgrid; ?>
					</div>
				<div class="clearer"></div>
				</div>

				<div class="medication_type_block">
					<div class="medication_container">
						<p><b><?php echo $this->translate('discontinuedmedlist'); ?></b></p>
						<input type="hidden" value="<?php echo $this->jsmedadd; ?>" id="jsmedadd" />
						<?php echo $this->delmedications ?>
					</div>
				<div class="clearer"></div>
				</div>
			<br style="clear:both;" />
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>

<?php if(in_array('befund',$allowed_blocks) && $v_box == 'befund'): ?>
<!--  ############################################################################## -->
<!--  ################################# Befund   ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="befund">
		<h2> + <?php echo $this->translate('block_befund') ?></h2>
		<div class="contactform_dragvbox_content" id="grow5"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($this->befund_hasvalues)) {echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table class="kvno_korpelicht_befund" cellpadding="0"  >
			 <tr>
			 <td class="kvno_bigtd">Kopf</td>
			 <td><input type="radio" name="kopf" id="kopfk" value="1" <?php if( $patient_befund_values['kopf'] == '1'): ?> checked="checked" <?php endif;?> /><label>krankheitsentsprechend</label></td>
			 <td class="empty_befun">&nbsp;</td>
			 <td><input type="radio" name="kopf" id="kopfb"  value="2" <?php if( $patient_befund_values['kopf'] == '2'): ?> checked="checked" <?php endif;?>   /><label>Befund</label> </td>
			 <td><div id="kopf_textdiv" style="display: none;">&nbsp;<input type="text" name="kopf_text" id="kopf_text"  value="<?php echo $patient_befund_values['kopf_text'];?>" style="width: 260px!important;"/></div></td>
			 </tr>

			  <tr>
			 <td class="kvno_bigtd">Thorax</td>
			 <td><input type="radio" name="thorax" id="thoraxk" value="1"  <?php if( $patient_befund_values['thorax'] == '1'): ?> checked="checked" <?php endif;?> /><label>krankheitsentsprechend</label></td>
			 <td class="empty_befun">&nbsp;</td>
			 <td ><input type="radio" name="thorax" id="thoraxb"  value="2"  <?php if( $patient_befund_values['thorax'] == '2'): ?> checked="checked" <?php endif;?>   /><label>Befund</label> </td>
			 <td><div id="thorax_textdiv" style="display: none;">&nbsp;<input type="text"   name="thorax_text" id="thorax_text" value="<?php echo  $patient_befund_values['thorax_text'];?>"  style="width: 260px!important;"  /></div></td>
			 </tr>


			  <tr>
			 <td class="kvno_bigtd">Abdomen</td>
			 <td><input type="radio" name="abdomen" id="abdomenk" value="1"  <?php if( $patient_befund_values['abdomen'] == '1'): ?> checked="checked" <?php endif;?> /><label>krankheitsentsprechend</label></td>
			 <td class="empty_befun">&nbsp;</td>
			 <td><input type="radio" name="abdomen" id="abdomenb"  value="2"  <?php if( $patient_befund_values['abdomen'] == '2'): ?> checked="checked" <?php endif;?>   /><label>Befund</label> </td>
			 <td><div id="abdomen_textdiv" style="display: none;">&nbsp;<input type="text"   name="abdomen_text" id="abdomen_text" value="<?php echo  $patient_befund_values['abdomen_text'];?>"   style="width: 260px!important;" /></div></td>
			 </tr>


			 <tr>
			 <td class="kvno_bigtd">Extremitäten</td>
			 <td><input type="radio" name="extremitaten" id="extremitatenk" value="1"  <?php if( $patient_befund_values['extremitaten'] == '1'): ?> checked="checked" <?php endif;?> /><label>krankheitsentsprechend</label></td>
			 <td class="empty_befun">&nbsp;</td>
			 <td><input type="radio" name="extremitaten" id="extremitatenb"  value="2"  <?php if( $patient_befund_values['extremitaten'] == '2'): ?> checked="checked" <?php endif;?>   /><label>Befund</label> </td>
			 <td><div id="extremitaten_textdiv" style="display: none;">&nbsp;<input type="text"   name="extremitaten_text" id="extremitaten_text" value="<?php echo  $patient_befund_values['extremitaten_text'];?>"   style="width: 260px!important;" /></div></td>
			 </tr>


			 <tr>
			 <td class="kvno_bigtd">Haut/Wunden</td>
			 <td><input type="radio" name="haut_wunden" id="haut_wundenk" value="1"  <?php if( $patient_befund_values['haut_wunden'] == '1'): ?> checked="checked" <?php endif;?> /><label>krankheitsentsprechend</label></td>
			 <td class="empty_befun">&nbsp;</td>
			 <td><input type="radio" name="haut_wunden" id="haut_wundenb"  value="2"  <?php if( $patient_befund_values['haut_wunden'] == '2'): ?> checked="checked" <?php endif;?>   /><label>Befund</label> </td>
			 <td><div id="haut_wunden_textdiv" style="display: none;">&nbsp;<input type="text"   name="haut_wunden_text" id="haut_wunden_text" value="<?php echo  $patient_befund_values['haut_wunden_text'];?>"  style="width: 260px!important;" /></div></td>
			 </tr>

			 <tr>
			 <td class="kvno_bigtd">neurologisch / psychiatrisch</td>
			 <td><input type="radio" name="neurologisch_psychiatrisch" id="neurologisch_psychiatrischk" value="1"  <?php if( $patient_befund_values['neurologisch_psychiatrisch'] == '1'): ?> checked="checked" <?php endif;?> /><label>krankheitsentsprechend</label></td>
			 <td class="empty_befun">&nbsp;</td>
			 <td><input type="radio" name="neurologisch_psychiatrisch" id="neurologisch_psychiatrischb"  value="2"  <?php if( $patient_befund_values['neurologisch_psychiatrisch'] == '2'): ?> checked="checked" <?php endif;?>   /><label>Befund</label> </td>
			 <td><div id="neurologisch_psychiatrisch_textdiv" style="display: none;">&nbsp;<input type="text"   name="neurologisch_psychiatrisch_text" id="neurologisch_psychiatrisch_text" value="<?php echo  $patient_befund_values['neurologisch_psychiatrisch_text'];?>"  style="width: 260px!important;"  /></div></td>
			 </tr>
			 </table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>





<?php if(in_array('ecog',$allowed_blocks)  && $v_box == 'ecog'): ?>
<!--  ############################################################################## -->
<!--  ################################# Karnofsky   ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="com">
		<h2> + <?php echo $this->translate('block_ecog') ?></h2>
		<div class="contactform_dragvbox_content" id="grow6"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($contact_form_details['karnofsky'])) {echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			 <table class="kvno_ecog">
			 <tr>
				 <td style="width:80px;">
					  <b>Karnofsky :</b>
				 </td>
				 <td>
					 <select name="karnofsky" id="karnofsky">
						<option value="" <?php if(  $contact_form_details['karnofsky'] == 'NULL' || empty( $contact_form_details['karnofsky'])) {echo  'selected="selected"';}?> ><?php echo $this->translate('please_select');  ?></option>
						<?php foreach($this->karnofsky as $karnofsky_value => $karnofsky_details):?>
							<option value="<?php echo  $karnofsky_details['value']; ?>" <?php if(  $contact_form_details['karnofsky'] == $karnofsky_details['value'] ) {echo  'selected="selected"';}?> ><?php echo $karnofsky_details['label'];?></option>
						<?php endforeach;?>
					</select>
					
				 </td>
				 <td></td>
			 </tr>
			 </table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>



<?php if(in_array('com',$allowed_blocks)  && $v_box == 'com'): ?>
<!--  ############################################################################## -->
<!--  #############################  Kommentar   ################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="com">
		<h2> + <?php echo $this->translate('block_com') ?></h2>
		<div class="contactform_dragvbox_content" id="grow7"  style="display:<?php if($_REQUEST['openinmodal'] == '1') { if($contact_form_details['comment_block'] != ''){ echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1' || ($_REQUEST['openinmodal'] == '1' && !empty($contact_form_details['comment_block']))){ echo 'block';} else { echo 'none'; }}?>;" >
			<div class="sonstiges">
				<div>&nbsp;<b>Sonstiges / Kommentar: (Übertrag in Verlauf)  </b></div><br/>
				<textarea name="comment_block" class="textarea_full"><?php echo $contact_form_details['comment_block'];?></textarea>
			</div>
		</div>
	</div>
 <!--  ############################################################################## -->
<?php endif; ?>
<?php if(in_array('careinstructions',$allowed_blocks) && $v_box == 'careinstructions'): ?>
<!--  ############################################################################## -->
<!--  #############################  Pflege-Anweisung ############################## -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="careinstructions">
		<h2> + <?php echo $this->translate('block_careinstructions') ?></h2>
		<div class="contactform_dragvbox_content" id="grow8"  style="display:<?php if($_REQUEST['openinmodal'] == '1'){if($contact_form_details['care_instructions'] != '') {echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<div class="kvno_sonstiges">
				 <div class=" left">&nbsp;<b>Pflege-Anweisung:</b></div><br/>
     			<textarea name="care_instructions"><?php echo $contact_form_details['care_instructions'];?></textarea>
			</div>
		</div>
	</div>
 <!--  ############################################################################## -->
<?php endif; ?>


<?php if(in_array('internalcomment',$allowed_blocks)  && $v_box == 'internalcomment'): ?>
 <!--  ############################################################################# -->
<!--  ############################################################################## -->
<!--  ###########################  Interner Kommentar  ############################# -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="internalcomment">
		<h2> + <?php echo $this->translate('block_internalcomment') ?></h2>
		<div class="contactform_dragvbox_content" id="grow9"  style="display:<?php if($_REQUEST['openinmodal'] == '1'){if($contact_form_details['internal_comment'] != '') {echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<div class="kvno_sonstiges">
				 <div class=" left">&nbsp;<b>Interner Kommentar:</b></div><br/>
     			<textarea name="internal_comment"><?php echo $contact_form_details['internal_comment'];?></textarea>
			</div>
		</div>
	</div>
 <!--  ############################################################################## -->
<?php endif; ?>




<?php if(in_array('com_ph',$allowed_blocks) && $v_box == 'com_ph'): ?>
<!--  ############################################################################## -->
<!--  #############################  Apotheke   #################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="com_ph">
		<h2> + <?php echo $this->translate('block_com_ph') ?></h2>
		<div class="contactform_dragvbox_content" id="grow10"  style="display:<?php if($_REQUEST['openinmodal'] == '1'){if($contact_form_details['comment_apotheke'] != '') {echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<div class="sonstiges">
				<div class=" left">&nbsp;<b>Kommentar Medikation / Pumpe / Apotheke </b></div><br/>
				<textarea name="comment_apotheke" class="textarea_full"><?php echo $contact_form_details['comment_apotheke'];?></textarea>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>

<?php if(in_array('anam',$allowed_blocks) && $v_box == 'anam'): ?>
<!--  ############################################################################## -->
<!--  #############################  Anamnese   #################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="anam">
		<h2> + <?php echo $this->translate('block_anam') ?></h2>
		<div class="contactform_dragvbox_content" id="grow11"  style="display:<?php if($_REQUEST['openinmodal'] == '1'){if($contact_form_details['case_history'] != '') {echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<div class="sonstiges">
				<div>&nbsp;<b>Anamnese</b></div><br/>
				<textarea name="case_history" class="textarea_full" ><?php echo $contact_form_details['case_history'];?></textarea>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>

<?php if(in_array('ebm',$allowed_blocks) && $v_box == 'ebm'): ?>
<!--  ############################################################################## -->
<!--  #################################  EBM  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="ebm">
		<h2> + <?php echo $this->translate('block_ebm') ?></h2>
		<div class="contactform_dragvbox_content" id="grow12"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($patient_ebm_values)) {echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table class="datatable" >
			<?php foreach($ebm_goa_blocks['ebm'] as $ke=>$value_ebm):?>
			<?php if($value_ebm['available'] == '1'):?>
					<tr>

					<?php if( $patient_ebm_values[$value_ebm['form_item_id']] !== null): ?>
						<td><input type="checkbox" name="egblock[ebm][<?php echo $value_ebm['id'];?>]" <?php if(!empty($value_ebm['form_item_id'])): ?> id="<?php echo $value_ebm['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_ebm_values[$value_ebm['form_item_id']] == '1'):?> checked="checked"<?php endif;?>  /></td>
					<?php else:?>
						<td><input type="checkbox" name="egblock[ebm][<?php echo $value_ebm['id'];?>]" <?php if(!empty($value_ebm['form_item_id'])): ?> id="<?php echo $value_ebm['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_ebmi_values[$value_ebm['id']] == '1'):?> checked="checked"<?php endif;?>  /></td>
					<?php endif;?>
						<td><label><?php echo $value_ebm['option_name'];?></label></td>
					</tr>
			<?php endif; ?>

			<?php endforeach; ?>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php if(in_array('ebmii',$allowed_blocks) && $v_box == 'ebmii'): ?>
<!--  ############################################################################## -->
<!--  #################################  EBM II ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="ebmii">
		<h2> + <?php echo $this->translate('block_ebmii') ?></h2>
		<div class="contactform_dragvbox_content" id="grow13"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($patient_xbdt_ebmii_values)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table class="datatable" id="ebmii_actions" >
			<?php foreach($ebm_goa_blocks['ebmii'] as $keii=>$value_ebmii):?>
			<?php if($value_ebmii['available'] == '1'):?>
					<tr>
						<td>
							<?php if($value_ebmii['source'] == "xbdt"):?>
								<input type="checkbox" name="egblock[ebmii][<?php echo $value_ebmii['id'];?>][value]"   value="1" <?php if($patient_xbdt_ebmii_values[$value_ebmii['id']]['value'] == '1'):?> checked="checked"<?php endif;?>  />
								<input type="hidden"  name="egblock[ebmii][<?php echo $value_ebmii['id'];?>][patient_xbdt_action_id]" value="<?php echo  $patient_xbdt_ebmii_values[$value_ebmii['id']]['patient_xbdt_action_id'] ; ?>" />
							<?php else:?>
								<input type="checkbox" name="egblock[ebmii][<?php echo $value_ebmii['id'];?>][value]" <?php if(!empty($value_ebmii['form_item_id'])): ?> id="<?php echo $value_ebmii['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_ebmii_values[$value_ebmii['id']] == '1'):?> checked="checked"<?php endif;?>  />
							<?php endif;?>
							<input type="hidden"  name="egblock[ebmii][<?php echo $value_ebmii['id'];?>][source]" value="<?php echo $value_ebmii['source']?>" />
						</td>
						
						<td><label><?php echo $value_ebmii['option_name'];?></label></td>
					</tr>
			<?php endif; ?>
			<?php endforeach; ?>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php if(in_array('goa',$allowed_blocks) && $v_box == 'goa'): ?>
<!--  ############################################################################## -->
<!--  #################################  GOA   ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="goa">
		<h2> + <?php echo $this->translate('block_goa') ?></h2>
		<div class="contactform_dragvbox_content" id="grow14"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($patient_goa_values)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table class="datatable" >
			<?php foreach($ebm_goa_blocks['goa'] as $kg=>$value_goa):?>
			<?php if($value_goa['available'] == '1'):?>
					<tr>
						<td>
						<?php if( $patient_goa_values[$value_goa['form_item_id']] !== null): ?>
							<input type="checkbox" name="egblock[goa][<?php echo $value_goa['id'];?>]" <?php if(!empty($value_goa['form_item_id'])): ?> id="<?php echo $value_goa['form_item_id'];?>" <?php endif;?>  <?php if(!empty($value_goa['form_item_class'])): ?> class="<?php echo $value_goa['form_item_class'];?>" <?php endif;?> value="1" <?php if($patient_goa_values[$value_goa['form_item_id']] == '1'):?> checked="checked"<?php endif;?>  />
						<?php else: ?>
							<input type="checkbox" name="egblock[goa][<?php echo $value_goa['id'];?>]" <?php if(!empty($value_goa['form_item_id'])): ?> id="<?php echo $value_goa['form_item_id'];?>" <?php endif;?>  <?php if(!empty($value_goa['form_item_class'])): ?> class="<?php echo $value_goa['form_item_class'];?>" <?php endif;?> value="1" <?php if($patient_goai_values[$value_goa['id']] == '1'):?> checked="checked"<?php endif;?>  />
						<?php endif; ?>
						</td>
						<td><label><?php echo $value_goa['option_name'];?></label></td>
					</tr>
			<?php endif;?>


			<?php endforeach; ?>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php if(in_array('goaii',$allowed_blocks) && $v_box == 'goaii'): ?>
<!--  ############################################################################## -->
<!--  #################################  GOA II  ##################################### -->
<!--  ############################################################################## -->

	<div class="contactform_dragvbox" id="goaii">
		<h2> + <?php echo $this->translate('block_goaii') ?></h2>
		<div class="contactform_dragvbox_content" id="grow15"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($patient_xbdt_goaii_values)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table class="datatable" id="goaii_actions" >
  
			<?php foreach($ebm_goa_blocks['goaii'] as $kgii=>$value_goaii):?>
				<?php if($value_goaii['available'] == '1'):?>
					<tr>
						<td>
						<?php if($value_goaii['source'] == "xbdt"):?>
							<input type="checkbox" name="egblock[goaii][<?php echo $value_goaii['id'];?>][value]"   value="1" <?php if($patient_xbdt_goaii_values[$value_goaii['id']]['value'] == '1'):?> checked="checked"<?php endif;?>  />
							<input type="hidden"  name="egblock[goaii][<?php echo $value_goaii['id'];?>][patient_xbdt_action_id]" value="<?php echo  $patient_xbdt_goaii_values[$value_goaii['id']]['patient_xbdt_action_id'] ; ?>" />
						<?php else:?>
							<input type="checkbox" name="egblock[goaii][<?php echo $value_goaii['id'];?>][value]" <?php if(!empty($value_goaii['form_item_id'])): ?> id="<?php echo $value_goaii['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_goaii_values[$value_goaii['id']] == '1'):?> checked="checked"<?php endif;?>  />
						<?php endif;?>
							<input type="hidden"  name="egblock[goaii][<?php echo $value_goaii['id'];?>][source]" value="<?php echo $value_goaii['source']?>" />
						</td>
						<td><label><?php echo $value_goaii['option_id'];?></label></td>
						<td><label><?php echo $value_goaii['option_name'];?></label></td>
					</tr>
				<?php endif;?>
			<?php endforeach; ?>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>


<?php if(in_array('sgbv',$allowed_blocks) && $v_box == 'sgbv'): ?>
<!--  ############################################################################## -->
<!--  #############################  SGBV / SAPV  ################################## -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="sgbv">
		<h2> +  <?php echo $this->translate('block_sgbv') ?></h2>
		<!--<span class="sgbv_loading_img" id="sgbv_loading_img"><img src="<?php echo RES_FILE_PATH.'/images/ajax-loader.gif'; ?>" width="14" /></span>-->
		<div class="contactform_dragvbox_content" id="grow16"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($this->patient_sgbv)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table border="1" id="social_actions_table" class="datatable" >
				<tr>
					<th colspan="2">&nbsp;</th>
				</tr>
				<?php foreach($this->sgbv_actions as $action=>$action_details):?>
				<tr  id="action_row_<?php echo $action_details['id']?>"  class="<?php if ($action_details['custom'] == '1' && $action_details['extra'] == '0'){echo 'custom_action'; } else { echo 'regular_action'; } ?>"  >
					<td><input type="checkbox" id="social_action[<?php echo $action_details['id']?>]" name="social_action[<?php echo $action_details['id']?>]" value="1" <?php if($this->patient_sgbv[$action_details['id']] == '1'):?> checked="checked" <?php endif; ?> /></td>
					<td><label for="social_action[<?php echo $action_details['id']?>]"><?php echo $action_details['action_name'];?></label></td>
				</tr>
	 			<?php endforeach;?>
			</table>
			<a class="add_action" rel=""  title="" href="javascript:void(0)"><img width="20" height="20" src="<?php echo RES_FILE_PATH;  ?>/images/edit_add.png"><span><?php echo $this->translate('add_custom_action')?></span> </a>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>




<?php if(in_array('classification',$allowed_blocks) && $v_box == 'classification'): ?>
<!--  ############################################################################## -->
<!--  #################################  Classification  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="Classification">
		<h2> + <?php echo $this->translate('block_classification') ?></h2>
		<div class="contactform_dragvbox_content" id="grow17"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($this->classif_hasvalues)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table class="datatable" >
					<tr>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
					</tr>

					<tr>
						<td><input type="checkbox" name="beratung" id="beratung" value="1" <?php if($patient_classification_values['beratung'] == '1'):?> checked="checked"<?php endif;?>  /></td>
						<td><label for="beratung"><?php echo $this->translate('block_option_beratung');  ?></label></td>
					</tr>

					<tr>
						<td><input type="checkbox" name="koordination"  id="koordination" value="1" <?php if($patient_classification_values['koordination'] == '1'):?> checked="checked"<?php endif;?>   /></td>
						<td><label for="koordination"><?php echo $this->translate('block_option_koordination');  ?></label></td>
					</tr>

					<tr>
						<td><input type="checkbox" name="intern"  id="intern" value="1" <?php if($patient_classification_values['intern'] == '1'):?> checked="checked"<?php endif;?>   /></td>
						<td><label for="intern"><?php echo $this->translate('block_option_intern')  ?></label></td>
					</tr>
					<tr>
						<td><input type="checkbox" name="psyhosocial"  id="psyhosocial" value="1" <?php if($patient_classification_values['psyhosocial'] == '1'):?> checked="checked"<?php endif;?>   /></td>
						<td><label for="psyhosocial"><?php echo $this->translate('block_option_psyhosocial')  ?></label></td>
					</tr>
					<tr>
						<td><input type="checkbox" name="grief_endcall"  id="grief_endcall" value="1" <?php if($patient_classification_values['grief_endcall'] == '1'):?> checked="checked"<?php endif;?>   /></td>
						<td><label for="grief_endcall"><?php echo $this->translate('block_option_grief_endcall')  ?></label></td>
					</tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>




<?php if(in_array('bra_sapv',$allowed_blocks) && $v_box == 'bra_sapv'): ?>
<!--  ############################################################################## -->
<!--  #################################bra_sapv  BRA - SAPV Team - Hausarzt Einsatz  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="bra_sapv">
		<h2> + <?php echo $this->translate('block_bra_sapv') ?></h2>
		<div class="contactform_dragvbox_content" id="grow18"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($patient_bra_sapv_values['sapv_team_doctor'] == '1'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table class="datatable" >
					<tr>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
					<tr>
						<td><input type="checkbox" name="sapv_team_doctor" id="PCT05" value="1" <?php if($patient_bra_sapv_values['sapv_team_doctor'] == '1'):?> checked="checked"<?php endif;?>  /></td>
						<td><label for="PCT05">Einsatz SAPV Team mit Hausarzt (PCT05 - HF02)</label></td>
					</tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>



<?php if(in_array('additional_users',$allowed_blocks) && $v_box == 'additional_users'): ?>
<?

?>
<!--  ############################################################################## -->
<!--  ################################# Display all users of client  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="additional_users">
		<h2> + <?php echo $this->translate('block_additional_users') ?></h2>
		<div class="contactform_dragvbox_content" id="grow19"  style="display:<?php if($opened_blocks[$v_box] == '1' || ($_REQUEST['openinmodal'] == '1' && !empty($client_users))){ echo 'block';} else { echo 'none'; }?>;" >
			<table class="datatable" >
					<tr>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
					<?php	foreach ($client_users as $kuser => $vuser):?>
					<?php if($vuser['id'] ==  $form_create_user): ?>
					<tr>
						<th style="border: 0;">
							<input type="checkbox" disabled="disabled" checked="checked"  />
							<input type="hidden"  id="additional_users[<?php echo $vuser['id']?>]" name="additional_users[<?php echo $vuser['id']; ?>][value]" value="1"  />
							<input type="hidden" name="additional_users[<?php echo $vuser['id']; ?>][creator]" value="1" />
						</th>
						<th style="border: 0;"><label for="additional_users[<?php echo $vuser['id']?>]"><?php echo $vuser['user_title'].' '.$vuser['last_name'].', '.$vuser['first_name'];?></label></th>
					</tr>
					<?php else:?>
					<tr>
						<td>
							<input type="checkbox" id="additional_users[<?php echo $vuser['id']?>]" name="additional_users[<?php echo $vuser['id']; ?>][value]" value="1"  <?php if( in_array($vuser['id'],$additional_users)):?> checked="checked" <?php endif; ?> />
							<input type="hidden" name="additional_users[<?php echo $vuser['id']; ?>][creator]" value="0" />
						</td>
						<td><label for="additional_users[<?php echo $vuser['id']?>]"><?php echo $vuser['user_title'].' '.$vuser['last_name'].', '.$vuser['first_name'];?></label></td>
					</tr>

					<?php endif;?>

					<?php endforeach; ?>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>



<?php if(in_array('sgbxi',$allowed_blocks) && $v_box == 'sgbxi'): ?>
<!--  ############################################################################## -->
<!--  #################################  SGBV XI ( Qualitätssicherungsbesuch )  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="sgbxi">
		<h2> + <?php echo $this->translate('block_sgbxi') ?></h2>
		<div class="contactform_dragvbox_content" id="grow20"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($contact_form_details['sgbxi_quality'] == '1'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table class="datatable" >
					<tr>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
					</tr>

					<tr>
						<td><input type="checkbox" name="sgbxi_quality" id="sgbxi_quality" value="1" <?php if($contact_form_details['sgbxi_quality'] == '1'):?> checked="checked"<?php endif;?>  /></td>
						<td><label for="sgbxi_quality"><?php echo $this->translate('block_option_quality');  ?></label></td>
					</tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>




<?php
 if(in_array('measures',$allowed_blocks) && $v_box == 'measures'): ?>
<!--  ############################################################################## -->
<!--  #################################  MEASURES Maßnahmen  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="measures">
		<h2> + <?php echo $this->translate('block_measures') ?></h2>
		<div class="contactform_dragvbox_content" id="grow21"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($this->measures_hasvalues == '1'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table class="datatable" >
			<?php foreach($measures_blocks as $kmeasures=>$value_measures):?>
			<?php if($value_measures['available'] == '1'):?>
					<tr>
						<td><input type="checkbox" name="egblock[measures][<?php echo $value_measures['id'];?>]" <?php if(!empty($value_measures['form_item_id'])): ?> id="<?php echo $value_measures['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_measures_values[$value_measures['id']] == '1'):?> checked="checked"<?php endif;?>  /></td>
						<td><label><?php echo $value_measures['option_name'];?></label></td>
					</tr>
			<?php endif; ?>
			<?php endforeach; ?>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>


<?php
//ISPC-2487 Ancuta 27.11.2019
 if(in_array('coordinator_actions',$allowed_blocks) && $v_box == 'coordinator_actions'): 
 
 $history_patient_coordinator_actions = $this->history_patient_coordinator_actions;

 $caoptions['ca_state'] = array(
'receives_services',
'is_requested',
'redirected',
'informed',
'action_comment',
);
 $caoptions['ca_incoming_info_path'] = array(
'hand_strength_training',
'pain_diary',
'sleep_diary',
'incontinence_protocol',
);
 ?>
 
<!--  ############################################################################## -->
<!--  #################################     ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="coordinator_actions">
		<h2> + <?php echo $this->translate('block_coordinator_actions') ?></h2>
		<div class="contactform_dragvbox_content" id="grow21"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty(patient_coordinator_actions_values)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table class="datatable" >
			<thead>
				<tr>
					<th><?php echo  $this->translate('ca_action'); ?></th>
					<th><?php echo  $this->translate('ca_receives_services'); ?></th>
					<th><?php echo  $this->translate('ca_is_requested'); ?></th>
					<th><?php echo  $this->translate('ca_redirected'); ?></th>
					<th><?php echo  $this->translate('ca_informed'); ?></th>
					<th><?php echo  $this->translate('ca_action_comment'); ?></th>
					<th><?php echo  $this->translate('ca_history'); ?></th>
				</tr>
			</thead>
			<tbody>
			
			
			<?php foreach($coordinator_actions_blocks as $kca=>$value_coordinator_actions):?>
			<?php if($value_coordinator_actions['available'] == '1' && $value_coordinator_actions['form_item_class'] == 'ca_state'):?>
					<tr>
						<td><label><?php echo $value_coordinator_actions['option_name'];?></label></td>
						<td class="catd <?php if($last_patient_coordinator_actions_values[$value_coordinator_actions['id']]['receives_services'] == '1'):?> ca_filled<?php endif;?> "><input type="checkbox" name="egblock[coordinator_actions][<?php echo $value_coordinator_actions['id'];?>][receives_services]"   <?php if(!empty($value_coordinator_actions['form_item_id'])): ?> id="<?php echo $value_coordinator_actions['form_item_id'];?>" <?php endif;?>  value="1" <?php if($patient_coordinator_actions_values[$value_coordinator_actions['id']]['receives_services'] == '1'):?> checked="checked"<?php endif;?>  /></td>
						<td class="catd <?php if($last_patient_coordinator_actions_values[$value_coordinator_actions['id']]['is_requested'] == '1'):?> ca_filled<?php endif;?> "><input type="checkbox" name="egblock[coordinator_actions][<?php echo $value_coordinator_actions['id'];?>][is_requested]" <?php if(!empty($value_coordinator_actions['form_item_id'])): ?> id="<?php echo $value_coordinator_actions['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_coordinator_actions_values[$value_coordinator_actions['id']]['is_requested'] == '1'):?> checked="checked"<?php endif;?>  /></td>
						<td class="catd <?php if($last_patient_coordinator_actions_values[$value_coordinator_actions['id']]['redirected'] == '1'):?> ca_filled<?php endif;?> "><input type="checkbox" name="egblock[coordinator_actions][<?php echo $value_coordinator_actions['id'];?>][redirected]" <?php if(!empty($value_coordinator_actions['form_item_id'])): ?> id="<?php echo $value_coordinator_actions['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_coordinator_actions_values[$value_coordinator_actions['id']]['redirected'] == '1'):?> checked="checked"<?php endif;?>  /></td>
						<td class="catd <?php if($last_patient_coordinator_actions_values[$value_coordinator_actions['id']]['informed'] == '1'):?> ca_filled<?php endif;?> "><input type="checkbox" name="egblock[coordinator_actions][<?php echo $value_coordinator_actions['id'];?>][informed]" <?php if(!empty($value_coordinator_actions['form_item_id'])): ?> id="<?php echo $value_coordinator_actions['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_coordinator_actions_values[$value_coordinator_actions['id']]['informed'] == '1'):?> checked="checked"<?php endif;?>  /></td>
						<td class="catd <?php if(!empty($last_patient_coordinator_actions_values[$value_coordinator_actions['id']]['action_comment'] )):?> ca_filled<?php endif;?> "><textarea name="egblock[coordinator_actions][<?php echo $value_coordinator_actions['id'];?>][action_comment]"  rows="" cols=""><?php echo $patient_coordinator_actions_values[$value_coordinator_actions['id']]['action_comment']?></textarea> </td>
						<td>
						<?php if(!empty($history_patient_coordinator_actions[$value_coordinator_actions['id']])): ?>
							<a href="javascript:void(0);" class="coordinator_actions_info" data-action_id="<?php echo $value_coordinator_actions['id']; ?>"><img src="<?php echo RES_FILE_PATH; ?>/images/info_med.png" alt="" width="20" height="20"></a>
						<?php endif; ?>
						</td>
					</tr>
					<tr>
						<td colspan="7">
							<div class="coordinator_actions_history_block" id="cahb_<?php echo $value_coordinator_actions['id']; ?>">
								<h2><?php echo $value_coordinator_actions['option_name'];?></h2>
								
								<table width="100%">
									<tr>
										<th width="30%"></th>
										<?php foreach($caoptions['ca_state'] as $caop):?>
											<th width="14%"><?php echo  $this->translate('ca_'.$caop); ?></th>
										<?php endforeach;?>
									</tr>
									<?php foreach($history_patient_coordinator_actions[$value_coordinator_actions['id']] as $entry_ident => $cf_data):?>
									<tr>
										<th width="30%"><?php echo $cf_data['date'];?></th>
										<?php foreach($caoptions['ca_state'] as $caop):?>
											<td  width="14%">
												<?php if($caop == 'action_comment'):?>
													<?php echo $cf_data[$caop];?>
												<?php else:?>
													<?php if($cf_data[$caop] == "1"): echo "X"; else: ""; endif; ?>
												<?php endif;?>
											
											</td>
										<?php endforeach;?>
									</tr>
									<?php endforeach;?>
								</table>
								
								
								<table style="display: none;">
									<tr>
										<th width="10%"></th>
										<?php foreach($history_patient_coordinator_actions[$value_coordinator_actions['id']] as $entry_ident => $cf_data):?>
											<th width="1%"><?php echo $cf_data['date'];?></th>
										<?php endforeach;?>
									</tr>
						
												
									<?php foreach($caoptions['ca_state'] as $caop):?>
										<tr>
											<td  width="10%" class="ca_labels_history"><?php echo  $this->translate('ca_'.$caop); ?></td>
											<?php foreach($history_patient_coordinator_actions[$value_coordinator_actions['id']] as $entry_ident => $cf_data):?>
											
												<td width="1%">
												<?php if($caop == 'action_comment'):?>
													<?php echo $cf_data[$caop];?>
												<?php else:?>
													<?php if($cf_data[$caop] == "1"): echo "X"; else: ""; endif; ?>
												<?php endif;?>
												
												</td>
											<?php endforeach;?>
										</tr>
									<?php endforeach;?>
									
								
								</table>
							</div>
						</td>
					</tr>
			<?php endif; ?>
			<?php endforeach; ?>
			
			<?php foreach($coordinator_actions_blocks as $kcac=>$value_coordinator_actions):?>
				<?php if($value_coordinator_actions['available'] == '1' && $value_coordinator_actions['form_item_class'] == 'ca_incoming_info_path'):?>
					<tr>
						<td rowspan="4">
							<label><?php echo $value_coordinator_actions['option_name'];?></label>
						</td>
						<td colspan="5"  class="catd <?php if($last_patient_coordinator_actions_values[$value_coordinator_actions['id']]['hand_strength_training'] == '1'):?> ca_filled<?php endif;?> ">
							<input type="checkbox" name="egblock[coordinator_actions][<?php echo $value_coordinator_actions['id'];?>][hand_strength_training]" <?php if(!empty($value_coordinator_actions['form_item_id'])): ?> id="<?php echo $value_coordinator_actions['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_coordinator_actions_values[$value_coordinator_actions['id']]['hand_strength_training'] == '1'):?> checked="checked"<?php endif;?>  />
							<?php echo  $this->translate('hand_strength_training'); ?>
						</td>
						<td rowspan="4">
							<?php if(!empty($history_patient_coordinator_actions[$value_coordinator_actions['id']])): ?>
								<a href="javascript:void(0);" class="coordinator_actions_info" data-action_id="<?php echo $value_coordinator_actions['id']; ?>"><img src="<?php echo RES_FILE_PATH; ?>/images/info_med.png" alt="" width="20" height="20"></a>
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td colspan="5"  class="catd <?php if($last_patient_coordinator_actions_values[$value_coordinator_actions['id']]['pain_diary'] == '1'):?> ca_filled<?php endif;?> ">
						<input type="checkbox" name="egblock[coordinator_actions][<?php echo $value_coordinator_actions['id'];?>][pain_diary]" <?php if(!empty($value_coordinator_actions['form_item_id'])): ?> id="<?php echo $value_coordinator_actions['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_coordinator_actions_values[$value_coordinator_actions['id']]['pain_diary'] == '1'):?> checked="checked"<?php endif;?>  />
						<?php echo  $this->translate('pain_diary'); ?>
						</td>
					</tr>
					<tr>
						<td colspan="5"  class="catd <?php if($last_patient_coordinator_actions_values[$value_coordinator_actions['id']]['sleep_diary'] == '1'):?> ca_filled<?php endif;?> ">
						<input type="checkbox" name="egblock[coordinator_actions][<?php echo $value_coordinator_actions['id'];?>][sleep_diary]" <?php if(!empty($value_coordinator_actions['form_item_id'])): ?> id="<?php echo $value_coordinator_actions['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_coordinator_actions_values[$value_coordinator_actions['id']]['sleep_diary'] == '1'):?> checked="checked"<?php endif;?>  />
						<?php echo  $this->translate('sleep_diary'); ?>
						</td>
					</tr>
					<tr>
						<td colspan="5" class="catd <?php if($last_patient_coordinator_actions_values[$value_coordinator_actions['id']]['incontinence_protocol'] == '1'):?> ca_filled<?php endif;?> ">
						<input type="checkbox" name="egblock[coordinator_actions][<?php echo $value_coordinator_actions['id'];?>][incontinence_protocol]" <?php if(!empty($value_coordinator_actions['form_item_id'])): ?> id="<?php echo $value_coordinator_actions['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_coordinator_actions_values[$value_coordinator_actions['id']]['incontinence_protocol'] == '1'):?> checked="checked"<?php endif;?>  />
						<?php echo  $this->translate('incontinence_protocol'); ?>
						</td>
					</tr>
					
					<tr>
						<td colspan="7">
							<div class="coordinator_actions_history_block" id="cahb_<?php echo $value_coordinator_actions['id']; ?>">
								<h2><?php echo $value_coordinator_actions['option_name'];?></h2>
								<table width="100%">
									<tr>
										<th width="30%"></th>
										<?php foreach($caoptions['ca_incoming_info_path'] as $caop):?>
											<th width="14%"><?php echo  $this->translate('ca_'.$caop); ?></th>
										<?php endforeach;?>
									</tr>
									<?php foreach($history_patient_coordinator_actions[$value_coordinator_actions['id']] as $entry_ident => $cf_data):?>
									<tr>
										<th width="30%"><?php echo $cf_data['date'];?></th>
										<?php foreach($caoptions['ca_incoming_info_path'] as $caop):?>
											<td  width="14%">
												<?php if($cf_data[$caop] == "1"): echo "X"; else: ""; endif; ?>
											</td>
										<?php endforeach;?>
									</tr>
									<?php endforeach;?>
								</table>
								
								<table style="display: none">
									<tr>
										<th width="10%"></th>
										<?php foreach($history_patient_coordinator_actions[$value_coordinator_actions['id']] as $entry_ident => $cf_data):?>
											<th width="1%"><?php echo $cf_data['date'];?></th>
										<?php endforeach;?>
									</tr>
						
												
									<?php foreach($caoptions['ca_incoming_info_path'] as $cainfo_op):?>
										<tr>
											<td  width="10%" class="ca_labels_history"><?php echo  $this->translate('ca_'.$cainfo_op); ?></td>
											<?php foreach($history_patient_coordinator_actions[$value_coordinator_actions['id']] as $entry_ident => $cf_data):?>
											
												<td width="1%">
													<?php if($cf_data[$cainfo_op] == "1"): echo "X"; else: ""; endif; ?>
												</td>
											<?php endforeach;?>
										</tr>
									<?php endforeach;?>
									
								
								</table>
							</div>
						</td>
					</tr>
					
				<?php endif; ?>
			<?php endforeach; ?>
			</tbody>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>



<?php if(in_array('befund_txt',$allowed_blocks) && $v_box == 'befund_txt'): ?>
<!--  ############################################################################## -->
<!--  ############################# BEFUND text ############################## -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="befund_txt">
		<h2> + <?php echo $this->translate('block_befund_txt') ?></h2>
		<div class="contactform_dragvbox_content" id="grow22"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($contact_form_details['befund_txt'] != ''){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<div class="kvno_sonstiges">
				 <div class=" left">&nbsp;<b>Befund:</b></div><br/>
     			<textarea name="befund_txt"><?php echo $contact_form_details['befund_txt'];?></textarea>
			</div>
		</div>
	</div>
 <!--  ############################################################################## -->
<?php endif; ?>


<?php if(in_array('free_visit',$allowed_blocks) && $v_box == 'free_visit'): ?>
<!--  ############################################################################## -->
<!--  #################################  Nicht berechnen in internen Rechnungen  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="sgbxi">
		<h2> + <?php echo $this->translate('block_free_visit') ?></h2>
		<div class="contactform_dragvbox_content" id="grow23"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($contact_form_details['free_visit'] == '1'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table class="datatable" >
					<tr>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
					</tr>

					<tr>
						<td><input type="checkbox" name="free_visit" id="free_visit" value="1" <?php if($contact_form_details['free_visit'] == '1'):?> checked="checked"<?php endif;?>  /></td>
						<td><label for="free_visit"><?php echo $this->translate('block_option_free_visit');  ?></label></td>
					</tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>




<?php if(in_array('therapy',$allowed_blocks) && $v_box == 'therapy'): ?>
<!--  ############################################################################## -->
<!--  ############################# Therapie text ############################## -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="therapy">
		<h2> + <?php echo $this->translate('block_therapy') ?></h2>
		<div class="contactform_dragvbox_content" id="grow24"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($contact_form_details['therapy_txt'] != ''){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<div class="kvno_sonstiges">
				 <div class=" left">&nbsp;<b>Therapie:</b></div><br/>
     			<textarea name="therapy_txt"><?php echo $contact_form_details['therapy_txt'];?></textarea>
			</div>
		</div>
	</div>
 <!--  ############################################################################## -->
<?php endif; ?>





<?php
 if(in_array('sgbxi_actions',$allowed_blocks) && $v_box == 'sgbxi_actions'): ?>
<!--  ############################################################################## -->
<!--  #######################  sgbxi_actions SGB XI Leistungen  #################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="sgbxi_actions">
		<h2> + <?php echo $this->translate('block_sgbxi_actions') ?></h2>
		<div class="contactform_dragvbox_content" id="grow25"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($this->sgbxi_hasvalues == '1'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table class="datatable" >
			<?php foreach($sgbxi_actions_blocks as $ksgbxia=>$v_sgbxi_act):?>
			<?php if($v_sgbxi_act['available'] == '1'):?>
					<tr>
						<td><input type="checkbox" name="egblock[sgbxi_actions][<?php echo $v_sgbxi_act['id'];?>]"  value="1" <?php if($patient_sgbxi_actions_values[$v_sgbxi_act['id']] == '1'):?> checked="checked"<?php endif;?>  /></td>
						<td><label><?php echo $v_sgbxi_act['option_name'];?></label></td>
					</tr>
			<?php endif; ?>
			<?php endforeach; ?>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php
 if(in_array('ebm_ber',$allowed_blocks) && $v_box == 'ebm_ber'): ?>
<!--  ############################################################################## -->
<!--  #######################  ebm_ber EBM BER_Anthrocare. #################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="ebm_ber">
		<h2> + <?php echo $this->translate('block_ebm_ber') ?></h2>
		<div class="contactform_dragvbox_content" id="grow26"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($this->ebm_ber_hasvalues == '1'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<?php foreach($ebm_ber_blocks  as $cat_id=>$cat_values):?>
			<table class="datatable" >
				<tr>
					<th colspan="2" ><?php echo $cat_values['category'];?></th>
				</tr>
				<?php foreach($cat_values['actions'] as $kebmber=>$v_ebm_ber):?>
					<?php if($v_ebm_ber['available'] == '1'):?>
							<tr>
								<td width="5%"><input type="checkbox" name="egblock[ebm_ber][<?php echo $v_ebm_ber['id'];?>]" id="act[ebm_ber][<?php echo $v_ebm_ber['id'];?>]"  value="1" <?php if($patient_ebm_ber_values[$v_ebm_ber['id']] == '1'):?> checked="checked"<?php endif;?>  /></td>
								<td width="95%"><label for="act[ebm_ber][<?php echo $v_ebm_ber['id'];?>]" ><?php echo $v_ebm_ber['option_name'];?></label></td>
							</tr>
					<?php endif; ?>
				<?php endforeach; ?>
			</table>
			<?php endforeach; ?>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php
 if(in_array('vital_signs',$allowed_blocks) && $v_box == 'vital_signs'): ?>
<!--  ############################################################################## -->
<!--  #######################  vital_signs Vitalwerte #################### -->
<!--  ############################################################################## -->

<div class="contactform_dragvbox" id="vital_signs">
	<h2> + <?php echo $this->translate('block_vital_signs') ?></h2>
	<div class="contactform_dragvbox_content" id="grow27"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($this->vital_hasvalues == '1'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
	<table class="datatable" id="tbl_vitalsigns">
	<?php if($this->vitalsign_colmax == 1) { ?>
	<tr>
			<td>
				<table border="0" cellpadding="0" cellspacing="0" width="100%">
					<tr>
						<td>Datum</td>
					</tr>
					
					<tr>														<!-- TODO-3554 Lore 27.10.2020 -->
						<td ><input type="text" name="signs_date[]" id="kvno_signs_date" readonly="readonly" class="datepick signs_haschanged" data-haschanged="<?php if( ! empty($_REQUEST['cid'])) {echo '1';} else {echo '0';} ?>" onchange="signs_haschanged(this)"; value="<?=( ! empty($vital_signs_arr[0]['signs_date']) ? date('d.m.Y', strtotime($vital_signs_arr[0]['signs_date'])) : date('d.m.Y') )?>"/></td>
					</tr>
					<tr><td>&nbsp;</td></tr>
					<tr>
						<td>Zeit</td>
					</tr>
					<tr>
						<td><select name="signs_date_h[]" id="signs_date_h" class="signs_haschanged" data-haschanged="<?php if( ! empty($_REQUEST['cid'])) {echo '1';} else {echo '0';} ?>" onchange="signs_haschanged(this)";>
								<option value="00">00</option>
								<?php for ($i=1; $i<=23; $i++){?>
								<option value="<?php echo str_pad($i, 2 ,"0" ,STR_PAD_LEFT); ?>" <?php if(( ! empty($_REQUEST['cid']) && str_pad($i,2,"0",STR_PAD_LEFT) == date('H',strtotime($vital_signs_arr[0]['signs_date']))) ||  ( empty($_REQUEST['cid']) && str_pad($i,2,"0",STR_PAD_LEFT) == $contact_form_details['begin_date_h'])){echo 'selected="selected"';}?>><?php echo str_pad($i ,2, "0",STR_PAD_LEFT); ?></option>								
								<?php }?>
							</select>
							<label>:</label>
							<select name="signs_date_m[]" id="signs_date_m" class="signs_haschanged" data-haschanged="<?php if( ! empty($_REQUEST['cid'])) {echo '1';} else {echo '0';} ?>" onchange="signs_haschanged(this)";>
								<option value="00">00</option>
								<?php for ($i=1; $i<=59; $i++){?>
								<option value="<?php echo str_pad($i, 2 ,"0" ,STR_PAD_LEFT); ?>" <?php if(( ! empty($_REQUEST['cid']) &&  str_pad($i,2,"0",STR_PAD_LEFT) == date('i',strtotime($vital_signs_arr[0]['signs_date']))) || ( empty($_REQUEST['cid']) && str_pad($i,2,"0",STR_PAD_LEFT) == $contact_form_details['begin_date_m'] )){echo 'selected="selected"';}?>><?php echo str_pad($i ,2, "0",STR_PAD_LEFT); ?></option>
								<?php }?>
							</select>
						</td>
					</tr>
				</table>
			</td>
			<td>
				<table id="tbl_values"  border="0" cellpadding="0" cellspacing="0" width="100%">
					<tr>
						<td>RR</td>
						<td ><input type="text" name="blood_pressure_a[]" size="10" onblur="check_values('blood_pressure',this)" value="<?php if(empty($vital_signs_arr[0]['blood_pressure_a']) || $vital_signs_arr[0]['blood_pressure_a'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[0]['blood_pressure_a'],'2', ',', '.');} ?>" class="rightAlign"/> / <input type="text" name="blood_pressure_b[]" size="10" onblur="check_values('blood_pressure',this)" value="<?php if (empty($vital_signs_arr[0]['blood_pressure_b']) || $vital_signs_arr[0]['blood_pressure_b'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[0]['blood_pressure_b'],'2', ',', '.');} ?>" class="rightAlign"/> mmHg</td>
						
					</tr>
					<tr>
						<td>Puls</td>
						<td><input type="text" name="puls[]" size="10" onblur="check_values('puls',this)" value="<?php if(empty($vital_signs_arr[0]['puls']) || $vital_signs_arr[0]['puls'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[0]['puls'],'2',',','.');} ?>" class="rightAlign"/> /min.</td>
					</tr>
					<tr>
						<td>Atemfrequenz</td>
						<td><input type="text" name="respiratory_frequency[]" size="10" onblur="check_values('respiratory_frequency',this)" value="<?php if(empty($vital_signs_arr[0]['respiratory_frequency']) || $vital_signs_arr[0]['respiratory_frequency'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[0]['respiratory_frequency'],'2',',','.');} ?>" class="rightAlign"/> /min.</td>
					</tr>
					<tr>
						<td>Temperatur</td>
						<td><input type="text" name="temperature[]" size="10" onblur="check_values('temperature',this)" value="<?php if(empty($vital_signs_arr[0]['temperature']) || $vital_signs_arr[0]['temperature'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[0]['temperature'],'2',',','.');} ?>" class="rightAlign"/> °C
						 <select name="temperature_dd[]" >
						 	<option value="1" <?php if(  $vital_signs_arr[0]['temperature_dd'] == '1' ) {echo  'selected="selected"';}?> >im Ohr</option>
						 	<option value="2" <?php if(  $vital_signs_arr[0]['temperature_dd'] == '2' ) {echo  'selected="selected"';}?> >oral</option>
						 	<option value="3" <?php if(  $vital_signs_arr[0]['temperature_dd'] == '3' ) {echo  'selected="selected"';}?> >rektal</option>
							<!-- TODO-3513 Lore 12.10.2020 -->
							<option value="4" <?php if(  $vital_signs_arr[0]['temperature_dd'] == '4' ) {echo  'selected="selected"';}?> >in der Blase</option>
						 	<option value="5" <?php if(  $vital_signs_arr[0]['temperature_dd'] == '5' ) {echo  'selected="selected"';}?> >axillar</option>
						 	<option value="6" <?php if(  $vital_signs_arr[0]['temperature_dd'] == '6' ) {echo  'selected="selected"';}?> >an der Stirn</option>
						 </select>
						 
						 </td>
					</tr>
					<tr>
						<td>Sauerstoffsättigung</td>
						<td><input type="text" name="oxygen_saturation[]" size="10" onblur="check_values('oxygen_saturation',this)" value="<?php if(empty($vital_signs_arr[0]['oxygen_saturation']) || $vital_signs_arr[0]['oxygen_saturation'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[0]['oxygen_saturation'],'2',',','.');} ?>" class="rightAlign"/> %</td>
					</tr>
					<tr>
						<td>BZ</td>
						<td><input type="text" name="blood_sugar[]" size="10" onblur="check_values('blood_sugar',this)" value="<?php if(empty($vital_signs_arr[0]['blood_sugar']) || $vital_signs_arr[0]['blood_sugar'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[0]['blood_sugar'],'2',',','.');} ?>" class="rightAlign"/> mg/dl</td>
					</tr>
					<tr>
						<td>Gewicht</td>
						<td><input type="text" name="weight[]" size="10" value="<?php if(empty($vital_signs_arr[0]['weight']) || $vital_signs_arr[0]['weight'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[0]['weight'],'2',',','.');} ?>" class="rightAlign"/> kg</td>
					</tr>
					<tr>
						<td>Größe </td>
						<td><input type="text" name="height[]" size="10" value="<?php if(empty($vital_signs_arr[0]['height']) || $vital_signs_arr[0]['height'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[0]['height'],'2',',','.');} ?>" class="rightAlign"/> cm</td>
					</tr>					
					<?php if($this->show_head_circumference == "1"):?>
					<tr>
						<td>Kopfumfang</td>
						<td><input type="text" name="head_circumference[]" size="10" value="<?php if(empty($vital_signs_arr[0]['head_circumference']) || $vital_signs_arr[0]['head_circumference'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[0]['head_circumference'],'2',',','.');} ?>" class="rightAlign"/> cm</td>
					</tr>
					<?php endif;?>
					
					<tr>
						<td>Bauchumfang</td>
						<td><input type="text" name="waist_circumference[]" size="10" value="<?php if(empty($vital_signs_arr[0]['waist_circumference']) || $vital_signs_arr[0]['waist_circumference'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[0]['waist_circumference'],'2',',','.');} ?>" class="rightAlign"/> cm</td>
					</tr>
				</table>
			</td>
			
		</tr>	
	<?php } else { ?>
	<tr>
		<td>
			<table>
				<tr>
					<td><label class="lbltd">Date</label></td>
					<?php for($col = 0; $col< $this->vitalsign_colmax; $col++) { ?>
					<td>
						<table border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr>						
								<td>Datum</td>
							</tr>					
							<tr>																           <!-- TODO-3554 Lore 27.10.2020 -->
								<td ><input type="text" name="signs_date[]" id="kvno_signs_date<?php echo $col; ?>" readonly="readonly" class="datepick signs_haschanged" data-haschanged="<?php if( ! empty($_REQUEST['cid'])) {echo '1';} else {echo '0';} ?>" onchange="signs_haschanged(this)"; value="<?=( ! empty($vital_signs_arr[$col]['signs_date']) ? date('d.m.Y', strtotime($vital_signs_arr[$col]['signs_date'])) : date('d.m.Y') )?>"/></td>
							</tr>					
							<tr>
								<td>Zeit</td>
							</tr>
							<tr>
								<td><select name="signs_date_h[]" id="signs_date_h<?php echo $col; ?>" class="signs_haschanged" data-haschanged="<?php if( ! empty($_REQUEST['cid'])) {echo '1';} else {echo '0';} ?>" onchange="signs_haschanged(this)";>
										<option value="00">00</option>
										<?php for ($i=1; $i<=23; $i++){?>
										<option value="<?php echo str_pad($i, 2 ,"0" ,STR_PAD_LEFT); ?>" <?php if(( ! empty($_REQUEST['cid']) && str_pad($i,2,"0",STR_PAD_LEFT) == date('H',strtotime($vital_signs_arr[$col]['signs_date']))) ||  ( empty($_REQUEST['cid']) && str_pad($i,2,"0",STR_PAD_LEFT) == $contact_form_details['begin_date_h'])){echo 'selected="selected"';}?>><?php echo str_pad($i ,2, "0",STR_PAD_LEFT); ?></option>
										<?php }?>
									</select>
									<label>:</label>
									<select name="signs_date_m[]" id="signs_date_m<?php echo $col; ?>" class="signs_haschanged" data-haschanged="<?php if( ! empty($_REQUEST['cid'])) {echo '1';} else {echo '0';} ?>" onchange="signs_haschanged(this)";>
										<option value="00">00</option>
										<?php for ($i=1; $i<=59; $i++){?>
										<option value="<?php echo str_pad($i, 2 ,"0" ,STR_PAD_LEFT); ?>" <?php if(( ! empty($_REQUEST['cid']) &&  str_pad($i,2,"0",STR_PAD_LEFT) == date('i',strtotime($vital_signs_arr[$col]['signs_date']))) || ( empty($_REQUEST['cid']) && str_pad($i,2,"0",STR_PAD_LEFT) == $contact_form_details['begin_date_m'] )){echo 'selected="selected"';}?>><?php echo str_pad($i ,2, "0",STR_PAD_LEFT); ?></option>
										<?php }?>
									</select>
								</td>
							</tr>
						</table>
					</td>
					<?php } ?>
				</tr>
				<tr>
					<td><label  class="lbltd">RR</label></td>
					<?php for($col = 0; $col< $this->vitalsign_colmax; $col++) { ?>
					<td>
						<table id="tbl_values"  border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr>
								<td ><input type="text" name="blood_pressure_a[]" size="10" onblur="check_values('blood_pressure',this)" value="<?php if(empty($vital_signs_arr[$col]['blood_pressure_a']) || $vital_signs_arr[$col]['blood_pressure_a'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[$col]['blood_pressure_a'],'2', ',', '.');} ?>" class="rightAlign"/> / <input type="text" name="blood_pressure_b[]" size="10" onblur="check_values('blood_pressure',this)" value="<?php if (empty($vital_signs_arr[$col]['blood_pressure_b']) || $vital_signs_arr[$col]['blood_pressure_b'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[$col]['blood_pressure_b'],'2', ',', '.');} ?>" class="rightAlign"/> mmHg</td>					
							</tr>
						</table>
					</td>
					<?php } ?>
				</tr>
				<tr>
					<td><label  class="lbltd">Puls</label></td>
					<?php for($col = 0; $col< $this->vitalsign_colmax; $col++) { ?>
					<td>
						<table id="tbl_values"  border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr>
								<td><input type="text" onblur="check_values('puls',this)" name="puls[]" size="10" value="<?php if(empty($vital_signs_arr[$col]['puls']) || $vital_signs_arr[$col]['puls'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[$col]['puls'],'2',',','.');} ?>" class="rightAlign"/> /min.</td>					
							</tr>
						</table>
					</td>
					<?php } ?>
				</tr>
				<tr>
					<td><label  class="lbltd">Atemfrequenz</label></td>
					<?php for($col = 0; $col< $this->vitalsign_colmax; $col++) { ?>
					<td>
						<table id="tbl_values"  border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr>
								<td><input type="text" name="respiratory_frequency[]" size="10" onblur="check_values('respiratory_frequency',this)" value="<?php if(empty($vital_signs_arr[$col]['respiratory_frequency']) || $vital_signs_arr[$col]['respiratory_frequency'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[$col]['respiratory_frequency'],'2',',','.');} ?>" class="rightAlign"/> /min.</td>					
							</tr>
						</table>
					</td>
					<?php } ?>
				</tr>
				<tr>
					<td><label  class="lbltd">Temperatur</label></td>
					<?php for($col = 0; $col< $this->vitalsign_colmax; $col++) { ?>
					<td>
						<table id="tbl_values"  border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr>
								<td><input type="text" name="temperature[]" size="10" onblur="check_values('temperature',this)" value="<?php if(empty($vital_signs_arr[$col]['temperature']) || $vital_signs_arr[$col]['temperature'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[$col]['temperature'],'2',',','.');} ?>" class="rightAlign"/> °C
					
								 <select name="temperature_dd[]" >
									 <option value="1" <?php if(  $vital_signs_arr[$col]['temperature_dd'] == '1' ) {echo  'selected="selected"';}?> >im Ohr</option>
									 <option value="2" <?php if(  $vital_signs_arr[$col]['temperature_dd'] == '2' ) {echo  'selected="selected"';}?> >oral</option>
									 <option value="3" <?php if(  $vital_signs_arr[$col]['temperature_dd'] == '3' ) {echo  'selected="selected"';}?> >rektal</option>
									 <!-- TODO-3513 Lore 12.10.2020 -->
									 <option value="4" <?php if(  $vital_signs_arr[$col]['temperature_dd'] == '4' ) {echo  'selected="selected"';}?> >in der Blase</option>
								 	 <option value="5" <?php if(  $vital_signs_arr[$col]['temperature_dd'] == '5' ) {echo  'selected="selected"';}?> >axillar</option>
								 	 <option value="6" <?php if(  $vital_signs_arr[$col]['temperature_dd'] == '6' ) {echo  'selected="selected"';}?> >an der Stirn</option>
								 </select>					 
					 			</td>
							</tr>
						</table>
					</td>
					<?php } ?>
				</tr>
				<tr>
					<td><label  class="lbltd">Sauerstoffsättigung</label></td>
					<?php for($col = 0; $col< $this->vitalsign_colmax; $col++) { ?>
					<td>
						<table id="tbl_values"  border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr>
								<td><input type="text" name="oxygen_saturation[]" size="10" onblur="check_values('oxygen_saturation',this)" value="<?php if(empty($vital_signs_arr[$col]['oxygen_saturation']) || $vital_signs_arr[$col]['oxygen_saturation'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[$col]['oxygen_saturation'],'2',',','.');} ?>" class="rightAlign"/> %</td>					
							</tr>
						</table>
					</td>
					<?php } ?>
				</tr>
				<tr>
					<td><label  class="lbltd">BZ</label></td>
					<?php for($col = 0; $col< $this->vitalsign_colmax; $col++) { ?>
					<td>
						<table id="tbl_values"  border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr>
								<td><input type="text" name="blood_sugar[]" size="10" onblur="check_values('blood_sugar',this)" value="<?php if(empty($vital_signs_arr[$col]['blood_sugar']) || $vital_signs_arr[$col]['blood_sugar'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[$col]['blood_sugar'],'2',',','.');} ?>" class="rightAlign"/> mg/dl</td>					
							</tr>
						</table>
					</td>
					<?php } ?>
				</tr>
				<tr>
					<td><label  class="lbltd">Gewicht</label></td>
					<?php for($col = 0; $col< $this->vitalsign_colmax; $col++) { ?>
					<td>
						<table id="tbl_values"  border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr>
								<td><input type="text" name="weight[]" size="10" value="<?php if(empty($vital_signs_arr[$col]['weight']) || $vital_signs_arr[$col]['weight'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[$col]['weight'],'2',',','.');} ?>" class="rightAlign"/> kg</td>					
							</tr>
						</table>
					</td>
					<?php } ?>						
				</tr>					
				<tr>
					<td><label  class="lbltd">Größe</label></td>
					<?php for($col = 0; $col< $this->vitalsign_colmax; $col++) { ?>
					<td>
						<table id="tbl_values"  border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr>
								<td><input type="text" name="height[]" size="10" value="<?php if(empty($vital_signs_arr[$col]['height']) || $vital_signs_arr[$col]['height'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[$col]['height'],'2',',','.');} ?>" class="rightAlign"/> cm</td>					
							</tr>
						</table>
					</td>
					<?php } ?>	
				</tr>
				<?php if($this->show_head_circumference == "1"):?>
				<tr>
					<td><label  class="lbltd">Kopfumfang</label></td>
					<?php for($col = 0; $col< $this->vitalsign_colmax; $col++) { ?>
					<td>
						<table id="tbl_values"  border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr>
								<td><input type="text" name="head_circumference[]" size="10" value="<?php if(empty($vital_signs_arr[$col]['head_circumference']) || $vital_signs_arr[$col]['head_circumference'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[$col]['head_circumference'],'2',',','.');} ?>" class="rightAlign"/> cm</td>					
							</tr>
						</table>
					</td>
					<?php } ?>
				</tr>
				<?php endif;?>
				<tr>
					<td><label  class="lbltd">Bauchumfang</label></td>
					<?php for($col = 0; $col< $this->vitalsign_colmax; $col++) { ?>
					<td>
						<table id="tbl_values"  border="0" cellpadding="0" cellspacing="0" width="100%">
							<tr>
								<td><input type="text" name="waist_circumference[]" size="10" value="<?php if(empty($vital_signs_arr[$col]['waist_circumference']) || $vital_signs_arr[$col]['waist_circumference'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr[$col]['waist_circumference'],'2',',','.');} ?>" class="rightAlign"/> cm</td>					
							</tr>
						</table>
					</td>
					<?php } ?>	
				</tr>
			</table>
		</td>
	</tr>
	<?php } ?>	
	</table>
	</div>
	</div>

<!--  ############################################################################## -->
<?php endif; ?>



<?php
 if(in_array('bowel_movement',$allowed_blocks) && $v_box == 'bowel_movement'): ?>
<!--  ############################################################################## -->
<!--  #######################   Stuhlgang or bowel movement   #################### -->
<!--  ############################################################################## -->
<?php
if (isset($patient_bowel_movement_values['bowel_movement_date'])){
	$myTime = date("d.m.Y", strtotime($patient_bowel_movement_values['bowel_movement_date']));
}else{
	$myTime = date("d.m.Y");
}
?>
<style>
	.yellow_bg{
		background-color: #ffffe0;
	}
</style>
<script type="text/javascript">
	$(document).ready(function(){	
		$('#bowel_movement_date').datepicker({
			dateFormat: 'dd.mm.yy',
			showOn: "both",
			buttonImage: $('#calImg').attr('src'),
			buttonImageOnly: true,
			changeMonth: true,
			changeYear: true,
			nextText: '',
			prevText: '',
			maxDate: '<?php echo date("d.m.Y"); ?>'
		})
			.mask("99.99.9999")
			.css({"margin":"0"});
		$('#bowel_movement_table tr')
			.focusin(function() {$(this).addClass("yellow_bg")})
			.focusout(function() {$(this).removeClass("yellow_bg")});
		
	});
</script>
<div class="contactform_dragvbox" id="bowel_movement">
		<h2> + <?php echo $this->translate('block_bowel_movement'); ?></h2>
		<div class="contactform_dragvbox_content" id="grow28"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($this->bowelmov_hasvalues == '1'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;">
			<table class="datatable" id="bowel_movement_table" >
				<tr>
					<td width="150px">
						<label for="bowel_movement_option"><?php echo $this->translate('block_option_bowel_movement'); ?></label>
					</td>
					<td>
						<input type="checkbox" name="bowel_movement[bowel_movement]" id="bowel_movement_option" value="1" <?php if($patient_bowel_movement_values['bowel_movement'] == '1'): ?> checked="checked"<?php endif; ?>  />
					</td>
				</tr>
				<tr>
					<td>
						<label for="bowel_movement_date"><?php echo $this->translate('block_bowel_movement_date'); ?></label>
					</td>

					<td>
						<input type="text" name="bowel_movement[bowel_movement_date]" id="bowel_movement_date"  style="width:80px; margin: 2px 0 -2px 10px;" value="<?php echo $myTime; ?>"   class="embconditions" />
					</td>
				</tr>
				
				
				<tr>
					<td>
						<label for="bowel_movement_description"><?php echo $this->translate('block_bowel_movement_description'); ?></label>
					</td>

					<td>
						<textarea name="bowel_movement[bowel_movement_description]" id="bowel_movement_description" class="textarea_full"><?php if(isset($patient_bowel_movement_values['bowel_movement_description'])) echo $patient_bowel_movement_values['bowel_movement_description']; ?></textarea>
					</td>
				</tr>
				
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php
 if(in_array('hospiz_imex',$allowed_blocks) && $v_box == 'hospiz_imex'): ?>
<!--  ############################################################################## -->
<!--  #######################   Hospiz II(hospiz_imex)   #################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="bowel_movement">
		<h2> + <?php echo $this->translate('hospiz_imex'); ?></h2>
		<div class="contactform_dragvbox_content" id="grow29"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($patient_hzimex)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;">
			<table class="datatable" >
				<tr>
				    <td>
						<label for="import"><?php echo $this->translate('import_hospiz'); ?></label>
					</td>
					<td>
						<input type="text" name="import" size="30" value="<?php if(empty($this->patient_hzimex['import'])) {echo ''; } else {echo $this->patient_hzimex['import']; }?>"> 
					</td>
				</tr>
				<tr>
				    <td>
						<label for="export"><?php echo $this->translate('export_hospiz'); ?></label>
					</td>
					<td>
						<input type="text" name="export" size="30" value="<?php if(empty($this->patient_hzimex['export'])) {echo ''; } else {echo $this->patient_hzimex['export']; }?>"> 
					</td>
				</tr>

			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php
 if(in_array('hospiz_medi',$allowed_blocks) && $v_box == 'hospiz_medi'): ?>
<!--  ############################################################################## -->
<!--  #######################   Hospiz I(hospiz_medi)   #################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="bowel_movement">
		<h2> + <?php echo $this->translate('hospiz_medi'); ?></h2>
		<div class="contactform_dragvbox_content" id="grow30"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty(patient_hzmedi)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;">
			
			
			
			
			
			<?php foreach($this->medication_hp as $type => $medication_n):?>
			
				<div style="font-size:14px; padding-top:5px; margin-bottom:-15px; font-weight:bold;"><?php  echo $this->translate('medication_'.$type); ?></div>
			<table class="datatable" >
				<tr>
				    <th width="30%">
						Medikation 
					</th>
					<th width="30%"> 
						Medikation Dosierung 
					</th>
					<th width="20%">
						<?php  echo $this->translate('prepared'); ?>
					</th>
					<th width="20%">
						<?php  echo $this->translate('given'); ?>
					</th>
				</tr>
				
				<?php foreach($medication_n as $med_id => $val): ?>
				<tr>
				    <td>
				    <?php echo  $val['medication']; ?>	
				    <input type="hidden" name="hospiz_med[<?php echo  $med_id; ?>][medication]"  value=" <?php echo  $val['medication']; ?>">
				    
					</td>
					
					<td>
					<?php echo  $val['dosage']; ?>
					<input type="hidden" name="hospiz_med[<?php echo  $med_id; ?>][dosage]"  value=" <?php echo  $val['dosage']; ?>">	
					</td>
					
					<td>
					 <input type="checkbox" name="hospiz_med[<?php echo  $med_id; ?>][sprepared]"  value="1" <?php  if($this->patient_hzmedi[ $med_id]['sprepared'] ==1 ):  ?> checked ="checked" <?php endif; ?> />  </td>
					
					
					<td>
					  <input type="checkbox" name="hospiz_med[<?php echo  $med_id; ?>][given]"  value="1" <?php  if($this->patient_hzmedi[ $med_id]['given'] ==1 ):  ?> checked ="checked" <?php endif; ?> />  </td>
					
				</tr>
					
               <?php  endforeach; ?>
			</table>
			
			<?php endforeach;?>

		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>




<?php
 if(in_array('med_time_dosage',$allowed_blocks) && $v_box == 'med_time_dosage'): ?>
<!--  ############################################################################## -->
<!--  #######################   Medication New   #################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="med_time_dosage">
		<h2> + <?php echo $this->translate('block_med_time_dosage'); ?></h2>
		<div class="contactform_dragvbox_content" id="grow31"  style="display:<?php if($_REQUEST['openinmodal'] == '1') { echo  block; } else {if($opened_blocks[$v_box] == '1'): echo 'block'; else: echo 'none'; endif;}?>;">
			 <div class="medication_new" style="display: block; float:none; width: 100%; height: 100%;">
			 
			 </div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>





<?php //if((in_array('ipos',$allowed_blocks) || in_array('lmu_visit',$allowed_blocks)) && $v_box == 'ipos' && (in_array('pflegeipos',$allowed_blocks)==false)): ?>
<?php if(in_array('ipos',$allowed_blocks) && $v_box == 'ipos'): ?>
<!--  ############################################################################## -->
<!--  ###############################  IPOS   ###################################### -->
<!--  ############################################################################## -->
	<?php $iposhist=$this->patient_ipos_hist_values;?>


<!--  ############################################################################## -->
<?php endif;?>









			
<?php $blockname = "lmu_visit"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  #########################  Visite renamed to Status ########################## -->
 <!--  ############################################################################## -->
	<?php $f_values = $this->patient_lmu_visit_values[0];?>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + Status</h2>

		<input type="hidden" name="<?php echo $blockname;?>[klau_diag]" value="<?php echo $f_values['klau_diag'];?>">
		<input type="hidden" name="<?php echo $blockname;?>[klau_frage]" value="<?php echo $f_values['klau_frage'];?>">
		<div class="contactform_dragvbox_content" id="grow32"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($f_values)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table>

			<tr>
				<td style="vertical-align:top;" width="200px">	
					<b>Krankheitsphase:</b>
				</td>
				<td style="vertical-align:top;" width="500px">
					<?php   $fm_name="phase";?>
					<?php 	$ms_name=$blockname.$fm_name;?>
					<?php 	$verbs = array('1'=>'stabil', '2'=>'fluktuierende Symptome', '3'=>'erwartet verschlechternd', '4'=>'sterbend');?>
					<?php 	$preselect = ($f_values[$fm_name]===Null)? "" : $f_values[$fm_name.''];?>
					<input type="hidden" id="lmu_visit_iposenabled" name="<?php echo $blockname;?>[iposenabled]" value="<?php echo $f_values['iposenabled'];?>">
					
					<select id="lmuvisit_kphase" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]">
						<?php foreach ($verbs as $key=>$val):?>
							<?php $selected= ($preselect==$key)? "selected":"";?>
							<option <?php echo $selected;?> value="<?php echo $key;?>"><?php echo $val;?></option>
						<?php endforeach; ?>
					</select>
				</td>
			</tr>

			<tr>
				<td style="vertical-align:top;" width="200px">	
					<b>Karnofsky:</b>
				</td>
				<td style="vertical-align:top;" width="500px">
					<?php   $fm_name="karnofsky";?>
					<?php 	$ms_name=$blockname.$fm_name;?>
					<select name="<?php echo $blockname;?>[<?php echo $fm_name;?>]">
						<option value="" <?php if(  $f_values[$fm_name.''] == 'NULL' || empty($f_values[$fm_name.''])) {echo  'selected="selected"';}?> > </option>
						<?php foreach($this->karnofsky_clinik as $karnofsky_value => $karnofsky_details):?>
							<option value="<?php echo  $karnofsky_details['value']; ?>" <?php if(  $f_values[$fm_name.''] == $karnofsky_details['value'] ) {echo  'selected="selected"';}?> ><?php echo $karnofsky_details['label'];?></option>
						<?php endforeach;?>
 
					</select>
				</td>
			</tr>
			
			<tr>
				<td style="vertical-align:top;" width="200px">	
					<b>Bewusstsein:</b>
				</td>
				<td style="vertical-align:top;" width="500px">
					<?php   $fm_name="bewusstsein";?>
					<?php 	$ms_name=$blockname.$fm_name;?>
					<?php 	$verbs = array('', 'wach', 'somnolent', 'soporös', 'komatös');?>
					<select name="<?php echo $blockname;?>[<?php echo $fm_name;?>]">
						<?php foreach ($verbs as $key=>$val):?>
							<?php $selected= ($f_values[$fm_name] == $val)? "selected":"";?>
							<option <?php echo $selected;?> value="<?php echo $val;?>"><?php echo $val;?></option>
						<?php endforeach; ?>
					</select>
				</td>
			</tr>

			<tr>
				<td style="vertical-align:top;" width="200px">	
					<b>Orientierung:</b>
				</td>
				<td style="vertical-align:top;" width="500px">
					<?php $fm_name="ort"; $a_name = "orient_".$fm_name;?>
					<?php $ms_name=$blockname.$fm_name;?>
					<?php $selected= ($f_values[$fm_name.'']==1)? "checked":"";?>
					<input onChange="if ($(this).attr('checked')){$('.orient_b').attr('checked',false);}" class="orient_a" type="checkbox" value="1" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" <?php echo $selected;?> /> Ort
					
					<?php $fm_name="person"; $a_name = "orient_".$fm_name;?>
					<?php $ms_name=$blockname.$fm_name;?>
					<?php $selected= ($f_values[$fm_name.''] ==1 )? "checked":"";?>
					<input onChange="if ($(this).attr('checked')){$('.orient_b').attr('checked',false);}" class="orient_a" type="checkbox" value="1" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" <?php echo $selected;?> /> Person
					
					<?php $fm_name="situation"; $a_name = "orient_".$fm_name;?>
					<?php $ms_name=$blockname.$fm_name;?>
					<?php $selected= ($f_values[$fm_name.''] == 1)? "checked":"";?>
					<input onChange="if ($(this).attr('checked')){$('.orient_b').attr('checked',false);}" class="orient_a" type="checkbox" value="1" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" <?php echo $selected;?> /> Situation
					
					<?php $fm_name="zeit";?>
					<?php $ms_name=$blockname.$fm_name; $a_name = "orient_".$fm_name;?>
					<?php $selected= ($f_values[$fm_name.''] == 1)? "checked":"";?>
					<input onChange="if ($(this).attr('checked')){$('.orient_b').attr('checked',false);}" class="orient_a" type="checkbox" value="1" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" <?php echo $selected;?> /> Zeit

                    <?php $fm_name="keineorient";?>
                    <?php $ms_name=$blockname.$fm_name; $a_name = $fm_name;?>
                    <?php $selected= ($f_values[$fm_name.'']==1)? "checked":"";?>
                    <input class="orient_b" style="margin-left:24px;" onChange="if ($(this).attr('checked')){$('.orient_a').attr('checked',false);}" type="checkbox" value="1" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" <?php echo $selected;?> /> Keine Orientierung
				</td>
			</tr>
			</table>
			
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>

<!-- ISPC-2663 Carmen 02.09.2020 -->
<?php $blockname="talkwithsingleselection";?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
<!--  ############################################################################## -->
<!--  ###############################  talkwith ################################### -->
<!--  ############################################################################## -->
		<?php
			$block_talkwithsingleselection = $this->block_talkwithsingleselection;
			echo $block_talkwithsingleselection['__formHTML'];
		?>
	<!-- <div class="contactform_dragvbox" id="<?php echo $blockname;?>">
		<h2> + <? echo $this->translate('block_talkwith') ?></h2>
			<div class="contactform_dragvbox_content" id="talkwith"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>; min-height:30px;" >
						
			<table>
				<tr>
					<td width="200px;">	
						<b>Kontakt mit:</b>
					</td>
					<td style="vertical-align:top;">
						
					<?php   $fm_name="contact";?>
					<?php 	$ms_name=$blockname.$fm_name;?>
					<?php 	$verbs = array('', 'Patient', 'Angehörige', 'Partner/Partnerin/Lebensgefährte/Lebenbensgefährtin/Ehefrau/Ehemann', 'Kinder (0-5 Jahre)', 'Kinder (6-13 Jahre)', 'Kinder (14-17 Jahre)', 'Kinder (ab 18 Jahre)', 'Eltern', 'Dolmetscher', 'KH Pflege', 'KH Arzt', 'Einweiser', 'Hausarzt',  'gesetzl. Betreuuer', 'Pflegedienst', 'Pflegeheim', 'SAPV', 'Hospiz', 'Sanitätshaus', 'Kostenträger', 'Sonstige');?>
								
					<input id="<?php echo $ms_name.'_val';?>" type="hidden" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" value="<?php echo $patient_talkwith_values[$fm_name];?>"/>					
					<ul class="pseudomultiselect" id="<?php echo $ms_name;?>">
						<li>
						<select onChange="checkbox_ms('<?php echo $ms_name;?>')">
							<?php foreach ($verbs as $key=>$val):?>
								<option> <?php echo $val;?></option>
							<?php endforeach; ?>
						</select>
						</li>
					</ul>
					</td>
				</tr>
				<tr>
					<td></td>
					<td>weitere Angaben:<input type=text" name="<?php echo $blockname;?>[contact_more]" style="width:100%;" value="<?php echo $patient_talkwith_values['contact_more'];?>" /></td>
				</tr>
			</table>
			
			<table style="display:none">
				<tr>
					<td width="200px;">	
						<b>Weitere Teilnehmer:</b>
					</td>
					<td style="vertical-align:top;">
					<?php   $fm_name="helpers";?>
					<?php 	$ms_name=$blockname.$fm_name;?>
					<?php 	$verbs = array('', 'Chefarzt/in', 'Oberarzt/in', 'Stationsarzt/in', 'Pflegedienst', 'Sozialdienst', 'Psychotherapie', 'Seelsorge', 'Physikalische Therapie', 'Atemtherapie', 'Apotheke', 'Sonstige');?>
								
					<input id="<?php echo $ms_name.'_val';?>" type="hidden" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" value="<?php echo $patient_talkwith_values[$fm_name];?>"/>					
					<ul class="pseudomultiselect" id="<?php echo $ms_name;?>">
						<li>
						<select onChange="checkbox_ms('<?php echo $ms_name;?>')">
							<?php foreach ($verbs as $key=>$val):?>
								<option> <?php echo $val;?></option>
							<?php endforeach; ?>
						</select>
						</li>
					</ul>
					</td>
				</tr>
				<tr>
					<td></td>
					<td>weitere Angaben:<input type=text" name="<?php echo $blockname;?>[helpers_more]" style="width:100%;" value="<?php echo $patient_talkwith_values['helpers_more'];?>" />
					
					
					
					
					
					</td>
				</tr>
			</table>
		</div>
	</div> -->
	
<!--  ############################################################################## -->
<?php endif;?>
 
<!-- // -->


<?php $blockname="talkback"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  ################################  Talkback ################################### -->
 <!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + Rücksprache</h2>
		<div class="contactform_dragvbox_content" id="grow33"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
			<table>

			<tr>
				<td style="vertical-align:top;" width="200px">	
					<b>Rücksprache erfolgt mit:</b>
				</td>
				<td style="vertical-align:top;" width="500px">
					<?php   $fm_name="optionvalue";?>
					<?php 	$ms_name=$blockname.$fm_name;?>
					<?php
					//ISPC-2868,Elena,18.03.2021
					$talkback_opt = '';
					if(isset($patient_talkback_values['optionvalue'])){
					$talkback_opt = $patient_talkback_values['optionvalue'];
					}
					?>
					<?php 	$verbs = array('', 'Arzt', 'Pflege', 'Sozialarbeit', 'Haus-Seelsorge', 'Atemtherapie', 'PhysMed', 'Psychologie');?>
					<!--<input id="<?php echo $ms_name.'_val';?>" type="hidden" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" value="<?php echo $patient_talkback_values[0][$fm_name];?>"/>	-->
					<ul class="pseudomultiselect" id="<?php echo $ms_name;?>">
						<li>
                            <!-- ISPC-2868,Elena,18.03.2021 -->
						<select name="<?php echo $blockname;?>[optionvalue]" onChange="checkbox_ms('<?php echo $ms_name;?>')">
							<?php foreach ($verbs as $key=>$val):?>
								<option <?php if($val ==$talkback_opt){echo 'selected';} ?> ><?php echo $val;?></option>
							<?php endforeach; ?>
						</select>
						</li>
					</ul>
				</td>
			</tr>
			<tr>
				<td style="vertical-align:top;">Memo:</td>
				<td style="vertical-align:top;">					
                    <!-- ISPC-2868,Elena,18.03.2021 -->
					<textarea class="textarea_full" name="<?php echo $blockname;?>[freetext]" style="vertical-align:top;"><?php echo $patient_talkback_values['freetext'];?></textarea>
				</td>
			</tr>
			</table>
			
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>			
		
 
		
		
<?php $blockname="lmu_pmba_body"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  ####  LMU Palliativmedizinisches Basisassesment Körperliche Untersuchung  #### -->
 <!--  ############################################################################## -->
 	<?php $f_values = $this->patient_lmu_pmba_body_values;?>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + Körperliche Untersuchung</h2>
		<div class="contactform_dragvbox_content" id="grow34"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($f_values)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table>
			<tr>
				<?php $fkey='allgemeinzustand_freetext';?>
				<td style="width:200px; vertical-align:top;">
					<b>Allgemeinzustand und Ernährungszustand</b>
				</td>
				<td style="width:280px;">
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>]"><?php echo $f_values[$fkey];?></textarea>
				</td>
				<td style="width:260px; vertical-align:top;">
					<?php $fkey='allgemeinzustand_dropdown';?>
					<select style="width:260px;" name="<?php echo $blockname;?>[<?php echo $fkey;?>]" >
						<?php $verbs = array('', 'guter Allgemeinzustand', 'reduzierter Allgemeinzustand', 'stark reduzierter Allgemeinzustand');
						foreach ($verbs as $key=>$val):?>
							<?php 
								$selected='';
								if ($f_values[$fkey] ==  $val) $selected='selected';
							?>
							<option <?php echo $selected;?> ><?php echo $val;?></option>
						<?php endforeach; ?>
					</select>
					<br/>
					<?php $fkey='ernaehrung_dropdown';?>
					<select style="width:260px;" name="<?php echo $blockname;?>[<?php echo $fkey;?>]" >
						<?php $verbs = array('','guter Ernährungszustand', 'reduzierter Ernährungszustand', 'stark reduzierter Ernährungszustand');
						foreach ($verbs as $key=>$val):?>
							<?php 
								$selected='';
								if ($f_values[$fkey] ==  $val) $selected='selected';
							?>
							<option <?php echo $selected;?> ><?php echo $val;?></option>
						<?php endforeach; ?>
					</select>	
					<br/>					
					<?php   $fm_name="allgemeinzustand_checkboxen";?>
					<?php 	$verbs = array(	
											'Normale Hydratation', 
											'Keine Effloreszenzen', 
											'unauffällige Hautfarbe'										
											);?>
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>
				</td>
			</tr>

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='kopfundhals';?>
				<td style="vertical-align:top;">
					<b>Kopf und Hals</b>
				</td>
				<td >
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">					
					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	
											'unauffälliger Zahnstatus', 
											'Mundhöhle/Zunge/Rachen ohne path. Befund', 
											'keine Venenstauung',
											'Schleimhäute unauffällig'										
											);?>
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>		
				</td>
			</tr>

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='lunge';?>
				<td style="vertical-align:top;">
					<b>Lunge</b>
				</td>
				<td>
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">	
					<div style="vertical-align:baseline;">
						<table>
						<tr>
							<td width="90px">
								Atemfrequenz 
							</td>
							<td>
								<input style="width:30px;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freq]" value="<?php echo $f_values[$fkey.'_freq'];?>"> / min.
							</td>
						</tr>
						</table>

					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$ms_name=$blockname.$fm_name;?>
					<?php 	$verbs = array(	
											'perkutorisch unauffällig', 
											'seitengleich belüftet', 
											'Vesikuläratmen über allen LF',
											'Keine feuchten oder trockenen RGs'										
											);?>
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>	
					</div>		
				</td>
			</tr>

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='herz';?>
				<td style="vertical-align:top;">
					<b>Herz</b>
				</td>
				<td >
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">	
					<div style="vertical-align:baseline;">
						<table>
						<tr>
							<td width="90px">
								Frequenz:
							</td>
							<td>
								<input style="width:30px;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freq]" value="<?php echo $f_values[$fkey.'_freq'];?>"> / min.
							</td>
						</tr>
						<tr>
							<td>
								RR:
							</td>
							<td>
								<input style="width:60px;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_rr]" value="<?php echo $f_values[$fkey.'_rr'];?>">
							</td>
						</tr>
						</table>

					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	
											'Normofrequent', 
											'rhythmisch', 
											'Herztöne rein, keine VTG',									
											);?>
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>
					</div>		
				</td>
			</tr>

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='abdomen';?>
				<td style="vertical-align:top;">
					<b>Abdomen</b>
				</td>
				<td >
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">					
					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	 
											'Bauchdecke weich', 
											'Kein Druckschmerz', 
											'keine Resistenzen',
											'Darmgeräusche über allen 4 Quad.'										
											);?>				
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>			
				</td>
			</tr>
			
			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='becken';?>
				<td style="vertical-align:top;">
					<b>Becken- und Geschlechtsorgane</b>
				</td>
				<td >
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">					
					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	
											'kein Druck- oder Klopfschmerz über dem Nierenlager', 									
											);?>
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>			
				</td>
			</tr>
			
			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='extremitaeten';?>
				<td style="vertical-align:top;">
					<b>Extremitäten</b>
				</td>
				<td>
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">					
					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	
											'Extremitäten frei beweglich', 	
											'Gelenke nicht schmerzhaft',
											'Keine Ödeme',
											'Keine trophischen Störungen'								
											);?>				
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>			
				</td>
			</tr>			

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='nervensystem';?>
				<td style="vertical-align:top;">
					<b>Nervensystem</b>
				</td>
				<td>
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">					
					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	
											'Stimme, Sprache und Gehör normal', 	
											'Visus intakt',
											'Okulomotorik und Pupillenreaktion unauffällig',
											'Reflexstatus unauffällig',	
											'Gangbild und Koordination unauffällig',
											'Keine Sensibilitätsstörung',
											'Keine motorischen Defizite',
											'Kein Tremor oder Myoklonie'
											);?>				
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>			
				</td>
			</tr>

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='psyche';?>
				<td style="vertical-align:top;">
					<b>Psyche</b>
				</td>
				<td>
					<textarea style="width:250px; height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">					
					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	
											'keine affektive Störung', 	
											'normaler Antrieb',
											'keine Denkstörungen',
											'keine Angststörung',	
											'keine Wahrnehmungsstörung',
											'nicht suizidal',
											);?>
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>		
				</td>
			</tr>						
			</table>
			<h4>Portkatheter/zentrale Zugänge, „invasive Schläuche“:  (in Situ/ letzter Wechsel)</h4>
			<?php $fm_name='zugaenge';?>
			<textarea style="width:99%;" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]"><?php echo $f_values[$fm_name];?></textarea>
			<h4>OP-Wunden: Verbände/Fäden ex?</h4>
			<?php $fm_name='wunden';?>
			<textarea style="width:99%;" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]"><?php echo $f_values[$fm_name];?></textarea>		
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>	
		

<?php $blockname="lmu_pmba_pain"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  ########## LMU Palliativmedizinisches Basisassesment Schmerzanamnese ######### -->
 <!--  ############################################################################## -->
 	<?php $f_values = $this->patient_lmu_pmba_pain_values;?>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + Schmerzanamnese</h2>
		<div class="contactform_dragvbox_content" id="grow35"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($f_values)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
		<h4>Hauptschmerz</h4>
			<table style="width:100%;">
			<tr>
				<td>
				<b>Schmerzanamnese</b>  (Vorgeschichte, Beginn, Häufigkeit, Auslöser, Verstärkung und Linderung):
				</td>
			</tr>
			<tr>
				<td>
				<textarea style="width:99%" type="text" name="<?php echo $blockname;?>[beginn]"><?php echo $f_values['beginn'];?></textarea>
				</td>
			</tr>
			<tr>
				<td>
				<b>Charakter und Qualität:</b>
				</td>
			</tr>
			<tr>
				<td>
				<table width="100%">
				<tr>
					<td rowspan="2" width="200px">
						<input type="checkbox" name="<?php echo $blockname;?>[Nozizeptiver]" <?php if ($f_values['Nozizeptiver']) echo "checked";?> value="1">
						Nozizeptiver Schmerz
					</td>
					<td width="200px">
						<input type="checkbox" name="<?php echo $blockname;?>[Somatisch]" <?php if ($f_values['Somatisch']) echo "checked";?> value="1">
						Somatisch
					</td>
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[Somatisch_gutlokalisierbar]" <?php if ($f_values['Somatisch_gutlokalisierbar']) echo "checked";?> value="1">
						gut lokalisierbar
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Somatisch_scharfbegrenzt]" <?php if ($f_values['Somatisch_scharfbegrenzt']) echo "checked";?> value="1">
						scharf begrenzt
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Somatisch_stechend]" <?php if ($f_values['Somatisch_stechend']) echo "checked";?> value="1">
						stechend
					</td>
				</tr>
				<tr style="border-top:1px solid grey;">
					<td >
						<input type="checkbox" name="<?php echo $blockname;?>[Viszeral]" <?php if ($f_values['Viszeral']) echo "checked";?> value="1">
						Viszeral
					</td>
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[Viszeral_schlechtlokalisierbar]" <?php if ($f_values['Viszeral_schlechtlokalisierbar']) echo "checked";?> value="1">
						schlecht lokalisierbar
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Viszeral_dumpf]" <?php if ($f_values['Viszeral_dumpf']) echo "checked";?> value="1">
						dumpf / tief
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Viszeral_krampfartig]" <?php if ($f_values['Viszeral_krampfartig']) echo "checked";?> value="1">
						krampfartig / kolikartig
					</td>
				</tr>
				<tr style="border-top:1px solid grey;">
					<td rowspan="2">
						<input type="checkbox" name="<?php echo $blockname;?>[NeuropathischerSchmerz]" <?php if ($f_values['NeuropathischerSchmerz']) echo "checked";?> value="1">
						Neuropathischer Schmerz
					</td>
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[Neuralgiform]" <?php if ($f_values['Neuralgiform']) echo "checked";?> value="1">
						Neuralgiform
					</td>
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[neuraligi_stechend]" <?php if ($f_values['neuraligi_stechend']) echo "checked";?> value="1">
						stechend / schneidend
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[neuraligi_blitzartig]" <?php if ($f_values['neuraligi_blitzartig']) echo "checked";?> value="1">
						blitzartig einschießend
						<br/>
					</td>
				</tr>
				<tr style="border-top:1px solid grey;">
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[Dauerschmerz]" <?php if ($f_values['Dauerschmerz']) echo "checked";?> value="1">
						Dauerschmerz
					</td>
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[Dauerschmerz_brennend]" <?php if ($f_values['Dauerschmerz_brennend']) echo "checked";?> value="1">
						brennend
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Dauerschmerz_bohrend]" <?php if ($f_values['Dauerschmerz_bohrend']) echo "checked";?> value="1">
						bohrend
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Dauerschmerz_Dysaesthesie]" <?php if ($f_values['Dauerschmerz_Dysaesthesie']) echo "checked";?> value="1">
						Dysästhesie
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Dauerschmerz_Hyperaesthesie]" <?php if ($f_values['Dauerschmerz_Hyperaesthesie']) echo "checked";?> value="1">
						Hyperästhesie
					</td>
				</tr>
				<tr style="border-top:1px solid grey;">
					<td >
						<input type="checkbox" name="<?php echo $blockname;?>[MyofaszialerSchmerz]" <?php if ($f_values['MyofaszialerSchmerz']) echo "checked";?> value="1">
						Myofaszialer Schmerz
					</td>
					<td >
					</td>
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[Myofaszialer_einschliessend]" <?php if ($f_values['Myofaszialer_einschliessend']) echo "checked";?> value="1">
						einschießend
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Myofaszialer_trigger]" <?php if ($f_values['Myofaszialer_trigger']) echo "checked";?> value="1">
						durch Triggerpunkte auslösbar
						<br/>
					</td>
				</tr>
				<tr style="border-top:1px solid grey;">
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[totalpain]" <?php if ($f_values['totalpain']) echo "checked";?> value="1">
						V. a. „Total Pain“
					</td>
					<td>
					</td>
					<td>
					</td>
				</tr>
				</table>
				</td>
			</tr>
			<tr>
				<td>
					<table width="100%">
					<tr>
						<td width="200px;"><b>Dauer:</b></td>
						<td>
							<input type="checkbox" name="<?php echo $blockname;?>[dauer_Kontinuierlich]" <?php if ($f_values['dauer_Kontinuierlich']) echo "checked";?> value="1">
							Kontinuierlich
						</td>
						<td>
							<input type="checkbox" name="<?php echo $blockname;?>[dauer_intermittierend]" <?php if ($f_values['dauer_intermittierend']) echo "checked";?> value="1">
							intermittierend
						</td>
						<td>
							<input type="checkbox" name="<?php echo $blockname;?>[dauer_Schmerzattacken]" <?php if ($f_values['dauer_Schmerzattacken']) echo "checked";?> value="1">
							Schmerzattacken
						</td>
					</tr>
					<tr>
						<td></td>
						<td colspan="3">
							<textarea style="width:99%" type="text" name="<?php echo $blockname;?>[dauer_freetext]"><?php echo $f_values['dauer_freetext'];?></textarea>
						</td>
					</tr>
					<tr>
						<td><b>Lokalisation:</b></td>
						<td colspan="3" style="vertical-align:top;">
							<textarea style="width:99%" type="text" name="<?php echo $blockname;?>[lokalisation]"><?php echo $f_values['lokalisation'];?></textarea>
						</td>
					</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					<h4>Weitere Schmerzen</h4>
				</td>
			</tr>
			<tr>
				<td>
					<table width="100%">
						<tr>
							<td width="200px" style="vertical-align:top;">
								<b>Lokalisation:</b>
							</td>
							<td>
								<textarea style="width:99%" type="text" name="<?php echo $blockname;?>[weitere_lokalisation]"><?php echo $f_values['weitere_lokalisation'];?></textarea>
							</td>
						</tr>
						<tr>
							<td style="vertical-align:top;">
								<b>Kurzbeschreibung:</b>
							</td>
							<td>
								<textarea style="width:99%" type="text" name="<?php echo $blockname;?>[weitere_kurzbeschreibung]"><?php echo $f_values['weitere_kurzbeschreibung'];?></textarea>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					<h4>Schmerzmedikamente</h4>
				</td>
			</tr>
			<tr>
				<td>
					<table width="100%">
						<tr>
							<td width="200px" style="vertical-align:top;">
								<b>Bisherige Schmerzmedikamente:</b>
							</td>
							<td>
								<textarea style="width:99%" type="text" name="<?php echo $blockname;?>[bisher_medis]"><?php echo $f_values['bisher_medis'];?></textarea>
							</td>
						</tr>
					</table>
					
				</td>
			</tr>
			</table>
			
		</div>
	</div>

	
<!--  ############################################################################## -->
<?php endif;?>	


		
		
		
		
		
		
		
		
		
		
<?php $blockname="lmu_pmba_wishes"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  ############  LMU Palliativmedizinisches Basisassesment Wünsche   ############ -->
 <!--  ############################################################################## -->
 	<?php $f_values = $this->patient_lmu_pmba_wishes_values;?>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + Wünsche und Erwartungen des Patienten und seiner Angehörigen</h2>
		<div class="contactform_dragvbox_content" id="grow36"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($f_values)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table style="width:100%">
			<tr>
				<td style="vertical-align:top;">	
				<p>(auch bezüglich tumorspezifischer Therapie, lebensverlängernder Maßnahmen, Reanimation)</p>				
					<textarea class="textarea_full" name="<?php echo $blockname;?>[text]" style="vertical-align:top;"><?php echo $f_values['text'];?></textarea>	
				</td>
			</tr>	
			</table>
			
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>
		
		
		
		
		
<?php $blockname="lmu_pmba_aufklaerung"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  #######  LMU Palliativmedizinisches Basisassesment Aufklärungsstand   ######## -->
 <!--  ############################################################################## -->
 	<?php $f_values = $this->patient_lmu_pmba_aufklaerung_values;?>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + Aufklärungsstand/Krankheitsverarbeitung Patient/ ggf. Angehörige</h2>
		<div class="contactform_dragvbox_content" id="grow37"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($f_values)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table style="width:100%">
			<tr>
				<td style="vertical-align:top;">					
					<textarea class="textarea_full" name="<?php echo $blockname;?>[text]" style="vertical-align:top;"><?php echo $f_values['text'];?></textarea>	
				</td>
			</tr>	
			</table>
			
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>





<?php if(in_array('todos',$allowed_blocks) && $v_box == 'todos'): ?>
<?php 
	$block_todos = $this->block_todos ; 
	$patient_todos_values = $block_todos['patient_todos_values'];

	$flat_todo_users = array();
	foreach($block_todos['todo_users'] as $k=>$row_user) {
		if ( ! is_array( $row_user)) { $row_user = array($k => $row_user); }
		$flat_todo_users = array_merge($flat_todo_users, $row_user );
	}
?>
<!--  ############################################################################## -->
<!--  ###############################  todo ######################################## -->
<!--  ############################################################################## -->
	<script type="text/javascript">
	$(document).ready(function(){
 
		 $( ".todo_date" ).datepicker({
				dateFormat: 'dd.mm.yy',
				showOn: "both",
				buttonImage: $('#calImg').attr('src'),
				buttonImageOnly: true,
				changeMonth: true,
				changeYear: true,
				nextText: '',
				prevText: ''
			}).mask("99.99.9999");
		 
		$(".todo_date").mask("99.99.9999");
		
		$('.todo_selectbox' , $("#todos")).chosen({
			placeholder_text_single: translate('please select'),
			placeholder_text_multiple : translate('please select'),
			multiple:1,
			width:'250px',
			"search_contains": true,
			no_results_text: translate('noresultfound')
		});
	});

	function todo_checkinput( element )
	{
		var parent = $(element).parents("tr.todorow");	
		if ( $(".todo_text", parent).val() != "" && $(".todo_selectbox", parent).val() !== null)
		{
			$(parent).next("tr.todorow"). show();					
		}
		return;
		/*
		var elename=$(element).attr('name');
		var todo_id=elename.slice(elename.indexOf('[')+1,elename.indexOf('[')+2);

		if ($("select[name='todos["+todo_id+"][user]']").val()!=0 && $("input[name='todos["+todo_id+"][text]']").attr('value')!=""){			
			$("#todos_"+(parseInt(todo_id)+1)).show();
			}
		*/
	}
		
	function add_new_todo_for_assistenzarzt(text){
		var uid="<?php echo intval($this->assistenzarzt_id);?>";
		var el=$('.todotable:visible').last();
		$(el).find('.todo_text').val(text);
		$(el).find("select option[value='"+uid+"']").attr('selected', 'true').change();
		}
		
	</script>			
	<div class="contactform_dragvbox" id="todos">
		<h2> + <? echo $this->translate('block_todos') ?></h2>
		<div class="contactform_dragvbox_content" id="todos"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >

		<table class="todotable datatable table-striped">
			<tr>
				<th width="330px">Aufgabe</th>
				<th >zu erledigen von</th>
				<th width="120px" >zu erledigen am</th>
			</tr>
		<?php foreach ($patient_todos_values as $rownum=>$row): ?>
				<tr>
					<td>
						<span style="padding:2px"><?php echo $row['text'];?></span>
					</td>
					<td>
						<span style="padding:2px">
						
						<?php	
						$todo_users = array();					
						foreach ($row['additional_info'] as $row_user) {
							$todo_users[] = $flat_todo_users[$row_user];
						}
						echo implode(" | ", $todo_users);
						?>	
						</span>
					</td>
					<td>
						<span style="padding:2px"><?php echo strftime("%d.%m.%Y",strtotime($row['date'])); ?></span>
					</td>
				</tr>
		<?php endforeach; ?>
		
		<?php for ($rownum=0; $rownum<6; $rownum++ ): ?>
			<tr class="todorow" <?php if ($rownum > 0 ) {echo 'style="display:none"';}?>>
				<td style="vertical-align:top">
					<input class="todo_text" type="text" name="todos[<?php echo $rownum;?>][text]" value="" style="width:310px;" onChange="todo_checkinput(this)">
				</td>
				<td style="vertical-align:top" >						
					<?php 
						echo $this->formSelect(
							"todos[{$rownum}][user][]", 
							null, 
							array(
								"class" => "todo_selectbox",
								"multiple" => true,
								"size" => 1,
								"onChange" => "todo_checkinput(this)",
								"disable" => array("0")
							),
							$block_todos['todo_users']
						);
					?>	
				</td>
				<td style="vertical-align:top; padding-left:2px;">
					<input type="text" name="todos[<?php echo $rownum;?>][date]" class="todo_date"  style="width:80px;" value="<?php echo strftime("%d.%m.%Y",strtotime('now')); ?>"   class="embconditions" />
				</td>
			</tr>
			
		<?php endfor; ?>	


		</table>
	
		
		</div>
	</div>
	
<!--  ############################################################################## -->
<?php endif;?>

		
		
		
		
	

<?php if(in_array('kvno_visit_type',$allowed_blocks)  && $v_box == 'kvno_visit_type'): ?>
<!--  ############################################################################## -->
<!--  ########################## Besuch war   ###################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="kvno_visit_type">
		<h2> + <?php echo $this->translate('block_kvno_visit_type') ?></h2>
		<div class="contactform_dragvbox_content" id="grow38"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($this->kvno_hasvalues == '1'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
				<div class="kvno_visit_type">
					<label class="kvno_top_labels"><?php echo $this->translate('block_kvno_visit_type_label'); ?>:</label>
					<ul>
						<li>
							<input type="checkbox" id="ethisch" name="kvno_visit_type[ethically]" value="1" <?php if($kvno_visit_type['ethically'] == "1"): ?> checked="checked" <?php endif; ?> />
							<label for="ethically">ethisch</label>
						</li>
						<li>
							<input type="checkbox" id="somatisch" name="kvno_visit_type[somatic]" value="1"  <?php if($kvno_visit_type['somatic'] == "1"): ?> checked="checked" <?php endif; ?>  />
							<label for="somatic">somatisch</label>
						</li>
						<li>
							<input type="checkbox" id="psycho" name="kvno_visit_type[psychosocial]" value="1"  <?php if($kvno_visit_type['psychosocial'] == "1"): ?> checked="checked" <?php endif; ?>  />
							<label for="psycho">psycho-sozial</label>
						</li>
						<li>
							<input type="checkbox" id="koord" name="kvno_visit_type[coordination]" value="1"  <?php if($kvno_visit_type['coordination'] == "1"): ?> checked="checked" <?php endif; ?>  />
							<label for="koord">Koordination</label>
						</li>
					</ul>
				</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>
 
 
 
 
 
 
 
 <?php if(in_array('bavaria_options',$allowed_blocks)  && $v_box == 'bavaria_options'): ?>
<!--  ############################################################################## -->
<!--  ########################## Besuch war   ###################################### -->
<!--  ############################################################################## -->



	<div class="contactform_dragvbox"  id="bavaria_options">
		<h2> + <?php echo $this->translate('block_bavaria_options') ?></h2>
 		<div class="contactform_dragvbox_content bayern_dragvbox_content" id="grow39"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($this->sapvalarr)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >

<div class="bayern_doctor_vboxes">
	<div class="bayern_vboxes_left">

		<div class="bayern_dragvbox" id="item_1">
			<h2 class="">Beratung - Einsatzort / -art</h2>
			<div     id="grow1" class="bayern_dragvbox_content">
			<div class="bayern_sapvfb3_content">
				<table class="bayern_sapvfb3_table">
					<tr>
						<td width="95%"><label for="cbx_1">Hausbesuch in Privatwohnung</label></td>
						<td width="5%">
							<?php if( is_array($this->sapvalarr)):?>
      							<input type="checkbox" id="cbx_1" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Hausbesuch in Privatwohnung','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)" value="1" <?php if(in_array('1',$this->sapvalarr)) { echo ' checked="checked"';}?> />
							<?php else :?>
								<input type="checkbox" id="cbx_1" name="symptom[]" value="1" onclick="saveCheckboxes(this,'Hausbesuch in Privatwohnung','<?php echo $this->cat1;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label for="cbx_2">Besuch im Krankenhaus / Palliativstation</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
     						<input type="checkbox" id="cbx_2"  value="2" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Besuch im Krankenhaus / Palliativstation','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('2',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
							<input type="checkbox" id="cbx_2"  value="2" name="symptom[]" onclick="saveCheckboxes(this,'Besuch im Krankenhaus / Palliativstation','<?php echo $this->cat1;?>')" />
						<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label for="cbx_3">Besuch in stationärer Pflegeeinrichtung / Hospiz</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
     						<input type="checkbox" id="cbx_3"  value="3" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Besuch in stationärer Pflegeeinrichtung / Hospiz','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('3',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
							<input type="checkbox" id="cbx_3"  value="3" name="symptom[]" onclick="saveCheckboxes(this,'Besuch in stationärer Pflegeeinrichtung / Hospiz','<?php echo $this->cat1;?>')" />
						<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label for="cbx_6" >Telefonate/ E-Mails</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
							<input type="checkbox" id="cbx_6" value="6" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Telefonate/ E-Mails','<?php echo $this->cat1;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('6',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
						<?php else :?>
							<input type="checkbox" id="cbx_6" value="6" name="symptom[]" onclick="saveCheckboxes(this,'Telefonate/ E-Mails','<?php echo $this->cat1;?>');">
						<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label for="cbx_61" >24h-Bereitschaft</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
     						<input type="checkbox" id="cbx_61"  value="61" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'24h-Bereitschaft','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('61',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
							<input type="checkbox" id="cbx_61"  value="61" name="symptom[]" onclick="saveCheckboxes(this,'24h-Bereitschaft','<?php echo $this->cat1;?>')" />
						<?php endif;?>
						</td>
					</tr>
					<tr  >
						<td>20.00 – 6.00 Uhr</td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
     						<input type="checkbox" id="cbx_7" class="visit_interval"  value="7" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'20.00 – 6.00 Uhr','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('7',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
							<input type="checkbox" id="cbx_7" class="visit_interval"  value="7" name="symptom[]" onclick="saveCheckboxes(this,'20.00 – 6.00 Uhr','<?php echo $this->cat1;?>')" />
						<?php endif;?>
						</td>
					</tr>

				</table>
			</div>
			</div>
		</div>

		<div class="bayern_dragvbox" id="item_2">
			<h2 class="">Koordination - Absprache mit/ Beratung von  FachkollegInnen</h2>
			<div   id="grow2" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
				<table class="bayern_sapvfb3_table">
					<tr>
						<td width="95%"><label for="cbx_8" >behandelnde Ärzte</label></td>
						<td width="5%">
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_8"  value="8" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'behandelnde Ärzte','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('8',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_8"  value="8" name="symptom[]" onclick="saveCheckboxes(this,'behandelnde Ärzte','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_9" >amb. und stationäre Pflege</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_9"  value="9" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'amb. und stationäre Pflege','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('9',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
								<input type="checkbox" id="cbx_9"  value="9" name="symptom[]" onclick="saveCheckboxes(this,'amb. und stationäre Pflege','<?php echo $this->cat2;?>')" />
						<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_10" >Koordinatoren des amb. Hospiz</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_10"  value="10" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Koordinatoren des amb. Hospiz','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('10',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
								<input type="checkbox" id="cbx_10"  value="10" name="symptom[]" onclick="saveCheckboxes(this,'Koordinatoren des amb. Hospiz','<?php echo $this->cat2;?>')" />
						<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_11" >Med.-pfleg. Palliative Care Fachkraft</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_11"  value="11" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Med.-pfleg. Palliative Care Fachkraft','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('11',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
								<input type="checkbox" id="cbx_11"  value="11" name="symptom[]" onclick="saveCheckboxes(this,'Med.-pfleg. Palliative Care Fachkraft','<?php echo $this->cat2;?>')" />
						<?php endif;?>
						</td>
					</tr>

					<tr>
						<td><label  for="cbx_12" >PalliativmedizinerIn</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_12"  value="12" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'PalliativmedizinerIn','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('12',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_12"  value="12" name="symptom[]" onclick="saveCheckboxes(this,'PalliativmedizinerIn','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_19" >Klinik- Aufnahme bzw. Entlassung</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_19"  value="19" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Klinik- Aufnahme bzw. Entlassung','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('19',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_19"  value="19" name="symptom[]" onclick="saveCheckboxes(this,'Klinik- Aufnahme bzw. Entlassung','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>

					</tr>
					<tr>
						<td><label  for="cbx_62" >HomeCare</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_62"  value="62" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'HomeCare','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('62',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_62"  value="62" name="symptom[]" onclick="saveCheckboxes(this,'HomeCare','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>

					</tr>

				</table>
				</div>
			</div>
		</div>

		<div class="bayern_dragvbox" id="item_3">
			<h2 class="">Teilversorgung - palliativärztlich-pflegerische Maßnahmen</h2>
			<div   id="grow3" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
				<table class="bayern_sapvfb3_table">
					<tr>
						<td  width="95%"><label  for="cbx_20" ><b>Schmerztherapie<b> Erstberatung</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_20"  value="20" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Schmerztherapie Erstberatung','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('20',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_20"  value="20" name="symptom[]" onclick="saveCheckboxes(this,'Schmerztherapie Erstberatung','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_21" ><span>Verlaufskontrolle</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_21" value="21" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Verlaufskontrolle','<?php echo $this->cat1;?>', <?php echo $this->sapv_id ;?> )"    <?php if(in_array('21',$this->sapvalarr)) { echo ' checked="checked"';}?> />
							<?php else :?>
								<input type="checkbox" id="cbx_21" value="21" name="symptom[]" onclick="saveCheckboxes(this,'Verlaufskontrolle','<?php echo $this->cat1;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_22" ><b>REASSESSMENT Krisenintervention</b></label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
     						<input type="checkbox" id="cbx_22"  value="22" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'REASSESSMENT Krisenintervention','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('22',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
							<input type="checkbox" id="cbx_22"  value="22" name="symptom[]" onclick="saveCheckboxes(this,'REASSESSMENT Krisenintervention','<?php echo $this->cat3;?>')" />
						<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_23" ><b>Symptomkontrolle</b> Erstberatung</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_23"  value="23" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Symptomkontrolle  Erstberatung','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('23',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_23"  value="23" name="symptom[]" onclick="saveCheckboxes(this,'Symptomkontrolle  Erstberatung','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_24" ><span>Verlaufskontrolle</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr) && in_array('24',$this->sapvalarr)):?>
								<input type="checkbox" id="cbx_24" value="24" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Verlaufskontrolle','<?php echo $this->cat2;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('24',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_24" value="24" name="symptom[]" onclick="saveCheckboxes(this,'Verlaufskontrolle','<?php echo $this->cat2;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_25" ><b>REASSESSMENT   Krisenintervention</b></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_25"  value="25" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'REASSESSMENT Krisenintervention','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('25',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_25"  value="25" name="symptom[]" onclick="saveCheckboxes(this,'REASSESSMENT Krisenintervention','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_26" ><span>individueller Notfallplan</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_26"  value="26" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'individueller Notfallplan','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('26',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_26"  value="26" name="symptom[]" onclick="saveCheckboxes(this,'individueller Notfallplan','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_27" ><span>Terminalphase</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_27"  value="27" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Terminalphase','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('27',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_27"  value="27" name="symptom[]" onclick="saveCheckboxes(this,'Terminalphase','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_28" ><span>Maßnahmen im <b>Todesfall</b></span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_28"  value="28" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Maßnahmen im Todesfall','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('28',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_28"  value="28" name="symptom[]" onclick="saveCheckboxes(this,'Maßnahmen im Todesfall','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_31" >Medikation subkutan / i.v. / i.m.</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_31" value="31" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Medikation subkutan / i.v. / i.m.','<?php echo $this->cat3;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('31',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_31" value="31" name="symptom[]" onclick="saveCheckboxes(this,'Medikation subkutan / i.v. / i.m.','<?php echo $this->cat3;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_34" ><span>Mundpflege</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_34"  value="34" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Mundpflege','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('34',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_34"  value="34" name="symptom[]" onclick="saveCheckboxes(this,'Mundpflege','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_35" ><span>Wundversorgung</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_35"  value="35" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Wundversorgung','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('35',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_35"  value="35" name="symptom[]" onclick="saveCheckboxes(this,'Wundversorgung','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_36" ><span>Abführmaßnahmen</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr) ):?>
	     						<input type="checkbox" id="cbx_36"  value="36" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Abführmaßnahmen','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('36',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_36"  value="36" name="symptom[]" onclick="saveCheckboxes(this,'Abführmaßnahmen','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_37" ><span>Stomata-Kontinenzberatung</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_37"  value="37" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Stomata-Kontinenzberatung','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('37',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_37"  value="37" name="symptom[]" onclick="saveCheckboxes(this,'Stomata-Kontinenzberatung','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_38" ><span>Lagerungsmaßnahmen</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_38"  value="38" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Lagerungsmaßnahmen','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('38',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_38"  value="38" name="symptom[]" onclick="saveCheckboxes(this,'Lagerungsmaßnahmen','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_39" ><span>Einsatz von Hilfsmitteln</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_39" value="39" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Einsatz von Hilfsmitteln','<?php echo $this->cat3;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('39',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_39" value="39" name="symptom[]" onclick="saveCheckboxes(this,'Einsatz von Hilfsmitteln','<?php echo $this->cat3;?>');">
							<?php endif;?>
						</td>
					</tr>
				</table>
				</div>
			</div>
		</div>

	</div>

	<div class="bayern_vboxes_right">

		<div class="bayern_dragvbox" id="item_4">
			<h2 class="">Teilversorgung - Psychosoziale Beratung und Begleitung</h2>
			<div   id="grow4" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
				<table class="bayern_sapvfb3_table">
					<tr>
						<td  width="95%"><label  for="cbx_40" >Krankheitsbewältigung</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_40"  value="40" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Krankheitsbewältigung','<?php echo $this->cat4;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('40',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_40"  value="40" name="symptom[]" onclick="saveCheckboxes(this,'Krankheitsbewältigung','<?php echo $this->cat4;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_41" >Unterstützung in akuten Krisen</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_41"  value="41" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Unterstützung in akuten Krisen','<?php echo $this->cat4;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('41',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_41"  value="41" name="symptom[]" onclick="saveCheckboxes(this,'Unterstützung in akuten Krisen','<?php echo $this->cat4;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_42" >Situation der Angehörigen/ Bezugspersonen</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_42"  value="42" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Situation der Angehörigen/ Bezugspersonen','<?php echo $this->cat4;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('42',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_42"  value="42" name="symptom[]" onclick="saveCheckboxes(this,'Situation der Angehörigen/ Bezugspersonen','<?php echo $this->cat4;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_43" >Familienkonferenz</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_43"  value="43" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Familienkonferenz','<?php echo $this->cat4;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('43',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_43"  value="43" name="symptom[]" onclick="saveCheckboxes(this,'Familienkonferenz','<?php echo $this->cat4;?>')" />
							<?php endif;?>
						</td>
					</tr>
				</table>
				</div>
			</div>
		</div>

		<div class="bayern_dragvbox" id="item_6">
			<h2 class="">Teilversorgung - Ethisch-rechtliche Beratung</h2>
			<div   id="grow6" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
					<table class="bayern_sapvfb3_table">
						<tr>
							<td  width="95%"><label  for="cbx_46" >Selbstbestimmung und Patientenverfügung</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_46"  value="46" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Selbstbestimmung und Patientenverfügung','<?php echo $this->cat6;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('46',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_46"  value="46" name="symptom[]" onclick="saveCheckboxes(this,'Selbstbestimmung und Patientenverfügung','<?php echo $this->cat6;?>')" />
							<?php endif;?>
						</td>
						</tr>
						<tr class="bayern_box_alt">
							<td><label  for="cbx_63" >palliative Sedierung</label></td>
							<td>
								<?php if( is_array($this->sapvalarr)):?>
		     						<input type="checkbox" id="cbx_63"  value="63" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'palliative Sedierung','<?php echo $this->cat6;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('63',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
								<?php else :?>
									<input type="checkbox" id="cbx_63"  value="63" name="symptom[]" onclick="saveCheckboxes(this,'palliative Sedierung','<?php echo $this->cat6;?>')" />
								<?php endif;?>
							</td>
						</tr>
						<tr>
							<td><label  for="cbx_64" >Indikationsänderung</label></td>
							<td>
								<?php if( is_array($this->sapvalarr)):?>
									<input type="checkbox" id="cbx_64" value="64" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Indikationsänderung','<?php echo $this->cat6;?>', <?php echo $this->sapv_id ;?> )"    <?php if(in_array('64',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
								<?php else :?>
									<input type="checkbox" id="cbx_64" value="64" name="symptom[]" onclick="saveCheckboxes(this,'Indikationsänderung','<?php echo $this->cat6;?>');">
								<?php endif;?>
							</td>
						</tr>

					</table>
				</div>
			</div>
		</div>

		<div class="bayern_dragvbox" id="item_7">
			<h2 class="">Teilversorgung - Unterstützung in der Trauer</h2>
			<div  id="grow7" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
					<table class="bayern_sapvfb3_table">
						<tr>
							<td  width="95%"><label  for="cbx_51" >Unterstützung der Hinterbliebenen nach dem Tod</label></td>
							<td>
								<?php if( is_array($this->sapvalarr)):?>
		     						<input type="checkbox" id="cbx_51"  value="51" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Unterstützung der Hinterbliebenen nach dem Tod','<?php echo $this->cat7;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('51',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
								<?php else :?>
									<input type="checkbox" id="cbx_51"  value="51" name="symptom[]" onclick="saveCheckboxes(this,'Unterstützung der Hinterbliebenen nach dem Tod','<?php echo $this->cat7;?>')" />
								<?php endif;?>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>

		<div class="bayern_dragvbox" id="item_8">
			<h2 class="">Vollversorgung - Palliativmedizinische Leistungen</h2>
			<div  id="grow8" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
					<table class="bayern_sapvfb3_table">
						<tr>
							<td  width="95%"><label  for="cbx_53" >Schmerzpumpe: Anlage / Einstellung</label></td>
							<td width="5%">
								<?php if( is_array($this->sapvalarr)):?>
									<input type="checkbox" id="cbx_53" value="53" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Schmerzpumpe: Anlage / Einstellung','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('53',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
								<?php else :?>
									<input type="checkbox" id="cbx_53" value="53" name="symptom[]" onclick="saveCheckboxes(this,'Schmerzpumpe: Anlage / Einstellung','<?php echo $this->cat8;?>');">
								<?php endif;?>
							</td>
						</tr>
						<tr class="bayern_box_alt">
							<td><label  for="cbx_60" >Versorgung Port – zentraler Zugang</label></td>
							<td>
								<?php if( is_array($this->sapvalarr)):?>
									<input type="checkbox" id="cbx_60" value="60" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Versorgung Port – zentraler Zugang','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('60',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
								<?php else :?>
									<input type="checkbox" id="cbx_60" value="60" name="symptom[]" onclick="saveCheckboxes(this,'Versorgung Port – zentraler Zugang','<?php echo $this->cat8;?>');">
								<?php endif;?>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>

	</div>

</div>

<br style="clear: both;"/>

			<div class="bayern_dragvbox" id="item_8">
			<h2 style="width: 98.7%;"> + Leistungserfassung</h2>
			<div  id="grow8" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
				<table width="100%"> 
				<tr>
				<td  width="50%">
					<table class="bayern_sapvfb3_table  more_sapvfb3">
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th colspan="2">Beratung - Einsatzort / -art</th>
					</tr>
					<tr>
						<td  width="85%"><label for="cbx_4" >Besuch in Arztpraxis</label></td>
						<td  width="15%">
								<?php if( is_array($this->sapvalarr)):?>
		     						<input type="checkbox" id="cbx_4"  value="4" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Besuch in Arztpraxis','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('4',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
								<?php else :?>
									<input type="checkbox" id="cbx_4"  value="4" name="symptom[]" onclick="saveCheckboxes(this,'Besuch in Arztpraxis','<?php echo $this->cat1;?>')" />
								<?php endif;?>
							</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_5" >Beratung im Büro</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_5"  value="5" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Beratung im Büro','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('5',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_5"  value="5" name="symptom[]" onclick="saveCheckboxes(this,'Beratung im Büro','<?php echo $this->cat1;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th colspan="2">Koordination - Absprache mit/ Beratung von  FachkollegInnen</th>
					</tr>
					<tr>
						<td><label  for="cbx_13" >soziale Dienste</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_13"  value="13" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'soziale Dienste','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('13',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_13"  value="13" name="symptom[]" onclick="saveCheckboxes(this,'soziale Dienste','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_14" >ehrenamtliche HospizhelferIn</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_14"  value="14" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'ehrenamtliche HospizhelferIn','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('14',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_14"  value="14" name="symptom[]" onclick="saveCheckboxes(this,'ehrenamtliche HospizhelferIn','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_15" >therapeutische Hilfen</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_15"  value="15" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'therapeutische Hilfen','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('15',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_15"  value="15" name="symptom[]" onclick="saveCheckboxes(this,'therapeutische Hilfen','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_16" >seelsorgerliche Fachstelle</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_16"  value="16" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'seelsorgerliche Fachstelle','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('16',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_16"  value="16" name="symptom[]" onclick="saveCheckboxes(this,'seelsorgerliche Fachstelle','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_17" >sozial-rechtliche Beratung</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_17"  value="17" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'sozial-rechtliche Beratung','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('17',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_17"  value="17" name="symptom[]" onclick="saveCheckboxes(this,'sozial-rechtliche Beratung','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_18" >fachliche Nacht- bzw. Sitzwache</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_18"  value="18" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'fachliche Nacht- bzw. Sitzwache','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('18',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_18"  value="18" name="symptom[]" onclick="saveCheckboxes(this,'fachliche Nacht- bzw. Sitzwache','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th colspan="2">Teilversorgung - palliativärztlich-pflegerische Maßnahmen</th>
					</tr>
					<tr>
						<td><label  for="cbx_29"><b>Flüssigkeit und Ernährung</b><br/><span>enterale Ernährung</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_29" value="29" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Flüssigkeit und Ernährung','<?php echo $this->cat3;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('29',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_29" value="29" name="symptom[]" onclick="saveCheckboxes(this,'Flüssigkeit und Ernährung','<?php echo $this->cat3;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr  class="bayern_box_alt">
						<td><label  for="cbx_30" ><span>parenterale Ernährung</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_30" value="30" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'parenterale Ernährung','<?php echo $this->cat3;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('30',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_30" value="30" name="symptom[]" onclick="saveCheckboxes(this,'parenterale Ernährung','<?php echo $this->cat3;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr >
						<td><label  for="cbx_32" ><b>Dauerkatheter, Magensonde</b> Anlage / Wechsel</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_32" value="32" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Dauerkatheter, Magensonde Anlage / Wechsel','<?php echo $this->cat3;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('32',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_32" value="32" name="symptom[]" onclick="saveCheckboxes(this,'Dauerkatheter, Magensonde Anlage / Wechsel','<?php echo $this->cat3;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr  class="bayern_box_alt">
						<td><label  for="cbx_33" ><b>Beratung zur Pflege/Anleitung Pflege</b></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_33"  value="33" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Beratung zur Pflege/Anleitung Pflege','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('33',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_33"  value="33" name="symptom[]" onclick="saveCheckboxes(this,'Beratung zur Pflege/Anleitung Pflege','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th colspan="2">Teilversorgung - Sozialrechtliche Beratung</th>
					</tr>
					<tr>
						<td><label  for="cbx_44" >selbst erbracht</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_44"  value="44" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'selbst erbracht','<?php echo $this->cat5;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('44',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_44"  value="44" name="symptom[]" onclick="saveCheckboxes(this,'selbst erbracht','<?php echo $this->cat5;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_45" >Vermittlung Fachstelle</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_45" value="45" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Vermittlung Fachstelle','<?php echo $this->cat5;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('45',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_45" value="45" name="symptom[]" onclick="saveCheckboxes(this,'Vermittlung Fachstelle','<?php echo $this->cat5;?>');">
							<?php endif;?>
						</td>
					</tr>

					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					</table>
					</td>
					<td  width="50%">
					<table class="bayern_sapvfb3_table  more_sapvfb3" style="padding:0px; width: 355px!important;">
					<tr>
						<td width="85%">&nbsp;</td>
						<td  width="15%">&nbsp;</td>
					</tr>

					<tr>
						<th colspan="2">Teilversorgung - Ethisch-rechtliche Beratung</th>
					</tr>
					<tr>
						<td width="85%"><label  for="cbx_47" >Gesetzliche Vertretung</label></td>
						<td width="15%">
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_47"  value="47" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Gesetzliche Vertretung','<?php echo $this->cat6;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('47',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_47"  value="47" name="symptom[]" onclick="saveCheckboxes(this,'Gesetzliche Vertretung','<?php echo $this->cat6;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_48" >Erstellung individueller Verfügungen</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_48"  value="48" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Erstellung individueller Verfügungen','<?php echo $this->cat6;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('48',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_48"  value="48" name="symptom[]" onclick="saveCheckboxes(this,'Erstellung individueller Verfügungen','<?php echo $this->cat6;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_49" >Ethische Konfliktsituation</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_49"  value="49" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Ethische Konfliktsituation','<?php echo $this->cat6;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('49',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_49"  value="49" name="symptom[]" onclick="saveCheckboxes(this,'Ethische Konfliktsituation','<?php echo $this->cat6;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_50" >PEG als lebensverlängernde Maßnahme</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_50"  value="50" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'PEG als lebensverlängernde Maßnahme','<?php echo $this->cat6;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('50',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_50"  value="50" name="symptom[]" onclick="saveCheckboxes(this,'PEG als lebensverlängernde Maßnahme','<?php echo $this->cat6;?>')" />
							<?php endif;?>
						</td>
					</tr>

					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th colspan="2">Teilversorgung - Unterstützung in der Trauer</th>
					</tr>
					<tr>
						<td class="brd_bottom"><label  for="cbx_52" >Vermittlung in Trauerbegleitung</label></td>
						<td class="brd_bottom">
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_52" value="52" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Vermittlung in Trauerbegleitung','<?php echo $this->cat7;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('52',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_52" value="52" name="symptom[]" onclick="saveCheckboxes(this,'Vermittlung in Trauerbegleitung','<?php echo $this->cat7;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th colspan="2">Vollversorgung - Palliativmedizinische Leistungen</th>
					</tr>
					<tr>
						<td><label  for="cbx_54" >Pleurapunktion</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_54" value="54" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Pleurapunktion','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('54',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_54" value="54" name="symptom[]" onclick="saveCheckboxes(this,'Pleurapunktion','<?php echo $this->cat8;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_55" >Aszitespunktion</label></td>
						<td>
							<?php if( is_array($this->sapvalarr) && in_array('55',$this->sapvalarr)):?>
								<input type="checkbox" id="cbx_55" value="55" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Aszitespunktion','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('55',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_55" value="55" name="symptom[]" onclick="saveCheckboxes(this,'Aszitespunktion','<?php echo $this->cat8;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_56" >Transfusion</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_56" value="56" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Transfusion','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('56',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_56" value="56" name="symptom[]" onclick="saveCheckboxes(this,'Transfusion','<?php echo $this->cat8;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_57" >Medikamente epidural, intrathekal</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_57" value="57" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Medikamente epidural, intrathekal','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('57',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_57" value="57" name="symptom[]" onclick="saveCheckboxes(this,'Medikamente epidural, intrathekal','<?php echo $this->cat8;?>');">
							<?php endif;?>
						</td>
					</tr>

					<tr>
						<td><label  for="cbx_58" >Sonographie</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_58" value="58" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Sonographie','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('58',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_58" value="58" name="symptom[]" onclick="saveCheckboxes(this,'Sonographie','<?php echo $this->cat8;?>');">
							<?php endif;?>
						</td>
					</tr>

					</table>
					</td>
					</tr>
					</table>
				</div>
			</div>
		</div>
 </div>
 </div>
 <!--  ############################################################################## -->
<?php endif; ?>
 
 
 
 
 
 
 
 
 
 
<?php $blockname="lmu_pmba_psysoz"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  ##### LMU Palliativmedizinisches Basisassesment Psychosoziale Anamnese ####### -->
 <!--  ############################################################################## -->
 	<?php $f_values = $this->patient_lmu_pmba_psysoz_values; ?>
 	
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + Psychosoziale Anamnese</h2>
		<div class="contactform_dragvbox_content" id="grow2"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($f_values['patient_lmu_pmba_psysoz_value_empty'] != '1'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
		<h3>Familie und soziale Strukturen</h3>
			<table >
			<tr>
				<th width="200px" style="vertical-align:top;">					
					<b>Verwandtschaftsgrad</b>
				</th>
				<th width="40px" style="vertical-align:top;">					
					<b>Alter</b>
				</th>
				<th width="360px" style="vertical-align:top;">					
					<b>Bemerkung</b>
				</th>
				<th width="30px" style="vertical-align:top; align:center;">					
					<b>†</b>
				</th>
				<th width="100px" style="vertical-align:top;">					
					<b>Kontakt</b>
				</th>
			</tr>
			
			<?php $sections = array('vater'=>'Vater', 'mutter'=>'Mutter', 'partner'=>'Partner/in');?>
			<?php foreach ($sections as $fkey => $fvalue):?>
			<tr <?php if($fvalue=="Geschwister" || $fvalue=="Kinder") echo 'style="border-top:1px solid lightgrey;"';?>>
				<td>
					<b><?php echo $fvalue;?></b>
				</td>
				<td>
					<input type="text" style="width:20px;" name="<?php echo $blockname;?>[<?php echo $fkey;?>_age]"  value="<?php echo $f_values[$fkey . '_age'];?>"/>
				</td>
				<td>
					<input type="text" style="width:340px;"  name="<?php echo $blockname;?>[<?php echo $fkey;?>_note]" value="<?php echo $f_values[$fkey . '_note'];?>"/>
				</td>
				<td>
					<input type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_died]" <?php if ($f_values[$fkey . '_died']) echo "checked";?> value="1" />
				</td>
				<td>
					<input class="link_contacty_with_contactn" type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_contacty]" <?php if ($f_values[$fkey . '_contacty']) echo "checked";?> value="1" /> Ja &nbsp; &nbsp;
					<input class="link_contacty_with_contactn"  type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_contactn]" <?php if ($f_values[$fkey . '_contactn']) echo "checked";?> value="1" /> Nein
				</td>
			</tr>
			<?php endforeach;?>
			
			
			<script>
			function checkboxtoinput(elem){
				var cbv = $(elem).attr('checked');
				$(elem).prev().val(0);
				if (cbv=="checked") $(elem).prev().val(1);
				return;
				}
			function pmbapsysozmultiline(cname){
					var emptyrows=0;
					$('.'+cname).each(function(){
						var text="";
						$(this).find('input').each(function(){

							if($(this).attr('type')=='checkbox'){
								if($(this).attr('checked') == "checked") text=text+'X';
								} 
							else {
								text = text + $(this).val();			
								}
							});
						if (text=="") emptyrows++;
						});
					if(emptyrows==0){
						var newele = $('.'+cname+':last').clone();

						$('.'+cname+':last').after(newele);
						$(newele).find('input').each(function(){
							if($(this).attr('type')=='checkbox'){
								$(this).removeAttr('checked');
								} 
							else {
								$(this).val('');			
								}
							$(this).change(function(){pmbapsysozmultiline(cname)});
							});
						}
						

					}
					
				$(document).ready(function(){
		
				$('.multiline_geschwister input').change(function(){pmbapsysozmultiline('multiline_geschwister')});
				$('.multiline_kinder input').change(function(){pmbapsysozmultiline('multiline_kinder')});
				});

			</script>

			<?php $sections = array('geschwister'=>'Geschwister', 'kinder'=>'Kinder');//, 'geschwister2'=>'','geschwister3'=>'', 'kinder1'=>'Kinder', 'kinder2'=>'', 'kinder3'=>'');?>
			<?php foreach ($sections as $fkey => $fvalue):?>
			<?php $maxcount = max(count($f_values[$fkey . '_age']),3);?>
			<?php for ($ikey=0; $ikey < $maxcount; $ikey++):?>
			<tr class="multiline_<?php echo $fkey;?>" <?php if($ikey==0) echo 'style="border-top:1px solid lightgrey;"';?>>
				<td>
					<b><?php echo $fvalue;?></b>
				</td>
				<td>
					<input type="text" style="width:20px;" name="<?php echo $blockname;?>[<?php echo $fkey;?>_age][]"  value="<?php echo $f_values[$fkey . '_age'][$ikey];?>"/>
				</td>
				<td>
					<input type="text" style="width:340px;"  name="<?php echo $blockname;?>[<?php echo $fkey;?>_note][]" value="<?php echo $f_values[$fkey . '_note'][$ikey];?>"/>
				</td>
				<td>
					<input type="hidden" name="<?php echo $blockname;?>[<?php echo $fkey;?>_died][]" value=<?php if ($f_values[$fkey . '_died'][$ikey]){echo "1";}else{echo "0";};?> />
					<input type="checkbox" onchange="checkboxtoinput(this);" <?php if ($f_values[$fkey . '_died'][$ikey]) echo "checked";?> />
				</td>
				<td>
					<input type="hidden" name="<?php echo $blockname;?>[<?php echo $fkey;?>_contacty][]" value=<?php if ($f_values[$fkey . '_contacty'][$ikey]){echo "1";}else{echo "0";};?> />
					<input class="link_contacty_with_contactn" type="checkbox" onchange="checkboxtoinput(this)" <?php if ($f_values[$fkey . '_contacty'][$ikey]) echo "checked";?>  /> Ja &nbsp; &nbsp;
					<input type="hidden" name="<?php echo $blockname;?>[<?php echo $fkey;?>_contactn][]" value=<?php if ($f_values[$fkey . '_contactn'][$ikey]){echo "1";}else{echo "0";};?> />
					<input class="link_contacty_with_contactn" type="checkbox" onchange="checkboxtoinput(this)" <?php if ($f_values[$fkey . '_contactn'][$ikey]) echo "checked";?>  /> Nein
				</td>
			</tr>
			<?php endfor;?>			
			<?php endforeach;?>	
			</table>

		<h3>Beruf/Interessen/Kontext</h3>
		<textarea class="textarea_full" name="<?php echo $blockname;?>[beruf]" style="vertical-align:top;"><?php echo $f_values['beruf'];?></textarea>
      
		<h3>Psychosozialer Status</h3>
				<table style="width:100%;">
			<tr>
				<?php $fkey="wohnsituation";?>
				<td style="width:200px;">
					<b>Wohnsituation</b>
				</td>
				<td>
					<input type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_allein]" <?php if ($f_values[$fkey . '_allein']) echo "checked";?> value="1" /> allein &nbsp;
					<input type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_angehoerige]" <?php if ($f_values[$fkey . '_angehoerige']) echo "checked";?> value="1" /> mit Angehörigen &nbsp;
					<input type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_Zuhause]" <?php if ($f_values[$fkey . '_Zuhause']) echo "checked";?> value="1" /> Zuhause &nbsp;
					<input type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_Pflegeheim]" <?php if ($f_values[$fkey . '_Pflegeheim']) echo "checked";?> value="1" /> Pflegeheim
				</td>
 
			</tr>
            
            
            
            
            
            
            
            
            
            
            
            <!-- this is ACP start -->
            
			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey="Patientenverfuegung";?>
				<td style="width:200px;">
					<b>Patientenverfügung</b>
				</td>
				<td>
                <?=$this->formHidden("PatientAcp[living_will][division_tab]", 'living_will')?>
                <?=$this->formHidden("PatientAcp[living_will][id]", $f_values['PatientAcp']['saved_values']['living_will']['id'])?>
                <?=$this->formSelect("PatientAcp[living_will][active]", $f_values['PatientAcp']['saved_values']['living_will']['active'], array(), $f_values['PatientAcp']['select_options'])?>
                    <?php if ( ! 1) : ?>
                    <!-- 
                    
                    <select name="<?php echo $blockname;?>[<?php echo $fkey;?>_verfuegung]" >
                        <?php $verbs = array( 'nicht bekannt', 'Vorhanden', 'nicht vorhanden', 'geplant','abgelehnt');
            foreach ($verbs as $key=>$val):?>
                        <?php
								$selected='';
								if ($f_values[$fkey.'_verfuegung'] ==  $val) $selected='selected';
							?>
                        <option <?php echo $selected;?> ><?php echo $val;?></option>
                        <?php endforeach; ?>
                    </select>
                     -->
                     <?php endif; ?>
                </td>
 
			</tr>


            <?php $acp_contactpersons = [''=>''] + array_column($this->patientMasterData['ContactPersonMaster'], 'nice_name', 'id');?>

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey="Vorsorgevollmacht";?> 
				<td style="width:200px;">
					<b>Vorsorgevollmacht</b>
				</td>
				<td>
                    <?=$this->formHidden("PatientAcp[healthcare_proxy][division_tab]", 'healthcare_proxy')?>
                    <?=$this->formHidden("PatientAcp[healthcare_proxy][id]", $f_values['PatientAcp']['saved_values']['healthcare_proxy']['id'])?>
                    <?=$this->formSelect("PatientAcp[healthcare_proxy][active]", $f_values['PatientAcp']['saved_values']['healthcare_proxy']['active'], array(), $f_values['PatientAcp']['select_options'])?>
                <?php if ( ! 1) : ?>
                <!-- 
                <select name="<?php echo $blockname;?>[<?php echo $fkey;?>_vollmacht]" >
                    <?php $verbs = array( 'nicht bekannt', 'Vorhanden', 'nicht vorhanden', 'geplant','abgelehnt');
            foreach ($verbs as $key=>$val):?>
                    <?php
								$selected='';
								if ($f_values[$fkey.'_vollmacht'] ==  $val) $selected='selected';
							?>
                    <option <?php echo $selected;?> ><?php echo $val;?></option>
                    <?php endforeach; ?>
                </select>
                 -->
                 <?php endif; ?>
                    <table class="psysoz_cntperson" width="100%">
                        <tr>
                            <td></td>
                            <td>Kontaktperson:
                                <?=$this->formSelect("PatientAcp[healthcare_proxy][contactperson_master_id]", $f_values['PatientAcp']['saved_values']['healthcare_proxy']['contactperson_master_id'], array(), $acp_contactpersons)?>
                            <?php if ( ! 1) : ?>
                            <!-- 
                                <select class="psysoz_selectcntperson" name="<?php echo $blockname;?>[<?php echo $fkey;?>_selectedname]">
                                    <option>Auswählen</option>
                                    <?php if($f_values[$fkey . '_selectedname']):?>
                                        <option selected><?php echo $f_values[$fkey . '_selectedname'];?></option>
                                    <?php endif;?>
                                    <?php if((!$f_values[$fkey . '_selectedname']) && $f_values[$fkey . '_last_name']):?>
                                        <option selected><?php echo $f_values[$fkey . '_first_name'] .  " " . $f_values[$fkey . '_last_name'];?></option>
                                    <?php endif;?>
                                </select>
                             -->
                            <?php endif; ?>
                             
                            </td>
                        </tr>
                    </table>


				</td>
 
			</tr>
			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey="betreuung";?>
				<td style="width:200px;">
					<b>Betreuung</b> 
				</td>
				<td>
                    <?=$this->formHidden("PatientAcp[care_orders][division_tab]", 'care_orders')?>
                    <?=$this->formHidden("PatientAcp[care_orders][id]", $f_values['PatientAcp']['saved_values']['care_orders']['id'])?>
                    <?=$this->formSelect("PatientAcp[care_orders][active]", $f_values['PatientAcp']['saved_values']['care_orders']['active'], array(), $f_values['PatientAcp']['select_options'])?>
                <?php if ( ! 1) : ?>
                <!-- 
                <select name="<?php echo $blockname;?>[<?php echo $fkey;?>_betreuung]" >
                    <?php $verbs = array( 'nicht erforderlich/bekannt', 'Vorhanden', 'nicht vorhanden', 'angeregt/geplant','abgelehnt');
            foreach ($verbs as $key=>$val):?>
                    <?php
								$selected='';
								if ($f_values[$fkey.'_betreuung'] ==  $val) $selected='selected';
							?>
                    <option <?php echo $selected;?> ><?php echo $val;?></option>
                    <?php endforeach; ?>
                </select>
                 -->
                 <?php endif; ?>
                    <table class="psysoz_cntperson" width="100%">
                        <tr>
                            <td></td>
                            <td>Kontaktperson:
                                <?=$this->formSelect("PatientAcp[care_orders][contactperson_master_id]", $f_values['PatientAcp']['saved_values']['care_orders']['contactperson_master_id'], array(), $acp_contactpersons)?>
                                <?php if ( ! 1) : ?>
                                <!--
                                <select class="psysoz_selectcntperson" name="<?php echo $blockname;?>[<?php echo $fkey;?>_selectedname]">
                                    <option>Auswählen</option>
                                    <?php if($f_values[$fkey . '_selectedname']):?>
                                        <option selected><?php echo $f_values[$fkey . '_selectedname'];?></option>
                                    <?php endif;?>
                                    <?php if((!$f_values[$fkey . '_selectedname']) && $f_values[$fkey . '_last_name']):?>
                                        <option selected><?php echo $f_values[$fkey . '_first_name'] .  " " . $f_values[$fkey . '_last_name'];?></option>
                                    <?php endif;?>
                                </select>
                                -->
                                <?php endif; ?>
                            </td>
                        </tr>
                    </table>

				</td>
 
			</tr>
            <!-- this is ACP end -->
            
            
            
            
            
            
            
			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey="Pflegestufe";?>
				<td style="width:200px;">
					<b><?php echo $this->translate('carelevel'); ?></b>
				</td>
				<td>
                <?php if ( ! 1) : ?>
				<!-- 
					<select name="<?php echo $blockname;?>[<?php echo $fkey;?>_stufe]" >
						<?php $verbs = array('Keine Pflegestufe', 'Pflegestufe 0', 'Pflegestufe 1', 'Pflegestufe 2','Pflegestufe 3','Pflegestufe 3+');
						foreach ($verbs as $key=>$val):?>
							<?php
								$selected='';
								if ($f_values[$fkey.'_stufe'] ==  $val) $selected='selected';
							?>
							<option <?php echo $selected;?> ><?php echo $val;?></option>
						<?php endforeach; ?>
					</select>
				 -->
                 <?php endif; ?>	
					<?php
				 	
				 	$verbs = PatientMaintainanceStage::get_MaintainanceStage_array();
					echo $this->formSelect($blockname . "[" . $fkey . "_stufe]", $f_values[$fkey.'_stufe'] , null, $verbs);
					
					?>
					
					
					&nbsp;
					<input type="checkbox" value="1" style="margin-top:0px;vertical-align:middle;" name="<?php echo $blockname;?>[<?php echo $fkey;?>_hoeher]" <?php if ($f_values[$fkey.'_hoeher'] ==  1) echo 'checked="checked"';?> > Höherstufung beantragt &nbsp;&nbsp;
                    <input type="checkbox" value="1" style="margin-top:0px;vertical-align:middle;" name="<?php echo $blockname;?>[<?php echo $fkey;?>_neuantrag]" <?php if ($f_values[$fkey.'_neuantrag'] ==  1) echo 'checked="checked"';?> > Erstantrag

                </td>
 
			</tr>
			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey="Hilfsmittelversorgung";?>
				<td style="width:200px;">
				  <b>Hilfsmittelversorgung</b>
				</td>
				<td>
					<textarea style="width:375px; vertical-align:top;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
 
			</tr>
 
            <tr style="border-top:1px solid lightgrey;">
                <?php $fkey="wunschsterbeort";?>
                <td style="width:200px;">
                    <b>Wunschsterbeort</b>
                </td>
                <td>
                    <select name="<?php echo $blockname;?>[<?php echo $fkey;?>_val]">
                      <?php if(!empty($f_values[$fkey.'_val']) && !in_array($f_values[$fkey.'_val'],$this->list_sterbeort)):
                    	$this->list_sterbeort[] = $f_values[$fkey.'_val'];
						endif;
                     ?>
                        <?php foreach ($this->list_sterbeort as $sterbeort):?>
                            <?php
                            $selected='';
                            if ($f_values[$fkey.'_val'] ==  $sterbeort) $selected='selected';
                            ?>
                            <option <?php echo $selected;?>><?php echo $sterbeort;?></option>
                        <?php endforeach;?>
                    </select>
                </td>
 
            </tr>
 
            <tr style="border-top:1px solid lightgrey;">
                <?php $fkey="memopsysoz";?>
                <td style="width:200px;vertical-align:top;padding-top:5px;">
                    <b>Anmerkungen</b>
                </td>
                <td>
                    <textarea  style="width:100%; height:100px;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
                </td>
                <td style="width:140px;">

                </td>
            </tr>
			</table>
			<br/>
			
			

        <h3>Lebenshintergrund</h3>
                <script>
            function lh_pseudoradio(elem){
                var thisboxval=$(elem).val();

                if(($(elem)).attr('checked')){
                    if(thisboxval=="1"){
                        $(elem).parent().find('input[type="text"]').val('').show();
                    } else{
                        $(elem).parent().find('input[type="text"]').hide();
                    }
                }

            }
        </script>
        <table style="border:none; width:100%;">
            <tr>
                <td style="width:200px;">
                    <b>Migrationshintergrund: </b>
                </td>
                <td>
                    <input type="radio" name="<?php echo $blockname;?>[migrationshintergrund]"  <?php if ($f_values['migrationshintergrund']=="1") echo "checked";?> value="1" onchange="lh_pseudoradio(this)"> Ja
                    <?php
                    $disp="display:none;";
                    if( $f_values['migrationshintergrund']=="1") $disp="";
                    ?>
                    <input type="text" name="<?php echo $blockname;?>[migrationshintergrund_freetext]"  value="<?php echo $f_values['migrationshintergrund_freetext'];?>" style="width:200px;<?php echo $disp;?>">
                    <br/>
                    <input type="radio" name="<?php echo $blockname;?>[migrationshintergrund]"  <?php if ($f_values['migrationshintergrund']=="2") echo "checked";?> value="2" onchange="lh_pseudoradio(this)"> Nein
                </td>
                <td style="width:140px;">

                </td>
            </tr>
            <tr>
                <td>
                    <b>Dolmetscher nötig: </b>
                </td>
                <td>
                    <input type="radio" name="<?php echo $blockname;?>[dolmetscher]"  <?php if ($f_values['dolmetscher']=="1") echo "checked";?>  value="1" onchange="lh_pseudoradio(this)"> Ja

                    <?php
                    $disp="display:none;";
                    if( $f_values['dolmetscher']=="1") $disp="";
                    ?>

                    <input type="text" name="<?php echo $blockname;?>[dolmetscher_freetext]"  value="<?php echo $f_values['dolmetscher_freetext'];?>" style="width:200px;<?php echo $disp;?>">
                    <br/>
                    <input type="radio" name="<?php echo $blockname;?>[dolmetscher]"  <?php if ($f_values['dolmetscher']=="2") echo "checked";?>  value="2"  onchange="lh_pseudoradio(this)"> Nein
                </td>
            </tr>
            <tr>
                <td>
                    <b>Religionszugehörigkeit: </b>
                </td>
                <td>
                    <script>
                        function lh_showandere(elem){
                            if($(elem).val() == "7"){
                                $(elem).parent().find('input[type="text"]').show();
                            } else{
                                $(elem).parent().find('input[type="text"]').hide();
                            }
                        }
                    </script>

					<?php echo $this->formSelect($blockname.'[religion]', $f_values['religion'], array ('onchange' => 'lh_showandere(this)'), $this->religions); ?>
                    <?php
                    $disp="display:none;";
                    if( $f_values['religion'] == "7") $disp="";
                    ?>
                    <input type="text" name="<?php echo $blockname;?>[religion_freetext]" value="<?php echo $f_values['religion_freetext'];?>" style="width:180px;<?php echo $disp;?>">
                </td>
                <td>

                </td>
            </tr>
        </table>
			</div>
	</div>

<!--  ############################################################################## -->
<?php endif;?>	

 
<?php $blockname="time_division"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
<?php $time_division_values = $this->time_division_block[0];?>
 <!--  ############################################################################## -->
 <!--  ##### time_division_block START ####### -->
 <!--  ############################################################################## -->
<style>
	.time_division_error {
		border-color :#FF0000;
	}
	.yellow_bg{
		background-color: #ffffe0;
	}
</style>
<script type="text/javascript">

$(document).ready(function(){
	
	<?php if(!isset($time_division_values['remain'])) :?>
	$('#time_division_remain').val(calculate_time_diff());
	<?php endif; ?>
	var old_minutes = [];
	old_minutes['time_division_on_patient'] = <?php if(isset($time_division_values['on_patient'])) echo $time_division_values['on_patient'];else echo '0' ; ?>;
	old_minutes['time_division_relatives'] = <?php if(isset($time_division_values['relatives'])) echo $time_division_values['relatives'];else echo '0' ; ?>;
	old_minutes['time_division_systemic'] = <?php if(isset($time_division_values['systemic'])) echo $time_division_values['systemic'];else echo '0' ; ?>;
	old_minutes['time_division_professional'] = <?php if(isset($time_division_values['professional'])) echo $time_division_values['professional'];else echo '0' ; ?>;

	$( "#begin_date_h, #begin_date_m, #end_date_h, #end_date_m" ).bind( "change", function() {
		var minutes = calculate_time_diff();
		$('#time_division_remain').val(minutes);
		old_minutes['time_division_on_patient']=0;
		old_minutes['time_division_relatives']=0;
		old_minutes['time_division_systemic']=0;
		old_minutes['time_division_professional']=0;
		$("input[id=time_division_on_patient], input[id=time_division_relatives], input[id=time_division_systemic], input[id=time_division_professional]")
			.trigger( "change" );
		
	});
	
	$('#time_division_table tr')
		.focusin(function() {$(this).addClass("yellow_bg")})
		.focusout(function() {$(this).removeClass("yellow_bg")});
	
	$("input[id=time_division_on_patient], input[id=time_division_relatives], input[id=time_division_systemic], input[id=time_division_professional]")
		.click(function (){
			if($(this).val() == "0")$(this).val("");
			//$(this).parent().parent().addClass("yellow_bg");
		})
		.keydown(function (e) {
			// Allow: backspace, delete, tab, escape, enter and .
			if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
				// Allow: home, end, left, right
				(e.keyCode >= 35 && e.keyCode <= 39)) 
			{
				// let it happen, don't do anything
				return;
			}
			// Ensure that it is a number and stop the keypress
			if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
				e.preventDefault();
			}
    	})
		.change(function() {
			var minutes = calculate_time_diff();	
			var minutes_spent = 0;
			//$(this).parent().parent().removeClass("yellow_bg");
			$("input[id=time_division_on_patient], input[id=time_division_relatives], input[id=time_division_systemic], input[id=time_division_professional]")
				.map(function(idx, elem) {
					minutes_spent = minutes_spent+ (parseInt($(elem).val()) || 0);
				})
				.get();
			if((minutes - minutes_spent)>=0){//time OK
				$('#time_division_remain').val(minutes - minutes_spent);
				old_minutes[$(this).attr('id')] = $(this).val();
				$(this).removeClass("time_division_error");
			}else{//time BAD too much time			
				$(this)
					.val( old_minutes[$(this).attr('id')])
					.addClass("time_division_error")
					.delay(800).queue(function(next){
						$(this).removeClass("time_division_error").dequeue();
					});
				$('#time_division_remain')
					.addClass("time_division_error")
					.delay(1000).queue(function(next){
						$(this).removeClass("time_division_error").dequeue();	
					});
			}		
		});
});
</script>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + <?php echo $this->translate('lang_block_time_division_title');  ?></h2>
		<div class="contactform_dragvbox_content" id="time_division_block"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($time_division_values)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table id="time_division_table" class="datatable table-striped" style="width:100%">	
			<tr>
				<td width="120px"><?php echo $this->translate('lang_block_time_division_on_patient'); ?></td>
				<td width="60px"><input type="text" size="6" id="time_division_on_patient"  name="<?php echo $blockname;?>[on_patient]" value="<?php if(is_numeric($time_division_values['on_patient'])){echo (int)($time_division_values['on_patient']);} else {echo "0"; }?>"></td>
				<td><?php echo $this->translate('minutes'); ?></td>
			</tr>				
			<tr>
				<td><?php echo $this->translate('lang_block_time_division_relatives'); ?></td>
				<td><input type="text" size="6" id="time_division_relatives" name="<?php echo $blockname;?>[relatives]" value="<?php if(is_numeric($time_division_values['relatives'])){echo (int)($time_division_values['relatives']);} else {echo "0"; }?>"></td>
				<td><?php echo $this->translate('minutes'); ?></td>
			</tr>			
			<tr>
				<td><?php echo $this->translate('lang_block_time_division_systemic'); ?></td>
				<td><input type="text" size="6" id="time_division_systemic" name="<?php echo $blockname;?>[systemic]" value="<?php if(is_numeric($time_division_values['systemic'])){echo (int)($time_division_values['systemic']);} else {echo "0"; }?>"></td>
				<td><?php echo $this->translate('minutes'); ?></td>
			</tr>	
			<tr>
				<td><?php echo $this->translate('lang_block_time_division_professional'); ?></td>
				<td><input type="text" size="6" id="time_division_professional" name="<?php echo $blockname;?>[professional]" value="<?php if(is_numeric($time_division_values['professional'])){echo (int)($time_division_values['professional']);} else {echo "0"; }?>"></td>
				<td><?php echo $this->translate('minutes'); ?></td>
			</tr>	
			<tr>
				<td><?php echo $this->translate('lang_block_time_division_remain'); ?></td>
				<td><input type="text" size="6" readonly="true" id="time_division_remain"  name="<?php echo $blockname;?>[remain]" value="<?php if(is_numeric($time_division_values['remain'])){echo (int)($time_division_values['remain']);} else {echo "0"; }?>"></td>
				<td><?php echo $this->translate('minutes'); ?></td>
			</tr>		
			<tr>
				<td><?php echo $this->translate('lang_block_time_division_on_call'); ?></td>
				<td colspan="2"><input type="checkbox" value='1' <?php if($time_division_values['on_call'] == "1"){echo "checked='checked'";}?>" id="time_division_on_call"  name="<?php echo $blockname;?>[on_call]"></td>
			</tr>	
			</table>
		</div>
	</div>
 <!--  ##### time_division_block END ####### -->
<?php endif;?>	
 
 

<?php $blockname="tracheostomy"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
<?php $tracheostomy_values = $this->tracheostomy_block[0];?>
<?php
if (isset($tracheostomy_values['last_change']) && $tracheostomy_values['last_change'] !="0000-00-00 00:00:00"){
	$myTime_t = date("d.m.Y", strtotime($tracheostomy_values['last_change']));
}else{
	$myTime_t = date("d.m.Y",time());
}
?>
 <!--  ############################################################################## -->
 <!--  ##### Trachealkanüle tracheostomy block START ####### -->
 <!--  ############################################################################## -->
<style>
	.yellow_bg_tracheostomy{
		background-color: #ffffe0;
	}
</style>
<script type="text/javascript">
$(document).ready(function(){	
	//datapicker
	$("#tracheostomy_last_change" ).datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: ''
	}).mask("99.99.9999").css({"margin":"0"});
	//allow only numbers
	$("input[id=tracheostomy_cuff_pressure], input[id=tracheostomy_change_interval]")
		.click(function (){
			
		})
		.keydown(function (e) {
			// Allow: backspace, delete, tab, escape, enter and .
			if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
				// Allow: home, end, left, right
				(e.keyCode >= 35 && e.keyCode <= 39)) 
			{
				// let it happen, don't do anything
				return;
			}
			// Ensure that it is a number and stop the keypress
			if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
				e.preventDefault();
			}
    	});
	//table column class
	var $tds = $("#tracheostomy_table td");
	$("#tracheostomy_table td")
		.focusin(function() {
			var position = $(this).index(),
       		$tdsInColumn = $tds.filter(":nth-child(" + (position+1) + ")");
			$tdsInColumn.addClass("yellow_bg_tracheostomy");
		})
		.focusout(function() {$tds.removeClass("yellow_bg_tracheostomy")});

});	
</script>
	
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + <?php echo $this->translate('lang_block_tracheostomy_title');  ?></h2>
		<div class="contactform_dragvbox_content" id="tracheostomy_block"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($tracheostomy_values)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
			<table  id="tracheostomy_table" class="datatable table-striped">
				<thead>
					<tr>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_size');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_designation');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_company');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_speaking_cannula');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_cuff_pressure');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_change_interval');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_last_change');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_change_by');  ?></strong></td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td><input type="text" size="5" name="<?php echo $blockname;?>[size]" value="<?php echo $tracheostomy_values['size']; ?>"></td>
						<td><input type="text" size="10" name="<?php echo $blockname;?>[designation]" value="<?php echo $tracheostomy_values['designation']; ?>"></td>
						<td><input type="text" size="10" name="<?php echo $blockname;?>[company]" value="<?php echo $tracheostomy_values['company']; ?>"></td>
						<td><select name="<?php echo $blockname;?>[speaking_cannula]">
							<option value=0 <?php if($tracheostomy_values['speaking_cannula'] == 0) echo"selected=selected"; ?> ><?php echo $this->translate('please select');  ?></option>
							<option value=1 <?php if($tracheostomy_values['speaking_cannula'] == 1) echo"selected=selected"; ?> ><?php echo $this->translate('option_yes');  ?></option>
							<option value=2 <?php if($tracheostomy_values['speaking_cannula'] == 2) echo"selected=selected"; ?> ><?php echo $this->translate('option_no');  ?></option>	
							</select>
						</td>
						<td><input type="text" id="tracheostomy_cuff_pressure" size="10" name="<?php echo $blockname;?>[cuff_pressure]" value="<?php echo $tracheostomy_values['cuff_pressure']; ?>"></td><!-- only numbers -->
						<td><input type="text" id="tracheostomy_change_interval" size="10" name="<?php echo $blockname;?>[change_interval]" value="<?php echo $tracheostomy_values['change_interval']; ?>"></td><!-- only numbers -->
						<td><input type="text" id="tracheostomy_last_change" class="embconditions"  style="width:60px;margin:0;" name="<?php echo $blockname;?>[last_change]" value="<?php echo $myTime_t; ?>" > </td>
						<td><input type="text" size="10" name="<?php echo $blockname;?>[change_by]" value="<?php echo $tracheostomy_values['change_by']; ?>"></td>
					</tr>
				</tbody>
			</table>
			
		
			
		</div>
	</div>
 <!--  ##### Trachealkanüle tracheostomy block END ####### -->
<?php endif;?>	




<?php if(in_array('clientsymptoms',$allowed_blocks) && $v_box == 'clientsymptoms'): ?>
<?php $set_id = 1; ?>
 <!--  ############################################################################## -->
 <!--  #############################  clientsymptoms    ################################ -->
 <!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="clientsymptoms">
		<h2> + <?php echo $this->translate('block_clientsymptoms') ?></h2>
		<div class="contactform_dragvbox_content" id="grow3"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($patient_client_symptoms)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }} ?>;" >
			<table  border="0" cellpadding="2" cellspacing="2" class="client_symptomatics" width="100%">
				<thead>
				<tr>
				<!-- TODO-3284 Carmen 17.07.2020 -->
					<th class="selector_th_0">#</th>
					<th class="selector_th_1"><?php echo $this->translate('cl_sym_name')?></th>
					<th class="selector_th_2"><?php echo $this->translate('cl_sym_severity')?></th>
					<th class="selector_th_3"><?php echo $this->translate('cl_sym_sorrowfully')?></th>
					<th class="selector_th_4"><?php echo $this->translate('cl_sym_comment')?></th>
					<th class="selector_th_5"><?php echo $this->translate('cl_sym_del')?></th>
					<!-- // -->
				</tr>
				</thead>
				<tbody>
				<?php if(!empty($patient_client_symptoms)):?>
					<?php  
						$cs_nr = 1;
						foreach($patient_client_symptoms as $db_id=> $sym_details):

						if($cs_nr%2){
							$sym_row_class ="cl_sym_row_odd";
						} else {
							$sym_row_class ="cl_sym_row_even";
						}
					?>
						<tr id="cl_sym<?php echo $cs_nr;?>" class="sym_default_row  <?php echo $sym_row_class;?> ">
							<td>#<?php //echo $cs_nr?></td>
							<td>
								<?php 
								$sel_str ="";
								$sel_str .= '<option value=""></option>';


								foreach($this->client_syms  as $group_id => $group_details) 
								{
                                    //TODO-1296
                                    if(is_array($group_details['symps']) && count($group_details['symps'])>1) {
                                        usort($group_details['symps'], array(new Pms_Sorter('description'), "_strcmp"));
                                    }

									$sel_str .= '<optgroup label="'.$group_details['name'].'">';
									
									foreach($group_details['symps'] as $k=>$syms)
									{
										if($sym_details['symptom_id'] == $syms['id']){ 
											$selected[$db_id] = 'selected="selected"';
											$opt_selected = 'selected="selected"';
										} else {
											$selected[$db_id] = '';
											$opt_selected  = '';

										}
										//$sel_str .= '<option value="'.$syms['id'].'"  '.$selected[$db_id].' >'.$syms['description'].'</option>';
										$sel_str .= '<option value="'.$syms['id'].'"  '.$opt_selected.' >'.$syms['description'].'</option>';
									}
		
									$sel_str .= '</optgroup>';
								}
								?>
								<select name="clientsymptoms[<?php echo $db_id; ?>][symptom_id]"  class="sym_name_drop" ><?php echo $sel_str;?></select>
							</td>
							<td>
								<select name="clientsymptoms[<?php echo $db_id; ?>][severity]" class="sym_severety">
									<option value=""></option>
									<option value="0" <?php if($sym_details['severity'] == "0"){ echo 'selected="selected"'; } ?> >kein</option>
									<option value="4" <?php if($sym_details['severity'] == "4"){ echo 'selected="selected"'; } ?> >leicht</option>
									<option value="7" <?php if($sym_details['severity'] == "7"){ echo 'selected="selected"'; } ?> >mittel</option>
									<option value="10" <?php if($sym_details['severity'] == "10"){ echo 'selected="selected"'; } ?> >schwer</option>
								</select>
							</td>
							<td>
								<input type="radio"  name="clientsymptoms[<?php echo $db_id; ?>][sorrowfully]" value="1" <?php if($sym_details['sorrowfully'] == "1"){ echo 'checked="checked"'; } ?>/><label>Ja</label>
								<input type="radio"  name="clientsymptoms[<?php echo $db_id; ?>][sorrowfully]" value="2" <?php if($sym_details['sorrowfully'] == "2"){ echo 'checked="checked"'; } ?>/><label>Nein</label>
							</td>
							
							<td>
                            <?php //TODO-1296; ?>
                            <!-- 
								<input type="text"  name="clientsymptoms[<?php echo $db_id; ?>][comment]"  class="sym_comment"  value="<?php echo $sym_details['comment'];?>"/>
                             -->
								<textarea name="clientsymptoms[<?php echo $db_id; ?>][comment]"  class="sym_comment" ><?php echo $sym_details['comment'];?></textarea>
							</td>
								
							<td align="left" valign="top"><a href="javascript:void(0)" onclick="remove_sym_line(<?php echo $cs_nr ; ?>)"><img src="images/action_delete.png" border="0" /></a></td>
						</tr>
						
						<tr id="care_cl_sym<?php echo $cs_nr;?>"  class="sym_default_row bbotttom <?php echo $sym_row_class;?>">
							<td colspan="6">
								<b><?php echo $this->translate('Sym care instructions: '); ?></b><br/>
								<textarea  cols="" rows=""  class="sym_care_instruction" name="clientsymptoms[<?php echo $db_id; ?>][care_specifications]"><?php echo $sym_details['care_specifications']?></textarea>
								<input type="hidden" name="clientsymptoms[<?php echo $db_id; ?>][custom]"  value="0" >
							</td>
						</tr>
					<?php $cs_nr++; endforeach; ?>
				<?php endif; ?>
				</tbody>
			</table>
			<a href="javascript:create_new_symptom_item()" class="add_item_link">
				<?php echo $this->translate('addnewsymptom'); ?>
			</a>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>

<!-- ISPC-2671 Lore 07.09.2020 -->
<script type="text/javascript">
$(function(){
	$('#PatientAcp-living_will-file_date').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientAcp-care_orders-file_date').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientAcp-healthcare_proxy-file_date').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientAcp-emergencyplan-file_date').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
});	
</script>
<?php
//ISPC-2671 Lore 07.09.2020 
if(in_array('patient_acp',$allowed_blocks)  && $v_box == 'patient_acp'): 
   $block_patient_acp = $this->block_patient_acp;
	echo $block_patient_acp['__formHTML'];
endif;?> 


<?php
//ISPC-2668 Lore 14.09.2020 
if(in_array('patient_ms',$allowed_blocks)  && $v_box == 'patient_ms'): 
   $block_patient_ms = $this->block_patient_ms;
	echo $block_patient_ms['__formHTML'];
endif;?> 
<script type="text/javascript">
$(function(){
	$('#PatientMaintainanceStage-fromdate').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});

	$('#PatientMaintainanceStage-e_fromdate').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});

	$('#PatientMaintainanceStage-h_fromdate').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});

	$('#PatientMaintainanceStage-rejected_date').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});

	$('#PatientMaintainanceStage-opposition_date').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});

});	
</script>




<?php
//ISPC-2666 Lore 16.09.2020 
if(in_array('patient_hi',$allowed_blocks)  && $v_box == 'patient_hi'): 
	$block_patient_hi = $this->block_patient_hi;
	echo $block_patient_hi['__formHTML'];
endif;?> 

<?php
//ISPC-2667 Lore 21.09.2020 
if(in_array('patient_ci',$allowed_blocks)  && $v_box == 'patient_ci'): 
	$block_patient_ci = $this->block_patient_ci;
	echo $block_patient_ci['__formHTML'];
endif;?> 

<!-- ISPC-2669 Lore 23.09.2020 -->
<script type="text/javascript">
$(function(){
	$('#PatientHandicappedCard-since_date').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientHandicappedCard-approved_date').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
});	
</script>
<?php
//ISPC-2669 Lore 23.09.2020 
if(in_array('patient_hc',$allowed_blocks)  && $v_box == 'patient_hc'): 
	$block_patient_hc = $this->block_patient_hc;
	echo $block_patient_hc['__formHTML'];
endif;?> 

<?php
//ISPC-2670 Lore 24.09.2020 
if(in_array('patient_evn',$allowed_blocks)  && $v_box == 'patient_evn'): 
	$block_patient_evn = $this->block_patient_evn;
	echo $block_patient_evn['__formHTML'];
endif;?> 

<?php
//ISPC-2673 Lore 25.09.2020 
if(in_array('resources',$allowed_blocks)  && $v_box == 'resources'): 
	$block_resources = $this->block_resources;
	echo $block_resources['__formHTML'];
endif;?> 

<?php
//ISPC-2773 Lore 14.12.2020 
if(in_array('patient_familyinfo',$allowed_blocks)  && $v_box == 'patient_familyinfo'): 
	$block_patient_familyinfo = $this->block_patient_familyinfo;
	echo $block_patient_familyinfo['__formHTML'];
endif;?> 

<?php
//ISPC-2788 Lore 08.01.2021 
if(in_array('patient_nutritioninfo',$allowed_blocks)  && $v_box == 'patient_nutritioninfo'): 
	$block_patient_nutritioninfo = $this->block_patient_nutritioninfo;
	echo $block_patient_nutritioninfo['__formHTML'];
endif;?> 

<?php
//ISPC-2787 Lore 11.01.2021 
if(in_array('patient_stimulatorsinfo',$allowed_blocks)  && $v_box == 'patient_stimulatorsinfo'): 
	$block_patient_stimulatorsinfo = $this->block_patient_stimulatorsinfo;
	echo $block_patient_stimulatorsinfo['__formHTML'];
endif;?> 

<?php
//ISPC-2790 Lore 12.01.2021 
if(in_array('patient_finalphase',$allowed_blocks)  && $v_box == 'patient_finalphase'): 
	$block_patient_finalphase = $this->block_patient_finalphase;
	echo $block_patient_finalphase['__formHTML'];
endif;?> 

<?php
//ISPC-2791 Lore 13.01.2021 
if(in_array('patient_excretioninfo',$allowed_blocks)  && $v_box == 'patient_excretioninfo'): 
	$block_patient_excretioninfo = $this->block_patient_excretioninfo;
	echo $block_patient_excretioninfo['__formHTML'];
endif;?> 

<?php
//ISPC-2792 Lore 15.01.2021 
if(in_array('patient_personalhygiene',$allowed_blocks)  && $v_box == 'patient_personalhygiene'): 
	$block_patient_personalhygiene = $this->block_patient_personalhygiene;
	echo $block_patient_personalhygiene['__formHTML'];
endif;?> 

<?php
//ISPC-2793 Lore 18.01.2021
if(in_array('patient_comm_employ',$allowed_blocks)  && $v_box == 'patient_comm_employ'): 
	$block_patient_comm_employ = $this->block_patient_comm_employ;
	echo $block_patient_comm_employ['__formHTML'];
endif;?> 

<?php
//ISPC-2776 Lore 15.12.2020 
if(in_array('patient_childrendiseases',$allowed_blocks)  && $v_box == 'patient_childrendiseases'): 
	$block_patient_childrendiseases = $this->block_patient_childrendiseases;
	echo $block_patient_childrendiseases['__formHTML'];
endif;?> 
<!--ISPC-2776 Lore 15.12.2020 -->
<script type="text/javascript">
$(function(){
	$('#PatientChildrenDiseases-rotavirus_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-rotavirus_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-varicella_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-varicella_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-measles_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-measles_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-mumps_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-mumps_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-rubella_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-rubella_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-pertussis_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-pertussis_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-diphtheria_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-diphtheria_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-tetanus_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-tetanus_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-hib_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-hib_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-polio_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-polio_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-pneumococci_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-pneumococci_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-meningococci_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-meningococci_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-hepatit_a_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-hepatit_a_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-hepatit_b_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-hepatit_b_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-hpv_last_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
	
	$('#PatientChildrenDiseases-hpv_next_vaccination').datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "both",
		buttonImage: $('#calImg').attr('src'),
		buttonImageOnly: true,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: '',
		maxDate: '<?php echo date("d.m.Y"); ?>'
	}).mask("99.99.9999").css({"margin":"0", "width": "75px"});
});	
</script>

<?php
//ispc-2291 LYSOCARE blocks
?>

<?php 
if(in_array('puncture',$allowed_blocks)  && $v_box == 'puncture'): 
    $block_puncture = $this->block_puncture ;
    echo $block_puncture['__formHTML'];
endif;
?>


<?php 
if(in_array('infusion',$allowed_blocks)  && $v_box == 'infusion'): 
    $block_infusion = $this->block_infusion ;
    echo $block_infusion['__formHTML'];
endif;
?>


<?php 
if(in_array('infusiontimes',$allowed_blocks)  && $v_box == 'infusiontimes'): 
    $block_infusiontimes = $this->block_infusiontimes ;
    echo $block_infusiontimes['__formHTML'];
endif;
?>


<?php 
if(in_array('adverseevents',$allowed_blocks)  && $v_box == 'adverseevents'): 
    $block_adverseevents = $this->block_adverseevents ;
    echo $block_adverseevents['__formHTML'];
endif;
?>


<?php
// ISPC-Migration//IM-4//Care Process Clinic
if(in_array('care_process_clinic',$allowed_blocks)  && $v_box == 'care_process_clinic'):
    $block_care_process_clinic = $this->block_careprocessclinic;
	echo $block_care_process_clinic['__formHTML'];
endif;
?>
<?php
// ISPC-Migration//IM-16//Time Documentation Clinic
if(in_array('time_documentation_clinic',$allowed_blocks)  && $v_box == 'time_documentation_clinic'):
    $block_timedocumentationclinic = $this->block_timedocumentationclinic;
			echo $block_timedocumentationclinic['__formHTML'];
endif;
?>
<?php
// ISPC-Migration//IM-26//Treatment Plan Clinic
if(in_array('treatment_plan_clinic',$allowed_blocks)  && $v_box == 'treatment_plan_clinic'):
    $block_treatmentplanclinic = $this->block_treatmentplanclinic;
			echo $block_treatmentplanclinic['__formHTML'];
endif;
?>

<?php
// ISPC-Migration//IM-46//Conversation content
if(in_array('talkcontent',$allowed_blocks)  && $v_box == 'talkcontent'):
    $block_talkcontent = $this->block_talkcontent;
			echo $block_talkcontent['__formHTML'];
endif;
?>

<?php
// ISPC-Migration//IM-47//Jobbackground patient Clinic
if(in_array('job_background_clinic',$allowed_blocks)  && $v_box == 'job_background_clinic'):
    $block_jobbackgroundclinic = $this->block_jobbackgroundclinic;
			echo $block_jobbackgroundclinic['__formHTML'];
endif;
?>

<?php
// ISPC-Migration//IM-48//Dischargeplanning patient Clinic
if(in_array('discharge_planning_clinic',$allowed_blocks)  && $v_box == 'discharge_planning_clinic'):
    $block_dischargeplanningclinic = $this->block_dischargeplanningclinic;
			echo $block_dischargeplanningclinic['__formHTML'];
endif;
?>

<?php
// ISPC-Migration//IM-51//Screening for Depression Clinic
if(in_array('screen_depression_clinic',$allowed_blocks)  && $v_box == 'screen_depression_clinic'):
    $block_screeningdepressionclinic = $this->block_screeningdepressionclinic;
			echo $block_screeningdepressionclinic['__formHTML'];
endif;
?>
<?php
// ISPC-Migration//IM-56//Talk with
if(in_array('talkwith',$allowed_blocks)  && $v_box == 'talkwith'):
    $block_talkwith = $this->block_talkwith;
			echo $block_talkwith['__formHTML'];
endif;
?>
<?php
// ISPC-Migration//IM-65//Palliative_support
if(in_array('palliativ_support',$allowed_blocks)  && $v_box == 'palliativ_support'):
    $block_palliativsupport = $this->block_palliativsupport;
			echo $block_palliativsupport['__formHTML'];
endif;
?>
<?php
// ISPC-Migration//IM-66//Palliative_support
if(in_array('palliativ_assessment',$allowed_blocks)  && $v_box == 'palliativ_assessment'):
    $block_palliativassessment= $this->block_palliativassessment;
			echo $block_palliativassessment['__formHTML'];
			endif;
?>
<?php
// ISPC-Migration//IM-87//SOAP (Subjective - Objective - Assessment - Plan)
if(in_array('clinic_soap',$allowed_blocks)  && $v_box == 'clinic_soap'):
    $block_clinicsoap= $this->block_clinicsoap;
			echo $block_clinicsoap['__formHTML'];
			endif;
?>
<?php
// ISPC-Migration//IM-91//Clinic-Diagnosis
if(in_array('clinic_diagnosis',$allowed_blocks)  && $v_box == 'clinic_diagnosis'):
    $block_clinicdiagnosis= $this->block_clinicdiagnosis;
			echo $block_clinicdiagnosis['__formHTML'];
			endif;
?>
<?php
// ISPC-Migration//IM-92//Clinic-Shift
if(in_array('clinic_shift',$allowed_blocks)  && $v_box == 'clinic_shift'):
    $block_clinicshift= $this->block_clinicshift;
			echo $block_clinicshift['__formHTML'];
			endif;
?>
<?php
// ISPC-Migration//IM-105//actual_problems
if(in_array('actual_problems',$allowed_blocks)  && $v_box == 'actual_problems'):
    $block_actual_problems = $this->block_actual_problems;
			echo $block_actual_problems['__formHTML'];
			endif;
?>

<?php
// ISPC-Migration
foreach($this->auto_add_blocks as $myblock=>$myblockname){
    if(in_array($myblock,$allowed_blocks)  && $v_box == $myblock) {
        $block = $this->$myblockname;
        echo $block['__formHTML'];
    }
}

?>

<?php 

// ISPC-2454 custom blocks
if(in_array($v_box, $this->custom_blocks_allowed)):

		$block_name = 'block_'.$v_box;
		echo $this->{$block_name}['__formHTML'];
	endif;  	
?>

<?php 

// ISPC-2387 Mambo block
if(in_array('visitclasification',$allowed_blocks)  && $v_box == 'visitclasification'): 
    $block_visitclasification = $this->block_visitclasification ;
?>

<script type="text/javascript">

$(document).ready(function(){
	
	
	
	<?php if(!isset($block_visitclasification['__formOLDValues']['remain_minutes'])) :?>
	$('#mambo_time_division_remain').val(calculate_time_diff());
	<?php endif; ?>
	
	var old_minutes = [];
	old_minutes['mambo_assessment_minutes'] =<?php if(isset($block_visitclasification['__formOLDValues']['assessment_minutes'])) echo $block_visitclasification['__formOLDValues']['assessment_minutes'] ;else echo '0' ; ?>;
	old_minutes['mambo_consultation_minutes'] =<?php if(isset($block_visitclasification['__formOLDValues']['consultation_minutes'])) echo $block_visitclasification['__formOLDValues']['consultation_minutes'] ;else echo '0' ; ?>;
	old_minutes['mambo_training_minutes'] =<?php if(isset($block_visitclasification['__formOLDValues']['training_minutes'])) echo $block_visitclasification['__formOLDValues']['training_minutes'] ;else echo '0' ; ?>;
	old_minutes['mambo_maintenance_check_minutes'] =<?php if(isset($block_visitclasification['__formOLDValues']['maintenance_check_minutes'])) echo $block_visitclasification['__formOLDValues']['maintenance_check_minutes'] ;else echo '0' ; ?>;
	old_minutes['mambo_monitoring_minutes'] =<?php if(isset($block_visitclasification['__formOLDValues']['monitoring_minutes'])) echo $block_visitclasification['__formOLDValues']['monitoring_minutes'] ;else echo '0' ; ?>;
	old_minutes['mambo_applications_opposition_minutes'] =<?php if(isset($block_visitclasification['__formOLDValues']['applications_opposition_minutes'])) echo $block_visitclasification['__formOLDValues']['applications_opposition_minutes'] ;else echo '0' ; ?>;
	old_minutes['mambo_nurse_home_visit_minutes'] =<?php if(isset($block_visitclasification['__formOLDValues']['nurse_home_visit_minutes'])) echo $block_visitclasification['__formOLDValues']['nurse_home_visit_minutes'] ;else echo '0' ; ?>;
	old_minutes['mambo_other_minutes'] =<?php if(isset($block_visitclasification['__formOLDValues']['other_minutes'])) echo $block_visitclasification['__formOLDValues']['other_minutes'] ;else echo '0' ; ?>;
	//ISPC-2387 Lore 14.08.2019
	old_minutes['mambo_medication_plan_check_minutes'] =<?php if(isset($block_visitclasification['__formOLDValues']['medication_plan_check_minutes'])) echo $block_visitclasification['__formOLDValues']['medication_plan_check_minutes'] ;else echo '0' ; ?>;

	
	$( "#begin_date_h, #begin_date_m, #end_date_h, #end_date_m" ).bind( "change", function() {
		
		var minutes = calculate_time_diff();
		
		$('#mambo_time_division_remain').val(minutes);
		old_minutes['mambo_assessment_minutes']=0;
		old_minutes['mambo_consultation_minutes']=0;
		old_minutes['mambo_training_minutes']=0;
		old_minutes['mambo_maintenance_check_minutes']=0;
		old_minutes['mambo_monitoring_minutes']=0;
		old_minutes['mambo_applications_opposition_minutes']=0;
		old_minutes['mambo_nurse_home_visit_minutes']=0;
		old_minutes['mambo_other_minutes']=0;
		old_minutes['mambo_medication_plan_check_minutes']=0;
		$(".classification_minutes").trigger( "change" );
		
	});
	
	$('.classification_minutes_chk').click(function(){
		if( ! $(this).is(":checked")){
			var ident = $(this).data('opt');
			
			$('#mambo_'+ident).val(0);
			
			var minutes = calculate_time_diff();
			
			$('#mambo_time_division_remain').val(minutes);
 
			$(".classification_minutes").trigger( "change" );
		}
		
	})
	
	
	
	$('.create_form_visitclasification tr')
		.focusin(function() {$(this).addClass("yellow_bg")})
		.focusout(function() {$(this).removeClass("yellow_bg")});
	
	$(".classification_minutes")
		.click(function (){
			if($(this).val() == "0")$(this).val("");
			//$(this).parent().parent().addClass("yellow_bg");
		})
		.keydown(function (e) {
			// Allow: backspace, delete, tab, escape, enter and .
			if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
				// Allow: home, end, left, right
				(e.keyCode >= 35 && e.keyCode <= 39)) 
			{
				// let it happen, don't do anything
				return;
			}
			// Ensure that it is a number and stop the keypress
			if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
				e.preventDefault();
			}
    	})
		.change(function() {
			var minutes = calculate_time_diff();	
			var minutes_spent = 0;
			//$(this).parent().parent().removeClass("yellow_bg");
			$(".classification_minutes")
				.map(function(idx, elem) {
					minutes_spent = minutes_spent+ (parseInt($(elem).val()) || 0);
				})
				.get();
			if((minutes - minutes_spent)>=0){//time OK
				$('#mambo_time_division_remain').val(minutes - minutes_spent);
				old_minutes[$(this).attr('id')] = $(this).val();
				$(this).removeClass("time_division_error");
			}else{//time BAD too much time			
				$(this)
					.val( old_minutes[$(this).attr('id')])
					.addClass("time_division_error")
					.delay(800).queue(function(next){
						$(this).removeClass("time_division_error").dequeue();
					});
				$('#mambo_time_division_remain')
					.addClass("time_division_error")
					.delay(1000).queue(function(next){
						$(this).removeClass("time_division_error").dequeue();	
					});
			}		
		});
});
</script>
<?php 
    echo $block_visitclasification['__formHTML'];
endif;
?>

<!-- ISPC-2488 Lore 22.11.2019 -->
<?php 
if(in_array('delegation',$allowed_blocks)  && $v_box == 'delegation'): 
    $block_delegation = $this->block_delegation ;
?>
<script type="text/javascript">

$(document).ready(function(){
	
	var old_minutes = [];
	old_minutes['delegation_medication_check_sgbv_minutes'] =<?php if(isset($block_delegation['__formOLDValues']['medication_check_sgbv_minutes'])) echo $block_delegation['__formOLDValues']['medication_check_sgbv_minutes'] ;else echo '0' ; ?>;
	old_minutes['delegation_wound_care_sgbv_minutes'] =<?php if(isset($block_delegation['__formOLDValues']['wound_care_sgbv_minutes'])) echo $block_delegation['__formOLDValues']['wound_care_sgbv_minutes'] ;else echo '0' ; ?>;
	old_minutes['delegation_catheter_replacement_sgbv_minutes'] =<?php if(isset($block_delegation['__formOLDValues']['catheter_replacement_sgbv_minutes'])) echo $block_delegation['__formOLDValues']['catheter_replacement_sgbv_minutes'] ;else echo '0' ; ?>;
	old_minutes['delegation_blood_collection_sgbv_minutes'] =<?php if(isset($block_delegation['__formOLDValues']['blood_collection_sgbv_minutes'])) echo $block_delegation['__formOLDValues']['blood_collection_sgbv_minutes'] ;else echo '0' ; ?>;
	old_minutes['delegation_inr_measurement_sgbv_minutes'] =<?php if(isset($block_delegation['__formOLDValues']['inr_measurement_sgbv_minutes'])) echo $block_delegation['__formOLDValues']['inr_measurement_sgbv_minutes'] ;else echo '0' ; ?>;
	old_minutes['delegation_bz_measurement_sgbv_minutes'] =<?php if(isset($block_delegation['__formOLDValues']['bz_measurement_sgbv_minutes'])) echo $block_delegation['__formOLDValues']['bz_measurement_sgbv_minutes'] ;else echo '0' ; ?>;
	old_minutes['delegation_injection_sgbv_minutes'] =<?php if(isset($block_delegation['__formOLDValues']['injection_sgbv_minutes'])) echo $block_delegation['__formOLDValues']['injection_sgbv_minutes'] ;else echo '0' ; ?>;
	old_minutes['delegation_vaccination_sgbv_minutes'] =<?php if(isset($block_delegation['__formOLDValues']['vaccination_sgbv_minutes'])) echo $block_delegation['__formOLDValues']['vaccination_sgbv_minutes'] ;else echo '0' ; ?>;


	
	$('.create_form_delegation tr')
		.focusin(function() {$(this).addClass("yellow_bg")})
		.focusout(function() {$(this).removeClass("yellow_bg")});
	
	$(".delegation_minutes")
		.click(function (){
			if($(this).val() == "0")$(this).val("");
			//$(this).parent().parent().addClass("yellow_bg");


		})
		.keydown(function (e) {
			// Allow: backspace, delete, tab, escape, enter and .
			if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
				// Allow: home, end, left, right
				(e.keyCode >= 35 && e.keyCode <= 39)) 
			{
				// let it happen, don't do anything
				return;
			}
 
			
			// Ensure that it is a number and stop the keypress
			if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
				e.preventDefault();
			}
    	})
		.keyup(function (e) {

			//small than 1000
			if ($(this).val() > 999){
				var str = $(this).val();
				var res = str.substring(0, 3);
				$(this).val(res);
			}
	 
    	})
		.change(function() {

		});
	
	
    //ISPC-2488 Lore 21.01.2020  allow a decimal value in INR field (no limitation - just decimal like 888,4)
	$(".delegation_minutes_inr")
		.click(function (){
			if($(this).val() == "0")$(this).val("");
			//$(this).parent().parent().addClass("yellow_bg");
	
	
		})
		.keydown(function (e) {
			// Allow: backspace, delete, tab, escape, enter and .
			if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
				// Allow: home, end, left, right
				(e.keyCode >= 35 && e.keyCode <= 39)) 
			{
				// let it happen, don't do anything
				return;
			}
	
			
			// Ensure that it is a number and stop the keypress
			if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
				e.preventDefault();
			}
		})
		.keyup(function (e) {
	
			$(this).val($(this).val().replace(/[^0-9\.-]/g,''));
			
			//small than 1000
			/*if ($(this).val() > 999){
				var str = $(this).val();
				var res = str.substring(0, 3);
				$(this).val(res);
			}  */
	 
		})
		.change(function() {
	
		});
	//.
	
	
});
</script>
<?php 
    echo $block_delegation['__formHTML'];
endif;
?>

<?php
//ISPC-2508 Carmen 22.01.2020
//Ancuta added to Clinic ISPC (CISPC)  on 18.03.2020
if(in_array('artificial_entries_exits',$allowed_blocks)  && $v_box == 'artificial_entries_exits'): 
    $block_artificial_entries_exits = $this->block_artificial_entries_exits ;
    echo $block_artificial_entries_exits['__formHTML'];
endif;
?>

<?php if(in_array('ventilation',$allowed_blocks)  && $v_box == 'ventilation'): ?>
<?php $block_ventilation_arr = $this->block_ventilation ;
$lang_block_ventilation = $this->translate('lang_block_ventilation');

 ?>
<!--  ############################################################################## -->
<!--  ######################## ventilation =  Beatmung  ############################ -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="<?php echo $v_box;?>">
		<h2> + <?php echo $this->translate('block_ventilation') ?></h2>
		<div class="contactform_dragvbox_content" id="grow2"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if(!empty($block_ventilation_arr)){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
				<div class="visit_quality">
					<table class="datatable table-striped block_ventilation_table">
						<tr>
							<td width="15%"> 
								<label>
								<?php echo $lang_block_ventilation['Modus'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[modus]", $block_ventilation_arr['modus'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['F_tot'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[f_tot]", $block_ventilation_arr['f_tot'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['Vt'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[vt]", $block_ventilation_arr['vt'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['MV'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[mv]", $block_ventilation_arr['mv'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['PEEP'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[peep]", $block_ventilation_arr['peep'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['PIP'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[pip]", $block_ventilation_arr['pip'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['O2_l_min'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[o2_l_min]", $block_ventilation_arr['o2_l_min'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['I_E'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[i_e]", $block_ventilation_arr['i_e'] , array()); ?>
							</td>
						</tr>
			
						
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['freetext'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formTextarea("block_ventilation[freetext]", $block_ventilation_arr['freetext'], array("rows"=>10)); ?>
							</td>
						</tr>
						
					</table>
				
					
				</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php if(in_array('invoice_condition',$allowed_blocks)  && $v_box == 'invoice_condition'): ?>
<?php 
$block_invoice_condition = $this->block_invoice_condition ;
$lang_block_invoice_condition = $this->translate('lang_block_invoice_condition');
?>
<!--  ######################## start invoice_condition =  Abrechnung Niedersachsen  ############################ -->
	<div class="contactform_dragvbox"  id="<?php echo $v_box;?>">
		<h2> + <?php echo $this->translate('block_invoice_condition') ?></h2>
		<div class="contactform_dragvbox_content" style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($block_invoice_condition['selected'] == 'hide_on_invoice'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >
				<div class="visit_quality" style="padding-left:10px;">
					<label>
						<?php echo $lang_block_invoice_condition['hide_on_invoice'];?>
						<?php echo $this->formCheckbox("block_invoice_condition", $block_invoice_condition['selected'] , array(), $block_invoice_condition['values']); ?>
					
					</label>					
				</div>
		</div>
	</div>
<!--  ######################## end invoice_condition =  Abrechnung Niedersachsen  ############################ -->
<?php endif; ?>

<?php $blockname="treatment_plan"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  ##### Behandlungsplan ####### -->
 <!--  ############################################################################## -->
 	<?php //$f_values = $this->patient_treatment_plan_values; ?>
 	
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + Behandlungsplan</h2>
		<div class="contactform_dragvbox_content" id="grow40"  style="display:<?php if($_REQUEST['openinmodal'] == '1') {if($this->treatpl_hasvalues == '1'){echo 'block';} else {echo 'none';}} else {if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }}?>;" >			 
            <?php echo $this->formblocktreatmentplan;?>
		</div>
	</div>
<!--  ######################## end Behandlungsplan  ############################ -->
<?php endif; ?>


<?php $blockname="pmd_rahmendaten"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
    <!--  ############################################################################## -->
    <!--  ##### PMD rahmendaten ####### -->
    <!--  ############################################################################## -->
    <?php $f_values = $this->patient_pmd_rahmendaten_values; ?>

    <div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
        <h2> + Angaben für Bericht</h2>
        <div class="contactform_dragvbox_content" id="grow40"  style="display:<? if($opened_blocks[$v_box] == '1') { echo 'block';} else { echo 'none'; }?>;" >
            <?php
            $f_values=Pms_CommonData::clear_pdf_data($f_values);
            $caps=array('','erstellt vorliegend','erstellt nicht vorliegend', 'nicht erstellt', 'geplant', 'nicht bekannt');
            $caps=array_combine(array_values($caps), array_values($caps));
            ?>
            <table>
                <?php foreach (array("pv"=>"Patientenverfügung","vv"=>"Vorsorgevollmacht", "gb"=>"gesetzliche Betreuung") as $name=>$caption):
                    $myval=$this->pmd_rahmendaten_extradata[$name];
                    if(isset($f_values[$name])) {$myval= $f_values[$name];}
                    ?>
                    <tr>
                        <td><?php echo $caption;?></td>
                        <!--<td><input type="text" value="<?php echo $myval;?>" name="<?php echo $this->config['blockname'];?>[<?php echo $name;?>]"></td>-->
                        <td><?php echo $this->formSelect($blockname.'['.$name.']', $myval, null, $caps); ?></td>
                    </tr>
                <?php endforeach;?>
            </table>
        </div>
    </div>
    <!--  ######################## end Behandlungsplan  ############################ -->
<?php endif; ?>



<?php $blockname="lmu_sign"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
    <!--  ############################################################################## -->
    <!--  ###################  LMU Contact Form Sign Form  ############################# -->
    <!--  ############################################################################## -->
    <?php $f_values = $this->patient_lmu_sign_values;?>
    <div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
        <h2> + Unterzeichner</h2>
        <div class="contactform_dragvbox_content" id="grow208"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
            <div class="lmuletterbox">
                <h1>Unterzeichner des Briefs</h1>
                <style>
                    .ltrsign{
                        width:300px;
                        border:1px solid #aeaeae;
                        padding:4px;
                        float:left;
                        margin-right:8px;
                        margin-bottom:8px;
                    }
                    .ltrsign .signname{
                        width:294px;
                    }
                    .ltrsign .signtitle{
                        width:294px;
                        margin-top:0px;
                    }
                    .ltrsignprototype{
                        display:none;
                    }
                    .signaddbuttonw{
                        width:300px;
                        padding-bottom:20px;
                        padding-top:20px;
                        text-align:center;
                        float:left;
                    }
                    #lmudocltr_selectsignsbox .sign_selectitem{
                        margin-bottom:3px;
                        background-color: #aee1f8;
                        border-radius:5px;
                        padding:5px;
                        border:1px solid grey;
                    }
                    #lmudocltr_selectsignsbox .sign_selectitem:hover{
                        background-color: #bff8bc;
                    }
                    #lmudocltr_selectsignsbox .signsep{
                        margin-left:-4px;
                        margin-top:6px;
                    }
                </style>
                <script>
                    if (!Object.keys) {
                        Object.keys = function(obj) {
                            var keys = [];
                            for (var i in obj) {
                                if (obj.hasOwnProperty(i)) {
                                    keys.push(i);
                                }
                            }
                            return keys;
                        };
                    }
                    $(document).ready(function(){
                        var actual_signbox=null;
                        $('#lmudocltr_selectsignsbox').dialog({
                            autoOpen:false,
                            modal: true,
                            title: '<?php echo $this->translate('Personal wählen'); ?>',
                            closeOnEscape: true,
                            resizable: false,
                            width:300,
                            height:300,
                            open: function(event, ui) {
                            },
                            close: function(event, ui){
                            }});

                        $('body').on('click', '#lmudocltr_selectsignsbox .sign_selectitem', function(){

                            $(actual_signbox).find('.signname').val($(this).attr('sign_n'));
                            $(actual_signbox).find('.signtitle').val($(this).attr('sign_t'));
                            $('#lmudocltr_selectsignsbox').dialog('close');

                        });
                        $('.signaddbuttonw .signaddbutton').click(function(){
                            var newel=$('.ltrsignprototype').clone();
                            $(newel).removeClass('ltrsignprototype');
                            $(newel).addClass('ltrsign');

                            $(this).parent().before(newel);
                            renumerate();

                            if($('.ltrsign').length>5){
                                $('.signaddbuttonw').hide();
                            }
                        });
                        function renumerate(){
                            var counter=1;
                            $('.ltrsign').each(function(){
                                $(this).find('.signname').attr('name','<?php echo $blockname;?>[n]['+counter+']');
                                $(this).find('.signtitle').attr('name','<?php echo $blockname;?>[t]['+counter+']');
                                counter++;
                            });
                        }
                        renumerate();

                        $('body').on('click', '.ltrsign .signdelbutton', function(){
                            $(this).parent().remove();
                            $('.signaddbuttonw').show();
                            renumerate();
                        });
                        $('body').on('keyup', '#sign_usrfilter', function(){
                            $('.sign_selectitem').show();
                            var filtertext=$('#sign_usrfilter').val();
                            filtertext=filtertext.toLowerCase();
                            $(this).parents('div').find('.sign_selectitem').each(function(){
                                var n=$(this).attr('sign_n');
                                n= n.toLowerCase();
                                if (n.indexOf(filtertext)==-1){
                                    $(this).hide();
                                }
                            });
                        });
                        function show_userselectbox(){
                            $('#lmudocltr_selectsignsbox').dialog('open');
                        }
                        var data_fetched=0;

                        $('body').on('click', '.ltrsign .signsearchbutton', function(){
                            actual_signbox=$(this).parent();
                            show_userselectbox();
                            if (data_fetched==0){
                                $.ajax({
                                    url: '<?php echo APP_BASE;?>/ajax/getuserstamps',
                                    success: function(data){
                                        $('#lmudocltr_selectsignsbox').html('');
                                        data_fetched=data_fetched+1;
                                        var l=Object.keys(data);
                                        for (var l_index=0; l_index< l.length; l_index++){
                                            $('#lmudocltr_selectsignsbox').append('<div class="signsep">'+l[l_index]+'</div>');
                                            for (var i=0; i<data[l[l_index]].length; i++){
                                                var newel_n = $('<div></div>');
                                                newel_n.append(data[l[l_index]][i][0]);

                                                var newel_t = $('<div></div>');
                                                newel_t.append(data[l[l_index]][i][1]);

                                                var newel_w = $('<div></div>');
                                                $(newel_w).addClass('sign_selectitem');
                                                newel_w.append(newel_n);
                                                newel_w.append(newel_t);
                                                newel_w.attr('sign_n',data[l[l_index]][i][0]);
                                                newel_w.attr('sign_t',data[l[l_index]][i][1]);
                                                $('#lmudocltr_selectsignsbox').append(newel_w);
                                            }
                                        }
                                        $('#lmudocltr_selectsignsbox').prepend('<p>Filter: <input type="text" id="sign_usrfilter"></p>');
                                    },
                                    dataType: 'json'
                                });
                            }else{
                                $('#sign_usrfilter').val('');
                            }
                        });
                    });
                </script>
                <p><i>Tipp: Links im Menü unter Einstellungen in Stempeldaten können Sie die Vorbelegung Ihrer Unterschriftszeile anpassen. <br/>
                        Hier im Brief werden nur die ersten beiden Zeilen verwendet.</i></p>
                <div class="ltrsigns">
                    <div class="ltrsignprototype">
                        <input class="signname" type="text"  value=""/><br/>
                        <input class="signtitle" type="text"  value=""/><br/>
                        <input class="signsearchbutton" type="button" value="suchen"/>
                        <input class="signdelbutton" type="button" value="entfernen"/>
                    </div>
                    <?php
                    $addnewstamp=0;
                    if(! isset($f_values['n'])){
                        $addnewstamp=1;
                        $f_values['n']=array();
                        $f_values['t']=array();
                    }else {
                        if (!is_array($f_values['n'])) {
                            $f_values['n'] = array($f_values['n']);
                        }
                        if (!is_array($f_values['t'])) {
                            $f_values['t'] = array($f_values['t']);
                        }
                    }
                    if ($this->userstamp && $this->userstamp[0] && $this->userstamp[0]['row1']){
                        // if (!in_array($this->userstamp[0]['row1'], $f_values['n'])){
                        if($addnewstamp){
                            $f_values['n'][]=$this->userstamp[0]['row1'];
                            $f_values['t'][]=$this->userstamp[0]['row2'];
                        }
                    }
                    ?> <?php foreach($f_values['n'] as $counter=>$sign):?>
                        <div class="ltrsign">
                            <input class="signname" type="text" name="sign[<?php echo $blockname;?>][n][<?php echo $counter;?>]" value="<?php echo $sign;?>"/><br/>
                            <input class="signtitle" type="text" name="sign[<?php echo $blockname;?>][t][<?php echo $counter;?>]" value="<?php echo $f_values['t'][$counter];?>"/><br/>
                            <input class="signsearchbutton" type="button" value="suchen"/>
                            <input class="signdelbutton" type="button" value="entfernen"/>
                        </div>
                    <?php endforeach;?>
                    <div class="signaddbuttonw">
                        <input class="signaddbutton" type="button" value="Unterzeichner hinzufügen" />
                    </div>
                    <div class="clearer"></div>
                </div>
                <div id="lmudocltr_selectsignsbox">
                    <div align="center">bitte warten...</div>
                </div>
            </div>
        </div>
    </div>
    <!--  ############################################################################## -->
<?php endif;?>

<?php foreach($this->simpleblocks as $blockname=>$block_content):?>
<?php if((  in_array($blockname,$allowed_blocks))&& $v_box == $blockname): ?>
    <div class="contactform_dragvbox" id="<?php echo $blockname;?>">
        <h2> + <?php echo $block_content['title'];?></h2>
        <div class="contactform_dragvbox_content" id="<?php echo $blockname;?>"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>; min-height:30px;" >
            <?php echo $block_content['html'];?>
        </div>
    </div>
    <?php endif;?>
    <?php endforeach;?>

<?php endforeach;  ?>
            <?php if($this->report_enabled):?>

                <div class="contactform_dragvbox">
                    <h2 class=""> + Bericht speichern als</h2>
                    <div class="contactform_dragvbox_content" style="display:block;">
                        <ul>
                            <li><input type="radio" name="generate_bericht_draft" value="1" <?php if(!$this->allowed_to_create_final_Report) echo "checked";?> >vorläufiger Bericht</li>
                            <li><input type="radio" name="generate_bericht_draft" value="0" <?php if(!$this->allowed_to_create_final_Report) echo "disabled";?> <?php if($this->allowed_to_create_final_Report) echo "checked";?>>finaler Bericht</li>
                        </ul>
                        <?php if(!$this->allowed_to_create_final_Report):?>
                        <p>Sie benötigen erweiterte Rechte um finale Berichte zu erzeugen.</p>
                        <?php endif;?>
                    </div>
                </div>

            <?php endif;?>


<input type="hidden" name="kvno_doc_id" value="<?php echo $this->kvno_doc_id;?>">
<input type="hidden" name="vs_error" id="vs_error" value="0" /> <!-- ISPC-2515 Carmen 10.04.2020 -->
<br/><br/>
 <div class="kvno_buttons">
 <input type="hidden" name="iskvno" value ="1" />

<!-- <input name="submitform" id="submitform" type="submit" value="<?php echo $this->translate('save') ?>" />&nbsp;&nbsp; -->
<!-- <input name="pdfexport" id="pdfexport" type="submit" value="<?php echo $this->translate('generatepdf') ?>" /> -->

</div>



            <div style="width:784px;left:220px;position:fixed;  z-index:3;  background-image: -webkit-linear-gradient( 90deg, rgb(157,163,179) 0%, rgb(181,191,213) 99%);
    background-image: -ms-linear-gradient( 90deg, rgb(157,163,179) 0%, rgb(181,191,213) 99%);border:2px solid #fff;padding:4px;border-radius:4px;bottom:30px;">

            <?php if($this->report_enabled):?>
                <script>
                    $(document).on( 'click','.submit_form_c', function(event) {
                        event.preventDefault();

                        var button_pressed_id=$(event.currentTarget).prop('id');

                        $(document).userSession().checksession('abort', function(result) {
                            if(result === false) {
                                event.stopImmediatePropagation(); //stop going forward
                            } else {
                                $('#generate_pdf').val('');
                                $('#save_visit').val('1');
                                $('#generate_bericht').val('');
                                $('#generate_bericht_preview').val('');

                                if(button_pressed_id =="submitform_report_c"){
                                    $('#generate_bericht').val('1');
                                }
                                if(button_pressed_id =="pdfpreview_c"){
                                    $('#generate_bericht_preview').val('1');
                                    setTimeout(function(){ $('#generate_bericht_preview').val(''); }, 3000);
                                    $('#save_visit').val('');
                                }
                                
                                $('#go_2_anlage2kinder').val('');
                                if(button_pressed_id =="submitform_go_2_anlage2kinder"){
                                    $('#go_2_anlage2kinder').val('1');
                                }

                                $('#save_create_doctorletter').attr('disabled',true);
                                $('#save_visit_edit_letter').attr('disabled',true);
                                $('#contact_form').submit();

                                setTimeout(function () {$('.submit_form_c').attr('disabled', true);}, 150);
                                setTimeout(function () {
                                    $('.submit_form_c').attr('disabled', false);
                                }, 6000);
                            }
                        });
                    });


                </script>



<table class="form_buttons_table">
	<tr>
		<td>
                            <input type="button" value="Boxen schließen" onclick="$('.contactform_dragvbox_content').css('display','none');">
                        </td>
                        <td>
                            <input type="hidden" name="submitform" id="save_visit" value="0"  />
                            <input type="hidden" name="pdfexport" id="generate_pdf" value="1" />
                            <input type="hidden" name="generate_bericht" id="generate_bericht" value="" />
                            <input type="hidden" name="generate_bericht_preview" id="generate_bericht_preview" value="" />

                            <input type="hidden" name="generate_bericht_rootid" id="generate_bericht_rootid" value="<?php echo $this->generate_bericht_rootid ;?>" />


                            <button type="button" id="submitform_c" class="submit_form submit_form_c" > <?php echo $this->translate('save') ?></button>
                            <button type="button" id="submitform_report_c" class="submit_form submit_form_c" > <?php echo $this->translate('Speichern und Bericht erstellen') ?></button>
                            <button type="button" id="pdfpreview_c"  class="submit_form submit_form_c"> <?php echo $this->translate('preview') ?></button>
                            <!-- //ISPC-2882 Ancuta 22.04.2021 -->
                            <input type="hidden" name="go_2_anlage2kinder" id="go_2_anlage2kinder" value="0"  />
                            <?php if ($this->clientModules[253]) : ?>
                            	<button type="button" id="submitform_go_2_anlage2kinder" class="submit_form submit_form_c" > <?php echo $this->translate('save and go to anlage2kinder') ?></button>
                            <?php endif; ?>
							<!-- //-- -->
                            
                        </td>
                    </tr>
                </table>

                <?php else:?>


                <table class="form_buttons_table">
                    <tr>
                        <td>
			<input type="hidden" name="submitform" id="save_visit" value=""  />&nbsp;&nbsp;
			<button type="button" id="submitform" class="submit_form" > <?php echo $this->translate('save') ?></button>
			
			<input type="hidden" name="pdfexport" id="generate_pdf" value="" />&nbsp;&nbsp;
			<button type="button" id="pdfexport"  class="submit_form"> <?php echo $this->translate('generatepdf') ?></button>
		
			<!-- //ISPC-2882 Ancuta 22.04.2021 -->
			<input type="hidden" name="go_2_anlage2kinder" id="go_2_anlage2kinder" value=""  />
            <?php if ($this->clientModules[253]) : ?>
            	<button type="button" id="submitform_go_2_anlage2kinder" class="submit_form submit_form_c" > <?php echo $this->translate('save and go to anlage2kinder') ?></button>
            <?php endif; ?>
            <!-- //-- -->
		
		</td>
	</tr>

</table>
            <?php endif;?>
            </div>



</div>
</div>

  </div>
</form>

<div id="duplicate_visits" class="<?php if($_REQUEST['openinmodal'] == '1') {echo openinmodal;} ?>">

	<p><?php echo $this->translate('overlapping_confirm');  ?></p>
</div>

<div class="add_action_block <?php if($_REQUEST['openinmodal'] == '1') {echo openinmodal;} ?>" id="add_action_block">
	<label><?php echo $this->translate('social_action_name'); ?></label>
	<input type="text" name="action_name" value="" id="action_name" />
</div>

<?php if ($this->bassis_prefill == "1"):?>

<div id="sync_prefill_widget" style="display:none;">
    <p>Es wurden Daten von einem anderen System empfangen. Diese Einträge können nun in dieses Assessment eingefügt werden.</p>
    <p>Dabei werden Inhalte für die unten aufgelisteten Blöcke übernommen:</p>
    <ul style="margin: 14px;list-style-type: square;">
        <li>Körperliche Untersuchung</li>
        <li>Schmerzanamnese</li>
        <li>Wünsche und Erwartungen des Patienten und seiner Angehörigen</li>
        <li>Aufklärungsstand/Krankheitsverarbeitung Patient/ ggf. Angehörige</li>
    </ul>

    <table>
        <tr>
            <td>Datensatz vom:</td>
            <td>
                <?php echo date('d.m.Y',strtotime($this->bassis_data['create_date']));?>
                <input type="hidden" class="sync_prefill_widget_rowid" value="<?php echo $this->bassis_data['id'];?>">
            </td>
        </tr>
    </table>
</div>


<script>
    $(document).ready(function(){
        var spf_open_dlg = function(){$('#sync_prefill_widget').dialog({
            title: 'Übertragene Eingaben übernehmen',
            width:  500,
            modal: true,
            buttons: {
                "Ignorieren": function () {
                    var id = $('#sync_prefill_widget').find('.sync_prefill_widget_rowid').val();
                    var that = $(this);
                    $.ajax({
                        url: "ajax/marksyncbapacketdone",
                        data: {syncid: id}
                    }).done(function () {
                        $(that).dialog("close");
                    });
                },
                "Daten übernehmen": function () {
                    var syncid = $('#sync_prefill_widget').find('.sync_prefill_widget_rowid').val();
                    window.location.href = window.location.href + "&prefill_bassis=" + syncid;
                }
            }
        })};
		
        <?php if($this->bassis_data['done']==0):?>
            spf_open_dlg();
        <?php endif;?>

    });
</script>
<?php endif;?>
<div id="edit_artificial_setting" class="<?php if($_REQUEST['openinmodal'] == '1') {echo openinmodal;} ?>"></div>

<!-- ISPC-2629 Carmen 07.08.2020 -->
<?php if($this->has_floatingbox == '1' && $_REQUEST['openinmodal'] != '1') : ?>


	<div class="visitshistory">
	<h3><?php echo $this->translate('Visits History'); ?></h3>
	<ul>
	<?php foreach($this->old_contactforms as $kr => $vr) { ?>
	<a href="javascript:void(0)" onclick="openinmodal(<?php echo $kr; ?>)">
		<li>
			<div class="header">
		 		<!-- <span class="type">ContactForm</span> -->
		 		<span class="name"><?php echo $vr['oldcontactform_type']; ?></span>
		  		<span class="visit_date"><?php echo $vr['oldcontactform_date']; ?></span>
		  		<!-- <span class="name"><?php echo $vr['oldcontactform_type']; ?></span> -->
		  	</div>
		 	<div class="details" data-cid="<?php echo $kr; ?>"><?php echo $vr['oldcontactform_author']; ?></div>
		</li>
	</a>
	<?php } ?>
	</ul>
	
	<script>
	function openinmodal(cid)
	{
		$('#openinmodal').dialog({
		    autoOpen: true,
		    modal: true,
		    width: 850,
		   	height: 600,
		   	title:  "<?php echo $this->translate('old_contactform'); ?>",
		   	open: function(){
		   		
		   		//$('#openinmodal').load(appbase+'patientform/contactform?cid='+cid+'&id=<?php echo $_REQUEST["id"]; ?>&openinmodal=1');
		   		var url = 'patientform/contactform?cid='+cid+'&id=<?php echo $_REQUEST["id"]; ?>&openinmodal=1';
		   		$('.modal_loading_div', this).show();
				$.ajax({
					type: 'POST',
					url: url,
					
					success:function(data){
						$.getScript('<?php echo RES_FILE_PATH; ?>/javascript/autogrow/jquery.elastic.source_new.js');
				   		$.getScript('<?php echo RES_FILE_PATH; ?>/javascript/dragdiv/dragdivpatient.js');
				   	
				   		$.getScript('<?php echo RES_FILE_PATH; ?>/javascript/views/patientnew/medicationeditblocks.js');
				   		$.getScript('<?php echo RES_FILE_PATH; ?>/javascript/views/patientnew/medicationedit.js');
				   		$.getScript('<?php echo RES_FILE_PATH; ?>/javascript/jquery.tablesorter.js');
					   	
						$('#openinmodal').html(data);
						
						$('#openinmodal :input').attr('disabled', true);						
						$('#openinmodal  a').remove();
						$("#openinmodal img").hide();
						$('#openinmodal button').hide();
						$('#openinmodal .ibutton').hide();
					},
					error:function(){
						
					}
				});
		   	},
		   	close: function() {
		   		$.getScript('<?php echo RES_FILE_PATH; ?>/javascript/autogrow/jquery.elastic.source_new.js');
		   		$.getScript('<?php echo RES_FILE_PATH; ?>/javascript/dragdiv/dragdivpatient.js');
		   	
		   		$.getScript('<?php echo RES_FILE_PATH; ?>/javascript/views/patientnew/medicationeditblocks.js');
		   		$.getScript('<?php echo RES_FILE_PATH; ?>/javascript/views/patientnew/medicationedit.js');
		   		$.getScript('<?php echo RES_FILE_PATH; ?>/javascript/jquery.tablesorter.js');
		   	
		   		$('#openinmodal').empty();
		   		$( '<div class="modal_loading_div"></div>' ).appendTo("#openinmodal");
		   	}
			
		});
		return false;
	}
	</script>
	
	</div>	

	<div id="openinmodal">
		<div class="modal_loading_div"></div>
	</div>
<?php endif; ?>	
<!-- // -->	
	



