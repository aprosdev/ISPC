<!-- ISPC-2241, elena, 02.09.2020 (took from clinic) -->
<?php echo $this->patientinfo ?>
<?php echo $this->tabmenus ?>
<div style="margin-left:20px;">
    <style>
        #nadrbk-wrap{
            width:780px;
        }
        #nadrbk-wrap:after{
            content: "";
            display: table;
            clear: both;
        }
        .nadrbk-cattab{
            padding: 8px 6px;
            border-bottom: 1px solid silver;
            border-left: 1px solid silver;
            background: #eeeeee;//#9DA3B3;
            color: #333333;//#f4f4f4;
            cursor: pointer;
            font-weight: bold;
            border-radius: 5px 0 0 5px;
            font-size:13px;
            width:86px;
            height:30px;
            float: right;
            margin-left: 8px;
        }
        .nadrbk-cattab:nth-child(1){
            border-top: 1px solid silver;
        }
        .nadrbk-cattab:hover{
            background: #8d97b0;
            background: #ffffff;
        }
        .nadrbk-cattab.nadrbk-tabactive {
            background: #9DA3B3;
            color: #f4f4f4;
            position: relative;
            border-right: none;
            width: 94px;
            margin-left: 0px;
        }
        .nadrbk-cattab.nadrbk-tabactive:after {
            content: "";
            display: block;
            position: absolute;
            width: 2px;
            height: 48px;
            background: #9DA3B3;
            top: 0px;
            left: 106px;
        }
        #nadrbk-right{
            width:620px;
            float:left;
            min-height:800px;
            border: 1px solid silver;
            background-color: #9DA3B3;
        }
        #nadrbk-left{
            width:100px;
            float:left;
        }
        .nadrbk-entry{
            width:540px;
            font-size:12px;
            margin-bottom:8px;
            background-color: #ffffff;
            padding:5px 5px 5px 5px;
            margin-bottom: 4px;
            border-radius: 3px;;
        }
        .nadrbk-entry:after{
            content: "";
            display: table;
            clear: both;
        }
        .nadrbk-entry-details{
            margin-top:4px;
            background-color: #ffffff;
            margin-bottom:0px;
            float:right;
            display:none;
        }
        .nadrbk-entry-details td{
            padding:4px 2px 4px 2px;
            border:1px solid #cccccc;
        }
        .nadrbk-entry-details td:nth-child(1){
            width:120px;
            background-color:#dddddd;
        }
        .nadrbk-entry-details td:nth-child(2){
            width:380px;
        }

        .nadrbk-entries{
            width: 550px;
            float: left;
            margin: 16px 0px 4px 7px;
        }

        .nadrbk-entry-title{
            font-size:15px;
            font-weight: bold;
            color:#333333;
            width:540px;
            padding: 0px;
            cursor: ns-resize;
        }

        .nadrbk-entry-toolbar{
            text-align:right;
            padding:0px 5px 0px 5px;
            float:right;
        }

        .nadrbk-icon{
            cursor:pointer;
        }

        #address_clipper{
            display:none;
        }

        .nadrbk-ltrjump-bar{
            float:right;
            width:36px;
            margin:0px 0px 0px 0px;
        }

        .nadrbk-ltrjump-ltr{
            border: 1px solid #9DA3B3;
            border-radius:4px;
            border-width: 0px 1px 1px 1px ;
            background-color: #eeeeee;
            padding: 7px 0px;
            text-align: center;
            font-size:15px;
            font-weight:bold;
        }
        .nadrbk-ltrjump-ltr:hover,
        .nadrbk-ltrjump-ltr-selected{
            background-color:#333;
            color:#eee;
            cursor:pointer;
        }

        .nadrbk-ltrjump-ltr:first-child{
            border-top-width: 1px;
        }

        .nadrbk-entry-details-open{
            display:block;
        }
        .nadrbk-throbber{
            background: url("<?php echo RES_FILE_PATH;?>/images/ajax-loader-squares-bg.gif");
            background-position: center;
            background-repeat: no-repeat;
            vertical-align: bottom;
            font-size:22px;
            color: #eee;
            padding-top: 150px;
            background-position-y: 100px;
            text-align: center;
            opacity: 0.8;
        }
        .nadrbk-searchbar{
            height: 42px;
            box-sizing: border-box;
            padding: 0;
            margin: 0;
            border: 0;
            color: #ffffff;
            transition: all 0.3s;
            background: transparent;
            text-align: right;
        }
        .nadrbk-searchbar:after{
            content: "";
            display: inline-block;
            clear: both;
            transition: all 0.3s;
            background: transparent;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNSIgaGVpZ2h0PSIxNSIgdmlld0JveD0iMCAwIDE1IDE1Ij4KICA8bWV0YWRhdGE+PD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxMzggNzkuMTU5ODI0LCAyMDE2LzA5LzE0LTAxOjA5OjAxICAgICAgICAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAKPD94cGFja2V0IGVuZD0idyI/PjwvbWV0YWRhdGE+CjxkZWZzPgogICAgPHN0eWxlPgogICAgICAuY2xzLTEgewogICAgICAgIGZpbGw6ICNmZmY7CiAgICAgICAgZmlsbC1ydWxlOiBldmVub2RkOwogICAgICB9CiAgICA8L3N0eWxlPgogIDwvZGVmcz4KICA8cGF0aCBpZD0ic2VhcmNoIiBjbGFzcz0iY2xzLTEiIGQ9Ik0yMzcuNjc3LDIzLjg0NGE2LjYxOCw2LjYxOCwwLDEsMC0uODQ2Ljg0N2wzLjEzNCwzLjE0YTAuNiwwLjYsMCwwLDAsLjg0NS0wLjg0N1ptLTUuMDcyLDEuMTg1YTUuNDE2LDUuNDE2LDAsMSwxLDUuNDEtNS40MTVBNS40MTksNS40MTksMCwwLDEsMjMyLjYwNSwyNS4wMjlaIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjI2IC0xMykiLz4KPC9zdmc+Cg==') 12px 13px no-repeat;
            width: 42px;
            height: 42px;
            vertical-align: middle;
        }
        .nadrbk-searchbar input{
            width:120px;
            font-size: 14px;
            height: 24px;
            border-radius: 5px;
            border: none;
            text-align:right;
            padding-right:4px;
        }
    </style>

    <script>
        $(document).ready(function(){
            function load_tab(tabname){
                $('.nadrbk-tabactive').removeClass('nadrbk-tabactive');
                $('.nabrk-tabname-'+tabname).addClass('nadrbk-tabactive');
                $('#nadrbk-right').empty().html('<div class="nadrbk-throbber">Eintr√§ge werden geladen...</div>');
                $('#nadrbk-right').load('<?php echo APP_BASE;?>patientnew/addressbookentries',{id:'<?php echo $this->encid;?>',tab:tabname});
            }


            $(document).on('click', '.nadrbk-cattab', function(){
                var tabname=$(this).data('tabname');
                load_tab(tabname);
            });
            $(document).on('click', '.nadrbk-icon-copy', function(event){
                event.stopPropagation();
                var address=$(this).data('address');
                $('#address_clipper textarea').val(address);
                $('#address_clipper').dialog(
                    {width:440,
                        height:160,
                        title:'Adresse kopieren',
                        open:true}
                );
            });

            $(document).on('click', '.nadrbk-entry-title', function(){
                var block=$(this).parent().find('.nadrbk-entry-details');
                if($(block).hasClass('nadrbk-entry-details-open')){
                    $(block).removeClass('nadrbk-entry-details-open');
                }else{
                    $(block).addClass('nadrbk-entry-details-open');
                }
            });

            $(document).on('click', '.nadrbk-ltrjump-ltr', function(){
                var c=$(this).text();
                c=".nadrbk-entry-sortletter_"+ c.toLowerCase();
                $('.nadrbk-ltrjump-ltr-selected').removeClass('nadrbk-ltrjump-ltr-selected');
                $(this).addClass('nadrbk-ltrjump-ltr-selected');
                if(c!=".nadrbk-entry-sortletter_*"){
                    $('.nadrbk-entry').hide();
                    $(c).show();
                }else{
                    $('.nadrbk-entry').show();
                }
            });

            $(document).on('keyup', '.nadrbk-searchbar input', function(){
                var search=$(this).val();
                search=search.toLowerCase();

                $('.nadrbk-entry').each(function(){
                    var s=$(this).find('.nadrbk-entry-title').text();

                    var t="";
                    $(this).find('td:nth-child(2)').each(function(){
                        t=t + " " + $(this).text();
                    });

                    s= s.toLowerCase() + t.toLowerCase();
                    if (s.indexOf(search)>=0){
                        $(this).show();
                    }else{
                        $(this).hide();
                    }
                });

                $('.nadrbk-entry-details-open').removeClass('nadrbk-entry-details-open');

                if($('.nadrbk-entry:visible').length<4){
                    $('.nadrbk-entry:visible').each(function(){
                        if($(this).find('.nadrbk-entry-details').hasClass('nadrbk-entry-details-open')){

                        }else{
                            $(this).find('.nadrbk-entry-details').addClass('nadrbk-entry-details-open');
                        }
                    });
                }
            });


            load_tab('patient');
        });
    </script>

    <h2 style="margin:8px;font-size:20px;">Adressbuch</h2>

    <div id="nadrbk-wrap">

        <div id="nadrbk-left">
            <div class="nadrbk-cattab nabrk-tabname-patient nadrbk-tabactive" data-tabname="patient">Patient</div>
            <div class="nadrbk-cattab nabrk-tabname-all" data-tabname="all">Alle</div><?php //TODO-3496, elena, 09.10.2020 ?>

            <?php foreach($this->categories as $catkey=>$cat):?>
            <?php if (isset($cat['custom_category']) && $cat['custom_category']){continue;}?>
            <div class="nadrbk-cattab <?php echo "nabrk-tabname-".$catkey;?>" data-tabname="<?php echo $catkey;?>"><?php echo str_replace('Krankenversicherung','Kranken&shy;versicherung',str_replace('Physiotherapeut','Physio&shy;therapeut',$cat['label']));?></div>
        <?php endforeach;?>
    </div>

    <div id="nadrbk-right">
    </div>

</div>

<div id="address_clipper"><textarea style="width:400px;height:80px;"></textarea></div>


</div>