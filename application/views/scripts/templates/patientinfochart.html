<?php
//ISPC-2513 Ancuta  
// Maria:: Migration ISPC to CISPC 08.08.2020
//Maria:: Migration CISPC to ISPC 20.08.2020
//$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/jquery.blockUI.js');

$this->headScript()->appendFile(RES_FILE_PATH . '/javascript/portamento.js?' . date('Ymd'));
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/patientheaderscroll.css?' . date('Ymd'));
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/patientheaderscroll_new.css?' . date('Ymd'));
$memo_patient = trim(strip_tags($this->memo));
$whitebox_patient = trim(strip_tags($this->whitebox)); //IM-5,elena,09.12.2020 // ISPC-2800, elena, 10.12.2020
 
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/icon_patient_ipos.css?' . date('Ymd'));
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/icon_patient_medication.css?' . date('Ymd'));

$system_icon_data = $this->system_icon_data;
$system_icon_data['3']['patient_verordnungs'] = $system_icon_data['68']['patient_verordnungs']; //ISPC -1148 - not used
//print_r($system_icon_data); exit;
$use_status_scroll = $this->ModulePrivileges['157'];
$use_pmenu_scroll = $this->ModulePrivileges['158'];

$use_whitebox = $this->ModulePrivileges['1007']; //IM-5,elena,09.12.2020  //IM-5 whitebox // ISPC-2800, elena, 10.12.2020

$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/patientheaderchart.css?' . date('Ymd'));
// ISPC-2517 Ancuta
//if($this->has_events_add_button==1){
	$this->headScript()->appendFile(RES_FILE_PATH . '/javascript/pms/modalevents.js?' . date('Ymd'));
	$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/patienteventsmodal.css?' . date('Ymd'));
//}
// --
//$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/page-css/overview_charts.css?' . date('Ymd')); // added for css modal Carmen 27.04.2020
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/data_tables/datatables.min.css');
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/data_tables/jquery.dataTables.js');
//ISPC-2583 Carmen 27.04.2020
$color_map = $this->color_map;
$color_map_js = $this->color_map_js;
//--

#ISPC-2512PatientCharts
?>

<script type="text/javascript">

var pid = '<?php echo $_REQUEST['id']; ?>';
//ISPC-2615 Carmen 14.07.2020
var pstatus = '<?php echo $this->isdischarged; ?>';
//--

var weight_chart_icon_settings = "";
var weight_chart_icon_settings_obj = {};
var given_medi_documented = <?=($this->ModulePrivileges[220] === true) ? 1 : 0;?>;

//ISPC-2661 Carmen
var opensetsorg = 0;
var endsetorg = 0;
var startsetorg = 0;
//--

function goTo(location){

	var location_url = "#";
	
	location_url = appbase + location;
	window.location.href = location_url;
}

function refresh_weight_chart_block() {
	
	$('#weight_chart_block').load(
			appbase + 'ajax/loadweightchart?id=' + idpd + '&' + weight_chart_icon_settings,
			/*
			<?php 
					//change to use this weight_chart_icon_settings_obj to POST variables, instead of http_build_query, and use a from-to
			?>
			weight_chart_icon_settings_obj,
			*/
			{},	
			function(){ 
				
				$('#content_sys_icon-49 svg').attr('visibility', 'hidden');
				$('#content_sys_icon-49').css({'visibility': 'hidden', "height":"0px"});
			}
	);
	
}
//ISPC-2564 Carmen 25.06.2020
function refresh_rass_chart_block() {
	
	$('#rass_chart_block').load(
			appbase + 'ajax/loadrasschart?id=' + idpd,
			/*
			<?php 
					//change to use this weight_chart_icon_settings_obj to POST variables, instead of http_build_query, and use a from-to
			?>
			weight_chart_icon_settings_obj,
			*/
			{},	
			function(){ 
				
				$('#content_sys_icon-75 svg').attr('visibility', 'hidden');
				$('#content_sys_icon-75').css({'visibility': 'hidden', "height":"0px"});
			}
	);
	
}
//--


//ISPC-2661 pct.13 Carmen 08.09.2020
function addformnewrow(that, parent_form)
{
    try{
			
    		var form_table = $(that).closest("table");			
			$.get(appbase + 'charts/createformadditionalrow?parent_form='+parent_form, function(result) {
				var newFieldset =  $(result).appendTo($(form_table));
				$('.time')
        		.timepicker({
        			minutes: {
        				interval: 5
        			},
        			showPeriodLabels: false,
        			rows: 4,
        			//ISPC-2661 Carmen
        			timeOnlyTitle: translate('Choose Time'),
        			timeText: 'Zeit',
        			closeText: 'Ende',
        			//--
        			hourText: 'Stunde',
        			minuteText: 'Minute'
        		})
        		.mask("99:99");
		   		
		   		$( ".date" ).datepicker({
					dateFormat: 'dd.mm.yy',
					showOn: "button",
					buttonImage: $('#calImg').attr('src'),
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: '',
					maxDate: '0',
				}).mask("99.99.9999");
			});



    } catch (e) {
        console.log(e);
    }

}
//--
//ISPC-2661 pct.18 Carmen 
function addformawakesleepingnewrow(that, parent_form)
{
    try{
		
    		var form_table = $(that).closest("table");
			$.get(appbase + 'charts/createformawakesleepingadditionalrow?parent_form='+parent_form, function(result) {
				var newFieldset =  $(result).appendTo($(form_table));
				$('.time')
        		.timepicker({
        			minutes: {
        				interval: 5
        			},
        			showPeriodLabels: false,
        			rows: 4,
        			//ISPC-2661 Carmen
        			timeOnlyTitle: translate('Choose Time'),
        			timeText: 'Zeit',
        			closeText: 'Ende',
        			//--
        			hourText: 'Stunde',
        			minuteText: 'Minute'
        		})
        		.mask("99:99");
		   		
		   		$( ".date" ).datepicker({
					dateFormat: 'dd.mm.yy',
					showOn: "button",
					buttonImage: $('#calImg').attr('src'),
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: '',
					maxDate: '0',
				}).mask("99.99.9999");
			});



    } catch (e) {
        console.log(e);
    }

}
//--
	$(document).ready(function()
	{
		//ISPC-2661 pct.12 Carmen 14.09.2020
		$('.show_admission_weight').hover(function(){ $(".admission_weight").show(); }, function(){ $(".admission_weight").hide(); });
		//--
		
		var wrapp_floater = null;
		if($('#ap-content').length == 1){
			wrapp_floater = $('#ap-content');
		} else{
			wrapp_floater = $('#MainContent');
		}
		
		<?php if($use_status_scroll == "1") : ?>	
	
			$('#pmenu_container').prependTo(wrapp_floater);
			$('#pmenu_container').portamento({
				wrapper: wrapp_floater,
				gap: 0
			});
		<?php endif; ?>
		
		<?php if($use_pmenu_scroll == "1") : ?>
			var mgap = 60;
			<?php if($use_status_scroll != "1") : ?>	
			 mgap = 0;
			<?php endif; ?>
 			$('.sf-menu').portamento({
				wrapper: wrapp_floater,
				gap: mgap
			});
 			
		<?php endif; ?>
		
		//ISPC-2517 Ancuta 23.05.2020
   		$('#medication_icon_block').load(appbase + 'patientevents/medicationicon?id=' + idpd ,{});
		//
		
		//ISPC-2564 Carmen 25.06.2020
		refresh_rass_chart_block();
		//--
		
		$('.loadingdiv').hide();
		
		<?php 
		$icon_settings = "";
		
		if((count($this->system_icon_data[49]['weight_chart'][$this->ipid]) > 0)  
				|| $this->system_icon_data[49]['icon_settings'][$this->ipid]['allways_display'] == 1 ): 
			
			if(!empty($this->system_icon_data[49]['icon_settings'][$this->ipid])){
				$icon_settings = http_build_query(array("icon_settings" => $this->system_icon_data[49]['icon_settings'][$this->ipid]));
			}
		?>
		
		weight_chart_icon_settings = '<?php echo $icon_settings;?>';
		weight_chart_icon_settings_obj = <?php echo json_encode( array("id" => $_REQUEST['id'], "icon_settings" => $this->system_icon_data[49]['icon_settings'][$this->ipid]));?>;
		
		refresh_weight_chart_block();
		
		<?php endif;?>
		$("form#patient_btm_icon").bind("keypress", function(e) {
            if (e.keyCode == 13) {
                return false;
            }
        });
		
		<?php
			//ISPC-2156
			// if you bind other event to this, change this to be like the one from icons (with ns)
		?>
		var show_user_info_handlerIn = function(){ 
			var user_id = $(this).data('uid');
			$('#show_info_'+user_id).show();
		};
		var show_user_info_handlerOut = function(){ 
        	var user_id = $(this).data('uid');
			$('#show_info_'+user_id).hide();
		};
		$('.show_user_info')
		.bind('mouseover', show_user_info_handlerIn)
		.bind('mouseout', show_user_info_handlerOut)
		.click(function(evt) {
			
			var _events = $._data(this, "events");
			var _hasHover = _events['mouseover'] && _events['mouseout'];
			
			if (_hasHover) {
				//detach and off
				$(this).unbind('mouseover').unbind('mouseout').off('mouseleave').off('mouseover');
			} else {
				//re-attach and hide
				$(this).bind('mouseover', show_user_info_handlerIn);
				$(this).bind('mouseout', show_user_info_handlerOut).trigger('mouseout');
			}
			
			return;
			
		})
		
		;
		
		$('div#status_icon').click(function() {
			if ($('div#sys_icon-6').hasClass('traffic_light')) {
				$('#other_lights').toggle();
				$('.traffic_light').toggle();
			}
		});

		$('div#other_lights .patient_icon_cell').live('click', function() {
			var initial_status = $('#current_traffic_status').val();
			var selected_status = $(this).find('img').attr('rel');
			if (initial_status != selected_status) {
				save_status(selected_status, $(this));
			}
			$('#current_traffic_status').val(selected_status);
		});


			
		$('#vital_signs_modal').dialog({
			autoOpen: false,
			modal: true,
			title: '<?php echo $this->translate('vital_signs_modal_title'); ?>',
			width: '650',
			height: '450',
			resizable: false,
			draggable: false,
			dialogClass: "charts_modal",
			
			buttons : [
				//delete button
				{
					'class' : "delbutton leftButton",
					text : 'Eintrag l√∂schen',
					click : function() {
					var that = $(this);
						
					jConfirm(translate('[Are you sure you want to delete this?]'), translate('confirmdeletetitle'), function(r) {
					    if(r) {
					    	
					    	$.ajax({
					    		 type: 'POST',
								 url: 'patientform/vitalsigns?id=<?php echo $_REQUEST["id"]; ?>&subaction=delete',
								 data: $('#vital_signs_icon_form').serialize(),
								 success:function(data){
									 $('#vital_signs_modal').dialog("close");
									 if (typeof loadPage == 'function' && that.data("vs_source") == 'charts') { 
											loadPage(); 
										}
										else
										{
											window.location.reload(true);
										}
									 
											/* $('#awake_sleeping_modal').unblock();
											$('.ui-dialog-buttonpane button:first').removeAttr('disabled');
				
											var action_name = '<?php echo Zend_Controller_Front::getInstance()->getRequest()->getActionName(); ?>';
				
											if(action_name == 'patientcourse') {
												window.location.reload(true);
											} */
								 }
							 });
					    }
					});
						
					},
					
				},
	           {
	        	   text : translate('save'),
	        	   click : function() {
	        		 	//ISPC-2515 Carmen 16.04.2020
		        		if($('#vs_error').val() == '0')
		        		{
		        			var that = $(this);
		        			$('input', '#vital_signs_icon_form').each(function(){
		        				$(this).val().replace(/\,/g, '.');
		        			});
		        		
		        		   $.ajax({
		        			   type: 'POST',
		        			   url: 'patientform/vitalsigns?id=<?php echo $_REQUEST["id"]; ?>&vs_source='+that.data("vs_source"), //ISPC-2515
	    					   data: $('#vital_signs_icon_form').serialize(),
	    					   success:function(data){
	 								$('#vital_signs_modal').dialog("close");
	 								$('.modal_success_msg').show();
									setTimeout(function () {
										$('.modal_success_msg').hide();
										},1000);
	 								if (typeof loadPage == 'function' && that.data("vs_source") == 'charts') { 
										loadPage(); 
									}
									else if(that.data("vs_source") == 'icon')
									{
										window.location.reload(true);
									}
	 								
	 								/* $('#vital_signs_modal').unblock();
	 								$('.ui-dialog-buttonpane button:first').removeAttr('disabled');
	
	 								var action_name = '<?php echo Zend_Controller_Front::getInstance()->getRequest()->getActionName(); ?>';
	
	 								if(action_name == 'patientcourse') {
	 									window.location.reload(true);
	 								} */
									}
							});
		        		}
	        			//--
					}
	           },
	         //ISPC-2517 Carmen 05.06.2020
	           {
	        	   text : translate('save and go back to chart'),
	        	   'id': 'vital_save_go_back',
	        	   click : function() {
	        		 	//ISPC-2515 Carmen 16.04.2020
		        		if($('#vs_error').val() == '0')
		        		{
		        			var that = $(this);
		        			$('input', '#vital_signs_icon_form').each(function(){
		        				$(this).val().replace(/\,/g, '.');
		        			});
		        		
		        		   $.ajax({
		        			   type: 'POST',
		        			   url: 'patientform/vitalsigns?id=<?php echo $_REQUEST["id"]; ?>&vs_source='+that.data("vs_source"), //ISPC-2515
	    					   data: $('#vital_signs_icon_form').serialize(),
	    					   success:function(data){
	 								$('#vital_signs_modal').dialog("close");
	 								if($('#patient-main-add-modal').length && $('#patient-main-add-modal').hasClass('ui-dialog-content') && $('#patient-main-add-modal').dialog('isOpen'))
	 								{	 									
	 									$('#patient-main-add-modal').dialog("close");
									}
	 								$('.modal_success_msg').show();
									setTimeout(function () {
										$('.modal_success_msg').hide();
										},1000);
	 								if (typeof loadPage == 'function' && that.data("vs_source") == 'charts') { 
										loadPage(); 
									}
									else if(that.data("vs_source") == 'icon')
									{
										//window.location.reload(true);
										// go to charts Ancuta 05.06.2020
										window.location.href = appbase + 'charts/overview?id='+pid+'#vital_signs_chart';
									}
	 								
	 								/* $('#vital_signs_modal').unblock();
	 								$('.ui-dialog-buttonpane button:first').removeAttr('disabled');
	
	 								var action_name = '<?php echo Zend_Controller_Front::getInstance()->getRequest()->getActionName(); ?>';
	
	 								if(action_name == 'patientcourse') {
	 									window.location.reload(true);
	 								} */
									}
							});
		        		}
	        			//--
					}
	           },
	           //--
	           {
	        	   text : translate('cancel'),
	        	   click : function() {
	        		   //$('#vital_signs_modal').html('<div id="loading_vs" style="display: none; width: 100%; text-align: center"><img src="<? echo RES_FILE_PATH;  ?>/images/pageloading.gif"></div>');
	        		   $(this).dialog("close");
				}}
			],
			open: function(ui) {
				//ISPC-2517
				if(($('#patient-main-add-modal').length && $('#patient-main-add-modal').hasClass('ui-dialog-content') && $('#patient-main-add-modal').dialog('isOpen')) || typeof loadPage != 'function' || (typeof loadPage == 'function' && $(this).data("vs_source") == 'icon'))
				{
					$('#vital_save_go_back').show();
				}
				else
				{
					$('#vital_save_go_back').hide();
				}
				//--
				 jQuery('.ui-widget-overlay').on('click', function () {
					 $('#vital_signs_modal').dialog('close');
		            });
				
				
				$('#modal_loading_div', this).show();
				/*
				$( ".datepick" ).datepicker({
						dateFormat: 'dd.mm.yy',
						showOn: "both",
						buttonImage: $('#calImg').attr('src'),
						buttonImageOnly: true,
						changeMonth: true,
						changeYear: true,
						nextText: '',
						prevText: ''
					}).mask("99.99.9999");	
				 */
					//ISPC-2515 Carmen 16.04.2020
					// if ($("#loading_vs", this).length){					
						if($(this).data('recid'))
					   	{
							$('#vital_signs_modal').load('<?php  echo APP_BASE."ajax/loadvitalsignsform?id=".$_REQUEST['id']; ?>&vs_source='+$(this).data('vs_source')+'&recid='+$(this).data('recid'));
							if($(this).parent().find('.delbutton').is(":hidden"))
	    					{
	    		   				$(this).parent().find('.delbutton').show();
	    					}
					   	}
						else
						{
							$('#vital_signs_modal').load('<?php  echo APP_BASE."ajax/loadvitalsignsform?id=".$_REQUEST['id']; ?>&vs_source='+$(this).data('vs_source'));
							$(this).parent().find('.delbutton').hide();
						}
					 /* } else {
						 $(ui.target).find('input[type=text]').not('.vs_datepick').val('');
					 } */
					//--
				
			},
			close:function(){
//					reset_btm_modal();
			}
		});

		<?php 
				//ISPC-2122
				//known bug: click icon to stay-open unbinds events, click again hides and binds/unbinds??, 3rd chick or hower not working 
		?>
		var patientIcon_handlerIn = function(event) {
			
			var tab_name = $(this).attr('id');
			
			$(".tab-content").removeClass('active_content');
			$(".tab-content").hide();
			
			$("#content_" + tab_name).fadeTo(300, 1).addClass('active_content');
			
			$('#content_sys_icon-49 svg').attr('visibility', 'hidden');
			$('#content_sys_icon-49').css({'visibility': 'hidden', "height":"0px"});
			$('#content_sys_icon-49 > #weight_chart_block').hide();
			
			if(tab_name == "sys_icon-49" ){
				$('#content_sys_icon-49').css({'visibility': 'visible',"height":"40px"});
				$('#content_sys_icon-49 > #weight_chart_block').show();
				if ($('#content_sys_icon-49 #weight_container').length) {
					$('#content_sys_icon-49 svg').attr('visibility', 'visible');
					$('#content_sys_icon-49').css({"height":"280px"});
				}
			} else {
				$('#content_sys_icon-49 svg').attr('visibility', 'hidden');
				$('#content_sys_icon-49').css({'visibility': 'hidden', "height":"0px"});
				$('#content_sys_icon-49 > #weight_chart_block').hide();
			}
			
			//ISPC-2564 Carmen 25.06.2020
			$('#content_sys_icon-75 svg').attr('visibility', 'hidden');
			$('#content_sys_icon-75').css({'visibility': 'hidden', "height":"0px"});
			$('#content_sys_icon-75 > #rass_chart_block').hide();
			
			if(tab_name == "sys_icon-75" ){
				$('#content_sys_icon-75').css({'visibility': 'visible',"height":"40px"});
				$('#content_sys_icon-75 > #rass_chart_block').show();
				if ($('#content_sys_icon-75 #rass_container').length) {
					$('#content_sys_icon-75 svg').attr('visibility', 'visible');
					$('#content_sys_icon-75').css({"height":"280px"});
				}
			} else {
				$('#content_sys_icon-75 svg').attr('visibility', 'hidden');
				$('#content_sys_icon-75').css({'visibility': 'hidden', "height":"0px"});
				$('#content_sys_icon-75 > #rass_chart_block').hide();
			}
			//--
			
			//verify all other icons for events, and re-attach them if missng... 
			var _that = this;
			$('div.tabs_table').each(function(){
				
				if (this == _that) {
					return;
				} else {
					var _events = $._data(this, "events");
					var _hasHover = _events['mouseover'] && _events['mouseout'];
					var _hasMouseover = false;
					var _hasMouseout = false;
					
					if (_hasHover) {//check to see if this are my ns events or others
						$.each(_events['mouseover'], function(i, evt){
							if (evt.namespace == 'patientIcon') {
								_hasMouseover = true;
								return false;
							}
						});
						$.each(_events['mouseout'], function(i, evt){
							if (evt.namespace == 'patientIcon') {
								_hasMouseout = true;
								return false;
							}
						});
					}
					
					if ( ! _hasMouseover) {
						$(this).bind('mouseover.patientIcon', patientIcon_handlerIn);
					}
					if ( ! _hasMouseout) {
						$(this).bind('mouseout.patientIcon', patientIcon_handlerOut);
					}			
				}
			});
			
			return false;
		};
		
		var patientIcon_handlerOut = function(event){ 
			var tab_name = $(this).attr('id');
			/*
			if(tab_name != "sys_icon-49" && tab_name != "sys_icon-52" && tab_name != "sys_icon-51"&& tab_name != "sys_icon-31" ){
				$(".tab-content").hide();
			}
			*/
			$('#content_sys_icon-49 svg').attr('visibility', 'hidden');
			$('#content_sys_icon-49').css({'visibility': 'hidden', "height":"0px"});
			$('#content_sys_icon-49 > #weight_chart_block').hide();
			
			//ISPC-2564 Carmen 25.06.2020
			$('#content_sys_icon-75 svg').attr('visibility', 'hidden');
			$('#content_sys_icon-75').css({'visibility': 'hidden', "height":"0px"});
			$('#content_sys_icon-75 > #rass_chart_block').hide();
			//--
			
			// THIS WAS ADDED AS A QUICK FIX FOR  TODO-1489 ToDo check off IPAD bugs
			//$(".tab-content").hide();
			if(tab_name != "sys_icon-49" && tab_name != "sys_icon-52" && tab_name != "sys_icon-51" && tab_name != "sys_icon-31" ){
				$(".tab-content").hide();
			}
			
			
		};
		
		var patientIcon_handlerClick = function(event){
		};
		
		
		
		$("div.tabs_table")
		.bind('mouseover.patientIcon', patientIcon_handlerIn)
		.bind('mouseout.patientIcon', patientIcon_handlerOut)
		//.bind('click.patientIcon', patientIcon_handlerClick)
		.click(function(evt) {
			
			var _events = $._data(this, "events");
			var _hasHover = _events['mouseover'] && _events['mouseout'];
			var _hasMouseover = false;
			var _hasMouseout = false;

			if (_hasHover) {//check to see if this are my events or others
				$.each(_events['mouseover'], function(i, evt){
					if (evt.namespace == 'patientIcon' ) {
						_hasMouseover = true;
						return false;
					}
				});
				$.each(_events['mouseout'], function(i, evt){
					if (evt.namespace == 'patientIcon' ) {
						_hasMouseout = true;
						return false;
					}
				});
			}
			
			if (_hasMouseover && _hasMouseout) {
				$(this)
				.unbind('mouseover.patientIcon mouseout.patientIcon')
				.off('mouseleave.patientIcon mouseover.patientIcon')
				;
			} else {
				if ( ! _hasMouseover){
					$(this).bind('mouseover.patientIcon', patientIcon_handlerIn);
				}
				if ( ! _hasMouseout){
					$(this).bind('mouseout.patientIcon', patientIcon_handlerOut).trigger('mouseout.patientIcon');
				}
			}

			
			return;
			
		})
		;
		
		
		
		
		
		
		// 
		$('#content_sys_icon-52').mouseleave(function() {
			//$(".tab-content").hide();
		});
		
		$('#content_sys_icon-49').unbind('mouseleave');
		//ISPC-2564 Carmen 25.06.2020
		$('#content_sys_icon-75').unbind('mouseleave');
		//--
		// special for vital signs
		/*$('#content_sys_icon-49').mouseleave(function() {
			//$(".tab-content").hide();
		});
		*/
		// Todo icon
		$('#content_sys_icon-51').mouseleave(function() {
			//$(".tab-content").hide();
		});
		
		$('.vital_signs_icon_button').live('click', function() {
			$('#vital_signs_modal').data('vs_source', 'icon').data('recid', '').dialog('open'); //ISPC-2515 Carmen 16.04.2020
		});
		
		// TODO-1677
		// 06.07.2018 Ancuta
		
		$('#sys_icon-51').live('click',function() {
			if($('#content_sys_icon-51').is(":visible")){ // TODO-1694 Ancuta - 18.07.2018
			
// 				$(".tab-content").hide();
				$('#content_sys_icon-51').hide();
			} else{
				$('#content_sys_icon-51').show();
			} 
		});
		
		$('#sys_icon-31').live('click',function() {
			if($('#content_sys_icon-31').is(":visible")){
// 				$(".tab-content").hide();
				$('#content_sys_icon-31').hide();
			} else{
				$('#content_sys_icon-31').show();
			} 
		});
		//--
		
		check_icons();

		$('#assign_custom_icon').click(function() {
			check_icons();
			$('#available_custom_icons').toggle();
		});

		//assign
		$('div#available_custom_icons div.available').live('click', function() {
			var that = $(this);
			$(that).hide();

			//do assign code here! some ajax stuffs
			xhr = $.ajax({
				url: '<?php echo APP_BASE; ?>ajax/assignpatienticon?id=<?php echo $_REQUEST['id']; ?>&iconid=' + $(this).attr('rel'),
				success: function(response) {
					var response_obj = jQuery.parseJSON(response);
					if (response_obj['status'] == 'ok') {
						//clone that element and append it to the icon bar with id changed
						$(that).clone().insertBefore('div.fixed').attr('id', 'assigned_custom_icon-' + $(that).attr('rel'));

						//remove old class and add new class for iconbar entity
						$('#assigned_custom_icon-' + $(that).attr('rel')).removeClass('available').addClass('custom_icon_assigned').show();

						//hide cloned icon
						$(that).hide();
						check_icons();
					}
				}
			});
		});
		//(un)assign
		$('#confirm_unassign').dialog({autoOpen: false});
		$('.custom_icon_assigned').live('click', function() {
			var icon_id = parseInt($(this).attr('id').substr(('assigned_custom_icon-').length));

			$('#confirm_unassign').dialog({
				autoOpen: false,
				modal: true,
				title: '<?php echo $this->translate('unassign_icon'); ?>',
				buttons: {
					"<?php echo $this->translate('unassign_icon_btn'); ?>": function() {
						//do (un)assign code here! some ajax stuffs
						xhr = $.ajax({
							url: '<?php echo APP_BASE; ?>ajax/removepatienticon?id=<?php echo $_REQUEST['id']; ?>&iconid=' + icon_id,
							success: function(response) {
								var response_obj = jQuery.parseJSON(response);

								if (response_obj['status'] == 'ok') {
									//remove curent icon element
									$('#assigned_custom_icon-' + icon_id).remove();

									//unhide available icon
									$('#available_custom_icon-' + icon_id).show();

									check_icons();
								}
							}
						});
						$(this).dialog("close");
					},
					"<?php echo $this->translate('cancel'); ?>": function() {
						$(this).dialog("close");
					}
				}
			});
			$('#confirm_unassign').dialog('open');
		});
		
		$('.readmit_patient').on('click', function() {
			$('#status_readmit_data').dialog('open');
		});
		
		$('#status_readmit_data').dialog({
			autoOpen:false,
			title: "<?php echo $this->translate('status_readmission_dialog_title'); ?>",
			modal: true,
			closeOnEscape: true,
			draggable: true,
			resizable: false,
			width:"500",
			height: "250",
			close: function() {
				//restore and clear all used data
				$('#status_readmit_data').removeData('readmit_date');
				$('#status_readmit_data').removeData('adm_time_h');
				$('#status_readmit_data').removeData('adm_time_m');
			    $('#status_admission_date').datepicker( "destroy" );
			    $('#status_admission_transition').val('active');
				
				
				//reenable dialog buttons
				//$('.ui-dialog button.ui-button').each(function() { $(this).attr('disabled', false); });
			},
			open: function() {
				$('#status_readmit_data').data('readmit_date', $('#status_admission_date').val());
				
				//todo: limit datepicker to last discharge date of patient!
			    $('#status_admission_date').datepicker({
					dateFormat: 'dd.mm.yy',
					showOn: "both",
					buttonImage: $('#calImg').attr('src'),
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: '',
					onSelect: function (date_str) {
						$('#status_readmit_data').data('readmit_date', date_str);
					}
				}).mask('99.99.9999');
				
				<?php if(strlen($this->last_discharge)>'0'):?>
					$('#status_admission_date').datepicker("option", "minDate", "<?php echo $this->last_discharge; ?>");
				<?php elseif(strlen($this->last_inactive_discharge) > '0'): ?>
					$('#status_admission_date').datepicker("option", "minDate", "<?php echo $this->last_inactive_discharge; ?>");
				<?php endif; ?>
				$('#status_admission_date').datepicker("option", "maxDate", "<?php echo date('d.m.Y', time()); ?>");
			},
			buttons: [
			    {
					text: "<?php echo $this->translate('save'); ?>",
					click: function () {
						var patient_id = '<?php echo $_REQUEST['id']; ?>';
						var readmission_date = $('#status_readmit_data').data('readmit_date');
						
						$('.time_sel').each(function() {
							$('#status_readmit_data').data($(this).attr('id'), $(this).val());
						});
						
						var readmission_time_h = $('#status_readmit_data').data('adm_time_h');
						var readmission_time_m = $('#status_readmit_data').data('adm_time_m');

						var transition = 'active'; // DEFAULT
						transition = $('#status_admission_transition').val();
						
						//$('.ui-dialog button.ui-button').each(function() { $(this).attr('disabled', true); });
						save_readmission(patient_id,transition, readmission_date, readmission_time_h, readmission_time_m);
					}
			    },
			    {
					text: "<?php echo $this->translate('cancel'); ?>",
					click: function () {
						
						$(this).dialog("close");
					}
			    }
			]
		});

			//IM-5,elena, 09.12.2020
			// ISPC-2800, elena, 10.12.2020
			$('#whitebox_history_modal').dialog({
					autoOpen:false,
							title: "Whitebox Verlauf",
							modal: true,
							closeOnEscape: true,
							draggable: true,
							resizable: false,
							width:"500",
							height: "250",


							open: function() {
						$.ajax({
							type: 'POST',
							url: 'ajax/whiteboxhistory?id=<?php echo $_REQUEST['id']; ?>',
							success : function(html){
								$('#whitebox_history_modal_content').html(html);

							}


						})
					}


				});

			$('#wb_history').on('click', function(e){
					$('#whitebox_history_modal').dialog('open');

				});



<?php if($this->btm_perm == '1' && $this->has_btm_permission == '1'): ?>
//BTM ICON MODAL AND PROCEDURES

	function validatePositiveInteger( testNumber )
	{    

		return testNumber.match(/^\d+$/) && parseInt(testNumber) >= 0;
		
	}


		$('#btm_actions_modal').dialog({
			autoOpen: false,
			modal: true,
			title: '<?php echo $this->translate('btm_dialog_title'); ?>',
			width: '350',
			height: '395',
			resizable: false,
			draggable: false,
			buttons: {
				"<?php echo $this->translate('use_this_btm'); ?>": function() {
					var ammount = parseInt($('#btm_ammount').val());
					var medid = parseInt($('#btm_sel').val());
					var method = parseInt($('#btm_method').val());
					var source = $('#btm_source').val();
					var userid = parseInt($('#btm_users').val());

					var submit_btm = '0';

					if(validatePositiveInteger($('#btm_ammount').val()) && ammount>0){
						if(method == '7'){
							var stock = parseInt($('#stock_'+medid+'_'+userid).val());

							if(ammount <= stock) {
								$('#btm_error').html('');
//								$('#patient_btm_icon').submit();
								var submit_btm = 1;
							} else {
								$('#btm_error').html('<?php echo $this->translate('ammount_is_higher_than_stock'); ?> ('+stock+')');
							}
						} else if(method == '8') {
							if(source == 'u' || source == 'p')
							{
								var stock = '0';
								//reset error
								$('#btm_error').html('');

								if($('#pat_stock_'+medid) && source == 'p') {
									var stock = parseInt($('#pat_stock_'+medid).val());
								}

								if($('#stock_'+medid+'_'+userid) && source == 'u') {
									var stock = parseInt($('#stock_'+medid+'_'+userid).val());
								}

								if(ammount <= stock) {
									$('#btm_error').html('');
									var submit_btm = '1';
								} else {
									$('#btm_error').html('<?php echo $this->translate('ammount_is_higher_than_stock'); ?> ('+stock+')');
								}
							} else {
								$('#btm_error').html('<?php echo $this->translate('select_ammount_source'); ?>');
							}
						} else if(method == '9' || method == '11') {
							if($('#pat_stock_'+medid).val()) {
								var stock = parseInt($('#pat_stock_'+medid).val());
							} else {
								var stock = '0';
							}

							//use curent user stock
							if(ammount <= stock) {
								$('#btm_error').html('');
								var submit_btm = '1';
							} else {
								$('#btm_error').html('<?php echo $this->translate('ammount_is_higher_than_patient_stock'); ?> ('+stock+')');
							}
						} else {
							$('#btm_error').html('');
							var submit_btm = '1';
						}
					} else {
						$('#btm_error').html('<?php echo $this->translate('ammount_must_be_higher_than_0'); ?>');
					}

					if(submit_btm == '1' )
					{
						
						//verify if BTM medis amount if greater than 1
						if (Math.abs(parseInt($('#btm_ammount').val())) > 1){
							jConfirm('<?php echo $this->translate('btm_over_1_alert_message'); ?>', '<?php echo $this->translate('btm_over_1_alert_title'); ?>', function(r) {
								if(r) {
									ajax_clientbtmbuchcheck();
								}
							});
						}
						else{
							$('.ui-dialog-buttonpane button:first').prop('disabled',true); // TODO-1718 on 04.09.2018 by Ancuta
							ajax_clientbtmbuchcheck();
							
						}
						

						
					}
				},
				"<?php echo $this->translate('cancel'); ?>": function() {
					$(this).dialog("close");
				}
			},
			open: function() {
				//load ajax
				load_btm_form('<?php echo $_REQUEST['id']; ?>');
				reset_btm_modal();
			},
			close:function(){
				reset_btm_modal();
			}
		});

		function ajax_clientbtmbuchcheck()
		{	
			$.ajax({
				type: 'POST',
				url: 'ajax/btmbuchcheck?id=<?php echo $_REQUEST['id']; ?>',
				data: {
					date: $('#btm_date').val(),
					time: $('#btm_time').val(),
					source: $('#source').val(),
					medicationid: $('#btm_sel').val(),
					method: $('#btm_method').val(),
					selectUser: $('#btm_users').val(),
					amount: Math.abs(parseInt($('#btm_ammount').val())),
					amount_source: $('#btm_source').val(),
					btm_number:$('#btm_number').val(),				//ISPC-2768 Lore 05.01.2020
					sonstige_more: $('#sonstige_more').val()
				},
				success:function(jdata){
					var data = jQuery.parseJSON(jdata);
					
					if(data.date_error == ""){
						if(data.allow_operation =="1"){
	 						$('.ui-dialog-buttonpane button:first').attr('disabled', 'disabled');
	 						$('#btm_actions_modal').block({
	 							css: {
	 								padding: '5px',
	 								backgroundColor: '#000',
	 								'-webkit-border-radius': '5px',
	 								'-moz-border-radius': '5px',
	 								opacity: .5,
	 								color: '#fff',
	 								height: 'auto',
	 								width:'auto',
	 								left: '50px'
	 							},
	 							message: '<h2 style="padding:5px;"><?php echo $this->translate('btm_icon_modal_saving'); ?></h2><img src="<?php echo RES_FILE_PATH ?>/images/ajax-loader-bar.gif" style="width:150px;">'
	 						});

	 						$.ajax({
	 							type: 'POST',
	 							url: 'patient/btmbuch?id=<?php echo $_REQUEST['id']; ?>',
	 							data: {
	 								date: $('#btm_date').val(),
	 								time: $('#btm_time').val(),
	 								source: $('#source').val(),
	 								medicationid: $('#btm_sel').val(),
	 								method: $('#btm_method').val(),
	 								selectUser: $('#btm_users').val(),
	 								amount: Math.abs(parseInt($('#btm_ammount').val())),
	 								amount_source: $('#btm_source').val(),
	 								btm_number:$('#btm_number').val(),			//ISPC-2768 Lore 05.01.2020
	 								sonstige_more: $('#sonstige_more').val()
	 							},
	 							success:function(data){
	 								$('#btm_actions_modal').dialog("close");
	 								$('#btm_actions_modal').unblock();
	 								$('.ui-dialog-buttonpane button:first').removeAttr('disabled');

	 								var action_name = '<?php echo Zend_Controller_Front::getInstance()->getRequest()->getActionName(); ?>';

	 								if(action_name == 'patientcourse') {
	 									window.location.reload(true);
	 								}
	 							}
	 						});
						} else {
							alert("<?php echo $this->translate('Please check the medication stock - it was recently modified');?>")
						}
					} else{
						alert(data.date_error)
					}
				}
			});
			
		}


		$('#btm_actions').live('click', function() {
			$('#btm_actions_modal').dialog('open');
		});


		$('#btm_method_row').hide();
		$('#btm_user_row').hide();
		$('#btm_sonstige_more').hide();
		$('#btm_users_row').hide();
		$('#btm_ammount_row').hide();
		$('#btm_ammount_source_row').hide();
		$('#btm_error').html('');

		$('#btm_sel').live('change', function() {

			var $medication_id = $(this).val();

			if($('#stock_'+$medication_id+'_'+parseInt($('#btm_users').val())).length){
				var $user_stock_value = $('#stock_'+$medication_id+'_'+parseInt($('#btm_users').val())).val();
			} else {
				var $user_stock_value = '0';
			}


			if($('#pat_stock_'+$medication_id).val() > '0'){
				var $patient_stock_value = $('#pat_stock_'+$medication_id).val();
			} else {
				var $patient_stock_value = '0';
			}

			$('#user_stock_label').html($user_stock_value);
			$('#patient_stock_label').html($patient_stock_value);


			$('#btm_error').html('');
			if ($(this).val() != '') {
				$('#stock_details').show();
				$('#btm_method').val('');
				$('#btm_method_row').show();
				$('#btm_sonstige_more').hide();
				$('#btm_users_row').hide();
				$('#btm_ammount_row').hide();
				$('#btm_ammount_source_row').hide();
			} else {
				$('#stock_details').hide();
				$('#btm_method').val('');
				$('#btm_method_row').hide();

				//hide and reset inputs
				$('#btm_user_row').hide();
				$('#btm_sonstige_more').hide();
				$('#btm_users_row').hide();

				$('#btm_ammount').val('');
				$('#btm_ammount_row').hide();

				$('#btm_ammount_source_row').hide();
			}
		});

		$('#btm_method').live('change', function() {
			$('#btm_error').html('');
			var value = $(this).val();
			var disable_ammount = false;

			if (value == '7' || value == '9') {
				$('#btm_user_row').show();
			} else {
				$('#btm_user_row').hide();
			}
			
			if (value == '11') {
				$('#btm_sonstige_more').show();
			} else {
				$('#btm_sonstige_more').hide();
			}
				
			if(value == '8') {
				var medid = parseInt($('#btm_sel').val());
				var method = parseInt($('#btm_method').val());
				var userid = parseInt($('#btm_users').val());

				//set stock from patient
				var pat_stock = parseInt($('#pat_stock_'+medid).val());

				//set stock from user
				var user_stock = parseInt($('#stock_'+medid+'_'+userid).val());
				var options = '<option value=""><?php echo $this->translate('select_btm_source'); ?></option>';

				if(pat_stock > 0)
				{
					options += '<option value="p"><?php echo $this->translate('patient_as_source'); ?> ('+pat_stock+')</option>';
				}

				if(user_stock > 0)
				{
					options += '<option value="u"><?php echo $this->translate('user_as_source'); ?>('+user_stock+')</option>';
				}

				$('#btm_source').html(options);

				if(pat_stock > '0' || user_stock > '0') {
					$('#btm_source_nostock').hide();
					$('#btm_source').show();
				} else {
					disable_ammount = true;
					$('#btm_source').hide();
					$('#btm_source_nostock').show();

				}

				$('#btm_ammount_source_row').show();

			} else {
				$('#btm_ammount_source_row').hide();
				$('#btm_source options').remove();
				$('#btm_source').hide();
			}

			if (value != '' && disable_ammount === false) {
				$('#btm_ammount_row').show();
			} else if(value != '' && disable_ammount === true) {
				$('#btm_ammount_row').hide();
			} else {
				$('#btm_user_row').hide();
				$('#btm_ammount').val('');
				$('#btm_ammount_row').hide();
				$('#btm_ammount_source_row').hide();
				$('#btm_source_nostock').hide();
			}
		});
<?php endif; ?>


$('.remove_cave').on('click', function() {
	var entry_id = $(this).attr("rel")
 	var comment_value ="<?php echo $this->translate('reason for removing cave'); ?>";
 	var patient_id = '<?php echo $_REQUEST['id']; ?>';
	jConfirm('<?php echo $this->translate('confirmdeleterecord'); ?>', '<?php echo $this->translate('remove cave model title'); ?>', function(r) {
		if (r)
		{
			ajaxCallserver({
				url : 'patientcourse/savewrongcave',
				method : 'POST',
				data : {
					comment : comment_value,
					val : 1,
					patient : patient_id,
					ids : entry_id
				}
			});			
			$('#cave_'+entry_id).hide();
		}
	});
});

$('.remove_meta').on('click', function() {
	var pdiagno_id = $(this).data("diagno_id")
	var meta_ids = $(this).data("meta_ids")
 	var comment_value ="<?php echo $this->translate('remove meta'); ?>";
 	var patient_id = '<?php echo $_REQUEST['id']; ?>';
	jConfirm('<?php echo $this->translate('confirm remove all meta data from this diagnosis '); ?>', '<?php echo $this->translate('remove all meta title'); ?>', function(r) {
		if (r)
		{
			ajaxCallserver({
				url : 'patient/patdiagnometaremove',
				method : 'POST',
				data : {
					patient : patient_id,
					pdiagno_id : pdiagno_id,
					diagno_meta_ids : meta_ids
				}
			});
			
			$('#diagnom_'+pdiagno_id).hide();
		}
	});
});



	//     ISPC-1717  next patient / last patient 
	$('#change_patient')
	.on('change', function() {
		if ($(this).val() !="") {
			var selected_pid = $(this).val();
			var url ='<?php echo APP_BASE; ?>patientcourse/patientcourse?id='+selected_pid;
			$(location).attr('href',url);
			//console.log(url);
			if(selected_pid){
				$('.pheader_navigation')
				.html("")
				.addClass("phn_content_loading");
			}
		}
	})
	.chosen({
		//ISPC-2249
        placeholder_text_single : translate('please select'),
        placeholder_text_multiple : translate('please select'),
        no_results_text : translate('noresultfound'),
        multiple : false,
        "search_contains" : true
    });

	
	$('.next_patient').on('click', function() {
		$('.pheader_navigation').html("");
		$('.pheader_navigation').addClass("phn_content_loading");
	});
	
	$('.prev_patient').on('click', function() {
		$('.pheader_navigation').html("");
		$('.pheader_navigation').addClass("phn_content_loading");
	});
	

	//give_scheduled_medication
	
	$(".give_scheduled_medication").on('click',function(){
	 	var patient_id = '<?php echo $_REQUEST['id']; ?>';
		var drug_id = $(this).data("drug_id");
		var int_current_date= '<?php echo date("d.m.Y",time()); ?>';
		
		jConfirm('<?php echo $this->translate('confirm_give_medication'); ?>', '<?php echo $this->translate('confirm_give_medication_title'); ?>', function(r) {
		    if(r) {
		    	
				$.ajax({
					type: 'POST',
					url: 'ajax/givescheduledmed',
					data: {
						id: patient_id,
						drug_id: drug_id
					},
					success:function(response){
						
						$('#interval_set_button_'+drug_id).remove();
						$('#due_date_'+drug_id).html(int_current_date);
						setTimeout(function () {
							$('#sch_'+drug_id).remove();
						}, 800);
								
						//console.log(response);
						var response_obj = jQuery.parseJSON(response);
						if (response_obj['remove_icon'] == '1') {
							$('#sys_icon-52').remove();
							$('#content_sys_icon-52').remove();
						}
					}
				});
				
		    } else {
				//$('#status_readmit_data').dialog('close');
			}
		});
		
		
	});
	
	$('.done_event').live('click', function() {
		if ($(this).is(':checked')) {
			var row_id = $(this).attr('rel');
			//ISPC - 2368
			$('#contactArea').html('<iframe id="add_family_doc" frameborder="0" src="" scrolling="no" style="margin:0 auto;"></iframe>');


			centerPopup({sr:'about:blank',ht:250,wt:450});

			$('#contactArea').html('<div><?php echo $this->translate('completecomment'); ?><div align="right"><a id="popupContactClose" style="cursor:pointer;" onclick="uncheckbox(\'done_event_'+row_id+'\');closepopup()">x</a></div></div><div><textarea name="completecomment" id="completecomment"></textarea></div><div><button name="" onClick="saveCompleteComment(\''+row_id+'\');"><?php echo $this->translate('submit');?></button></div>');

			loadPopup();
			
			/* var todo_nr = $(this).data('todo_nr');
			var todo_idss = $("#todoids_"+todo_nr).val();
			var todo_ids = todo_idss.split(',');
			
			var event_tabname = 'todo';
			var event_done_date = $.datepicker.formatDate('yy-mm-dd', new Date());
			$('#loading_div_'+ todo_nr).show();
			//$('tr#d_row_' + row_id).effect("highlight", {}, 5000);
			$.each(todo_ids, function(index, value) {
				//alert(value);
			mark_event_done(value, todo_nr, event_tabname, event_done_date);
			}); */
		}
	});
	
	document.title = '<?php echo addslashes(trim($this->last_name . ", " . $this->first_name)); ?>';
	

	//$('#sys_icon-64').live('click',function() {
	/*$(document).on('click', '#sys_icon-64, #sys_icon-65, #sys_icon-66', function(){
		var tabname = $(this).attr('id');	
	alert(tabname);
		if($('#content_'+tabname).is(":visible")){
			$('#content_'+tabname).hide();
		} else{
			$('#content_'+tabname).show();
		}
		$('#current_problem_modal').data('tabname', tabname).dialog('open');
		
	});
	
	$('#current_problem_modal').dialog({
		autoOpen: false,
		modal: true,
		title: '<?php echo $this->translate('current_problem__modal_title'); ?>',
		width: '450',
		height: '450',
		resizable: false,
		draggable: false,
		
		buttons : [
           {
        	   text : translate('save'),
        	   click : function() {
        		   $.ajax({
        			   type: 'POST',
        			   url: 'patientform/vitalsigns?id=<?php echo $_REQUEST['id']; ?>',
					   data: $('#vital_signs_icon_form').serialize(),
					   success:function(data){
								$('#vital_signs_modal').dialog("close");
								$('#vital_signs_modal').unblock();
								$('.ui-dialog-buttonpane button:first').removeAttr('disabled');

								var action_name = '<?php echo Zend_Controller_Front::getInstance()->getRequest()->getActionName(); ?>';

								if(action_name == 'patientcourse') {
									window.location.reload(true);
								}
							}
						});
				}
           },
           {
        	   text : translate('cancel'),
        	   click : function() {
        		   //$('#vital_signs_modal').html('<div id="loading_vs" style="display: none; width: 100%; text-align: center"><img src="<? echo RES_FILE_PATH;  ?>/images/pageloading.gif"></div>');
        		   $(this).dialog("close");
			}}
		],
		open: function(ui) {
			
			$('#loading_cp', this).show();*/
			/*
			$( ".datepick" ).datepicker({
					dateFormat: 'dd.mm.yy',
					showOn: "both",
					buttonImage: $('#calImg').attr('src'),
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: ''
				}).mask("99.99.9999");	
			 */
			/* if ($("#loading_cp", this).length){
				var tabname = $('#current_problem_modal').data('tabname') 
				$('#current_problem_modal').load('<?php  echo APP_BASE."ajax/loadcurrentproblemform?id=".$_REQUEST['id']; ?>&tabname='+tabname);
			 } else {
				 $(ui.target).find('input[type=text]').not('.vs_datepick').val('');
			 }
			
		},
		close:function(){
//				reset_btm_modal();
		}
	});*/
	
	$(document).on('click', '.current_problem', function() {
		var icon = $(this).attr("data-icon");

		if(!changing){
			width = 770;
			height =this.offsetHeight + 2;

			if(width < 70) width = 90;
			if(height < 50) height = 50;
			//if(this.innerHTML == 'Dies ist ein Memo Feld, klicken Sie hier um etwas einzutragen.') { this.innerHTML = ''; }
			if(this.innerHTML == "<?php echo $this->translate('No data, click to add'); ?>") { this.innerHTML = ''; }
			this.innerHTML = "<textarea name=\""+icon+"\" class=\"current_problem_text\" style=\"width: "+width+"px; height: "+height+"px;\" >" + br2nl(this.innerHTML) + "</textarea>";

			changing = true;
		}

		this.firstChild.focus();		
		
	});
	
	$(document).on('blur', '.current_problem_text', function() {
		var fieldname = $(this).attr('name');
		var content = $(this).val();
		var urlBase = "ajax/savecurrentproblem";
		remotos = new datosServidor;
		
		nt = remotos.enviar(urlBase + "?fieldname=" +encodeURIComponent(fieldname)+'&pid=<?php echo $_REQUEST["id"]; ?>', content);
		if(content != '')
		{
			this.parentElement.innerHTML = content;
		}
		else
		{
			//this.parentElement.innerHTML = 'Dies ist ein Memo Feld, klicken Sie hier um etwas einzutragen.';
			this.parentElement.innerHTML = "<?php echo $this->translate('No data, click to add'); ?>";			
		}
		
		changing = false;
		
	});
	
	//TODO-3707 Lore 06.01.2021
	$(document).on('click', '.ventilation', function() {
		var icon = $(this).attr("data-icon");

		if(!changing){
			width = 770;
			height =this.offsetHeight + 2;
	
			if(width < 70) width = 90;
			if(height < 50) height = 50;
			//if(this.innerHTML == 'Dies ist ein Memo Feld, klicken Sie hier um etwas einzutragen.') { this.innerHTML = ''; }
			if(this.innerHTML == "<?php echo $this->translate('No data, click to add'); ?>") { this.innerHTML = ''; }
			this.innerHTML = "<textarea name=\""+icon+"\" class=\"current_problem_text\" style=\"width: "+width+"px; height: "+height+"px;\" >" + br2nl(this.innerHTML) + "</textarea>";
	
			changing = true;
		}
	
		this.firstChild.focus();		
	
	});
	//.

	//ISPC - 2304
	var show_email_info_handlerIn = function(){
		$('#email_info').show();
	};
	var show_email_info_handlerOut = function(){
		$('#email_info').hide();
	};
	$('#show_email_info')
	.bind('mouseover', show_email_info_handlerIn)
	.bind('mouseout', show_email_info_handlerOut)
	.click(function(evt) {
		
		var _events = $._data(this, "events");
		var _hasHover = _events['mouseover'] && _events['mouseout'];
		
		if (_hasHover) {
			//detach and off
			$(this).unbind('mouseover').unbind('mouseout').off('mouseleave').off('mouseover');
		} else {
			//re-attach and hide
			$(this).bind('mouseover', show_email_info_handlerIn);
			$(this).bind('mouseout', show_email_info_handlerOut).trigger('mouseout');
		}
		
		return;
		
	});
	
	//ISPC-2508 Carmen 30.01.2020
	//Ancuta added to Clinic ISPC (CISPC)  on 18.03.2020
	//gives artificial entries exits expired
	//ISPC-2508 Carmen 26.05.2020 new design
	$(document).on('click', ".set_patient_artificial_setting", function(){
		var openfrom = $(this).data('openfrom');
		$('#patient_charts_actions_modal').data('recid', $(this).data('recid')).data('openfrom', openfrom).dialog('open');
	});
	/* $(".set_patient_artificial_setting").on('click',function(){
	 	var patient_id = '<?php echo $_REQUEST['id']; ?>';
		var artset_id = $(this).data("setting_id");
		var action = $(this).data("action");
		//var int_current_date= '<?php echo date("d.m.Y",time()); ?>';
		
		jConfirm(translate('[Are you sure you want to '+action +' this artificial entry/exit ?]'), translate('confirmdeletetitle'), function(r) {
		    if(r) {
		    	
				$.ajax({
					type: 'POST',
					url: 'ajax/setpatientartificialsetting',
					data: {
						id: patient_id,
						artset_id: artset_id,
						action: action
					},
					success:function(response){
						
						setTimeout(function () {
							$('#part_'+artset_id).remove();
						}, 800);
								
						//console.log(response);
						var response_obj = jQuery.parseJSON(response);
						
						if (response_obj['remove_icon'] == '1') {
							$('#sys_icon-72').remove();
							$('#content_sys_icon-72').remove();
						}
					}
				});
				
		    } else {
				//$('#status_readmit_data').dialog('close');
			}
		});
	}); */
	
	//ISPC-2547 Carmen 03.03.2020
	//document the given of medication from medi icon if module 220 is activated
	//class addinfo can be used on li to add a textarea for documented info
	//ISPC-2583 Carmen 28.04.2020 - change to update as in charts
	if(given_medi_documented == '1') {
		//$('.dose').live('click', function() {
		$(document).on('click', '.dose, .onedose', function() {
			
			var givenData = $(this).data('given');
	
			switch($(this).data('medication_type')) {
			  case 'N':
			    var med_type = 'isbedarfs';
			    break;
			  case 'Q':
				  var med_type = 'isschmerzpumpe';
			    break;
			  case 'KM':
				  var med_type = 'iscrisis';
			    break;
			  default:
				  var med_type = 'actual';
			  	break;
			}
			
			
			if(givenData != '')
			{
			$('#medication_dosage_interaction_modal')
					.data('drugplan_id', givenData.drugplan_id )
					.data('cocktail_id', givenData.cocktail_id)
					.data('medication_type', med_type)
					.data('medication_name', $(this).data('medication'))
                    .data('dosage_status', givenData.dosage_status )
                    .data('dosage', givenData.dosage )
                    .data('entry_id', givenData.entry_id )
                    .data('dosage_date', givenData.dosage_date )
                    .data('dosage_time_interval', givenData.dosage_time_interval )
                    .data('documented_info', givenData.documented_info )
                    .data('not_given_reason', givenData.not_given_reason)
                    .data('time_schedule', $(this).data('time_schedule'))
					.data('md_source', 'icon').data('that', $(this)).dialog('open');
			}
			else
			{
				$('#medication_dosage_interaction_modal')
				.data('drugplan_id', $(this).data('drugplan_id'))
				.data('cocktail_id', $(this).data('cocktail_id'))
				.data('medication_type', med_type)
				.data('medication_name', $(this).data('medication'))
				.data('entry_id', '0')
				.data('dosage_unit', '')
				.data('dosage_status', '')
                .data('dosage_time_interval', $(this).data('dosage_time_interval'))
                .data('dosage', $(this).data('dosage'))
                .data('dosage_date', $(this).data('dosage_date'))
                .data('documented_info', '')
                .data('not_given_reason', '')
                .data('time_schedule', $(this).data('time_schedule'))
				.data('md_source', 'icon').data('that', $(this)).dialog('open');
			}
		});
	}
	else
	{
		$('li.dose'). each(function(){
			if($(this).hasClass('givenow'))
			{
				$(this). removeClass('givenow');
			}
		});
		$('li.onedose'). each(function(){
			if($(this).hasClass('givenow'))
			{
				$(this). removeClass('givenow');
			}
		});
	}
		
		$('#medication_dosage_interaction_modal').dialog({
			autoOpen: false,
			modal: true,
			width: 650,
			height: 450,
			title:  "Medication",
			dialogClass: "charts_modal",
			open: function(){
				
			
				if(($('#patient-main-add-modal').length && $('#patient-main-add-modal').hasClass('ui-dialog-content') && $('#patient-main-add-modal').dialog('isOpen'))  || typeof loadPage != 'function' || (typeof loadPage == 'function' && $(this).data('md_source') == 'icon'))
				{
					$('#med_save_go_back').show();
				}
				else
				{				
					$('#med_save_go_back').hide();
				}
				jQuery('.ui-widget-overlay').on('click', function () {
					$('#medication_dosage_interaction_modal').dialog('close');
				});
				$('#modal_loading_div', this).show();
	           var dosageData = {
	        		   drugplan_id: $(this).data('drugplan_id'),
	        		   cocktail_id: $(this).data('cocktail_id'),
				   		pumpe_id: $(this).data('pumpe_id'),//ISPC-2871,Elena,12.04.2021
	        		   entry_id: $(this).data('entry_id'),
	        		   medication_name: $(this).data('medication_name'),
	        		   time_schedule: $(this).data('time_schedule'),
	        		   dosage_status: $(this).data('dosage_status'),
	        		   dosage: $(this).data('dosage'),
	        		   dosage_unit: $(this).data('dosage_unit'),
	        		   dosage_date: $(this).data('dosage_date'),
	        		   dosage_time_interval: $(this).data('dosage_time_interval'),
	        		   documented_info: $(this).data('documented_info'),
	        		   not_given_reason: $(this).data('not_given_reason'),
				};
	           console.log(dosageData);
	           if(dosageData.dosage_status != '' && dosageData.dosage_status !== null)
		   		{
		   			if($(this).parent().find('.delbutton').is(":hidden"))
					{
		   				$(this).parent().find('.delbutton').show();
					}
		   		}
		   		else
		   		{
		   			$(this).parent().find('.delbutton').hide();
		   		}
				
				var url = 'patientevents/events?action=show_form&form=dosage_interaction&medication_type='+$(this).data('medication_type');
				
				$.ajax({
					type: 'POST',
					data: dosageData,
					url: url,
					
					success:function(data){
						
						$('#medication_dosage_interaction_modal').html(data);
						
						$('.time')
						.timepicker({
							minutes: {
								interval: 5
							},
							showPeriodLabels: false,
							rows: 4,
							//ISPC-2661 Carmen
		        			timeOnlyTitle: translate('Choose Time'),
		        			timeText: 'Zeit',
		        			closeText: 'Ende',
		        			//--
							hourText: 'Stunde',
							minuteText: 'Minute'
						})
						.mask("99:99");
						
						$( ".date" ).datepicker({
							dateFormat: 'dd.mm.yy',
							showOn: "both",
							buttonImage: $('#calImg').attr('src'),
							buttonImageOnly: true,
							changeMonth: true,
							changeYear: true,
							nextText: '',
							prevText: '',
							maxDate: '0',
						}).mask("99.99.9999");
					},
					error:function(){
						
					}
				});
			},
			buttons:[
						//delete button
						{
							'class' : "delbutton leftButton",
							text : 'Eintrag l√∂schen',
							click : function() {
							var that = $(this).data('that');
							var md_source = $(this).data('md_source');
							
							var pid = "<?php echo $_REQUEST['id']; ?>";
							
							var time_sched = $(this).data('time_schedule');
							
							var formdata = $('.dosage_interaction').map(function() {
								
								var formset = {};
								$(this).find(':input').each(function() {				    		
									
									if(this.type == 'radio' && $(this).is(":checked"))
									{
										formset[this.name] = $(this).val();
									}
									else if(this.type != 'radio')
									{
										formset[this.name] = $(this).val();
									}
								});
								return formset;
							}).get();
							
							var set_data  = formdata[0];
							set_data['dosage_time_interval'] = $(this).data('dosage_time_interval');
							set_data['medication_name'] = $(this).data('medication_name');
							
							jConfirm(translate('[Are you sure you want to delete this?]'), translate('confirmdeletetitle'), function(r) {
							    if(r) {	
							    	
							    	console.log(that);
									$.ajax({
										 type: 'POST',
										 url: 'patientevents/events?action=save_form&form=dosage_interaction_save&subaction=delete&patid='+pid,
										 data: set_data,
										 success:function(data){
											 $('#medication_dosage_interaction_modal').dialog("close");
											 if( md_source == 'icon')
											 {
													if(time_sched == '1')
													{
														if(that.hasClass('<?php echo $color_map["given"]; ?>'))
														{
															that.removeClass('<?php echo $color_map["given"]; ?>');
														}
														else if(that.hasClass('<?php echo $color_map["given_different_dosage"]; ?>'))
														{
															that.removeClass('<?php echo $color_map["given_different_dosage"]; ?>');
														}
														else if(that.hasClass('<?php echo $color_map["not_taken_by_patient"]; ?>'))
														{
															that.removeClass('<?php echo $color_map["not_taken_by_patient"]; ?>');
														}
														else if(that.hasClass('<?php echo $color_map["not_given"]; ?>'))
														{
															that.removeClass('<?php echo $color_map["not_given"]; ?>');
														}
													
														setTimeout(function () {
															that.removeClass('given');
															that.addClass('givenow');
														}, 1500);
													}
											 }
											 
											 if (typeof loadPage == 'function' && md_source == 'charts') { 
													loadPage(); 
												}
												else
												{
													//window.location.reload(true);
													// go to charts Ancuta 05.06.2020
													window.location.href = appbase + 'charts/overview?id='+pid+'#symptomatology_chart';
												}
													/* $('#awake_sleeping_modal').unblock();
													$('.ui-dialog-buttonpane button:first').removeAttr('disabled');
						
													var action_name = '<?php echo Zend_Controller_Front::getInstance()->getRequest()->getActionName(); ?>';
						
													if(action_name == 'patientcourse') {
														window.location.reload(true);
													} */
										 }
									 });
							    }
							});
								
							},
							
						},
					
				{
					click: function(){
						

						var md_source = $(this).data('md_source');
						
						var pid = "<?php echo $_REQUEST['id']; ?>";
						
						var that = $(this).data('that');
						
						var time_sched = $(this).data('time_schedule');
						
						var formdata = $('.dosage_interaction').map(function() {
							
							var formset = {};
							$(this).find(':input').each(function() {				    		
								
								if(this.type == 'radio' && $(this).is(":checked"))
								{
									formset[this.name] = $(this).val();
								}
								else if(this.type != 'radio')
								{
									formset[this.name] = $(this).val();
								}
							});
							return formset;
						}).get();
						
						var set_data  = formdata[0];
						set_data['dosage_time_interval'] = $(this).data('dosage_time_interval');
						set_data['medication_name'] = $(this).data('medication_name');
						
							$.ajax({
								type: 'POST',
								url: 'patientevents/events?action=save_form&form=dosage_interaction_save&patid='+pid,
								data: set_data,
								success:function(data){
									$('#medication_dosage_interaction_modal').dialog("close");
									
									if(md_source == 'icon')
									{
										if(time_sched == '1')
										{
											if(that.hasClass('<?php echo $color_map["given"]; ?>'))
											{
												that.removeClass('<?php echo $color_map["given"]; ?>');
											}
											else if(that.hasClass('<?php echo $color_map["given_different_dosage"]; ?>'))
											{
												that.removeClass('<?php echo $color_map["given_different_dosage"]; ?>');
											}
											else if(that.hasClass('<?php echo $color_map["not_taken_by_patient"]; ?>'))
											{
												that.removeClass('<?php echo $color_map["not_taken_by_patient"]; ?>');
											}
											else if(that.hasClass('<?php echo $color_map["not_given"]; ?>'))
											{
												that.removeClass('<?php echo $color_map["not_given"]; ?>');
											}
											
											if(typeof set_data.dosage_status !== 'undefined')
											{
												if(that.hasClass('givenow') && set_data.dosage_status != 'not_given')
												{
													that.removeClass('givenow');
													that.addClass('given');
												}
												else if(that.hasClass('given') && set_data.dosage_status == 'not_given')
												{
													that.removeClass('given');
													that.addClass('notgiven');
												}
												else if(that.hasClass('notgiven') && set_data.dosage_status != 'not_given')
												{
													that.removeClass('notgiven');
													that.addClass('given');
												}												
												
												var colormap = <?php echo $color_map_js; ?>;											
												that.addClass(colormap[set_data.dosage_status]);
											}
										}
										else
										{
											setTimeout(function () {												
													that.removeClass('givenow');
													that.addClass('given');
											}, 400);
											setTimeout(function () {												
												that.removeClass('given');
												that.addClass('givenow');
											}, 1500);
										}
									}
									
									if (typeof loadPage == 'function' && md_source == 'charts') { 
										loadPage();
									}else if(md_source == 'button')//ISPC-2914,Elena,10.05.2021
									{
										//window.location.reload(true);
										$('.modal_loading_div', this).show();
//		   		$('#medication_dosage_view_modal').load(appbase + 'patientevents/medicationicon?id=' + idpd ,{},);
										$('#medication_dosage_view_modal').load(appbase + 'patientevents/medicationicon?id=' + idpd );
									}
									else
									{
										//window.location.reload(true);
									}
									 /*$('#awake_sleeping_modal').unblock();
		 								$('.ui-dialog-buttonpane button:first').removeAttr('disabled');
	
		 								var action_name = '<?php echo Zend_Controller_Front::getInstance()->getRequest()->getActionName(); ?>';
	
		 								if(action_name == 'patientcourse') {
									window.location.reload(true);
		 								} */
	//								window.location.reload(true);
								}
							});
					},
					text: translate('save')
				},
				//ISPC-2517 Carmen 05.06.2020
				{
					click: function(){
						

						var md_source = $(this).data('md_source');						

						var md_type = $(this).data('medication_type');
						
						var pid = "<?php echo $_REQUEST['id']; ?>";
						
						var that = $(this).data('that');
						
						var time_sched = $(this).data('time_schedule');
						
						var formdata = $('.dosage_interaction').map(function() {
							
							var formset = {};
							$(this).find(':input').each(function() {				    		
								
								if(this.type == 'radio' && $(this).is(":checked"))
								{
									formset[this.name] = $(this).val();
								}
								else if(this.type != 'radio')
								{
									formset[this.name] = $(this).val();
								}
							});
							return formset;
						}).get();
						
						var set_data  = formdata[0];
						set_data['dosage_time_interval'] = $(this).data('dosage_time_interval');
						set_data['medication_name'] = $(this).data('medication_name');
						
							$.ajax({
								type: 'POST',
								url: 'patientevents/events?action=save_form&form=dosage_interaction_save&patid='+pid,
								data: set_data,
								success:function(data){
									$('#medication_dosage_interaction_modal').dialog("close");
									if ($('#medication_dosage_view_modal').is(":visible")){
										$('#medication_dosage_view_modal').dialog("close");
										$('#patient-main-add-modal').dialog("close");
									}
									
									if(md_source == 'icon')
									{
										if(time_sched == '1')
										{
											if(that.hasClass('<?php echo $color_map["given"]; ?>'))
											{
												that.removeClass('<?php echo $color_map["given"]; ?>');
											}
											else if(that.hasClass('<?php echo $color_map["given_different_dosage"]; ?>'))
											{
												that.removeClass('<?php echo $color_map["given_different_dosage"]; ?>');
											}
											else if(that.hasClass('<?php echo $color_map["not_taken_by_patient"]; ?>'))
											{
												that.removeClass('<?php echo $color_map["not_taken_by_patient"]; ?>');
											}
											else if(that.hasClass('<?php echo $color_map["not_given"]; ?>'))
											{
												that.removeClass('<?php echo $color_map["not_given"]; ?>');
											}
											
											if(typeof set_data.dosage_status !== 'undefined')
											{
												if(that.hasClass('givenow') && set_data.dosage_status != 'not_given')
												{
													that.removeClass('givenow');
													that.addClass('given');
												}
												else if(that.hasClass('given') && set_data.dosage_status == 'not_given')
												{
													that.removeClass('given');
													that.addClass('notgiven');
												}
												else if(that.hasClass('notgiven') && set_data.dosage_status != 'not_given')
												{
													that.removeClass('notgiven');
													that.addClass('given');
												}												
												
												var colormap = <?php echo $color_map_js; ?>;											
												that.addClass(colormap[set_data.dosage_status]);
											}
										}
										else
										{
											setTimeout(function () {												
													that.removeClass('givenow');
													that.addClass('given');
											}, 400);
											setTimeout(function () {												
												that.removeClass('given');
												that.addClass('givenow');
											}, 1500);
										}
									}
									
									if (typeof loadPage == 'function' && md_source == 'charts') { 
										loadPage();
									}
									else
									{										
										// go to charts Ancuta 05.06.2020
										window.location.href = appbase + 'charts/overview?id='+pid+'#medication_'+md_type+'_chart';
										//window.location.reload(true);
									}
									 /*$('#awake_sleeping_modal').unblock();
		 								$('.ui-dialog-buttonpane button:first').removeAttr('disabled');
	
		 								var action_name = '<?php echo Zend_Controller_Front::getInstance()->getRequest()->getActionName(); ?>';
	
		 								if(action_name == 'patientcourse') {
									window.location.reload(true);
		 								} */
	//								window.location.reload(true);
								}
							});
					},
					text: translate('save and go back to chart'),
					'id' : 'med_save_go_back'
				},
				//--
				{
					click: function(){
						
						$('#medication_dosage_interaction_modal').dialog("close");
					},
					text: translate('cancel'),
				}
			]
		});
		/* $(".dose").on('click',function(){
		 	var patient_id = '<?php echo $_REQUEST['id']; ?>';
		 	var dosage = $(this).text();
		 	var has_given = $(this).hasClass('given');
		 	var has_givenow = $(this).hasClass('givenow'); //ISPC-2583 Carmen 27.04.2020
		 	var drugplan_id = $(this).data('drugplanid');
		 	var dosage_time = $(this).data('dosagetime');
		 	var medication = $(this).data('medication');
		 	var has_addinfo = $(this).hasClass('addinfo');
		 	var that = $(this);
			
		 	if(dosage)
		 	{
		 		if(has_given)
		 		{
		 			var action = 'remove';
		 			
		 			// var html_pop = translate('[Are you sure you want to undocument the given for] ') + medication + ' and time ' + dosage_time +'?'; 
		 			//ISPC-2547 Lore 26.03.2020
		 			var html_pop = translate('[Are you sure you want to undocument the given for] ') + medication + translate(' and time ') + dosage_time +'?';
		 			if(has_addinfo)
		 			{
		 				html_pop += '<br /><textarea class="documented_info" id="documented_info_'+drugplan_id+'"></textarea>';
		 			}
		 		}
		 		else if(has_givenow) //ISPC-2583 Carmen 27.04.2020
		 		{
		 			var action = 'set';
		 			// var html_pop = translate('[Are you sure you want to document the given for] ') + medication + ' and time ' + dosage_time +'?'; 
		 			//ISPC-2547 Lore 26.03.2020
		 			var html_pop = translate('[Are you sure you want to document the given for] ') + medication + translate(' and time ') + dosage_time +'?';
		 			if(has_addinfo)
		 			{
		 				html_pop += '<br /><textarea class="documented_info" id="documented_info_'+drugplan_id+'"></textarea>';
		 			}
		 		}
		 		//ISPC-2583 Carmen 27.04.2020
		 		else
		 		{
		 			var action = 'noaction';
		 		}
		 		
		 		if(action != 'noaction')
		 		{
		 		//--	
		 			$('#documentedconfirm').dialog({
						autoOpen: true,
						modal: true,
						width: 400,
				        title: translate('confirmdeletetitle'),
				        open: function() {
				          $(this).html(html_pop);
				        },
				        buttons: {
				          Ja: function() {
				        	  if ($('#documented_info_'+drugplan_id).length > 0){
				        		  var documented_info = $('#documented_info_'+drugplan_id).val();
				        	  }
				        	  else
				        	  {
				        		  var documented_info = '';
				        	  }
				        	  
				        	  $.ajax({
									type: 'POST',
									url: 'ajax/setpatientdosagegiven',
									data: {
										id: patient_id,
										drugplan_id: drugplan_id,
										dosage: dosage,
										dosage_time: dosage_time,
										documented_info: documented_info,
										medication: medication,
										action: action
									},
									success:function(response){
										
										setTimeout(function () {
											if(action == 'remove')
											{
												that.removeClass('given');
												//ISPC-2583 Carmen 27.04.2020
												if(that.hasClass('<?php echo $color_map["given"]; ?>'))
												{
													that.removeClass('<?php echo $color_map["given"]; ?>');
												}
												else if(that.hasClass('<?php echo $color_map["given_different_dosage"]; ?>'))
												{
													that.removeClass('<?php echo $color_map["given_different_dosage"]; ?>');
												}
												that.addClass('<?php echo $color_map["not_given"]; ?>');
												//--
											}
											else
											{
												that.removeClass('givenow');
												that.addClass('given');
											}
										}, 800);
									}
								});
				        	  $( this ).dialog( "close" );
				          },
				          Nein: function() {
					            $( this ).dialog( "close" );
					      }
				        
				        }
					});
		 		} //ISPC-2583 Carmen 27.04.2020
		 	}
		}); */
		
		//ISPC-2547 Carmen 09.03.2020 add given and documented info for bedarf and krise onetime dosage
		//class addinfo can be used on li to add a textarea for documented info
		/* $(".onedose").on('click',function(){

	 		if($(this).hasClass('given') || $(this).hasClass('givenow'))
	 		{
			 	var patient_id = '<?php echo $_REQUEST['id']; ?>';
			 	var dosage = $(this).text();
			 	var has_given = $(this).hasClass('given');
			 	var drugplan_id = $(this).data('drugplanid');
			 	var dosage_time = $(this).data('dosagetime');
			 	var medication = $(this).data('medication');
			 	var has_addinfo = $(this).hasClass('addinfo');
			 	var that = $(this);
				
			 	if(dosage)
			 	{
			 		if(has_given)
			 		{
			 			var action = 'remove';
						var html_pop = translate('[Are you sure you want to undocument the given for] ') + medication + '?';
						if(has_addinfo)
						{
							html_pop += '<br /><textarea class="documented_info" id="documented_info_'+drugplan_id+'"></textarea>';
						}
			 		}
			 		else
			 		{
			 			var action = 'set';
						var html_pop = translate('[Are you sure you want to document the given for] ') + medication + '?';
						if(has_addinfo)
						{
							html_pop += '<br /><textarea class="documented_info" id="documented_info_'+drugplan_id+'"></textarea>';
						}
			 		}		
					$('#documentedconfirm').dialog({
						autoOpen: true,
						modal: true,
						width: 400,
				        title: translate('confirmdeletetitle'),
				        open: function() {
				          $(this).html(html_pop);
				        },
				        buttons: {
				          Ja: function() {
				        	  
				        	  if ($('#documented_info_'+drugplan_id).length > 0){
				        		  
				        		  var documented_info = $('#documented_info_'+drugplan_id).val();
				        		 
				        	  }
				        	  else
				        	  {
				        		  var documented_info = '';
				        	  }
				        	  
				        	  $.ajax({
									type: 'POST',
									url: 'ajax/setpatientdosagegiven',
									data: {
										id: patient_id,
										drugplan_id: drugplan_id,
										dosage: dosage,
										documented_info: documented_info,
										medication: medication,
										dosage_type: 'onedose',
										action: action
									},
									success:function(response){
										
										/* setTimeout(function () {
											if(action == 'remove')
											{
												that.removeClass('given');
												that.addClass('givenow');
											}
											else
											{
												that.removeClass('givenow');
												that.addClass('given');
											}
										}, 800); */
										
										/*if(action == 'set')
										{
											setTimeout(function () {												
													that.removeClass('givenow');
													that.addClass('given');
											}, 400);
											setTimeout(function () {												
												that.removeClass('given');
												that.addClass('givenow');
										}, 1500);
										}
									}
								});
				        	  $( this ).dialog( "close" );
				          },
				          Nein: function() {
					            $( this ).dialog( "close" );
					      }
				        
				        }
					});
			 	}
	 		}
		}); */
	
	}); // end $(document).ready

	function mark_event_done(event_id, event_row, event_tabname, event_done_date, event_comment)
	{
		url = '<?php echo APP_BASE; ?>overview/dashboardlist';
		xhr = $.ajax({
			url: url + '?mode=done&eventid=' + event_id + '&tabname=' + event_tabname + '&donedate=' + event_done_date + '&event_comment=' + event_comment,
			success: function(response) {
				var firsttime = 1;
				if($("#done_event_"+event_row).length != 0 && firsttime == 1)
				{
					//$("#done_event_"+event_id).closest('tr').stop().effect("highlight", {}, 2000).stop().hide();
					$("#done_event_"+event_row).closest('tr').css("background-color", "#47d247");
					$("#complete_user"+event_row).html('<?php echo $this->username; ?>');
					$("#complete_data"+event_row).html($.datepicker.formatDate('dd.mm.yy', new Date())+' '+((new Date()).getHours()<10?'0':'')+(new Date()).getHours()+':'+((new Date()).getMinutes()<10?'0':'')+(new Date()).getMinutes());
					$("#done_event_"+event_row).hide();
					firsttime++;
				}
			}
		});
	}

	function reset_btm_modal(){
		$('#btm_error').html('');
		$('#btm_sonstige_more').hide();
		$('#btm_user_row').hide();
		$('#btm_ammount_source_row').hide();
		$('#medicationid').val('');
		$('#btm_sel').val('');
		$('#btm_method').val('');
		$('#btm_ammount').val('');
		$('#btm_ammount_source').val('');
		$('.ui-dialog-buttonpane button:first').removeAttr('disabled');
		$('form#patient_btm_icon').html("");
	}

	function load_btm_form(id)
	{

		$('#btm_actions_modal').block({
			css: {
				padding: '5px',
				backgroundColor: '#000',
				'-webkit-border-radius': '5px',
				'-moz-border-radius': '5px',
				opacity: .5,
				color: '#fff',
				height: 'auto',
				width:'auto',
				left: '50px'
			},
			message: '<h2 style="padding:5px;"><?php echo $this->translate('btm_icon_modal_loading'); ?></h2><img src="<?php echo RES_FILE_PATH ?>/images/ajax-loader-bar.gif" style="width:150px;">'
		});


		$.ajax({
			type: 'POST',
			url: 'ajax/loadbtmform',
			data: {
				id: '<?php echo $_REQUEST['id']; ?>'
			},
			success:function(data){
				$('form#patient_btm_icon').html(data);
				$('#btm_method_row').hide();
				$('#btm_user_row').hide();
				$('#btm_sonstige_more').hide();
				$('#btm_users_row').hide();
				$('#btm_ammount_row').hide();
				$('#btm_ammount_source_row').hide();
				$('#btm_actions_modal').unblock();
				
				var max_date = $( "#btm_date" ).data('max');
				var min_date = $( "#btm_date" ).data('min');
				
				$( "#btm_date" ).datepicker({
					dateFormat: 'dd.mm.yy',
					showOn: "both",
					buttonImage: '<?php echo RES_FILE_PATH;?>/images/calendar.png',
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: '',
					
					maxDate: max_date,
					minDate: min_date,
					
				}).mask('99.99.9999');
				
				$('#btm_time').timepicker({
					minutes: {
						interval: 5
					},
					showPeriodLabels: false,
					rows: 4,
					//ISPC-2661 Carmen
        			timeOnlyTitle: translate('Choose Time'),
        			timeText: 'Zeit',
        			closeText: 'Ende',
        			//--
					hourText: 'Stunde',
					minuteText: 'Minute'
				}).mask('99:99');

			}
		});
	}
	
	
	
	function load_vital_signs_form(id)
	{

		$('#vital_signs_modal').block({
			css: {
				padding: '5px',
				backgroundColor: '#000',
				'-webkit-border-radius': '5px',
				'-moz-border-radius': '5px',
				opacity: .5,
				color: '#fff',
				height: 'auto',
				width:'auto',
				left: '50px'
			},
			message: '<h2 style="padding:5px;"><?php echo $this->translate('btm_icon_modal_loading'); ?></h2><img src="<?php echo RES_FILE_PATH ?>/images/ajax-loader-bar.gif" style="width:150px;">'
		});


		$.ajax({
			type: 'POST',
			url: 'ajax/loadbtmform',
			data: {
				id: '<?php echo $_REQUEST['id']; ?>'
			},
			success:function(data){
				$('form#patient_btm_icon').html(data);
				$('#btm_method_row').hide();
				$('#btm_user_row').hide();
				$('#btm_sonstige_more').hide();
				$('#btm_users_row').hide();
				$('#btm_ammount_row').hide();
				$('#btm_ammount_source_row').hide();
				$('#btm_actions_modal').unblock();
				
				$( "#btm_date" ).datepicker({
					dateFormat: 'dd.mm.yy',
					showOn: "both",
					buttonImage: '<?php echo RES_FILE_PATH;?>/images/calendar.png',
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
					prevText: ''
				}).mask('99.99.9999');
				
				$('#btm_time').timepicker({
					minutes: {
						interval: 5
					},
					showPeriodLabels: false,
					rows: 4,
					//ISPC-2661 Carmen
        			timeOnlyTitle: translate('Choose Time'),
        			timeText: 'Zeit',
        			closeText: 'Ende',
        			//--
					hourText: 'Stunde',
					minuteText: 'Minute'
				}).mask('99:99');

			}
		});
	}
	function check_icons() {
		var count_asigned = $('div.custom_icon_assigned').length;
		var count_available = $('div.available').length;

		if (count_asigned == count_available) {
			$('#available_custom_icons').hide();
			$('#assign_custom_icon').hide();
		} else {
			$('#assign_custom_icon').show();
		}

	}

	function save_status(new_status, replacement)
	{
		if (new_status) {
			var stat = new Array();

			stat[1] = "normal, keine Krise";
			stat[2] = "Achtung, instabil";
			stat[3] = "Krise";
			jConfirm('Sind Sie sicher, dass Sie den Status des Patienten auf "' + stat[new_status] + '" √§ndern wollen?', '', function(r) {
				if (new_status && r)
				{
					ajaxCallserver({url: appbase + 'patient/changetraffic?status_id=' + new_status + '&patienttrid=<?php echo $_GET['id']; ?>'});
					$('div.traffic_light img').replaceWith($(replacement).html());
					$('div.traffic_light img').show();
				}
			});
		}
	}
	
	readmisionCallback = function (params)
	{
		if(params)
		{
			if(params.status == "1")
			{
				//do refresh
				window.location.reload(true);
			}
			else
			{
				//alert user
//				alert('<?php echo $this->translate('patient_not_readmitted'); ?>');
			}
		}
	}
	
	function save_readmission(patient, transition, date, time_h, time_m)
	{
		
		if(transition == "standby"){
			
			var confirm_text =  '<?php echo str_replace('%epid%', strtoupper($this->epid), $this->translate('confirm_move_to_standby_patient')); ?>';
			var confirm_title =  '<?php echo $this->translate('confirm_move_to_standby_patient_title'); ?>';
			
		} else {
			var confirm_text =  '<?php echo str_replace('%epid%', strtoupper($this->epid), $this->translate('confirm_readmit_patient')); ?>';
			var confirm_title =  '<?php echo $this->translate('confirm_readmit_patient_title'); ?>';
		}
		
		jConfirm(confirm_text, confirm_title, function(r) {
		    if(r) {
				ajaxCallserver({url: appbase + 'ajax/readmitpatient', method:'POST', data: {id: patient, adm_date: date, adm_time_h: time_h, adm_time_m: time_m, transition: transition}, callLoading: readmisionCallback});
				$('#status_readmit_data').dialog('close');
		    } else {
				$('#status_readmit_data').dialog('close');
			}
		});
	}
	
	//ISPC - 2368
	function closepopup() {
		disablePopup();
	}
	
	function saveCompleteComment(row_id)
	{
	   var val = "";
	   
		//if($("#completecomment").val().length>0) {
		val = $("#completecomment").val();

		$("#completecomment_"+row_id).val(val);
		
		var todo_nr = $('#done_event_' + row_id).data('todo_nr');
		var todo_idss = $("#todoids_"+todo_nr).val();
		var todo_ids = todo_idss.split(',');
		
		var event_tabname = 'todo';
		var event_done_date = $.datepicker.formatDate('yy-mm-dd', new Date());
		var event_comment = $('#completecomment_' + row_id).val(); //ISPC - 2368
		
		$('#loading_div_'+ todo_nr).show();
		//$('tr#d_row_' + row_id).effect("highlight", {}, 5000);
		$.each(todo_ids, function(index, value) {
			//alert(value);
		mark_event_done(value, todo_nr, event_tabname, event_done_date, event_comment);
		});
		closepopup();
		/*}
		else
		{
			jAlert('<?php echo $this->translate('entercomment') ?>');
		}*/
	}
	
	function uncheckbox(chk)
	{
	       $('#'+chk).attr('checked',false);
	}
	//ISPC - 2368
		
</script>
<!-- ISPC-2513 css hack:: START -->
<style>
/* .outer */
/* { width:100% !important;} */

/* #Wrapper */
/* { width:calc(100% - 20px) !important; } */

/* #MainContent */
/* { width:calc(100% - 202px) !important; }  */
</style>
<!-- ISPC-2513 css hack:: END -->

<div class="main_patient_header">
	<div class="status_and_navigation">
		<div class="patient_name"> 
			<div id="status_icon" class="table_column column_left">
				<!--display status icon-->
				<div class="status_icon_label">
					<?php echo $this->translate('status_icon_label'); ?>
				</div>

				<!--display system icons-->
				<?php foreach($this->system_icon_details as $k_icon_det => $v_icon_det):?>
					<?php if(!empty($system_icon_data[$k_icon_det][$this->ipid]['show'])): //status icon ?>
						<?php $patient_image = $system_icon_data[$k_icon_det][$this->ipid]['show']['image'];?>
						<input type="hidden" value="<?php echo $system_icon_data[$k_icon_det][$this->ipid]['traffic_status']; ?>" name="current_status" id="current_traffic_status" />
						<?php if(in_array($system_icon_data[$k_icon_det][$this->ipid]['show']['id'], array("8","10"))): ?>
							<div class="patient_icon_cell tabs_table <?php if($system_icon_data[$k_icon_det][$this->ipid]['condition'] == 'patient_status_icon'): echo 'traffic_light'; endif; ?>" style="background:#<?php echo $system_icon_data[$k_icon_det][$this->ipid]['show']['color']; ?>" id="sys_icon-<?php echo $k_icon_det; ?>">
								<?php if(!empty($system_icon_data[$k_icon_det][$this->ipid]['show']['image'])): ?>
									<img src="<?php echo APP_BASE . 'icons_system/' . $system_icon_data[$k_icon_det][$this->ipid]['show']['image']; ?>"  title="<?php echo $this->translate($system_icon_data[$k_icon_det][$this->ipid]['show']['name']); ?>" />
								<?php else: ?>
									<p> &nbsp; </p>
								<?php endif; ?>
							</div>
						
						<?php else:?>
						<div class="patient_icon_cell <?php if($system_icon_data[$k_icon_det][$this->ipid]['condition'] == 'patient_status_icon'): echo 'traffic_light'; endif; ?> <?php if($system_icon_data[$k_icon_det][$this->ipid]['show']['id'] == '7'): echo 'tabs_table'; endif;?>" style="background:#<?php echo $system_icon_data[$k_icon_det][$this->ipid]['show']['color']; ?>" id="sys_icon-<?php echo $k_icon_det; ?>">
							<?php if(!empty($system_icon_data[$k_icon_det][$this->ipid]['show']['image'])): ?>
								<?php if($system_icon_data[$k_icon_det][$this->ipid]['show']['id'] == "7" || $system_icon_data[$k_icon_det][$this->ipid]['show']['id'] == "9"): ?>
									<?php $readmit_pat_dialog = "readmit_patient"; ?>
								<?php else: ?>
									<?php $readmit_pat_dialog = ""; ?>
								<?php endif; ?>
								<img src="<?php echo APP_BASE . 'icons_system/' . $system_icon_data[$k_icon_det][$this->ipid]['show']['image']; ?>" class="<?php echo $readmit_pat_dialog; ?>" title="<?php echo $this->translate($system_icon_data[$k_icon_det][$this->ipid]['show']['name']); ?>" />
							<?php else: ?>
								<p> &nbsp; </p>
							<?php endif; ?>
						</div>
						<?php endif; ?>
						
						<div id="status_readmit_data" style="display: none;text-align: left;">
								<label for="status_admission_date"><?php echo $this->translate('admissiondate'); ?>: </label>
								<input type="text" name="status_admission_date" id="status_admission_date" value="<?php echo date('d.m.Y', time()); ?>" readonly="readonly" autofocus="false" />
								<?php echo $this->formSelect('adm_time_h', date('H', time()), array('class'=>'time_sel'), $this->hours); ?>
								<?php echo $this->formSelect('adm_time_m', date('i', time()), array('class'=>'time_sel'), $this->minutes); ?>
							<?php if($this->isstandby == "0"):?>
							<br/>
								<label> Patienten-Status</label>
								<select name="status_admission_transition" id="status_admission_transition" >
									<option value="active">regul√§rer Patient</option>
									<option value="standby">Standby / Anfrage</option>
								</select>
							<?php else:?>
								<input type="hidden"  name="status_admission_transition" id="status_admission_transition" value="active" />
							<?php endif; ?>
						</div>
						
						<?php if($system_icon_data[$k_icon_det][$this->ipid]['condition'] == 'patient_status_icon'): ?>
						<div id="other_lights">
							<div class="patient_icon_cell" id="patient_icon_cell_red">
								<img src="<?php echo APP_BASE . 'icons_system/' . IconsMaster::traffic_light_icons($patient_image, '3'); ?>" rel="3">
							</div>
							<div class="patient_icon_cell" id="patient_icon_cell_yellow">
								<img src="<?php echo APP_BASE . 'icons_system/' . IconsMaster::traffic_light_icons($patient_image, '2'); ?>" rel="2">
							</div>
							<div class="patient_icon_cell" id="patient_icon_cell_green">
								<img src="<?php echo APP_BASE . 'icons_system/' . IconsMaster::traffic_light_icons($patient_image, '1'); ?>" rel="1">
							</div>
						</div>
						<?php endif; ?>
					<?php endif; ?>
				<?php endforeach; ?>
		</div>
		<?php if($this->show_navigation == "1"):?>
			<select id="change_patient">
			<!--  ISPC-2513 Lore 18.05.2020 -->
				<option value=""><?php echo trim($this->last_name . ", " . $this->first_name); ?> *<?php echo $this->birthd; ?></option>
				<!-- <option value=""></option>-->
			<?php foreach($this->nav['dropdown'] as $gr_id=>$gr_p_data):?>
			<!-- ISPC-2093 @Lore 07.10.2019 -->
				 <optgroup label="<? echo $gr_id;?>">
					<?php foreach($gr_p_data as $p_id=>$p_name):?>
						<option value="<?php echo Pms_Uuid::encrypt($p_id);?>"   <?php if($p_id == $this->nav['current']):?> selected="selected"<?endif;?> ><?php echo $p_name; ?></option>
					<?php endforeach?>
			 	</optgroup>
			<?php endforeach?>
			</select>
			
			<span class="p_gender <? echo $this->nav['gender'][$this->nav['current']]; ?>"></span><!-- 	ISPC-2513 Ancuta 15.05.2020 -->  
			<?php if($this->nav['previous']):?>
				<a href="<?php echo APP_BASE .'patientcourse/patientcourse?id=' . Pms_Uuid::encrypt($this->nav['previous']['id']); ?>"  title="<?php echo $this->nav['previous']['details'] ?>" class="btn btnPrev" style="width:30px!important; height:30px!important;"></a>
			<?php endif;?>
			<?php
			 if($this->nav['next']):?>
				<a href="<?php echo APP_BASE .'patientcourse/patientcourse?id=' . Pms_Uuid::encrypt($this->nav['next']['id']); ?>"  title="<?php echo $this->nav['next']['details'] ?>" class="btn btnNext"></a>
			<?php endif;?>
	<?php else: ?>
			<span><?php echo trim($this->last_name . ", " . $this->first_name); ?>*<?php echo $this->birthd; ?></span>
	<?php endif;?> 
		</div>	
			
			
			
			<?php echo $this->ptheader; ?>
			<div style="display: none;">
				<span style="display: none;"><?php echo $this->ipid; ?></span>
				<?php if($this->print != 1) : ?>
						<?php if($this->iscreateuser) : ?>
							<br /><a href="patientpermissions/setkeyuser?id=<?php echo $_REQUEST['id'] ?>"><?php echo $this->translate("setchangekeyuser"); ?></a>
							<?php elseif($this->iskeyuser) : ?>
							<br /><a href="patientpermissions/assign?id=<?php echo $_REQUEST['id'] ?>"><?php echo $this->translate("patientpermissions"); ?></a>
							<br /><a href="patientpermissions/setkeyuser?id=<?php echo $_REQUEST['id'] ?>"><?php echo $this->translate("setchangekeyuser"); ?></a>
							<br /><a href="patientpermissions/setvisibility?id=<?php echo $_REQUEST['id'] ?>"><?php echo $this->translate("setvisibility"); ?></a>
						<?php else: ?>
							&nbsp;
						<?php endif; ?>
					<?php endif; ?>
			</div>	
			<div class="btn-collapse-userinfo"></div>
		</div>
		
		<div class="details-container">
			<ul class="details-col col1">
				<li class="aufnahmedatum">
					<span>Aufnahmedatum</span>
					<span><?php echo date("d.m.Y H:i",strtotime($this->admission_date)); ?> <?php echo '('.$this->admission_type.')'; ?> </span>
				</li>
				<li class="aufnagmegrund">
					<span>Aufnahmegrund</span>
					<span><?php echo $this->admission_reason; ?> </span>
				</li>
			<!-- 	<li class="aufnahme">
					<span>Aufnahme</span>
					<span><?php echo $this->admission_type; ?> </span>
				</li>  
			-->
				<?php if(!empty($this->main_diagno_texts)) :?>
				<li class="grunderkrankung">
					<span>Grunderkrankung</span>
					<span><?php echo $this->main_diagno_texts;?></span>
				</li>
				<?php endif;?>
			</ul>
			
			<ul class="details-col col2">
				<!-- <li class="alter_year">
					<span>Alter</span>
					<span><?php echo $this->age_yearsAndMonths; ?></span>
				</li>
				 -->
				<li class="gewicht">
					<span>Gewicht</span>
					<!-- ISPC-2661 pct.12 Carmen 14.09.2020 -->
					<span><?php echo $this->weight; ?></span><span class="show_admission_weight"><img src="<?php echo RES_FILE_PATH; ?>/images/alert_info.png" width="18" height="18" /></span>
					<?php if($this->admission_weight != '-') { ?>
						<span class="admission_weight" style="display: none;">Aufnahmegewicht: <?php echo $this->admission_weight.' ('.$this->date_admission_weight .')'; ?></span>
					<?php } else { ?>
						<span class="admission_weight" style="display: none;">Aufnahmegewicht: <?php echo $this->admission_weight; ?></span>
					<?php } ?>
					<!-- // -->
				</li>
				<li class="grobe">
					<span>Gr√∂√üe</span>
					<span><?php echo $this->height; ?></span>
				</li>
			</ul>
			
			<ul class="details-col col3">
				<!-- ISPC-2513 Lore 18.05.2020 -->
				<li>
					<span>Patientennummer</span>
					<span><?php echo $this->epid; ?></span>
					<!-- ISPC-2513 Lore 27.05.2020 -->
					<span style="display: none;"><?php echo $this->ipid; ?></span>
						<?php if($this->print != 1) : ?>
							<?php if($this->iscreateuser) : ?>
								<a href="patientpermissions/setkeyuser?id=<?php echo $_REQUEST['id'] ?>"><?php echo $this->translate("setchangekeyuser"); ?></a>
							<?php elseif($this->iskeyuser) : ?>
								<a href="patientpermissions/assign?id=<?php echo $_REQUEST['id'] ?>"><?php echo $this->translate("patientpermissions"); ?></a>
								<br /><a href="patientpermissions/setkeyuser?id=<?php echo $_REQUEST['id'] ?>"><?php echo $this->translate("setchangekeyuser"); ?></a>
								<br /><a href="patientpermissions/setvisibility?id=<?php echo $_REQUEST['id'] ?>"><?php echo $this->translate("setvisibility"); ?></a>
							<?php else: ?>
								&nbsp;
							<?php endif; ?>
						<?php endif; ?>
				</li>
				<!-- //. -->
			
				<!-- ISPC-2670 Lore 24.09.2020 -->
				<?php if($this->evn_option == 'ja') : ?>
					<li class="green" style="">
						<span>EVN</span>
					</li>
				<?php elseif($this->evn_option == 'nein'): ?>
					<li class="red" style="">
						<span>EVN</span>
						<?php echo $this->evn_text; ?>
					</li>
				<?php elseif($this->evn_option == 'Sonstiges'): ?>
					<li class="yellow" style="">
						<span>EVN</span>
						<?php echo $this->evn_text; ?>
					</li>					
				<?php else: ?>
					<li class="green" style="display: none;">
						<span>EVN</span>
					</li>
				<?php endif; ?>
<!-- 					<li class="green" style="display: none;">
						<span>EVN</span>
					</li> -->

				<?php if($this->has_living_will): ?>
				<? if( !empty($this->living_will_file['id'])) :?>
				<li class="green" onClick="goTo('stats/patientfileupload?doc_id=<?php echo $this->living_will_file['id'];?>id=<?php echo $_REQUEST['id'];?>')" >
				<?php else: ?>
				<li class="green"  >
				<?php endif; ?>
					<span>Patientenverf√ºgung</span>
				</li>
				<?php else: ?>
				<li class="orange">
					<span>Patientenverf√ºgung</span>
				</li>
				<? endif; ?>
				
				<li class="green">
					<span>zu- und ableitungen</span>
				<? if(!empty($this->artificial_entries)):?>
					<span><?php echo $this->artificial_entries;?></span>
				<?php else: ?>	
					<span> - </span>
				<?php endif; ?>
				</li>
			</ul>
		</div>
		<div class="buttons-container">
		
			<!-- ICONS -->
			<div id="new_icons" class="table_column column_middle no_border" >
				<?php foreach($this->system_icon_details as $k_icon_details => $v_icon_details): ?>
					<?php if(isset($v_icon_details['visible']) && $v_icon_details['visible'] == '1'): ?>
						<?php if($k_icon_details == "3"): ?>
							<!-- ISPC - 1148 - not used yet <div class="patient_icon_cell tabs_table" style="background:#<?php echo $system_icon_data[$k_icon_details]['last'][$this->ipid]['color']; ?>" id="sys_icon-<?php echo $k_icon_details; ?>"> -->
							<div class="patient_icon_cell" style="background:#<?php echo $system_icon_data[$k_icon_details]['last'][$this->ipid]['color']; ?>" id="sys_icon-<?php echo $k_icon_details; ?>">
								<?php if(!empty($system_icon_data[$k_icon_details]['last'][$this->ipid]['image'])): ?>
									<img src="<?php echo APP_BASE . 'icons_system/' . $system_icon_data[$k_icon_details]['last'][$this->ipid]['image']; ?>" title="<?php echo $this->translate($system_icon_data[$k_icon_details]['last'][$this->ipid]['name']); ?>" />
								<?php else: ?>
									<p> &nbsp; </p>
								<?php endif;
										$this->system_icon_details[$k_icon_details] = $system_icon_data[$k_icon_details]['patient_verordnungs'][$this->ipid]; //ISPC - 1148 - not used yet
					 				?>
							</div>				
				<?php //ISPC-2685, elena, 05.10.2020  ?>
				<?php elseif(!empty($system_icon_data[$k_icon_details]['calculate_image'][$this->ipid]['image'])): ?>
				<div class="patient_icon_cell tabs_table" style="background:#<?php echo $v_icon_details['color']; ?>" id="sys_icon-<?php echo $k_icon_details; ?>">
				<a href="<?php echo APP_BASE;?>patient/patienttoroom?id=<?php echo $_REQUEST['id']?>" >
					<img src="<?php echo APP_BASE . 'icons_system/' . $system_icon_data[$k_icon_details]['calculate_image'][$this->ipid]['image']; ?>" title="<?php echo $this->translate($v_icon_details['name']); ?>" />
				</a>
				</div>
				<?php elseif($k_icon_details == "10006"): ?>
				<!-- ISPC-2476 -->
				<?php
					$later = date_create_from_format('d.m.Y', $system_icon_data[10006]['patient_reassessments_next'][$this->ipid]);
				if($later !== false){
				$earlier = new DateTime();
								
				$diff = $later->diff($earlier)->format("%a");
				$bg = '#ffffff';
				if($diff < 5){
				$bg = '#ff0000';
				}
				?>

				<div class="patient_icon_cell tabs_table reass" style="background:<?php echo $bg; ?>" id="sys_icon-<?php echo $k_icon_details; ?>">

					<a href="<?php echo APP_BASE .'patientformnew/reassessment?id=' . $_REQUEST['id']; ?>">
						<img src="<?php echo APP_BASE . 'icons_system/' . $v_icon_details['image']; ?>"  title="<?php echo $this->translate($v_icon_details['name']); ?>" />
					</a>

				</div>
				<?php
					}
					?>
								
						<?php elseif( $k_icon_details == '53'): ?>
						<?php /* ISPC- */ ?>
							<?php $germination_status = $system_icon_data[53]['germination_status'][$this->ipid]['status'];?>
							<?php $germination_text = $system_icon_data[53]['germination_status'][$this->ipid]['germination_text'];?>
							<div class="patient_icon_cell tabs_table" style="background:#<?php echo $v_icon_details['color']; ?>" id="sys_icon-<?php echo $k_icon_details; ?>">
								<?php if(!empty($v_icon_details['image'])): ?>
									<img src="<?php echo APP_BASE . 'icons_system/' . $v_icon_details['image']; ?>" class="<?php echo $germination_status;?>" title="<?php echo $this->translate($v_icon_details['name']); ?>" />
								<?php else: ?>
									<p> &nbsp; </p>
								<?php endif; ?>
							</div>
						<?php elseif($k_icon_details != '6' && $v_icon_details['function'] != 'go_to_visitform' && $k_icon_details != '42' && $k_icon_details != '43' && $k_icon_details != '56' && $k_icon_details != '67' && $k_icon_details != '70' && $k_icon_details != '71' && $k_icon_details != '73'): ?>
							<?php $homecare_icon = array_values($system_icon_data[$k_icon_details]['master_homes'][$this->ipid]); ?>
							<?php $physio_icon = array_values($system_icon_data[$k_icon_details]['master_physio'][$this->ipid]); ?>
							<div class="patient_icon_cell<?php if($v_icon_details['function'] == 'go_to_visitform'): ?>_right<?php endif; ?> <?php if($k_icon_details != '5' && $k_icon_details != '33' && $v_icon_details['function'] != 'go_to_visitform' && $v_icon_details['function'] != 'sgbv_icon' && $k_icon_details != '77'): echo 'tabs_table'; endif; ?> <?php if($v_icon_details['function'] == 'get_patient_vital_signs'): ?> vital_signs_icon <?php endif; ?> " style="background:#<?php echo $v_icon_details['color']; ?>" id="sys_icon-<?php echo $k_icon_details; ?>"> <!-- TODO-3377 Carmen 27.08.2020 -->
								<?php if(!empty($system_icon_data[$k_icon_details]['master_pflege'][$this->ipid]['logo'])): ?>
									<img src="<?php echo APP_BASE . 'icons_system/' . $system_icon_data[$k_icon_details]['master_pflege'][$this->ipid]['logo']; ?>" title="<?php echo $this->translate($v_icon_details['name']); ?>" />
								<?php elseif(!empty($system_icon_data[$k_icon_details]['patient_supplier_data'][$this->ipid]['logo'])): ?>	
									<img src="<?php echo APP_BASE . 'icons_system/' . $system_icon_data[$k_icon_details]['patient_supplier_data'][$this->ipid]['logo']; ?>" title="<?php echo $this->translate($v_icon_details['name']); ?>" />		
								<?php elseif(!empty($homecare_icon[0]['logo'])): ?>
									<img src="<?php echo APP_BASE . 'icons_system/' . $homecare_icon[0]['logo']; ?>" title="<?php echo $this->translate($v_icon_details['name']); ?>" />
								<?php elseif(!empty($physio_icon[0]['logo'])): ?>
									<img src="<?php echo APP_BASE . 'icons_system/' . $physio_icon[0]['logo']; ?>" title="<?php echo $this->translate($v_icon_details['name']); ?>" />
								<?php elseif(!empty($v_icon_details['image'])): ?>
									<img src="<?php echo APP_BASE . 'icons_system/' . $v_icon_details['image']; ?>" title="<?php echo $this->translate($v_icon_details['name']); ?>" />
								<?php else: ?>
									<p> &nbsp; </p>
								<?php endif; ?>
							</div>
						<?php elseif( $k_icon_details == '42'): ?>
						<?php /* ISPC-1775,ISPC-1678,ISPC-1994 */ ?>
							<? $register_data = $system_icon_data[42]['register_status'][$this->ipid];?>
							<div class="patient_icon_cell" style="background:#<?php echo $v_icon_details['color']; ?>" id="sys_icon-<?php echo $k_icon_details; ?>">
							<?php if(!empty($v_icon_details['image'])): ?>
								<a href="<?php echo APP_BASE .'patientnew/hospizregisterv3?id=' . $_REQUEST['id']; ?>" >
									<img src="<?php echo APP_BASE . 'icons_system/' . $v_icon_details['image']; ?>" class="<?php echo $register_data['status'];?>" title="<?php echo $this->translate($v_icon_details['name']); ?>" />
								</a>
							<?php else: ?>
								<p> &nbsp; </p>
							<?php endif; ?>
							</div>
						<?php elseif( $k_icon_details == '73'): ?>
						<?php /* ISPC-2507 Ancuta 24.02.2020 */ ?>
								<div class="patient_icon_cell" style="background:#<?php echo $v_icon_details['color']; ?>" id="sys_icon-<?php echo $k_icon_details; ?>">
									<?php if(!empty($v_icon_details['image'])): ?>
										<a href="<?php echo APP_BASE .'patientmedication/edit?id=' . $_REQUEST['id']; ?>" >
										<img src="<?php echo APP_BASE . 'icons_system/' . $v_icon_details['image']; ?>" title="<?php echo $this->translate($v_icon_details['name']); ?>" />
										</a>
									<?php else: ?>
										<p> &nbsp; </p>
									<?php endif; ?>
								</div>
						<?php elseif( in_array($k_icon_details,array('70','71'))): ?>
						<?php /* ISPC-2420 */ ?>
								<? $demstepcare_data = $system_icon_data[$k_icon_details]['demstepcare_status'][$this->ipid];?>
								<div class="patient_icon_cell" style="background:#<?php echo $v_icon_details['color']; ?>" id="sys_icon-<?php echo $k_icon_details; ?>">
									<?php if(!empty($v_icon_details['image'])): ?>
										<a href="<?php echo APP_BASE .'rubin/demstepcare?id=' . $_REQUEST['id']; ?>" >
										<img src="<?php echo APP_BASE . 'icons_system/' . $v_icon_details['image']; ?>" class=" " title="<?php echo $this->translate($v_icon_details['name']); ?>" />
										</a>
									<?php else: ?>
										<p> &nbsp; </p>
									<?php endif; ?>
								</div>
						<?php elseif($k_icon_details == '43' && $this->diagno_act_module == "1"):?>
							<div class="patient_icon_cell" style="background:#<?php echo $system_icon_data[$k_icon_details]['last_diagno_act'][$this->ipid]['color']; ?>" id="sys_icon-<?php echo $k_icon_details; ?>">
								<?php if(!empty($system_icon_data['43']['last_diagno_act'][$this->ipid]['image'])): ?>
									<img src="<?php echo APP_BASE . 'icons_system/' . $system_icon_data[$k_icon_details]['last_diagno_act'][$this->ipid]['image']; ?>" title="<?php echo $this->translate($system_icon_data[$k_icon_details]['last_diagno_act'][$this->ipid]['name']); ?>" />
								<?php else: ?>
									<p> &nbsp; </p>
								<?php endif; ?>
							</div>			
						<?php elseif($k_icon_details == '56' ):?>
							<div class="patient_icon_cell tabs_table" style="background:#<?php echo $system_icon_data[$k_icon_details]['current_maintenancestage'][$this->ipid]['color']; ?>" id="sys_icon-<?php echo $k_icon_details; ?>">
								<?php if(!empty($system_icon_data['56']['current_maintenancestage'][$this->ipid]['image'])): ?>
									<img src="<?php echo APP_BASE . 'icons_system/' . $system_icon_data[$k_icon_details]['current_maintenancestage'][$this->ipid]['image']; ?>" title="<?php echo $this->translate($system_icon_data[$k_icon_details]['current_maintenancestage'][$this->ipid]['name']); ?>" />
								<?php else: ?>
									<p> &nbsp; </p>
								<?php endif; ?>
							</div>
						<?php elseif( $k_icon_details == '67'): ?>
							<?php /* ISPC-2129 */ ?>
									<? if($system_icon_data['67']['activefileup'][$this->ipid]) {
										$afup_data = $system_icon_data['67']['activefileup'][$this->ipid];
									?>
										<div class="patient_icon_cell" style="background:#<?php echo $v_icon_details['color']; ?>" id="sys_icon-<?php echo $k_icon_details; ?>">
											<?php if(!empty($v_icon_details['image'])) : ?>
												<a href="<?php echo APP_BASE .'stats/patientfileupload?id=' . $_REQUEST['id'] . '&doc_id=' .$afup_data; ?>" >
												<img src="<?php echo APP_BASE . 'icons_system/' . $v_icon_details['image']; ?>" class="<?php echo $register_data['status'];?>" title="<?php echo $this->translate($v_icon_details['name']); ?>" />
												</a>
											<?php else: ?>
												<p> &nbsp; </p>
											<?php endif; ?>
										</div>			
							<?php } endif; ?>
				<?php elseif( $k_icon_details == '10010'): ?><!-- ISPC-2912,Elena,25.05.2021 -->
				<div class="patient_icon_cell tabs_table"  id="sys_icon-<?php echo $k_icon_details; ?>">
					<img src="<?php echo APP_BASE . 'icons_system/' . $v_icon_details['image']; ?>"  title="<?php echo $this->translate($v_icon_details['name']); ?>" />
				</div>

				<?php endif; // ICON VISIBILE  ?>
				<?php endforeach; ?>
	 
				<?php foreach($this->patient_icons_details as $k_pat_icon => $v_pat_icon): ?>
					<div class="patient_icon_cell custom_icon_assigned" style="background:#<?php echo $v_pat_icon['color']; ?>" id="assigned_custom_icon-<?php echo $v_pat_icon['id']; ?>" title="<?php echo $v_pat_icon['name']; ?>">
						<?php if(!empty($v_pat_icon['image'])): ?>
							<img src="<?php echo APP_BASE . 'icons_system/' . $v_pat_icon['image']; ?>" title="<?php echo $this->translate($v_pat_icon['name']); ?>" />
						<?php else: ?>
							&nbsp;
						<?php endif; ?>
					</div>
				<?php endforeach; ?>
				<div class="patient_icon_cell fixed"> <a href="javascript:void(0);" id="assign_custom_icon" > <img src="<?php echo APP_BASE . 'images/btttt_plus.png' ?>" title="<?php echo $this->translate('assign_custom_icon'); ?>" /> </a></div>
			</div>
			
			<!-- CUSTOM ICONS -->
			<div id="available_custom_icons" style="display:none;">
				<?php foreach($this->custom_icon_details as $k_cust_icon_det => $v_cust_icon_det): ?>
					<div class="patient_icon_cell available" style="<?php if($v_cust_icon_det['visible'] == '0'): ?>display:none; <?php endif; ?>background:#<?php echo $v_cust_icon_det['color']; ?>" rel="<?php echo $v_cust_icon_det['id']; ?>" id="available_custom_icon-<?php echo $v_cust_icon_det['id']; ?>" title="<?php echo $v_cust_icon_det['name']; ?>">
					<?php if(!empty($v_cust_icon_det['image'])): ?>
						<img src="<?php echo APP_BASE . 'icons_system/' . $v_cust_icon_det['image']; ?>" />
					<?php else: ?>
						<p> &nbsp; </p>
					<?php endif; ?>
				</div>
				<?php endforeach; ?>
			</div>
			
			<!-- VISIT ICONS -->
			
			<?php 
			$see_visit_icons = 0;
			$visit_url = "patientform/contactform?id=".$_REQUEST['id'];

			if($this->system_icon_details['24']['function'] == 'go_to_visitform' && $this->system_icon_details['24']['visible'] == '1'){
			 foreach($this->system_icon_details as $k_icon_details => $v_icon_details){
				 if($v_icon_details['function'] == 'go_to_visitform' && $v_icon_details['visible'] == '1'){
					 $see_visit_icons = 1; 
					 if($v_icon_details['function'] == 'go_to_visitform' && !empty($v_icon_details['menu_link'])){
						if($v_icon_details['form_type'] != 0 && in_array($v_icon_details['form_type'],$this->client_form_types) ){
							 $visit_url =  $v_icon_details['menu_link'] . '?id=' . $_REQUEST['id'] . '&ftid=' . $v_icon_details['form_type'];
						} else{
							   $visit_url =$v_icon_details['menu_link'] . '?id=' . $_REQUEST['id']; 
						 } 
					}

					if(!empty($v_icon_details['custom']['image'])){ 
						$img_src= APP_BASE . 'icons_system/' . $v_icon_details['custom']['image'];
						$img_title= $v_icon_details['menu_title'];
						// ISPC-2513 Lore 24.04.2020
						//	} elseif(!empty($v_icon_details['image'])){
						//		$img_src= APP_BASE . 'icons_system/' . $v_icon_details['image'];
						//		$img_title= $this->translate($v_icon_details['name']);
					} else{
						$img_src = "";
					}
				}
				}
			}

			?>

			
			
			
 			<ul class="bc line" class="table_column column_right<?php if($this->btm_perm == '1' && $this->has_btm_permission == '1'): ?>_btm<?php endif;?>">
 				<!-- ISPC-2513 Lore 23.04.2020 -->
 				<?php if($img_src == "") : ?>
 					<li class="border besuch" title="Besuch" onClick="goTo('<?php echo $visit_url; ?>')">
 					</li>
 				<?php  else : ?>
 					<li class="border besuch" style="background-image:url(<?php echo $img_src ; ?>); width:150px;" title="Besuch" onClick="goTo('<?php echo $visit_url; ?>')">
 					</li>
 					<?php endif  ?>

				 <?php if($this->btm_perm == '1' && $this->has_btm_permission == '1'): ?>
				 <li id="btm_actions"  class="btm" title="BTM"></li>
				 <?php endif; ?>
				<!-- ISPC-2241, elena, 02.09.2020 (took from clinic) -->
				 <li class="addressbook" title="Addressbook"  onClick="goTo('patientnew/addressbook?id=<?php echo $_REQUEST['id']; ?>')"></li>
				 <li class="calendar" title="Calendar"  onClick="goTo('patient/calendar?id=<?php echo $_REQUEST['id']; ?>')" ></li>
			</ul>
 		</div>

 
 </div>
 
<div  id="pmenu_container">
<div class="floating_patient_header">
	<table class="pm_table">
		<tr>
			<td class="pname_label">
				<?php echo $this->translate("name"); ?>
			</td>
			<td>
				<div><?php echo trim($this->last_name . ", " . $this->first_name); ?></div>
			</td>
			<td class="pname_label">
				<?php echo $this->translate('status_icon_label'); ?>
			</td>
			<td>
					<div>
						<!--display system icons-->
						<?php foreach($this->system_icon_details as $k_icon_det => $v_icon_det):?>
							<?php if(!empty($system_icon_data[$k_icon_det][$this->ipid]['show'])): //status icon ?>
								<?php $patient_image = $system_icon_data[$k_icon_det][$this->ipid]['show']['image'];?>
								<div class="patient_icon_cell_pmenu" style="background:#<?php echo $system_icon_data[$k_icon_det][$this->ipid]['show']['color']; ?>" id="sys_icon-<?php echo $k_icon_det; ?>_pmenu">
									<?php if(!empty($system_icon_data[$k_icon_det][$this->ipid]['show']['image'])): ?>
										<img src="<?php echo APP_BASE . 'icons_system/' . $system_icon_data[$k_icon_det][$this->ipid]['show']['image']; ?>" title="<?php echo $this->translate($system_icon_data[$k_icon_det][$this->ipid]['show']['name']); ?>" width="30px"  />
									<?php else: ?>
										<p> &nbsp; </p>
									<?php endif; ?>
								</div>
			 
							<?php endif; ?>
						<?php endforeach; ?>
					</div>	
			</td>
			<td class="pname_label">
				<?php echo $this->translate('patientnumber'); ?>
			</td>
			<td>
				<?php echo $this->epid; ?>
			</td>
			
			<!-- ISPC-2593 Lore 19.05.2020 -->
			<?php if($this->header_option == 'show_location') : ?>
				<td class="pname_label location_pi">
					<?php echo $this->translate("location"); ?>
				</td>
				<?php if(!empty($this->location)) : ?>
					<td>
						<?php echo $this->location ?>
					</td>
				<?php else:?>
					<td>
					</td>
				<?php endif; ?>
				
			<?php else:?>
				<td class="pname_label" >
				 	<?php echo $this->translate('birthdate') ?> 
				</td>	
				<td><?php echo $this->birthd; ?></td>
				
				<td class="pname_label" >
				 	<?php echo $this->translate('Alter') ?>
				</td>	
				<td ><?php echo $this->age_yearsAndMonths; ?></td>
				
				<td class="pname_label" >
				 	<?php echo $this->translate('Gewicht') ?>
				</td>	
				<td ><?php echo $this->weight; ?></td>	

			<?php endif; ?>
			<!-- //. -->
			
		</tr>
	</table>
			
</div>
</div>
<div  class="main_patient_header_icons">	
		<!--   ICONS  -->
	<table border="0" style="width: 100%;"> 
		<tr>
			<td class="patheaderrow5" colspan="5">
 
				<div class="tab-container icons_tab-container">
<?php foreach($this->system_icon_details as $k_sys_det => $v_sys_det): ?>
							<div class="tab-content" style="display: none; " id="content_sys_icon-<?php echo $k_sys_det; ?>">
		<?php
		if($k_sys_det == '6' && in_array($system_icon_data[$k_sys_det][$this->ipid]['show']['id'], array("8", "7", "10"))):  //Dead
		?>
		<table class="discharge_dead_info">
			<tbody>
			<?php if($system_icon_data[$k_sys_det][$this->ipid]['show']['id'] == "8") { ?>
				<tr>
					<th class="colbold patcontactscol1" valign="top"><?php echo $this->translate('Discharge death date'); ?></th>
					<td class="patcontactscol2" valign="top"><?php echo $this->death_date; ?></td>
				</tr>
			<?php } elseif($system_icon_data[$k_sys_det][$this->ipid]['show']['id'] == "10") { ?>
				<tr>
					<th class="colbold patcontactscol1" valign="top"><?php echo $this->translate('hospital_admission'); ?></th>
					<td class="patcontactscol2" valign="top"><?php echo date('d.m.Y', strtotime($system_icon_data[$k_sys_det][$this->ipid]['last_location']['valid_from'])); ?></td>
				</tr>
			<?php } elseif($system_icon_data[$k_sys_det][$this->ipid]['show']['id'] == "7") { ?>
				<tr>
					<th class="colbold patcontactscol1" valign="top"><?php echo $this->translate('discharged_date'); ?></th>
					<td class="patcontactscol2" valign="top"><?php echo date('d.m.Y', strtotime($system_icon_data[$k_sys_det][$this->ipid]['discharge_details']['discharge_date'])); ?></td>
				</tr>
				<tr>	<!-- ISPC-2497 Lore 08.01.2020 -->
					<th class="colbold patcontactscol1" valign="top"><?php echo $this->translate('discharge_location'); ?></th>
					<?php if(array_key_exists($system_icon_data[$k_sys_det][$this->ipid]['discharge_details']['discharge_location'] , $this->discharge_locations_arr )) { ?>
						<td class="patcontactscol2" valign="top"><?php echo $this->discharge_locations_arr[$system_icon_data[$k_sys_det][$this->ipid]['discharge_details']['discharge_location']]; ?></td>
					<?php } else { ?>
						<td class="patcontactscol2" valign="top"><?php echo '-'; ?></td>
					<?php } ?>
				</tr>
			<?php } ?>			
			</tbody>
		</table>
 
		<?php
		elseif($k_sys_det == '4'):  //Pflegedienst
			$pflegedienstes = $system_icon_data[$k_sys_det]['master_pflege'][$this->ipid];
			$p_pflegedienstes = $system_icon_data[$k_sys_det]['patient_pflege'][$this->ipid];
		?>
		<?php foreach($pflegedienstes as $k_pfleges => $pflegedienst): ?>
		<table class="pflege_icon_list" colspan="2">
			<tbody>

				<tr>
					<td class="colbold patcontactscol1" colspan="4" valign="top"></td>
				</tr>
				<tr>
					<td class="colbold patcontactscol1 first_row" valign="top">
						<?php echo $this->translate('nursing_icon'); ?>
					</td>
					<td colspan="3" class="first_row" >
						<?php echo $pflegedienst['nursing']; ?>
					</td>
				</tr>
				<tr>
					<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('firstname'); ?></td>
					<td class="patcontactscol2" valign="top"><?php echo $pflegedienst['first_name']; ?></td>

					<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('lastname'); ?></td>
					<td class="patcontactscol2" valign="top"><?php echo $pflegedienst['last_name']; ?></td>
				</tr>
				<tr>
					<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('salutation'); ?></td>
					<td class="patcontactscol2" valign="top"><?php echo $pflegedienst['salutation']; ?></td>
					
					<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('address'); ?></td>
					<td class="patcontactscol2" valign="top"><?php echo $pflegedienst['street1']; ?></td>
				</tr>
				<tr>
					<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
					<td class="patcontactscol2" valign="top"><?php echo $pflegedienst['zip']; ?></td>
					
					<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
					<td class="patcontactscol2" valign="top"><?php echo $pflegedienst['city']; ?></td>
				</tr>
				<tr>
					<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone1'); ?></td>
					<td class="patcontactscol2"><?php echo $pflegedienst['phone_practice']; ?></td>

					<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('emergency_phone'); ?></td>
					<td class="patcontactscol2"><?php echo $pflegedienst['phone_emergency']; ?></td>
				</tr>
				<tr>
					<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('fax'); ?></td>
					<td class="patcontactscol2"><?php echo $pflegedienst['fax']; ?></td>
					
					<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
					<td class="patcontactscol2"><?php echo $pflegedienst['email']; ?></td>
				</tr>
				<tr>
					<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
					<td valign="top" colspan="3"><?php echo $p_pflegedienstes[$pflegedienst['id']]['pflege_comment']; ?></td>
				</tr>
			</tbody>
		</table>
	<?php endforeach; ?>

	<?php
		elseif($k_sys_det == '38'):  //Physiotherapist
			$physiotherapist = $system_icon_data[$k_sys_det]['master_physio'][$this->ipid];
			$p_physiotherapist = $system_icon_data[$k_sys_det]['patient_physio'][$this->ipid];

			?>
			
			<?php foreach($physiotherapist as $k_physio => $physiotherapist): ?>
										<table class="pflege_icon_list" colspan="2">
											<tbody>

												<tr>
													<td class="colbold patcontactscol1" colspan="4" valign="top"></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1 first_row" valign="top">
				<?php echo $this->translate('physio_icon'); ?>
													</td>
													<td colspan="3" class="first_row" >
				<?php echo $physiotherapist['physiotherapist']; ?>
													</td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('firstname'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $physiotherapist['first_name']; ?></td>

													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('lastname'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $physiotherapist['last_name']; ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('salutation'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $physiotherapist['salutation']; ?></td>
													
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('address'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $physiotherapist['street1']; ?></td>
													
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $physiotherapist['zip']; ?></td>
												
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $physiotherapist['city']; ?></td>
													
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone1'); ?></td>
													<td class="patcontactscol2"><?php echo $physiotherapist['phone_practice']; ?></td>
												
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('emergency_phone'); ?></td>
													<td class="patcontactscol2"><?php echo $physiotherapist['phone_emergency']; ?></td>
													
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('fax'); ?></td>
													<td class="patcontactscol2"><?php echo $physiotherapist['fax']; ?></td>
												 
												    <td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
													<td class="patcontactscol2"><?php echo $physiotherapist['email']; ?></td>

												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
													<td valign="top" colspan="3"><?php echo $p_physiotherapist[$physiotherapist['id']]['physio_comment']; ?></td>
												</tr>
											</tbody>
										</table>
			<?php endforeach; ?>
<?php
		elseif($k_sys_det == '39'):  //Homecare
			$homecare = $system_icon_data[$k_sys_det]['master_homes'][$this->ipid];
			$p_homecare = $system_icon_data[$k_sys_det]['patient_homes'][$this->ipid];

			?>
			<?php foreach($homecare as $k_home => $homecare): ?>
				<table class="pflege_icon_list" colspan="2">
					<tbody>

						<tr>
							<td class="colbold patcontactscol1" colspan="4" valign="top"></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1 first_row" valign="top">
								<?php echo $this->translate('home_icon'); ?>
							</td>
							<td colspan="3" class="first_row" >
								<?php echo $homecare['homecare']; ?>
							</td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('firstname'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $homecare['first_name']; ?></td>

													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('lastname'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $homecare['last_name']; ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('salutation'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $homecare['salutation']; ?></td>
													
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('address'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $homecare['street1']; ?></td>
													
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $homecare['zip']; ?></td>
												
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $homecare['city']; ?></td>
												
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone1'); ?></td>
													<td class="patcontactscol2"><?php echo $homecare['phone_practice']; ?></td>
												
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('emergency_phone'); ?></td>
													<td class="patcontactscol2"><?php echo $homecare['phone_emergency']; ?></td>
													
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('fax'); ?></td>
													<td class="patcontactscol2"><?php echo $homecare['fax']; ?></td>
												   
												    <td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
													<td class="patcontactscol2"><?php echo $homecare['email']; ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
													<td valign="top" colspan="3"><?php echo $p_homecare[$homecare['id']]['home_comment']; ?></td>
												</tr>
											</tbody>
										</table>
			<?php endforeach; ?>
		<?php
		elseif($k_sys_det == '23'):  //Hausnotruf - emergency nursing
			$pflegedienstes = $system_icon_data[$k_sys_det]['master_pflege_emergency'][$this->ipid];
			$p_pflegedienstes = $system_icon_data[$k_sys_det]['patient_pflege_emergency'][$this->ipid];
			?>
			<?php foreach($pflegedienstes as $k_pfleges => $pflegedienst): ?>
										<table class="pflege_icon_list" colspan="2">
											<tbody>

												<tr>
													<td class="colbold patcontactscol1" colspan="4" valign="top"></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1 first_row" valign="top">
				<?php echo $this->translate('pflege_emergency'); ?>
													</td>
													<td colspan="3" class="first_row" >
				<?php echo $pflegedienst['nursing']; ?>
													</td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('firstname'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $pflegedienst['first_name']; ?></td>

													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('lastname'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $pflegedienst['last_name']; ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('address'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $pflegedienst['street1']; ?></td>

													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $pflegedienst['zip']; ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $pflegedienst['city']; ?></td>

													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone1'); ?></td>
													<td class="patcontactscol2"><?php echo $pflegedienst['phone_practice']; ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('emergency_phone'); ?></td>
													<td class="patcontactscol2"><?php echo $pflegedienst['phone_emergency']; ?></td>

													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('fax'); ?></td>
													<td class="patcontactscol2"><?php echo $pflegedienst['fax']; ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
													<td class="patcontactscol2"><?php echo $pflegedienst['email']; ?></td>

													<td class="colbold patcontactscol1" valign="top"></td>
													<td class="patcontactscol2"></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
													<td colspan="3" valign="top"><?php echo $p_pflegedienstes[$pflegedienst['id']]['pflege_comment']; ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top" style="color: #ff0000"><?php echo $this->translate('emergency comment'); ?></td>
													<td colspan="3" valign="top"  style="color: #ff0000"><?php echo $p_pflegedienstes[$pflegedienst['id']]['pflege_emergency_comment']; ?></td>
												</tr>
											</tbody>
										</table>
			<?php endforeach; ?>


		<?php elseif($k_sys_det == '2'): //VOLLVERSORGUNG VL  ?>
									<table class="vollversorgung_icon_list" colspan="2">
										<tbody>

											<tr>
												<td class="colbold patcontactscol1 first_row"  valign="top">VOLLVERSORGUNG</td>
												<td class="patcontactscol2 first_row" valign="top"><?php echo $this->nr . '.'; ?> Tag</td>
												<td class="patcontactscol2 first_row" ></td>
												<td class="patcontactscol2 first_row" ></td>
											</tr>
										</tbody>
									</table>

		<?php
		elseif($k_sys_det == '1'): // Ehrenamtliche
			$workers = $system_icon_data[$k_sys_det]['master_workers_data'][$this->ipid];
			$p_workers = $system_icon_data[$k_sys_det]['patient_workers_data'][$this->ipid];
			?>
			
			<?php if(!1) foreach($workers as $k_worker => $worker): ?>
										<table class="workers_icon_list" colspan="2">
											<tbody>

												<tr>
													<td class="colbold patcontactscol1 first_row" colspan="4" valign="top">Ehrenamtliche</td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top" ><?php echo $this->translate('firstname'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $worker['first_name']; ?></td>

													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('lastname'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $worker['last_name']; ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('salutation'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $worker['salutation']; ?></td>
													
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('address'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $worker['street1']; ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $worker['zip']; ?></td>
													
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $worker['city']; ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone1'); ?></td>
													<td class="patcontactscol2"><?php echo $worker['phone']; ?></td>
													
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('mobile'); ?></td>
													<td class="patcontactscol2"><?php echo $worker['mobile']; ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
													<td class="patcontactscol2"><?php echo $worker['email']; ?></td>
													
													<td class="colbold patcontactscol1" valign="top"></td>
													<td class="patcontactscol2"></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
													<td colspan="3"><?php echo $p_workers[$worker['id']]['vw_comment']; ?></td>
												</tr>
												<!-- TODO-3782 Lore 19.02.2021 -->
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('Prim√§rstatus'); ?></td>
													<td colspan="3"><?php echo ($this->escape($worker['status']) == 'k') ? $this->translate("Koordinator") : (($this->escape($worker['status']) == 'e') ? $this->translate("Ehrenamtlicher") : "") ?></td>
												</tr>
											</tbody>
										</table>
			<?php endforeach; ?>
									<!-- mouseover voluntaryworker icon table start  -->
									<table class="workers_icon_list">
										<tbody>
												
												
									<?php foreach($workers as $k => $workers_type) :  ?>
											<tr>
												<td class="colbold patcontactscol1 first_row"  valign="top">
									<?php 
										if ($k == "active") {
											echo $this->translate("active voluntaryworkers");
										}										
										elseif ($k == "old") {
											echo $this->translate("inactive voluntaryworkers");
										}
									?>
										</td></tr>
										
										<tr><td>

									<?php foreach($workers_type as $k_worker => $worker): ?>
										<table class="workers_icon_list" >
											<tbody>

												<tr>
													<td class="colbold patcontactscol1 first_row" colspan="4" valign="top">Ehrenamtliche (<?php echo ($p_workers[$worker['id']]['start_date'] != '0000-00-00 00:00:00' ? date('d.m.Y', strtotime($p_workers[$worker['id']]['start_date'])) : date('d.m.Y', strtotime($p_workers[$worker['id']]['create_date']))); ?> - <?php echo ($p_workers[$worker['id']]['end_date'] != '0000-00-00 00:00:00' ? date('d.m.Y', strtotime($p_workers[$worker['id']]['end_date'])) : ''); ?> )</td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top" ><?php echo $this->translate('firstname'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $this->escape($worker['first_name']); ?></td>

													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('lastname'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $this->escape($worker['last_name']); ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('salutation'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $this->escape($worker['salutation']); ?></td>
													
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('address'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $this->escape($worker['street']); ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $this->escape($worker['zip']); ?></td>
													
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
													<td class="patcontactscol2" valign="top"><?php echo $this->escape($worker['city']); ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone1'); ?></td>
													<td class="patcontactscol2"><?php echo $this->escape($worker['phone']); ?></td>
													
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('mobile'); ?></td>
													<td class="patcontactscol2"><?php echo $this->escape($worker['mobile']); ?></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
													<td class="patcontactscol2"><?php echo $this->escape($worker['email']); ?></td>
													
													<td class="colbold patcontactscol1" valign="top"></td>
													<td class="patcontactscol2"></td>
												</tr>
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
													<td colspan="3"><?php  echo $this->escape($worker['pvw_comment']); ?></td>
												</tr>
												<!-- TODO-3782 Lore 19.02.2021 -->
												<tr>
													<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('Prim√§rstatus'); ?></td>
													<td colspan="3"><?php echo ($this->escape($worker['status']) == 'k') ? $this->translate("Koordinator") : (($this->escape($worker['status']) == 'e') ? $this->translate("Ehrenamtlicher") : "") ?></td>
												</tr>
											</tbody>
										</table>
			<?php endforeach; ?>
			</td></tr>
			
			
			
			<?php endforeach; ?>
			</tbody>
			</table>
			<!-- mouseover voluntaryworker icon table end  -->
			
			
		<?php
		elseif($k_sys_det == '27'): // Sanit√§tshaus
			$suppliers = $system_icon_data[$k_sys_det]['master_supplier_data'][$this->ipid];
			$p_suppliers = $system_icon_data[$k_sys_det]['patient_supplier_data'][$this->ipid];
			?>
			<?php foreach($suppliers as $k_suppliers => $v_suppliers): ?>
			<table class="supplier_icon_list" colspan="2">
				<tbody>

					<tr>
						<td class="colbold patcontactscol1 first_row" valign="top"><?php echo $this->translate('supplier') ?></td>
						<td class="first_row" colspan="3" valign="top"><?php echo $v_suppliers['supplier']; ?></td>
					</tr>
					<tr>
						<!-- <td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('salutation'); ?></td>
						<td class="patcontactscol2" valign="top"><?php echo $v_suppliers['salutation']; ?></td> -->

						<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('address'); ?></td>
						<td colspan="3" class="patcontactscol2" valign="top"><?php echo $v_suppliers['street1']; ?></td>
					</tr>
					<tr>
						<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
						<td class="patcontactscol2" valign="top"><?php echo $v_suppliers['zip']; ?></td>

						<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
						<td class="patcontactscol2" valign="top"><?php echo $v_suppliers['city']; ?></td>
					</tr>
					<tr>
						<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone1'); ?></td>
						<td class="patcontactscol2"><?php echo $v_suppliers['phone']; ?></td>

						<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('fax'); ?></td>
						<td class="patcontactscol2"><?php echo $v_suppliers['fax']; ?></td>
					</tr>
					<tr>
						<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
						<td class="patcontactscol2"><?php echo $v_suppliers['email']; ?></td>

						<td class="colbold patcontactscol1" valign="top"></td>
						<td></td>
					</tr>
					<tr>
						<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
						<td colspan="3"><?php echo $p_suppliers[$k_suppliers]['supplier_comment']; ?></td>
					</tr>
				</tbody>
			</table>
			<?php endforeach; ?>
		<?php
		elseif($k_sys_det == '29'): // Specialists

			$specialists = $system_icon_data[$k_sys_det]['master_specialists_data'][$this->ipid];
			$p_specialists = $system_icon_data[$k_sys_det]['patient_specialists_data'][$this->ipid];
			?>
			<?php foreach($specialists as $k_specialists => $v_specialists): ?>
				<table class="specialists_icon_list" colspan="2">
					<tbody>
						<tr>
							<td class="colbold patcontactscol1 first_row" colspan="4" valign="top"><?php echo $this->translate('specialist'); ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top" ><?php echo $this->translate('practice'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_specialists['practice']; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('specialist_type'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_specialists['medical_speciality_text']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top" ><?php echo $this->translate('firstname'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_specialists['first_name']; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('lastname'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_specialists['last_name']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('salutation'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_specialists['salutation']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('address'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_specialists['street1']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_specialists['zip']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_specialists['city']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone1'); ?></td>
							<td class="patcontactscol2"><?php echo $v_specialists['phone_practice']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('fax'); ?></td>
							<td class="patcontactscol2"><?php echo $v_specialists['fax']; ?></td>

						</tr>
						
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('Telefon privat'); ?></td>
							<td class="patcontactscol2"><?php echo $v_specialists['phone_private']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('mobile'); ?></td>
							<td class="patcontactscol2"><?php echo $v_specialists['phone_cell']; ?></td>
						</tr>
						
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
							<td class="patcontactscol2"><?php echo  $v_specialists['email']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"></td>
							<td></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
							<td colspan="3"><?php echo $p_specialists[$k_specialists]['comment']; ?></td>
						</tr>
					</tbody>
				</table>
			<?php endforeach; ?>

			<!--Family doctor icon-->
			<?php elseif($k_sys_det == '25'): ?>

				<?php $family_doc = $system_icon_data[$k_sys_det]['family_doc_data'][$this->ipid]; ?>
				<?php if(!empty($family_doc['title'])): ?>
					<?php $family_doc_name = $family_doc['title'] . ' ' . $family_doc['last_name'].', '.$family_doc['first_name']; ?>
				<?php else: ?>
					<?php $family_doc_name = $family_doc['last_name'].', '.$family_doc['first_name']; ?>
				<?php endif; ?>

				<table class="pflege_icon_list" colspan="2">
					<tbody>
						<tr>
							<td class="colbold patcontactscol1 first_row" valign="top">
								<?php echo $this->translate('familydoc'); ?>
							</td>
							
							<td class="colbold patcontactscol1 first_row" valign="top" colspan="3">
								 <?php echo  $family_doc_name;?>
							</td>
							
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('firstname'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $family_doc['first_name']; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('lastname'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $family_doc['last_name']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('salutation'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $family_doc['salutation']; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('address'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $family_doc['street1']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $family_doc['zip']; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $family_doc['city']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone1'); ?></td>
							<td class="patcontactscol2"><?php echo $family_doc['phone_practice']; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('Handy Nummer'); ?></td>
							<td class="patcontactscol2"><?php echo $family_doc['phone_private']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('fax'); ?></td>
							<td class="patcontactscol2"><?php echo $family_doc['fax']; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
							<td class="patcontactscol2"><?php echo $family_doc['email']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('LANR'); ?></td>
							<td class="patcontactscol2" ><?php echo $family_doc['doctornumber']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('bsnr'); ?></td>
							<td class="patcontactscol2" ><?php echo $family_doc['doctor_bsnr']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('practice'); ?></td>
							<td class="patcontactscol2" ><?php echo $family_doc['practice']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
							<!-- 
                            <td class="patcontactscol2" colspan="3"><?php echo $family_doc['comments']; ?></td>
                             -->
							<td class="patcontactscol2"><?php echo $family_doc['comments']; ?></td>
                            <?php
                            //@cla colspan="3" breaks the rule for the row to have only 4 tds .... removed by @cla
                            ?>

						</tr>
					</tbody>
				</table>
		<?php
		elseif($k_sys_det == '31'):  //Diagnosis icon
			$diagnosis_data = $system_icon_data[$k_sys_det]['diagnosis_data'][$this->ipid];
			ksort($diagnosis_data);
		?>
			<table  class="diagno_icon_list"  border="1" width="100%">
				<tbody>
					<tr>
						<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('Diagnosen'); ?></td>
					</tr>
					<?php foreach($diagnosis_data as $diagnosis_type => $diagnosis_details): ?>
						<tr>
							<td class="colbold patcontactscol1 first_row"  valign="top"><?php echo $diagnosis_type; ?></td>
						</tr>
						<?php foreach($diagnosis_details as $k => $description): ?>
						<tr>
							<td class="patcontactscol2" ><?php echo $description; ?></td>
						</tr>
						<?php endforeach; ?>
				<?php endforeach; ?>
				</tbody>
			</table>
		<?php
		elseif($k_sys_det == '32'):  //Medication icon
			$medication_data = $system_icon_data[$k_sys_det]['medication_data'][$this->ipid];
			//ISPC-2547 Carmen 02.03.2020 new design
		?>
<!--// ISPC-2517 Ancuta 23.05.2020  -->
<div id="medication_icon_block"></div>
<?php if( 1==2 ): ?>
				<table  class="diagno_icon_list"  width="100%">
				<tbody>				
					<?php foreach($medication_data as $medication_type => $medication_details): ?>
						<?php if($medication_type != "Q"): ?>
						<tr>
							<td colspan="2">
							<?php	if($medication_details['interval']) {
							
							?>
										<div class="modern-tab-content modern-active_content medikation">
										<div class="header">
											<h1><?php echo $this->translate('medication_type_' . $medication_type); ?></h1>
											<ul class="dosage-time">
												<?php $time = 1;foreach($medication_details['interval'] as $kt => $vt) { ?>
													<li class="time"><?php echo $vt['time']; ?></li>
													<?php $time++; if($time > 12) { break; } ?>
												<?php } unset($medication_details['interval']); ?>
												
											</ul>
										</div>
								
									<?php foreach($medication_details as $kdrug => $detail_drug): ?>
										<!-- medi repeating element -->
										<ul class="medi-element">
											<li class="medi">
												<span class="desc"><?php echo $detail_drug['medications']; ?></span>
												<span class="comment"><?php echo $detail_drug['comments']; ?></span>
												<?php if(!empty($detail_drug['indications'])):?>
													<?php if(!empty($detail_drug['indications']['color']) ): ?>
														<span class="status" style="color:#<?php echo $detail_drug['indications']['color']; ?>"><div style="background:#<?php echo $detail_drug['indications']['color']; ?>"></div><?php echo $detail_drug['indications']['name']; ?></span>
													<?php endif;?>
												<?php endif;?>
											</li>
											<?php $time = 1; foreach($detail_drug['dosage'] as $kt => $vt) {
												if($vt['value'] != '')
												{
												if($vt['given'] != '0') {				
													//ISPC-2583 Carmen 27.04.2020				
													if($vt['given']['dosage_status_color'] != $color_map['not_given']) {				
														?>
															<li class="dose given <?php echo $vt['given']['dosage_status_color']; ?>" data-given = "<?php echo htmlspecialchars(json_encode($vt['given'])); ?>" data-cocktail_id = "" data-medication="<?php echo $detail_drug['medications']; ?>" data-time_schedule = "1" data-medication_type="<?php echo $medication_type; ?>"><?php echo $vt['value']; ?></li>
															<?php $time++; if($time > 12) { break; } ?>
														<?php } else { ?>
															<li class="dose notgiven <?php echo $vt['given']['dosage_status_color']; ?>" data-given = "<?php echo htmlspecialchars(json_encode($vt['given'])); ?>" data-cocktail_id = "" data-medication="<?php echo $detail_drug['medications']; ?>" data-time_schedule = "1" data-medication_type="<?php echo $medication_type; ?>"><?php echo $vt['value']; ?></li>
															<?php $time++; if($time > 12) { break; } ?>
													<?php }
													//-- 
													} else { ?>
														<li class="dose givenow" data-given = "" data-cocktail_id = ""  data-drugplan_id = "<?php echo $kdrug; ?>" data-dosage_time_interval="<?php echo $kt; ?>" data-medication="<?php echo $detail_drug['medications']; ?>" data-dosage = "<?php echo $vt['value']; ?>" data-dosage_date="<?php echo date('d.m.Y', time()); ?>" data-time_schedule = "1" data-medication_type="<?php echo $medication_type; ?>"><?php echo $vt['value']; ?></li>
														<?php  $time++; if($time > 12) { break; } ?>
												<?php } }
												else { ?>
													<li class="dose"  data-cocktail_id = ""  data-drugplanid = "<?php echo $kdrug; ?>" data-dosagetime="<?php echo $kt; ?>" data-medication="<?php echo $detail_drug['medications']; ?>" data-medication_type="<?php echo $medication_type; ?>"><?php echo $vt['value']; ?></li>
													<?php  $time++; if($time > 12) { break; } ?>
											<?php } } ?>								
											
										</ul>
									<?php endforeach; ?>
									
									<!--// medi repeating element -->
								</div>
															
							<?php } else { ?>
								<div class="modern-tab-content modern-active_content medikation">
									<div class="header">
										<h1><?php echo $this->translate('medication_type_' . $medication_type); ?></h1>
										<ul class="onedosehead">
											<li><?php echo $this->translate('dosage'); ?></li>
											<? if($medication_type == "N" || $medication_type == "KM"): ?>
												<li class="interval"><?php echo $this->translate('Interval for dosage'); ?></li>
											<?php endif; ?>
										</ul>
									</div>
							
								<?php foreach($medication_details as $kdrug => $detail_drug): ?>
									<!-- medi repeating element -->
									<ul class="medi-element">
										<li class="medi">
											<span class="desc"><?php echo $detail_drug['medications']; ?></span>
											<span class="comment"><?php echo $detail_drug['comments']; ?></span>
											<?php if(!empty($detail_drug['indications'])):?>
												<?php if(!empty($detail_drug['indications']['color']) ): ?>
													<span class="status" style="color:#<?php echo $detail_drug['indications']['color']; ?>"><div style="background:#<?php echo $detail_drug['indications']['color']; ?>"></div><?php echo $detail_drug['indications']['name']; ?></span>
												<?php endif;?>
											<?php endif;?>
										</li>
										
										<? if($medication_type == "N" || $medication_type == "KM"): ?>
											<? 
											if($detail_drug['dosage']['dosage']['value'] != '')
											{
												if($detail_drug['dosage']['given'] == '1'): ?>
													<li class="onedose given addinfo" data-given = "" data-cocktail_id = "" data-drugplan_id = "<?php echo $kdrug; ?>" data-medication="<?php echo $detail_drug['medications']; ?>" data-dosage = "<?php echo $detail_drug['dosage']['dosage']; ?>" data-time_schedule = "0"><?php echo $detail_drug['dosage']['dosage']; ?></li>
												<?php else: ?>
													<li class="onedose givenow addinfo" data-given = "" data-cocktail_id = "" data-drugplan_id = "<?php echo $kdrug; ?>" data-medication="<?php echo $detail_drug['medications']; ?>" data-dosage = "<?php echo $detail_drug['dosage']['dosage']; ?>" data-dosage_date="<?php echo date('d.m.Y', time()); ?>" data-time_schedule = "0" data-dosage_time_interval="" data-medication_type="<?php echo $medication_type; ?>"><?php echo $detail_drug['dosage']['dosage']; ?></li>
												<?php endif; ?>
											 <?php } else { ?>	
												<li class="onedose"></li>
											<?php } ?>
											<li class="onedose"><?php echo $detail_drug['dosage_interval']; ?></li>
										<?php else: ?>
											<li class="onedose"><?php echo $detail_drug['dosage']['dosage']; ?></li>
										<?php endif; ?>
									</ul>
									<!--// medi repeating element -->
								<?php endforeach; ?>
								</div>							
							<?php } ?>
						</td>
					</tr>	
					<?php else:?>
						<tr>
							<td colspan="2">
								<div class="modern-tab-content modern-active_content medikation">
									<div class="header">
										<h1><?php echo $this->translate('medication_type_' . $medication_type); ?></h1>
										<ul class="onedosehead">
											<li><?php echo $this->translate('dosage'); ?></li>
										</ul>
									</div>
									<?php foreach($medication_details as $cocktail => $cocktail_medications): ?>
								<?php foreach($cocktail_medications['medications'] as $k => $description): ?>
								
									<!-- medi repeating element -->
									<ul class="medi-element">
										<li class="medi">
											<span class="desc"><?php echo $description; ?></span>
											<?php if(!empty($cocktail_medications['indications'])):?>
												<?php if(!empty($cocktail_medications['indications'][$k]['color']) ): ?>
													<span class="status" style="color:#<?php echo $cocktail_medications['indications'][$k]['color']; ?>"><div style="background:#<?php echo $cocktail_medications['indications'][$k]['color']; ?>"></div><?php echo $cocktail_medications['indications'][$k]['name']; ?></span>
												<?php endif;?>
											<?php endif;?>
										</li>
										<li class="onedose"><?php echo $cocktail_medications['dosage'][$k]; ?></li>
										</ul>
									
									<!--// medi repeating element -->
										
								<?php endforeach; ?>
								<ul class="medi-element">
									<li style="width: 100%;"><b><?php echo $this->translate("comments");?>: </b><?php echo $cocktail_medications['cocktail_details']['comment']; ?></li>
								</ul>
								<ul class="medi-element">
									<li style="width: 100%;"><b><?php echo $this->translate("Flussrate");?>: </b><?php echo $cocktail_medications['cocktail_details']['flussrate']; ?></li>
								</ul>
								<?php if($cocktail_medications['cocktail_details']['bolus'] != '')
								{ ?>
									<ul class="medi-element">
										<li class="onedose givenow" data-given = "" data-cocktail_id = "<?php echo $cocktail; ?>" data-drugplan_id = "" data-medication="<?php echo 'PUMPE'; ?>" data-dosage = "<?php echo $cocktail_medications['cocktail_details']['bolus']; ?>" data-dosage_date="<?php echo date('d.m.Y', time()); ?>" data-time_schedule = "0" data-dosage_time_interval="" style="width: 100%;" data-medication_type="<?php echo $medication_type; ?>"><b><?php echo $this->translate("Bolus");?>: </b><?php echo $cocktail_medications['cocktail_details']['bolus']; ?></li>
									</ul>
								<?php } else { ?>
									<ul class="medi-element">
										<li class="onedose" style="width: 100%;" data-medication_type="<?php echo $medication_type; ?>"><b><?php echo $this->translate("Bolus");?>: </b></li>
									</ul>
								<?php } ?>
							<?php endforeach; ?>
							</div>
							</td>
						</tr>
					<?php endif;?>
				<?php endforeach; ?>
			</tbody>
		</table>
<?php endif;?>		


		<?php
			elseif($k_sys_det == '34'):  //Aphoteke
			$aphoteke_data = $system_icon_data[$k_sys_det]['patient_pharmacy_data'][$this->ipid];
			?>
			<?php foreach($aphoteke_data as $k_pharmacy => $pharmacy): ?>
				<table class="pharmacy_icon_list" colspan="2">
					<tbody>

						<tr>
							<td class="colbold patcontactscol1" colspan="4" valign="top"></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1 first_row" valign="top">
								<?php echo $this->translate('pharmacy_icon'); ?>
							</td>
							<td colspan="3" class="first_row" >
								<?php echo $pharmacy['pharmacy']; ?>
							</td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('firstname'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $pharmacy['first_name']; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('lastname'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $pharmacy['last_name']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('salutation'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $pharmacy['salutation']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('address'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $pharmacy['street1']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $pharmacy['zip']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $pharmacy['city']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone1'); ?></td>
							<td class="patcontactscol2"><?php echo $pharmacy['phone']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('fax'); ?></td>
							<td class="patcontactscol2"><?php echo $pharmacy['fax']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
							<td class="patcontactscol2"><?php echo $pharmacy['email']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"></td>
							<td class="patcontactscol2"></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
							<td valign="top" colspan="3"><?php echo $pharmacy['pharmacy_comment']; ?></td>
						</tr>
					</tbody>
				</table>
			<?php endforeach; ?>
			<?php elseif($k_sys_det == '35'):  //Krankenkasse
			$hi_data = $system_icon_data[$k_sys_det]['patient_hi_data'][$this->ipid];
			?>
			<?php foreach($hi_data as $k_hi => $healthinsurance): ?>
				<table class="hi_icon_list" colspan="2">
					<tbody>

						<tr>
							<td class="colbold patcontactscol1" colspan="4" valign="top"></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1 first_row" valign="top">
								<?php echo $this->translate('healthinsurance_icon'); ?>
							</td>
							<td colspan="3" class="first_row" >
							<?php
								if($healthinsurance['privatepatient'] == 1)
								{
									echo $healthinsurance['company_name'].'<span style="color:#ff0000;">&nbsp;(Privat)</span>';
								}
								else
								{
								 	echo $healthinsurance['company_name'];
								}
							?>
							</td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('insurance_provider_icon'); ?></td>
							<td class="patcontactscol2" valign="top"><?php if(!empty($healthinsurance['ins_insurance_provider'])): echo $healthinsurance['ins_insurance_provider']; else:  echo $healthinsurance['company']['insurance_provider']; endif; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('contactperson'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $healthinsurance['ins_contactperson']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('street'); ?></td>
							<td class="patcontactscol2" valign="top"><?php if(!empty($healthinsurance['ins_street'])): echo $healthinsurance['ins_street']; else:  echo $healthinsurance['company']['street1']; endif; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
							<td class="patcontactscol2" valign="top"><?php if(!empty($healthinsurance['ins_zip'])): echo $healthinsurance['ins_zip']; else:  echo $healthinsurance['company']['zip']; endif; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
							<td class="patcontactscol2" valign="top"><?php if(!empty($healthinsurance['ins_city'])): echo $healthinsurance['ins_city']; else:  echo $healthinsurance['company']['city']; endif; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone1'); ?></td>
							<td class="patcontactscol2"><?php if(!empty($healthinsurance['ins_phone'])): echo $healthinsurance['ins_phone']; else:  echo $healthinsurance['company']['phone']; endif; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone2'); ?></td>
							<td class="patcontactscol2"><?php if(!empty($healthinsurance['ins_phone2'])): echo $healthinsurance['ins_phone2']; else:  echo $healthinsurance['company']['phone2']; endif; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phonefax'); ?></td>
							<td class="patcontactscol2"><?php if(!empty($healthinsurance['ins_phonefax'])): echo $healthinsurance['ins_phonefax']; else:  echo $healthinsurance['company']['phonefax']; endif; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
							<td class="patcontactscol2"><?php if(!empty($healthinsurance['ins_email'])): echo $healthinsurance['ins_email']; else:  echo $healthinsurance['company']['email']; endif; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('kassenno'); ?></td>
							<td class="patcontactscol2"><?php if(!empty($healthinsurance['kvk_no'])): echo $healthinsurance['kvk_no']; else:  echo $healthinsurance['company']['kvnumber']; endif; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('Institutskennzeichen (IK) '); ?></td>
							<td class="patcontactscol2"><?php if(!empty($healthinsurance['institutskennzeichen'])): echo $healthinsurance['institutskennzeichen']; else:  echo $healthinsurance['company']['iknumber']; endif; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('insuranceno'); ?></td>
							<td class="patcontactscol2"><?php echo $healthinsurance['insurance_no']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('insurancestatus'); ?></td>
							<td class="patcontactscol2"><?php echo $healthinsurance['insurance_status']; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('gebuhrenbefreit');?></td>
							<td class="patcontactscol2"><?php if($healthinsurance['rezeptgebuhrenbefreiung'] == '1'): echo $this->translate('yes_radio'). ($healthinsurance['exemption_till_date'] != "" ? "(bis: ".$healthinsurance['exemption_till_date'].")" : "");  endif; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('gebuhrenpflichtig');?></td>
							<td class="patcontactscol2"><?php if($healthinsurance['rezeptgebuhrenbefreiung'] == '2'): echo $this->translate('yes_radio');  endif; ?></td>
						<?php if(!empty($healthinsurance['private_contribution'])): ?>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('validcontribution'); ?></td>
							<td class="patcontactscol2"><?php echo $healthinsurance['private_contribution']; ?></td>							
						</tr>
						<tr>
						<?php if ($this->show_debtor_number == 1 && (!empty($healthinsurance['ins_debtor_number']) || !empty($healthinsurance['company']['debtor_number']))) :?>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
							<td valign="top">
							<?php if(strlen($healthinsurance['comment'])>'0'): ?>
								<?php echo $healthinsurance['comment']; ?>
							<?php elseif(strlen($healthinsurance['company']['comments'])>'0'): ?>
								<?php echo $healthinsurance['company']['comments']; ?>
							<?php endif; ?>
							</td>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('debtor_number'); ?></td>
							<td class="patcontactscol2"><?php if(!empty($healthinsurance['ins_debtor_number'])): echo $healthinsurance['ins_debtor_number']; else:  echo $healthinsurance['company']['debtor_number']; endif; ?></td>
						<?php else: ?>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
							<td colspan="3" valign="top">
							<?php if(strlen($healthinsurance['comment'])>'0'): ?>
								<?php echo $healthinsurance['comment']; ?>
							<?php elseif(strlen($healthinsurance['company']['comments'])>'0'): ?>
								<?php echo $healthinsurance['company']['comments']; ?>
							<?php endif; ?>
								</td>
						<?php endif; ?>
						</tr>
						<?php elseif ($this->show_debtor_number == 1 && (!empty($healthinsurance['ins_debtor_number']) || !empty($healthinsurance['company']['debtor_number']))) :?>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('debtor_number'); ?></td>
							<td class="patcontactscol2"><?php if(!empty($healthinsurance['ins_debtor_number'])): echo $healthinsurance['ins_debtor_number']; else:  echo $healthinsurance['company']['debtor_number']; endif; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
							<td colspan="3" valign="top">
							<?php if(strlen($healthinsurance['comment'])>'0'): ?>
								<?php echo $healthinsurance['comment']; ?>
							<?php elseif(strlen($healthinsurance['company']['comments'])>'0'): ?>
								<?php echo $healthinsurance['company']['comments']; ?>
							<?php endif; ?>
								</td>
						</tr>
						<?php else: ?>
							<td class="colbold patcontactscol1" valign="top"></td>
							<td class="patcontactscol2"></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
							<td colspan="3" valign="top">
							<?php if(strlen($healthinsurance['comment'])>'0'): ?>
								<?php echo $healthinsurance['comment']; ?>
							<?php elseif(strlen($healthinsurance['company']['comments'])>'0'): ?>
								<?php echo $healthinsurance['company']['comments']; ?>
							<?php endif; ?>
								</td>
						</tr>	
						<?php endif;?>
					</tbody>
				</table>
			<?php endforeach; ?>
			<?php elseif($k_sys_det == '36'):
//				Versorger
				$suppliers = $system_icon_data[$k_sys_det]['patient_supplyer_data'][$this->ipid];
			?>
			<?php foreach($suppliers as $k_suppliers => $v_suppliers): ?>
				<table class="supplier_icon_list" colspan="2">
					<tbody>

						<tr>
							<td class="colbold patcontactscol1 first_row" valign="top"><?php echo $this->translate('suppliers') ?></td>
							<td class="first_row" valign="top"><?php echo $v_suppliers['supplier']; ?></td>
							
							<td class="colbold patcontactscol1 first_row" valign="top"><?php echo $this->translate('supplier_type'); ?></td>
							<td class="first_row" valign="top"><?php echo $v_suppliers['type']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('firstname'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_suppliers['first_name']; ?></td>

							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('lastname'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_suppliers['last_name']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('salutation'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_suppliers['salutation']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('address'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_suppliers['street1']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('zip'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_suppliers['zip']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('city'); ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $v_suppliers['city']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('phone1'); ?></td>
							<td class="patcontactscol2"><?php echo $v_suppliers['phone']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('fax'); ?></td>
							<td class="patcontactscol2"><?php echo $v_suppliers['fax']; ?></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('email'); ?></td>
							<td class="patcontactscol2"><?php echo $v_suppliers['email']; ?></td>
							
							<td class="colbold patcontactscol1" valign="top"></td>
							<td class="patcontactscol2"></td>
						</tr>
						<tr>
							<td class="colbold patcontactscol1" valign="top"><?php echo $this->translate('comment'); ?></td>
							<td colspan="3"><?php echo $v_suppliers['supplier_comment']; ?></td>
						</tr>
					</tbody>
				</table>
			<?php endforeach; ?>
			<!-- Maria:: Migration CISPC to ISPC 20.08.2020 -->
			<?php elseif($k_sys_det == '10006') : ?>
			<?php
			$later = date_create_from_format('d.m.Y', $system_icon_data[$k_sys_det]['patient_reassessments_next'][$this->ipid]);
								if($later !== false){
								$earlier = new DateTime();
								
								$diff = $later->diff($earlier)->format("%a");
								$next_assessment =  $diff;
								if($diff > 0){
								$str = "N√§chstes Re-Assessment in x Tage/n";
								$text = str_replace('x', $next_assessment, $str  ); //"N√§chste Reassessment in " . $next_assessment . " Tage.";
								}elseif($diff == 0){
								$text = "N√§chste Reassessment heute.";
								}else{
								$text ="N√§chste Reassessment musste vor " . abs($next_assessment) . " Tagen gemacht werden.";
								}
								//echo $text;
								}
								?>
								<table class="hi_icon_list" colspan="2">
									<tbody>
									<tr>
										<td colspan="2"><?php echo $text; ?></td>
									</tr>
									<tr>
										<td style="font-weight:bold;"><?php echo $this->translate('reassessment_summary'); ?>:</td>
										<td><?php echo  $system_icon_data[$k_sys_det]['patient_reassessments_summary'][$this->ipid] ;
											?></td>
									</tr>
									</tbody>

								</table>



			<?php elseif($k_sys_det == '37'):
				$assigned_users = $system_icon_data[$k_sys_det]['patient_assigned_users'][$this->ipid];
			?>
				<table class="assigned_users_list" colspan="2">
					<tbody>
						<tr>
							<th class="" valign="top"><?php echo $this->translate('title'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('lastname'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('firstname'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('phone'); ?></th>
						</tr>

			<?php foreach($assigned_users as $k_user => $users_data): ?>
						<tr>
							<td class="patcontactscol2" valign="top"><?php echo $users_data['user_title']; ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $users_data['last_name']; ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $users_data['first_name']; ?></td>
							<td class="patcontactscol2"><?php echo $users_data['phone']; ?></td>
						</tr>
			<?php endforeach; ?>
					</tbody>
				</table>

								
			<?php elseif($k_sys_det == '40'):
				$location_users = $system_icon_data[$k_sys_det]['patient_location_users'][$this->ipid];
			?>
				<table class="assigned_users_list" colspan="2">
					<tbody>
						<tr>
							<th class="" valign="top"><?php echo $this->translate('title'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('lastname'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('firstname'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('phone'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('mobile'); ?></th>
						</tr>

			<?php foreach($location_users as $k_user => $users_data): ?>
						<tr>
							<td class="patcontactscol2" valign="top"><?php echo $users_data['user_title']; ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $users_data['last_name']; ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $users_data['first_name']; ?></td>
							<td class="patcontactscol2"><?php echo $users_data['phone']; ?></td>
							<td class="patcontactscol2"><?php echo $users_data['mobile']; ?></td>
						</tr>
			<?php endforeach; ?>
					</tbody>
				</table>
								
								
			<?php elseif($k_sys_det == '41'):
				$allergies_data = $system_icon_data[$k_sys_det]['allergies_data'][$this->ipid];
			?>
				<table class="assigned_users_list" colspan="2">
					<tbody>
						<tr>
							<th valign="top" width="20%">Allergien / Kommentare:</th>
							<td valign="top" width="80%"><?php echo  html_entity_decode($allergies_data['allergies']); ?></td>
						</tr>
					</tbody>
				</table>
				
						<?php
		elseif($k_sys_det == '48'):  //Medication icon
			$medication_data = $system_icon_data[$k_sys_det]['medication_data'][$this->ipid];
		?>
				<table  class="diagno_icon_list"  border="1" width="100%">
				<tbody>
					<?php foreach($medication_data as $medication_type => $medication_details): ?>
							<tr>
								<td  colspan="2" class="colbold patcontactscol1 first_row"  valign="top"><?php echo $this->translate('medication_type_' . $medication_type); ?></td>
							</tr>
							<?php foreach($medication_details['medications'] as $k => $description): ?>
								<tr>
									<?php if(!empty($medication_details['indications'][$k])):?>
										<td width="80%" class="patcontactscol2" ><?php echo $description; ?></td>
										<td width="20%"  <?php if(!empty($medication_details['indications'][$k]['color']) ): ?> style="background: #<?php echo $medication_details['indications'][$k]['color']; ?>" <?php endif;?>><?php echo $medication_details['indications'][$k]['name']; ?></td>
									<?php else:?>
										<td   colspan="3"  class="patcontactscol2" width="100%" ><?php echo $description; ?></td>
									<?php endif;?>
								</tr>
							<?php endforeach; ?>
 
					<?php endforeach; ?>
					</tbody>
				</table>
				
				<?php elseif($k_sys_det == '51'):
				$todos = $system_icon_data[$k_sys_det]['todo_data'][$this->ipid];

			?>
				<table class="assigned_users_list" colspan="2">
					<tbody>
						<tr>
							<th class="" valign="top"><?php echo $this->translate('todos'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('assigneduser'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('assignedgroup'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('untildate'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('completeuser'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('completedate'); ?></th>
							<th class="" valign="top"><?php echo $this->translate('completecomment'); ?></th>
							<th></th>
						</tr>

			<?php foreach($todos as $k_todo => $todo_data): ?>
				<?php 
					//ISPC-2507
					$special_highlight="";
					if(strpos($todo_data['triggered_by'], 'pharma_patient_drugplan_request') !== false){
						$special_highlight="  special_highlight_todo";
					}
				?>
			
				<?php if($todo_data['iscompleted'] == 1) { ?>
						<tr class="tcomplete">
						<?php } else { ?>
						<tr class="tnotcomplete <?php echo $special_highlight; ?>">
						<?php }?>						
							<td class="patcontactscol2" valign="top"><?php echo $todo_data['todo']; ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $todo_data['user_name']; ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $todo_data['group_name']; ?></td>
							<td class="patcontactscol2" valign="top"><?php echo $todo_data['until_date']; ?></td>
							<td class="patcontactscol2" id="complete_user<?php echo $todo_data['row_id']; ?>" valign="top"><?php echo $todo_data['complete_user']; ?></td>
							<td class="patcontactscol2" id="complete_data<?php echo $todo_data['row_id']; ?>" valign="top"><?php echo $todo_data['complete_date']; ?></td>
							<td class="patcontactscol2" id="complete_comment<?php echo $todo_data['row_id']; ?>" valign="top"><?php echo $todo_data['complete_comment']; ?></td>
				<?php //if($todo_data['iscompleted'] != 1 && $todo_data['hasrighttocomplete'] == 1) 
						if($todo_data['iscompleted'] != 1 && strpos($todo_data['triggered_by'], 'medacknowledge') === false) {?>	
							<td class="patcontactscol2" valign="top">
							<input type="checkbox" name="select_done" value="1" class="done_event" data-todo_nr="<?php echo  $todo_data['row_id']; ?>" id="done_event_<?php echo $todo_data['row_id']; ?>" rel="<?php echo $todo_data['row_id']; ?>" />
							<input type="hidden" name="todoids" value="<?php echo implode(',',$todo_data['ids']); ?>" id="todoids_<?php echo   $todo_data['row_id'];?>" />
							<input type="hidden" name="completecomment_<?php echo $todo_data['row_id']; ?>" id="completecomment_<?php echo $todo_data['row_id']; ?>" value="" />	
							</td>
				<?php } else { ?>
					<td class="patcontactscol2" valign="top"></td>
				<?php }?>			
						</tr>
			<?php endforeach; ?>
					</tbody>
				</table>
				
				<?php
		elseif($k_sys_det == '49'):  //Vital signs icon
		?>
			<div class="weight_block" id="weight_chart_block">
		
			</div>
		<?php
		elseif($k_sys_det == '50' && count($system_icon_data[$k_sys_det]['tourplan_settings'][$this->ipid] >0)):  //TourplanSettings icon
		?>
		
					<table class="PatientDetail_datatable table_thead_bold" style="margin:0;">
						<thead>
							<tr>
								<th width="300px"><?php echo $this->translate('users')?></th>
								<th><?php echo $this->translate('Monday')?></th>
								<th><?php echo $this->translate('Tuesday')?></th>
								<th><?php echo $this->translate('Wednesday')?></th>
								<th><?php echo $this->translate('Thursday')?></th>
								<th><?php echo $this->translate('Friday')?></th>
								<th><?php echo $this->translate('Saturday')?></th>
								<th><?php echo $this->translate('Sunday')?></th>
							</tr>
						</thead>								
						<tbody>
		<?php

			foreach( $system_icon_data[$k_sys_det]['tourplan_settings'][$this->ipid] as $id => $types ) :
				foreach ($types as $type => $days) :
					if (empty($system_icon_data[$k_sys_det]['tourplan_settings_users'][$type][$id])) continue;
		?>		
							<tr>
								<td>
									<b <?php if(isset($types['is_disabled']) && $types['is_disabled']==1 ) echo "class='deleted_visit'";?>><?php echo $system_icon_data[$k_sys_det]['tourplan_settings_users'][$type][$id];  ?></b>
									<?php if(isset($types['is_disabled']) && $types['is_disabled']==1 ) : ?>
										<br><?php echo $this->translate("user_cantvisit_or_inactive_label");?>
									<?php endif; ?>
								</td>
		<?php
					for($day_cnt = 1; $day_cnt<=7; $day_cnt++) : 
		?>
								<td <?php if(isset($types['is_disabled']) && $types['is_disabled']==1 ) echo "class='deleted_visit'";?>> <?php if ($days[$day_cnt] >0 ) echo $days[$day_cnt]; ?></td>
		<?php
					endfor; 
		?>
							</tr>
		<?php
				endforeach; 
			endforeach; 
		?>	
						</tbody>
								
						</table>
						
						
		<?php
		elseif($k_sys_det == '52' && count($system_icon_data[$k_sys_det]['scheduled_medication_data'][$this->ipid] >0)):
		?>						
		<table class="datatable">
			<tr>
				<th><?php echo $this->translate('medication_name');?></th>
				<th><?php echo $this->translate('medication_dosage');?></th>
				<th><?php echo $this->translate('medication_indication');?></th>
				<th><?php echo $this->translate('medication_comments');?></th>
				<th><?php echo $this->translate('medication_days_interval');?></th>
				<th><?php echo $this->translate('action');?></th>
			</tr>
		<?php foreach($system_icon_data[$k_sys_det]['scheduled_medication_data'][$this->ipid] as $mid=>$medication_details ):?>
			<tr id="sch_<?php echo $mid;?>">
				<td><?php echo $medication_details['medication_name'];?></td>
				<td><?php echo $medication_details['dosage'];?></td>
				<td width="20%"  <?php if(!empty($medication_details['indications']['color']) ): ?> style="background: #<?php echo $medication_details['indications']['color']; ?>" <?php endif;?>><?php echo $medication_details['indications']['name']; ?></td>
				<td><?php echo $medication_details['comments'];?></td>
				<td><?php echo $medication_details['days_interval'];?></td>
				<td>
					<span id="due_date_<?php echo $mid;?>">
					</span>
					<!-- 
					 <?php echo $medication_details['due_date'];?>
					-->
					<button class="give_scheduled_medication interval_settings" id="interval_set_button_<?php echo $mid;?>" data-drug_id="<?php echo $mid;?>"><?php echo $this->translate("GIVE");?></button>
				</td>
			</tr>
		<?php endforeach; ?>
		</table>
		
		<?php
		elseif($k_sys_det == '53'):
		?>		
		<table class="diagno_icon_list" border="1" width="100%">
			<tr>
				<td width="20%" class="colbold patcontactscol1 first_row"><?php echo $this->translate('germination');?></td>
				<td><?php echo($system_icon_data[$k_sys_det]['germination_status'][$this->ipid]['germination_text']);?></td>
			</tr>
		</table>
		

		<?php
		elseif($k_sys_det == '54' ):
		?>		
		<table class="diagno_icon_list" border="1" width="100%">
			<tr>
				<td class="colbold patcontactscol1 first_row"><strong><?php $nutritionformlist_lang = $this->translate('nutritionform'); echo $nutritionformlist_lang['freetext'];?></strong></td>
			</tr>
			<tr>
				<td><?php echo($system_icon_data[$k_sys_det]['nutrition_form'][$this->ipid]['freetext']);?></td>
			</tr>
		</table>
				
		
		<?php
		elseif($k_sys_det == '55' ):
		?>		
		<table class="diagno_icon_list" border="1" width="100%">
			<tr>
				<td class="colbold patcontactscol1 first_row" colspan="2"><strong><?php echo $this->translate('patient_form_block_ventilation');?></strong></td>
			</tr>
			
			<tr>
			<?php $lang_block_ventilation = $this->translate('lang_block_ventilation'); ?>
				<td width="15%"><?php echo $lang_block_ventilation['Modus'];?></td>
				<td><?php echo($system_icon_data[$k_sys_det]['form_block_ventilation'][$this->ipid]['modus']);?></td>
			</tr>
			<tr>
				<td width="15%"><?php echo $lang_block_ventilation['F_tot'];?></td>
				<td><?php echo($system_icon_data[$k_sys_det]['form_block_ventilation'][$this->ipid]['f_tot']);?></td>
			</tr>
			<tr>
				<td width="15%"><?php echo $lang_block_ventilation['Vt'];?></td>
				<td><?php echo($system_icon_data[$k_sys_det]['form_block_ventilation'][$this->ipid]['vt']);?></td>
			</tr>
			<tr>
				<td width="15%"><?php echo $lang_block_ventilation['MV'];?></td>
				<td><?php echo($system_icon_data[$k_sys_det]['form_block_ventilation'][$this->ipid]['mv']);?></td>
			</tr>
			<tr>
				<td width="15%"><?php echo $lang_block_ventilation['PEEP'];?></td>
				<td><?php echo($system_icon_data[$k_sys_det]['form_block_ventilation'][$this->ipid]['peep']);?></td>
			</tr>
			<tr>
				<td width="15%"><?php echo $lang_block_ventilation['PIP'];?></td>
				<td><?php echo($system_icon_data[$k_sys_det]['form_block_ventilation'][$this->ipid]['pip']);?></td>
			</tr>
			<tr>
				<td width="15%"><?php echo $lang_block_ventilation['O2_l_min'];?></td>
				<td><?php echo($system_icon_data[$k_sys_det]['form_block_ventilation'][$this->ipid]['o2_l_min']);?></td>
			</tr>			
			<tr>
				<td width="15%"><?php echo $lang_block_ventilation['I_E'];?></td>
				<td><?php echo($system_icon_data[$k_sys_det]['form_block_ventilation'][$this->ipid]['i_e']);?></td>
			</tr>
			<tr>
				<td width="15%"><?php echo $lang_block_ventilation['freetext'];?></td>
				<td><?php echo nl2br($system_icon_data[$k_sys_det]['form_block_ventilation'][$this->ipid]['freetext']);?></td>
			</tr>
			
			
		</table>
		
		<?php
		elseif($k_sys_det == '56' ):
		?>		
		<table class="diagno_icon_list" border="1" width="100%">
			<tr>
				<td width="20%" class="colbold patcontactscol1 first_row"><?php echo $this->translate('pflegegrade');?></td>
				<td><?php echo($system_icon_data[$k_sys_det]['details_current_maintenancestage'][$this->ipid]['stage']);?></td>
			</tr>
			<?php if($system_icon_data[$k_sys_det]['details_current_maintenancestage'][$this->ipid]['erstantrag'] == "1"):?>
				<tr>
					<td width="20%" class="colbold patcontactscol1 first_row"></td>
					<td>Erstantrag</td>
				</tr>
		<?php endif; ?>
			<?php if($system_icon_data[$k_sys_det]['details_current_maintenancestage'][$this->ipid]['horherstufung'] == "1"):?>
				<tr>
					<td width="20%" class="colbold patcontactscol1 first_row"></td>
					<td>H√∂herstufung beantragt</td>
				</tr>
		<?php endif; ?>
		</table>
		
        
        <?php  elseif($k_sys_det == '63' ):?>
          
            <?php foreach ($system_icon_data[$k_sys_det]['patient_contact_persons_custodians'][$this->ipid] as $row) :?>
        <table class="diagno_icon_list" border="1" width="100%">
            <thead>
                <td class="colbold patcontactscol1 first_row" valign="top" colspan=4>
                    <?= $row['cnt_custody_val'] == 1 ? $this->translate('custodians') : $this->translate('other persons'); ?>: 
                    <?= $row['nice_name']; ?>
                </td>
               
            </thead>
            <tbody>
                <tr class='yellow'>
                    <td class="colbold patcontactscol1" valign="top"><?= $this->translate('cnt_custody_val'); ?></td>
                    <td class="patcontactscol2" valign="top" colspan="3"><?=$row['cnt_custody_val'] == 1 ? $this->translate('yes_radio') : $this->translate('no_radio') ; ?>; <?=nl2br($this->escape($row['cnt_custody'])); ?></td>
                    <!-- 
                    <td class="colbold patcontactscol1" valign="top"><?= $this->translate('cnt_custody'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=nl2br($this->escape($row['cnt_custody'])); ?></td>
                     -->
                </tr>
                <tr>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('first_name'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['cnt_first_name']; ?></td>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('last_name'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['cnt_last_name']; ?></td>
                </tr>
                <tr>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('street'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['cnt_street1']; ?></td>
                    <td class="colbold patcontactscol1" valign="top"></td>
                    <td class="patcontactscol2" valign="top"></td>
                </tr>
                
                <tr>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('city'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['cnt_city']; ?></td>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('zip'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['cnt_zip']; ?></td>
                </tr>
                
                <tr>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('phone'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['cnt_phone']; ?></td>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('mobile'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['cnt_mobile']; ?></td>
                </tr>
                
                <tr>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('email'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['cnt_email']; ?></td>
                    <td class="colbold patcontactscol1" valign="top"></td>
                    <td class="patcontactscol2" valign="top"></td>
                </tr>
                
                <tr>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('hatversorgungsvollmacht'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['cnt_hatversorgungsvollmacht'] == 1 ? $this->translate('yes_radio') : $this->translate('no_radio') ; ?></td>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('Legal guardian'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['cnt_legalguardian'] == 1 ? $this->translate('yes_radio') : $this->translate('no_radio') ; ?></td>
                </tr>
                
                
                <tr>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('notify_funeral'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['notify_funeral'] == '1' ? $this->translate('yes_radio') : ($row['notify_funeral'] == '0' ? $this->translate('no_radio') : '‚Äì'); ?></td>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('quality_control'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['quality_control'] == 1 ? $this->translate('yes_radio') : $this->translate('no_radio') ; ?></td>
                </tr>
                
                
                <tr>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('patientrelationship'); ?></td>
                    <td class="patcontactscol2" valign="top"><?=$row['cnt_familydegree_id'] > 0 ? $this->protected_patientMasterData['FamilyDegree'][$row['cnt_familydegree_id']] : "" ?></td>
                    <td class="colbold patcontactscol1" valign="top"></td>
                    <td class="patcontactscol2" valign="top"></td>
                </tr>
                
                
                <tr>
                    <td class="colbold patcontactscol1" valign="top"><?=$this->translate('comment'); ?></td>
                    <td class="patcontactscol2" valign="top" colspan=3><?=nl2br($this->escape($row['cnt_comment'])); ?></td>
                </tr>
            </tbody>
                        
        </table>
        <?php endforeach; ?>
        
        <?php  elseif($k_sys_det == '69' ):?>
        
          <?php if(!empty($system_icon_data[$k_sys_det]['patient_ipos_results'][$this->ipid])) : ?>
           <div class="ipos-outer-container">
			 <div class="ipos_fixed">
           		<ul class="ipos_labels">
					<?php
						$nr=  1;
						foreach($system_icon_data[$k_sys_det]['patient_ipos_results']['labels'] as $symptom_ident=>$symptom_name):
							    $li_class="";  
								if($nr % 2 == 0){ 
    	     						$li_class="even";  
    							} 
    							else
								{ 
	         						$li_class="odd";  
    							} 

						?>
					<li class="<?php echo $li_class; ?>"   <?php if($symptom_ident == 'f1' || $symptom_ident == 'additional_sym'  ):?>  style="height: 100px!important; overflow:hidden"  <?php endif;?>> <?php echo $symptom_name ?> </li>
					<?php $nr++; endforeach;?>
				
				</ul>
            </div>
            <div class="ipos-container">
				<div class="ipos_scroll">
				<?php foreach($system_icon_data[$k_sys_det]['patient_ipos_results'][$this->ipid] as $survey_id => $survey_data):?>
					<ul class="ipos">
						<?php
							$number=  1;
							foreach($system_icon_data[$k_sys_det]['patient_ipos_results']['labels'] as $symptom_ident=>$symptom_name):
										 
							    $li_class="";  
								if($number % 2 == 0){ 
    	     						$li_class="even";  
    							} 
    							else
								{ 
	         						$li_class="odd";  
    							} 
			
								$symptom_value= "X";	
								//$symptom_value = strlen($system_icon_data[$k_sys_det]['patient_ipos_results'][$this->ipid][$survey_id][$symptom_ident]) > 0 ? $system_icon_data[$k_sys_det]['patient_ipos_results'][$this->ipid][$survey_id][$symptom_ident]: "X";
								if($symptom_ident== 'additional_sym'){
									$symptom_value = !empty($system_icon_data[$k_sys_det]['patient_ipos_results'][$this->ipid][$survey_id][$symptom_ident])  ? $system_icon_data[$k_sys_det]['patient_ipos_results'][$this->ipid][$survey_id][$symptom_ident]: array(); 
								} else{
									$symptom_value = strlen($system_icon_data[$k_sys_det]['patient_ipos_results'][$this->ipid][$survey_id][$symptom_ident]) > 0 ? $system_icon_data[$k_sys_det]['patient_ipos_results'][$this->ipid][$survey_id][$symptom_ident]: ""; 
								} 
								 
			
								$bg_color_class = "";
								$bg_color_class = "score_color_".$symptom_value;

								$additional_sym_colors = array('2'=>'0','3'=>'1','4'=>'2','5'=>'3','6'=>'4')
			 
						?>
						<?php if($symptom_ident== 'date'):?>
							<li class="<?php echo $li_class; ?>" data-label="<?php echo $symptom_name ?>">  <?php echo $symptom_value;?> </li>
						<?php elseif( $symptom_ident== 'status' ):?>
							<li class="<?php echo $li_class; ?>" data-label="<?php echo $symptom_name ?>"> <span class="ipos_status status_<?php echo $symptom_value;?>"> </span></li>
						<?php elseif( $symptom_ident== 'f1' ):?>
							<li class="<?php echo $li_class; ?>" data-label="<?php echo $symptom_name ?>" style="height: 100px!important;overflow-y: scroll;overflow-x: hidden">  <?php echo $symptom_value;?> </li>
						<?php elseif( $symptom_ident== 'additional_sym' && is_array($symptom_value)):?>
							<li class="<?php echo $li_class; ?>" data-label="<?php echo $symptom_name ?>" style="height: 100px!important;overflow-y: scroll;overflow-x: hidden;text-align: left"> 
							 <?php foreach($symptom_value as $s_row=>$add_symps):?>
							 <? if($add_symps['name']) :?>
							 <? $scolor= 'score_color_'.$additional_sym_colors[$add_symps['value']]; ?>
							 	<div class="<? echo $scolor;?>" style="line-height: 16px; width: auto!important;  text-align: left; font-weight:normal;margin:0px; padding:0px; display: block; float: left; "><?php echo $add_symps['name'].';'; ?></div>
							 <?php endif;?>
							 <?php endforeach;?>
							  </li>
						<?php else:?>
							<li class="<?php echo $li_class; ?>" data-label="<?php echo $symptom_name ?>"><span class="<?php echo $bg_color_class; ?>" > <?php echo $symptom_value;?> </span></li>
						<?php endif;?>
						<?php $number++; endforeach;?>
					
					</ul>
					<?php endforeach; ?>
				</div>
			</div>	
		</div>
 
        <?php endif; ?>
        
        
        
        
         <?php  elseif($k_sys_det == '78' ):?>
         <?php /* ISPC-2695 */ ?>
          <?php if(!empty($system_icon_data[$k_sys_det]['mePatient_faces_results'][$this->ipid])) : ?>
           <div class="ipos-outer-container MepatientFaces">
			 <div class="ipos_fixed">
           		<ul class="ipos_labels">
					<?php
						$nr=  1;
						foreach($system_icon_data[$k_sys_det]['mePatient_faces_results']['labels'] as $symptom_ident=>$symptom_name):
							    $li_class="";  
								if($nr % 2 == 0){ 
    	     						$li_class="even";  
    							} 
    							else
								{ 
	         						$li_class="odd";  
    							} 

						?>
					<li class="<?php echo $li_class; ?>"   <?php if($symptom_ident == 'f1' || $symptom_ident == 'additional_sym'  ):?>  style="height: 100px!important; overflow:hidden"  <?php endif;?>> <?php echo $symptom_name ?> </li>
					<?php $nr++; endforeach;?>
				
				</ul>
            </div>
            <div class="ipos-container">
				<div class="ipos_scroll">
				<?php foreach($system_icon_data[$k_sys_det]['mePatient_faces_results'][$this->ipid] as $survey_id => $survey_data):?>
					<?php foreach($survey_data as $took_id=>$values) : ?>
						<ul class="ipos">
							<?php
								$number=  1;
							foreach($system_icon_data[$k_sys_det]['mePatient_faces_results']['labels'] as $symptom_ident=>$symptom_name):
										 
							    $li_class="";  
								if($number % 2 == 0){ 
    	     						$li_class="even";  
    							} 
    							else
								{ 
	         						$li_class="odd";  
    							} 
			
								$symptom_date = $system_icon_data[$k_sys_det]['mePatient_faces_results'][$this->ipid][$survey_id][$took_id][$symptom_ident]; 
								$symptom_value = $system_icon_data[$k_sys_det]['mePatient_faces_results'][$this->ipid][$survey_id][$took_id][$symptom_name]; 
								 
			
			 
						?>
							<?php if($symptom_ident== 'date'):?>
								<li class="<?php echo $li_class; ?>" data-label="<?php echo $symptom_name ?>">  <?php echo $symptom_date;?> </li>
							<?php else:?>
								<li class="<?php echo $li_class; ?>" data-label="<?php echo $symptom_name ?>"><span class="<?php echo $bg_color_class; ?>" >
									<? if($symptom_value):?>	 
									<img src="<?php echo APP_BASE . 'images/mepatient/' . $symptom_value.'.svg'; ?>"   />
									<? endif;?>
							
								 </span></li>
							<?php endif;?>
							<?php $number++; endforeach;?>
						
						</ul>
						<?php endforeach; ?>
					<?php endforeach; ?>
				</div>
			</div>	
		</div>
 
        <?php endif; ?>
        
         <?php  elseif($k_sys_det == '64' ):?>
         		
		<table class="diagno_icon_list" border="1" width="100%">
			<tr>
				<td class="colbold patcontactscol1 first_row"><strong><?php echo $this->translate('measure');?></strong></td>
			</tr>
			<tr>
				<td><span class="current_problem" style="cursor: pointer;" title="Klicken Sie zum Bearbeiten!" data-icon="measure"> <?php if(strlen(trim(strip_tags($system_icon_data[$k_sys_det]['measure'][$this->ipid]['problem'])))>0) { echo $system_icon_data[$k_sys_det]['measure'][$this->ipid]['problem']; } else { echo $this->translate('No data, click to add'); }?></span></td>
			</tr>
		</table>
		
		 <?php  elseif($k_sys_det == '65' ):?>
         		
		<table class="diagno_icon_list" border="1" width="100%">
			<tr>
				<td class="colbold patcontactscol1 first_row"><strong><?php echo $this->translate('current_situation');?></strong></td>
			</tr>
			<tr>
				<td><span class="current_problem" style="cursor: pointer;" title="Klicken Sie zum Bearbeiten!" data-icon="current_situation"> <?php if(strlen(trim(strip_tags($system_icon_data[$k_sys_det]['current_situation'][$this->ipid]['problem'])))>0) { echo $system_icon_data[$k_sys_det]['current_situation'][$this->ipid]['problem']; } else { echo $this->translate('No data, click to add'); };?></span></td>
			</tr>
		</table>
        
         <?php  elseif($k_sys_det == '66' ):?>
         		
		<table class="diagno_icon_list" border="1" width="100%">
			<tr>
				<td class="colbold patcontactscol1 first_row"><strong><?php echo $this->translate('sapv_appl');?></strong></td>
			</tr>
			<tr>
				<td><span class="current_problem" style="cursor: pointer;" title="Klicken Sie zum Bearbeiten!" data-icon="sapv_appl"><?php if(strlen(trim(strip_tags($system_icon_data[$k_sys_det]['sapv_appl'][$this->ipid]['problem'])))>0) { echo $system_icon_data[$k_sys_det]['sapv_appl'][$this->ipid]['problem']; } else { echo $this->translate('No data, click to add'); };?></span></td>
			</tr>
		</table>
		
		<!-- TODO-3707 Lore 06.01.2021 -->
		<?php  elseif($k_sys_det == '79' ):?>
		
		<table class="diagno_icon_list" border="1" width="100%">
			<tr>
				<td class="colbold patcontactscol1 first_row"><strong><?php echo $this->translate('ventilation');?></strong></td>
			</tr>
			<tr>
				<td><span class="current_problem" style="cursor: pointer;" title="Klicken Sie zum Bearbeiten!" data-icon="ventilation"><?php if(strlen(trim(strip_tags($system_icon_data[$k_sys_det]['ventilation'][$this->ipid]['problem'])))>0) { echo $system_icon_data[$k_sys_det]['ventilation'][$this->ipid]['problem']; } else { echo $this->translate('No data, click to add'); };?></span></td>
			</tr>
		</table>
        
        
        <?php  elseif ($k_sys_det == '3'): //ISPC - 1148 - not used yet?>


													<table class="verordnung_icon_list" width="100%" style="border: 1px solid #c0c0c0;">
														<tr>
															<td colspan="3" style="background-color: #ccc;"><strong><?php echo $this->translate('sapv_verordnung');?></strong></td>
														</tr>
														<?php $row = $this->system_icon_details[$k_sys_det]; //foreach ($system_icon_data['14']['patient_verordnungs'][$this->ipid] as $row) :?>
														
														<tr>
															<!-- <td style="border: 1px solid #c0c0c0;"><?php echo $row['sapv_order_name'] . ' ' . $row['dotsLegend'];?></td> -->
															<td style="border: width: 40%; vertical-align: middle;"><?php echo $row['sapv_order_name']; ?></td>
															<td style="border: width: 8%;"><?php echo $row['dotsLegend']; ?></td>
															<td style="color: <?php echo $row['status_color']; ?>; vertical-align: middle;"><?php echo $row['verordnet_longtext'];?></td>
														</tr>
														<tr>
														<?php if($row['bra_options_formated'] != "") { ?>
															<td colspan="2"><?php echo $row['verordnet_von_nice_name'];?></td>
															<td><?php echo date('d.m.Y', strtotime($row['verordnungam'])) . '-' . date('d.m.Y', strtotime($row['verordnungbis']));?></td>
														<?php } else { ?>
															<td colspan="2" style="border-bottom: 1px solid #c0c0c0;"><?php echo $row['verordnet_von_nice_name'];?></td>
															<td style="border-bottom: 1px solid #c0c0c0;"><?php echo date('d.m.Y', strtotime($row['verordnungam'])) . '-' . date('d.m.Y', strtotime($row['verordnungbis']));?></td>
														<?php } ?>
														</tr>
														<?php if($row['bra_options_formated'] != "") { ?>
														<tr>
															<td colspan="3" style="border-bottom: 1px solid #c0c0c0; padding-left: 0px;"><?php echo 'SAPV Brandenburg:' .' ' . $row['bra_options_formated'];?></td>
														</tr>
														<?php }
														//endforeach; ?>
													</table>
		<?php
		// ISPC-2508 Carmen 30.01.2020
	    // Ancuta added to Clinic ISPC (CISPC)  on 18.03.2020
		elseif($k_sys_det == '72' && count($system_icon_data[$k_sys_det]['patient_artificial_entries_exits_expired'][$this->ipid]) >0):
		?>						
		<table class="datatable">
			<tr>
				<th><?php echo $this->translate('artificial_option_name');?></th>
				<th><?php echo $this->translate('artificial_option_date');?></th>
				<th><?php echo $this->translate('artificial_option_localization');?></th>
				<th><?php echo $this->translate('artificial_option_age');?></th>
				<th><?php echo $this->translate('actions');?></th>
			</tr>
		<?php foreach($system_icon_data[$k_sys_det]['patient_artificial_entries_exits_expired'][$this->ipid] as $partid=>$part_details ):?>
			<tr id="part_<?php echo $partid;?>">
				<td><?php echo $part_details['option_name'];?></td>
				<td><?php echo $part_details['option_date'];?></td>
				<td><?php echo $part_details['option_localization'];?></td>
				<td><?php echo $part_details['option_age'];?></td>
				<td><?php echo $part_details['actions'];?></td>
			</tr>
		<?php endforeach; ?>
		</table>
												
		<?php
		//ISPC-2507 Ancuta 10.02.2020
		elseif(1==2 && $k_sys_det == '73' && count($system_icon_data[$k_sys_det]['pharma_drugplan_request'][$this->ipid]) >0):
		?>						
		<table class="datatable">
			<tr>
				<th><?php echo $this->translate('pharma_req_user');?></th>
				<th><?php echo $this->translate('pharma_req_date');?></th>
				<th><?php echo $this->translate('pharma_req_sent_to');?></th>
				<th><?php echo $this->translate('pharma_req_stauts');?></th>
				<th><?php echo $this->translate('actions');?></th>
			</tr>
		<?php foreach($system_icon_data[$k_sys_det]['pharma_drugplan_request'][$this->ipid] as $req_id=>$rec_details ):?>
		<?php
		$request_status_bg = "";
		 if($rec_details['status'] == 'yes'){
			$request_status_bg = " pharma_request_processed";
		 } else{
			$request_status_bg = " pharma_requestNot_processed";
		}
		 
		 ?>
			<tr class="<?php echo $request_status_bg;?>">
				<td><?php echo $rec_details['user'];?></td>
				<td><?php echo $rec_details['request_date'];?></td>
				<td><?php echo $rec_details['sent_to'];?></td>
				<td><?php echo $rec_details['processed'];?></td>
				<td><?php echo $rec_details['link'];?></td>
			</tr>
		<?php endforeach; ?>
		</table>
		<?php
		//ISPC-2564 Carmen 25.06.2020
		elseif($k_sys_det == '75'):  //Vital signs icon
		?>
			<div class="rass_block" id="rass_chart_block">
		
			</div>
								<!-- ISPC-2912,Elena,25.05.2021 -->
								<?php elseif($k_sys_det == '10010' &&  count($system_icon_data[$k_sys_det]['btm_medication_data'][$this->ipid] >0))		: ?>
								<div class="btm_medis_block">
									<table class="datatable">
										<thead>
										<td class="colbold patcontactscol1 first_row" valign="top" >
											BTM-Medikamente
										</td>

										</thead>
										<!--<tr>
                                            <th><?php echo $this->translate('medication_name');?></th>
                                            <!--<th><?php echo $this->translate('medication_dosage');?></th>
                                            <th><?php echo $this->translate('medication_indication');?></th>
                                            <th><?php echo $this->translate('medication_comments');?></th>
                                            <th><?php echo $this->translate('medication_days_interval');?></th>
                                            <th><?php echo $this->translate('action');?></th>-=->
                                        </tr>-->
										<?php foreach($system_icon_data[$k_sys_det]['btm_medication_data'][$this->ipid] as $mid=>$medication_details ):?>
										<tr id="btm_<?php echo $mid;?>">
											<td><?php echo $medication_details['medication_name'];?></td>
											<!--<td><?php echo $medication_details['dosage'];?></td>
                                            <td width="20%"  <?php if(!empty($medication_details['indications']['color']) ): ?> style="background: #<?php echo $medication_details['indications']['color']; ?>" <?php endif;?>><?php echo $medication_details['indications']['name']; ?></td>
                                            <td><?php echo $medication_details['comments'];?></td>
                                            <td><?php echo $medication_details['days_interval'];?></td>
                                            <td>
                                            <span id="due_date_<?php echo $mid;?>">
                                            </span>

                                                <button class="give_scheduled_medication interval_settings" id="interval_set_button_<?php echo $mid;?>" data-drug_id="<?php echo $mid;?>"><?php echo $this->translate("GIVE");?></button>
                                            </td>-->
										</tr>
										<?php endforeach; ?>
									</table>
								</div>

        <?php
        // INFO-1554 Nico 27.07.2020
        // this is a generic html-popup, define displayed html in iconsPatient
        elseif(isset($system_icon_data[$k_sys_det]['popup_html'][$this->ipid])):?>
            <?php echo $system_icon_data[$k_sys_det]['popup_html'][$this->ipid];?>


        <?php endif; ?>

				


							</div>
	<?php endforeach; ?>
				</div>
			</td>
		</tr>
	</table>
</div>


<!-- ISPC-2692 Lore 03.11.2020 -->
<?php if($this->today_is_patient_birthday == '1'): ?>
	<div id="today_is_patient_birthday">
		<p style="background-color: #defae7; font-size: 14px; text-align: center;"><img  src="<?php echo RES_FILE_PATH; ?>/images/birthday_today.png"  /> <strong style="margin: 5px;"> <?php echo $this->translate('today_is_patient_birthday'); ?></strong></p>
	</div>
    <br style="clear:both;"/>
<?php endif; ?>


<?php if($this->permission_level != '0'): ?>
			<div id="memo_container" x-ms-format-detection="none">
				<span <?php if($this->permission_level == '1'): ?>id="patient_memo"<?php endif; ?> class="editText" ><?php if($memo_patient): ?><?php echo $this->memo; ?><?php else: ?><?php echo $this->translate('empty_memo'); ?><?php endif; ?></span>
			</div>
	<?php endif; ?>
	<br  style="clear:both;"/>
<?php if( $use_whitebox): ?><!-- IM-5, elena, 09.12.2020 --><!--// ISPC-2800, elena, 10.12.2020-->
<div id="whitebox_container" x-ms-format-detection="none">
	<span <?php if($this->permission_level == '1'): ?>id="patient_whitebox"<?php endif; ?> class="editText" data-emptytext="<?php echo $this->translate('empty_whitebox'); ?>"><?php if($whitebox_patient): ?><?php echo nl2br($this->whitebox); ?><?php else: ?><?php echo $this->translate('empty_whitebox'); ?><?php endif; ?></span><!--ISPC-2800,elena,14.01.2021,fix-->
	<div id="wb_history_block"><img id="wb_history" src="<?php echo RES_FILE_PATH; ?>/images/history-clock-button.png" width="12"></div><!-- IM-5, elena, 09.12.2020 --><!--// ISPC-2800, elena, 10.12.2020-->
</div>

<br  style="clear:both;"/>
<?php endif; ?>
<div id="confirm_unassign">
	<p><?php echo $this->translate('confirm_unassign_icon_text'); ?></p>
</div>


<div id="vital_signs_modal" class="modal_events_dialog">
	<div class="modal_loading_div"></div>
	<!-- load form -->
</div>

<div id="documentedconfirm"></div>


<!-- ISPC-2517 Ancuta 15.04.2020 -->
<?php if($this->has_events_add_button == '1'): ?>

	<div class="expandingbuttons">
		<?php 
			echo $this->formButton('patient-main-add-btn', '+', array("type"=>"button" ,"class"=>"btn-primary patient-main-add-btn", "onclick"=>"$.fn.modalevents()"));
		?>
		<div class="extrabuttons">
			<button name="prev" title="1 Tag zur√ºck" id="prev" type="button" value="" class="btnPrev"></button>		<!-- ISPC-2637 Lore 22.07.2020 -->
			<button name="top"  title="zum Seitenanfang" id="top" type="button" value="" class="btnTop"></button>	<!-- ISPC-2637 Lore 22.07.2020 -->
			<button name="next" title="1 Tag vor" id="next" type="button" value="" class="btnNext"></button>		<!-- ISPC-2637 Lore 22.07.2020 -->
		</div>
	</div>	
	<div id="patient-main-add-modal">
	<div class="modal_loading_div"></div>
	</div>
<?php endif; ?>	
	
	<!-- ISPC-2516 Carmen 09.04.2020 -->
	<div id="awake_sleeping_modal" class="modal_events_dialog">
		<div class="modal_loading_div"></div>
		<!-- load form -->
	</div>
	<!-- end  ISPC-2516 Carmen 09.04.2020 -->
	
	<!-- ISPC-2522 Carmen 10.04.2020 -->
	<div id="positioning_modal" class="modal_events_dialog">
		<div class="modal_loading_div"></div>
		<!-- load form -->
	</div>
	<!-- ISPC-2522 Carmen 10.04.2020 -->
	
	<!-- ISPC-2523 Carmen 13.04.2020 -->
	<div id="suckoff_modal" class="modal_events_dialog">
		<div class="modal_loading_div"></div>
		<!-- load form -->
	</div>
	<!-- ISPC-2523 Carmen 13.04.2020 -->
	
	<!-- ISPC-2518+ISPC-2520 Carmen 14.04.2020 -->
	<div id="organicentriesexits_modal" class="modal_events_dialog">
		<div class="modal_loading_div"></div>
		<!-- load form -->
	</div>
	<!-- ISPC-2518+ISPC-2520 Carmen 14.04.2020 -->
	
	<!-- ISPC-2519 Carmen 15.04.2020 -->
	<div id="custom_event_modal" class="modal_events_dialog">
		<div class="modal_loading_div"></div>
		<!-- load form -->
	</div>
	<!-- ISPC-2519 Carmen 15.04.2020 -->
	
	<!-- ISPC-2508 Carmen 21.04.2020 -->
	<div id="artificial_entries_exits_modal" class="modal_events_dialog">
		<div class="modal_loading_div"></div>
		<!-- load form -->
	</div>
	<!-- ISPC-2508 Carmen 21.04.2020 -->
	
	<!-- ISPC-2583 Carmen 28.04.2020 -->
	<div id="medication_dosage_interaction_modal" class="modal_events_dialog">
		<div class="modal_loading_div"></div>
		<!-- load form -->
	</div>
	<!-- ISPC-2583 Carmen 28.04.2020 -->
	<div id="symptomatology_modal" class="modal_events_dialog">
		<div class="modal_loading_div"></div>
		<!-- load form -->
	</div>
	
	<!-- ISPC-2516 Carmen 15.07.2020 -->
	<div id="symptomatologyII_modal" class="modal_events_dialog">
		<div class="modal_loading_div"></div>
		<!-- load form -->
	</div>
	
	<!-- ISPC-2583 Ancuta -->
	<div id="medication_dosage_view_modal" class="modal_events_dialog">
		<div class="modal_loading_div"></div>
		<!-- load medication icon   -->
	
	</div>
	<div id="medication_dosage_interaction_bulk_modal" class="modal_events_dialog">
		<div class="modal_loading_div"></div>
		<!-- load medication icon   -->
	
	</div>
<!-- ISPC-2697, elena, 11.10.2020 -->
<div id="patient_beatmung_modal" class="modal_events_dialog">
	<div class="modal_loading_div"></div>
	<!-- load beatmung form   -->

</div>
<!-- //-- -->
<div id='patient_charts_actions_modal'></div> <!-- //ISPC-2508 Carmen 20.05.2020 new design -->
<div id='artificial_entries_exits_main_modal'></div> <!-- //ISPC-2508 Carmen 27.05.2020 new design -->
<div id="whitebox_history_modal"><div id="whitebox_history_modal_content"></div></div><!-- IM-5, elena, 09.12.2020 --><!--// ISPC-2800, elena, 10.12.2020 -->

<!-- ISPC-2683 Carmen 15.10.2020 -->
<div id="vigilance_awareness_modal" class="modal_events_dialog">
	<div class="modal_loading_div"></div>
	<!-- load form -->
</div>
<div id="patient_data_changed_modal" class="modal_events_dialog"><!--//ISPC-2904,Elena,30.04.2021-->
	<span style="color:green;">Daten erfolgreich verabeitet.</span>
</div>



<!-- ISPC-2864 Ancuta 14.04.2021-->
    <div id="patient_problems_modal" class="modal_events_dialog">
    	<div class="modal_loading_div"></div>
    	<!-- load form -->
    </div>