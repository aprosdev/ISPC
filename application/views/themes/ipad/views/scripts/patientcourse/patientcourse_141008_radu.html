<?php
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/livesearch/patientcourse.js?'.date('Ymd'));
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/autogrow/jquery.elastic.source_new.js?'.date('Ymd'));
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/jquery.blockUI.js?'.date('Ymd'));
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/ias/jquery.ias.js?'.date('Ymd'));

?>
<style type="text/css">
	.ui-datepicker-trigger {
		padding-left: 2px;
		padding-top: 8px;
		margin-bottom: -4px;
		float: left;
	}	
</style>
<script type="text/javascript">
	var jscount = "1";
	var jcount = "1";
	var ltrjs = <?php echo $this->ltrjs ?>;
	var hotkeysjs = <?php echo $this->hotkeysjs ?>;
	var isdischarged = "<?php echo $this->isdischarged ?>";
	var jarr = <?php echo $this->jdarr ?>;
	var jsdiagnosismeta = <?php echo $this->jsdiagnosismeta?>;
	var jcount = jscount+1;
	var dcntr = jscount;
	var diagnosisblur = Array();
	var icddiagnosisblur = Array();
	var diagnosisblur_ed = Array();
	var $disable_hs_insert = '<?php echo $this->disable_hs_insert; ?>';
	 
	$('.anlage').each(function() {
		$(this).parent().parent().parent().parent().prev().remove(); //remove all anlage checkboxes
		$(this).remove(); // remove the curent selector to avoid conflicts
	});

	function isInteger(k, edit)
	{
	    var box = '';
	    if(edit == 1) {
		box = 'edit_value';
	    } else {
		box = 'sym_value';
	    }
		
	    var s = document.getElementById(box+k).value;
	    var chars = "0123456789";

	    if(s>10) {
		document.getElementById(box+k).value = "";
		return false;
	    }

	    var i;
	    s = s.toString();
	    for (i = 0; i < s.length; i++) {
		var c = s.charAt(i);
			if (chars.indexOf(c)==-1) {
		    document.getElementById(box+k).value = "";
		    return false;
		}
	    }
	    return true;
	}


	function chkmask(ltr,cnt)
	{
		var cnts = 0;
		for(i=0; i<ltrjs.length;i++) {
			if(ltrjs[i] == ltr) {
				cnts++;
			}
		}

		if(cnts<1){
			document.getElementById('course_type'+cnt).value="";
		} else {
			$('#course_title'+cnt).focus();
		}
	}


	$(function() {
		$('textarea').elastic();

		$('.divcheckbox').click(function(){
			var id = $(this).attr('id');

			if(this.checked==true) {
				$('.block_'+id).attr('checked', true);
			} else {
				$('.block_'+id).attr('checked', false);
			}
		})
	});


	function checkboxurl(chkbx,isfilter)
	{
		if(!chkbx.checked) {
			var ltrs = document.getElementsByName(chkbx.name);

			for(var j=0;j<ltrs.length;j++) {
				ltrs[j].checked = false;
			}
		} else {
			var ltrs = document.getElementsByName(chkbx.name);

			for(var j=0;j<ltrs.length;j++) {
				ltrs[j].checked = true;
			}
		}
		
		if(isfilter==1) {
			check3(chkbx);
		} else {
			check2();
		}
	}

	function check2()
	{
		$(".parentdiv").hide();
		var cletters=[];
		var chkurl = "";
		var cnt = 0;
		var hide_all = 0;
		
		for (var i in ltrjs ) {
			if(ltrjs[i] != '_owned'){
				$("."+ltrjs[i]).hide();
			}

			var ltrs = document.getElementsByName(ltrjs[i]);

			for(var j=0;j<(ltrs.length-1);j++) {
				if($('#wrong').is(':checked')){
					$('.wrongfilter:not(.source_entry)').show();
					$('.wrongfilter *:not(.colleft2_inpwid):not(.source_entry)').each(function(){
						$(this).show();
						cnt++;
					});
				}

				if(ltrs[j].name == '_owned' && ltrs[j].checked==true) {
					hide_all = (hide_all+1);
				}

				if(ltrs[j].name == '_shared' && ltrs[j].checked==true) {
					hide_all = (hide_all+1);
				}

				if(ltrs[j].checked == true ) {
					$("."+ltrs[j].name).parent().parent().parent().show();
					$("."+ltrs[j].name).show();
					cnt++;
				} else if(ltrs[j].name != '_owned') {
					$("."+ltrs[j].name).hide();
				}
			}
		}

		if(cnt==0) {
			$(".parentdiv").show();
			for (var i in ltrjs ) {
				$("."+ltrjs[i]).show();
			}
		}

		if(hide_all>=2) {
			$(".parentdiv").hide();
		}
	}

	function check3(chks) {
		var sel_chks = 1;
		var cletters=[];
		var chkurl = "";
		var cnt = 0;

		for(var i in ltrjs) {
			var ltrs = document.getElementsByName(ltrjs[i]);

			for(var j=0;j<(ltrs.length-1);j++) {
				if(ltrs[j].checked==true) {
					sel_chks = (sel_chks+1);
				}
			}
		}
		
		if(sel_chks ==1){
			$(".parentdiv").hide();
		}
		
		if(chks.checked) {
			$(".wrongfilter:not(.source_entry)").show();
			if($('#wrong').is(':checked')){
				$('.wrongfilter:not(.source_entry)').show();
				$('.wrongfilter *:not(.colleft2_inpwid):not(source_entry)').each(function(){
					$(this).show();
				});
			}
		} else {
			check2();
		}
	}


<?php echo $this->callcourse; ?>

	var delaytrimer;

	function keyupdelay(obj, cntr) {
		clearTimeout(delaytrimer);
		delaytrimer = setTimeout(function applydelay(){
			upper(cntr);
			chkmask(obj.value, cntr);
			changeinput(obj.value, cntr);
			//ipad elastic annoying
			$('#komment'+cntr).elastic();
		},700);
	}

	function upper(v) {
		document.getElementById("course_type"+v).value = document.getElementById("course_type"+v).value.toUpperCase();
	}

	for(var k=0; k<hotkeysjs.length;k++) {
		var ads = k+1;
		shortcut.add('Ctrl+Alt+'+hotkeysjs[k],function(e) {
			if($('input[name='+String.fromCharCode(e.keyCode)+']').is(':checked')) {
				$('input[name='+String.fromCharCode(e.keyCode)+']').removeAttr('checked');
			} else {
				$('input[name='+String.fromCharCode(e.keyCode)+']').attr('checked','checked');
			}

			checkboxurl(document.getElementById($('input[name='+String.fromCharCode(e.keyCode)+']').attr('id')));
		});
	}

	function printaction() {
		document.frmcourse.action = "patientcourse/printcourse?id=<?echo $this->pid ?>";
		document.frmcourse.target = "_blank";
		document.frmcourse.submit();
	}

	function closepopup() {
		disablePopup();
	}

	function openPopup(chkbx,id, skip_modal) {
			var checkid = $(chkbx).attr('id');
			var ids = "";
			var quamma = "";

		for(i=0;i<$('.block_'+checkid).length;i++) {
				ids = ids + quamma + ($('.block_'+checkid)[i].id);
				quamma = ",";
			}

		if(chkbx.checked) {
				$("<input type='hidden' name='comments["+id+"]' id='comment_"+id+"' value='' />").appendTo("#frmcourse");

				$('#contactArea').html('<iframe id="add_family_doc" frameborder="0" src="" scrolling="no" style="margin:0 auto;"></iframe>');


				centerPopup({sr:'about:blank',ht:250,wt:450});

				$('#contactArea').html('<div><?php echo $this->translate('wrongcomment'); ?><div align="right"><a id="popupContactClose" style="cursor:pointer;" onclick="uncheckbox(\''+checkid+'\');closepopup()">x</a></div></div><div><textarea name="comment" id="comment"></textarea></div><div><button name="" onClick="saveComment(\''+id+'\',\''+ids+'\',\''+checkid+'\');"><?php echo $this->translate('submit');?></button></div>');

				loadPopup();
			} else {

				$("#comment_"+id).remove();

				ajaxCallserver({url:'patientcourse/savewrongcd?ids='+ids+'&val=0&blockcnt='+checkid});
			}
		}

	function saveComment(id,ids,blockid)
	 {
		var val = "";
		var modal_mode = '0';

		if($("#comment").val().length>0) {
		  val="<?php echo ("Dieser Eintrag wurde als gelöscht markiert. Begründung : ") ?>" + $("#comment").val();

			$("#comment_"+id).val(val);

			ajaxCallserver({url:'patientcourse/savewrongcd', method:'POST', data:{comment:val,val:1,ids:ids,blockcnt:blockid}});
			disablePopup();

			var arr_medis = ["M", "N", "I", "Q"];
			var arr_diag = ["D","H","HS"];

			$('.courses_types_'+blockid).each(function(){
				if(jQuery.inArray($(this).val(), arr_medis)>=0){

					if(modal_mode == '0'){
						if($(this).val() == 'Q' && $(this).attr('rel') != 0){
							modal_mode = '1';
					   } else if($(this).val() == 'Q' && $(this).attr('rel') == 0) {
						   modal_mode = '3';
						} else if($(this).val() != 'Q') {
							modal_mode = '1';
						}
					}
				}
				
				if(jQuery.inArray($(this).val(), arr_diag)>=0) {
					if(modal_mode == 0){
						modal_mode = '2';
					}
				}
			});

			switch (modal_mode) {
				case '1':
					//modal medis with ok
					$('#delete_medis').show();
					$('#modal_redir_type').val('M');

					$('#modal_delete').dialog('open');
					break;
				case '2':
					//modal diag with ok
					$('#delete_diag').show();
					$('#modal_redir_type').val('D');

					$('#modal_delete').dialog('open');
					break;

				   case '3':
					   //modal btm dialog deleting medi with ok	
						$('#btm_medi_revert').val(ids);
						$('#delete_btm_med').dialog('open');
						
					   break
				default:
			}
		}
		else
		{
			   jAlert('<?php echo $this->translate('entercomment') ?>');
		}
	   }

	function diag_button(){
		window.location = appbase+'patient/patdiagnoedit?id=<?php echo $_REQUEST['id']; ?>';
		$('#modal_delete').dialog('close');
	}

	function medi_button(){
		window.location = appbase+'patient/patientmedication?id=<?php echo $_REQUEST['id']; ?>';
		$('#modal_delete').dialog('close');
	}

	var callBackWrong = function(params){

		if(params.val==1)
		{
		    $("#wrongcomment_"+params.id).show();
			$("#wrongcomment_"+params.id).html(params.comment);
			$('#maindiv_'+params.id).addClass('wrongfilter');

			$('#maindiv_'+params.id).addClass('greyclass');
			$('.wrc_'+params.id).find('font').attr('color','#cccccc');
			$('.wrt_'+params.id).find('font').attr('color','#cccccc');
		}
		else
		{
		    $('#maindiv_'+params.id).removeClass('greyclass');
			$('#maindiv_'+params.id).removeClass('wrongfilter');

			$('#wrongcomment_'+params.id).hide();



			for(i=0;i<$('.wrc_'+params.id).length;i++)
			{
		       var crid = ($('.wrc_'+params.id)[i].id);
			       var crtid = ($('.wrt_'+params.id)[i].id);
			       var oldcolor = $('#old_'+crid.substr(('wrc_').length)).val();

			       $('#'+crid).find('font').attr('color','#'+oldcolor);
			       $('#'+crtid).find('font').attr('color','#'+oldcolor);
		    }
		}
	}

	function uncheckbox(chk)
	{
	       $('#'+chk).attr('checked',false);
	}

	function appendto(rowId,inputValue){
		var modulepriv = '<?php echo $this->modulepriv; ?>';
		var modulepriv_bavaria = '<?php echo $this->modulepriv_bav; ?>';
		var text = '';
		
		 //we get all inputs values every time something changes so if user skip a box.. we have the rest 2 and so on
		 if(($('#name'+rowId).val() != "Name" && $('#dosage'+rowId).val() != "Dosierung") || ($('#todo'+rowId).val() != "TODO" && $('#till'+rowId).val() != "Till When" && $('#user'+rowId).val() != "0")
		       || ($('#diagnosis'+rowId).val() != "Beschreibung" )){

		       if($('#course_type'+rowId).val() == "M" || $('#course_type'+rowId).val() == "N" || $('#course_type'+rowId).val() == "I"){
			       text = $('#name'+rowId).val()+' | '+$('#dosage'+rowId).val()+' | '+$('#komment'+rowId).val()
		       } else if($('#course_type'+rowId).val() == "W"){

				if($('#group'+rowId).is(':checked')){
					var group = '1';
				} else {
					var group = '0';
				}

			       text = $('#todo'+rowId).val()+' |---------| '+$('#user'+rowId).val()+' |---------| '+ $('#till' + rowId).val() + ' |---------| ' + group;

					} else if ($('#course_type' + rowId).val() == "P") {
						text = $('#medi_name' + rowId).val() + ' | ' + $('#dosage' + rowId).val() + '  | ' + $('#comments' + rowId).val();
					} else if (($('#course_type' + rowId).val() == "U" || $('#course_type' + rowId).val() == "V") || ($('#course_type' + rowId).val() == "XT" && (modulepriv == "1" || modulepriv_bavaria == "1")) || ($('#course_type' + rowId).val() == "AA" && (modulepriv == "1" || modulepriv_bavaria == "1"))) {

						if ($('#course_type' + rowId).val() == "U" && modulepriv != "1") {
				       //appended the select value to time
							if ($('#time' + rowId).val() == "Zeit (in Minuten)" || $('#time' + rowId).val() == "" || $('#time' + rowId).val() == " ") {//set time default value if left empty
								time = $('#uSelect' + rowId).val() + " | 10";
				       } else {
								time = $('#uSelect' + rowId).val() + " | " + $('#time' + rowId).val();
				       }
						} else if ($('#course_type' + rowId).val() == "U" && modulepriv == "1") { //LNR client only
				       //appended the select value to time
							if ($('#time' + rowId).val() == "Zeit (in Minuten)" || $('#time' + rowId).val() == "" || $('#time' + rowId).val() == " ") {//set time default value if left empty
								time = $('#uSelect' + rowId).val() + " | 15";
				       } else {
								time = $('#uSelect' + rowId).val() + " | " + $('#time' + rowId).val();
				       }
						} else if ($('#course_type' + rowId).val() == "XT" && modulepriv == "1") {//LNR CLient Z=>XT(telefon) shortcut
				       //appended the select value to time
							if ($('#time' + rowId).val() == "Zeit (in Minuten)" || $('#time' + rowId).val() == "" || $('#time' + rowId).val() == " ") {//set time default value if left empty
								time = "12";
				       } else {
								time = $('#time' + rowId).val();
				       }
			       }
						else if ($('#course_type' + rowId).val() == "XT" && modulepriv_bavaria == "1") {//LNR CLient Z=>XT(telefon) shortcut
				       //appended the select value to time
							if ($('#time' + rowId).val() == "Zeit (in Minuten)" || $('#time' + rowId).val() == "" || $('#time' + rowId).val() == " ") {//set time default value if left empty
								time = "5";
				       } else {
								time = $('#time' + rowId).val();
				       }
			       }

			   		// NEW     Administration shortcut - like Koordination
						else if ($('#course_type' + rowId).val() == "AA" && modulepriv_bavaria == "1") {//TP CLient Z=>AA(administration) shortcut
							if ($('#time' + rowId).val() == "Zeit (in Minuten)" || $('#time' + rowId).val() == "" || $('#time' + rowId).val() == " ") {//set time default value if left empty
					       time = "5";
				       } else {
								time = $('#time' + rowId).val();
				       }
			       }

						if ($('#course_type' + rowId).val() == "V") {
							if ($('#time' + rowId).val() == "Zeit (in Minuten)" || $('#time' + rowId).val() == "" || $('#time' + rowId).val() == " ") {//set time default value if left empty
					       time = "8";
				       } else {
								time = $('#time' + rowId).val();
				       }
			       }

						if ($('#course_type' + rowId).val() == "U" && modulepriv != "1") {
							if ($('#komment' + rowId).val() == "Grund / Anlass" || $('#komment' + rowId).val() == "" || $('#komment' + rowId).val() == " ") {//set kommentar default value if left empty
							       komment = "Situation stabil, heute kein Besuch notwendig, Kontakt f. Folgetag vereinbart";
						       } else {
								komment = $('#komment' + rowId).val();
						       }
						} else if ($('#course_type' + rowId).val() == "U" && modulepriv == "1") { //LNR Client Only
							if ($('#komment' + rowId).val() == "Grund / Anlass" || $('#komment' + rowId).val() == "" || $('#komment' + rowId).val() == " ") {//set kommentar default value if left empty
							       komment = "Beratung";
						       } else {
								komment = $('#komment' + rowId).val();
						       }
						} else if ($('#course_type' + rowId).val() == "XT" && modulepriv == "1") {
							if ($('#komment' + rowId).val() == "Grund / Anlass" || $('#komment' + rowId).val() == "" || $('#komment' + rowId).val() == " ") {//set kommentar default value if left empty
							       komment = "Situation stabil, heute kein Besuch notwendig, Kontakt f. Folgetag vereinbart";
						       } else {
								komment = $('#komment' + rowId).val();
						       }
					       }

						else if ($('#course_type' + rowId).val() == "XT" && modulepriv_bavaria == "1")
					       {
							if ($('#komment' + rowId).val() == "Grund / Anlass" || $('#komment' + rowId).val() == "" || $('#komment' + rowId).val() == " ") {//set kommentar default value if left empty
							       komment = "Telefonat bzgl. der aktuellen Situation";
						       } else {
								komment = $('#komment' + rowId).val();
						       }
					       }
						else if ($('#course_type' + rowId).val() == "AA" && modulepriv_bavaria == "1")
					       {
							if ($('#komment' + rowId).val() == "Grund / Anlass" || $('#komment' + rowId).val() == "" || $('#komment' + rowId).val() == " ") {//set time default value if left empty
								       komment = "Administration Pflege";
								} else {
								komment = $('#komment' + rowId).val();
								}
						   }

						if ($('#course_type' + rowId).val() == "V") {
							if ($('#komment' + rowId).val() == "Grund / Anlass" || $('#komment' + rowId).val() == "" || $('#komment' + rowId).val() == " ") {//set time default value if left empty
							       komment = "Koordinationsleistung";
							} else {
								komment = $('#komment' + rowId).val();
							}
					       }
						text = time + ' | ' + komment + ' | ' + $('#date' + rowId).val() + ' ' + $('#hourtime' + rowId).val();
					} else if ($('#course_type' + rowId).val() == "D" || $('#course_type' + rowId).val() == "H" || $('#course_type' + rowId).val() == "HS") {

						icdId = $('#hidd_icdnumber' + rowId).val();

							if($('#icdnumber' + rowId).val() == "ICD") {
				       icdField = "";
			       } else {
							icdField = $('#icdnumber' + rowId).val();
			       }

						text = icdId + ' | ' + icdField + ' | ' + $('#diagnosis' + rowId).val();
						
					} else if ($('#course_type' + rowId).val() == "SB") {
		
						text = $('#sb_user' + rowId).val() + ' |__| ' +  $('#sb_order' + rowId).val() ;				
		       }
					$('#course_title' + rowId).val(text);
		 } else {
			$('#course_title' + rowId).val('');
		 }
	 }

	function changeinput(shortcut, id){
		idplus = id +1;
		idminus = id -1;
		var pid = $('#patientid').val();
		var total_cnt = $('.LeftList01').length;
		var has_hs_fields = false;
		
		$('input[name="course_type[]"]').each(function(){
			if($(this).val() == 'HS' && $(this).attr('id') != 'course_type'+id) {
				has_hs_fields = true;
			}
		});
		
		//reset error for newly changed line
//		$('#error'+id).remove();
		$('.verlauf_error_div').hide();
		$('#course_title'+id).val('');
		if((shortcut == "M" || shortcut == "I" || shortcut == "N" || shortcut == "m" || shortcut == "i" || shortcut == "n")){ //medications
			if($('#hidd'+id).length > 0){
				$('#hidd'+id).hide().remove();
				$('#course_title'+id).val('');
			}

			newInputs = '<div id="hidd'+id+'"><input type="text" id="name'+id+'"class="caret course_med_name" name="name[]" value="Name" onfocus="if(this.value == \'Name\') { this.value=\'\'}" onblur="if(this.value == \'\'){ this.value=\'Name\' } else { appendto(\''+id+'\',this.value) } insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');" /><input type="text" id="dosage'+id+'" name="dosage[]" class="caret"  value="Dosierung" style="width:150px; text-align:left;" onfocus="if(this.value == \'Dosierung\') { this.value=\'\'}" onblur="if(this.value == \'\'){ this.value=\'Dosierung\' } else { appendto(\''+id+'\',this.value) } insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');" /><input type="text" id="komment'+id+'" name="komment[]" class="caret"  value="Kommentar" style="width:210px; text-align:left;" onfocus="if(this.value == \'Kommentar\') { this.value=\'\'};" onblur="if(this.value == \'\'){ this.value=\'Kommentar\' } else { appendto(\''+id+'\',this.value) } insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');"/></div>';
			$('#course_title'+id).hide();
			$('#listcoursesession_course_title'+id).append(newInputs);
			$('#listcoursesession_course_title'+id).show();


			if(jQuery.inArray(shortcut, ltrjs)){
				$('#name'+id).focus();
			}

		} else if(shortcut == "W" || shortcut=="w") { // To Do

			if($('#hidd'+id).length > 0){
				$('#hidd'+id).hide().remove();
				$('#course_title'+id).val('');
			}
			

			<?php
				foreach($this->users as $sel_user_id=>$sel_user) {
					$sel_str .= '<option value="'.$sel_user_id.'">'.$sel_user.'</option>';
				}
			?>

			var usersSelect = '<select name="user'+id+'" id="user'+id+'" onblur="appendto('+id+',this.value);" onchange="insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');" style="width:150px; text-align:left; float:left;" class="caret"><?php echo $sel_str;?></select>';					
			newInputs = '<div id="hidd'+id+'">\n\
				<textarea id="todo'+id+'"class="caret course_todo" name="todo[]" value="TODO" onfocus="if(this.value == \'TODO\') { this.value=\'\'}" onblur="if(this.value == \'\'){ this.value=\'TODO\' } else { appendto(\''+id+'\',this.value) } insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');">TODO</textarea>\n\
				'+usersSelect+'\n\
				<div style="float: left;margin-left: 7px;width: 44px;margin-top: 2px;"><span style="float: left;width: 45px;">Gruppe</span><br><input type="checkbox" id="group'+id+'" name="group[]" class="caret course_todo_group" value="1" onchange="appendto(\''+id+'\',this.value); insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');" style="float: left;margin-top: 2px;margin-left:10px;"></div>\n\
				<input type="text" id="till'+id+'" name="till[]" class="caret course_todo_date" style="width:100px; text-align:left; float:left;heigth:16px; "  value="<?php echo date("d.m.Y"); ?>"  onfocus="appendto(\''+id+'\',this.value);" onchange="if(this.value == \'\'){ this.value=\'Till When\' } else { appendto(\''+id+'\',this.value);} insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');"/>\n\
			</div>';


			$('#listcoursesession_course_title'+id).append(newInputs);

			$('#todo'+id).elastic();
			$('#course_title'+id).hide();
			$('#till'+id).datepicker({
				dateFormat: 'dd.mm.yy',
				showOn: "both",
				buttonImage: $('#calImg').attr('src'),
				buttonImageOnly: true,
				changeMonth: true,
				changeYear: true,
				nextText: '',
				prevText: '',
				onSelect: function(date) {
					appendto(id,date.value);
					insertsession(id,pid,id);
					$(this).focus();
					return false;
				}
			});
			
			$('#listcoursesession_course_title'+id).show();
			appendto(id,'<?php echo date("d.m.Y"); ?>');
			if(jQuery.inArray(shortcut, ltrjs)){
				$('#todo'+id).focus();
			}

		} else if((shortcut == "U" || shortcut == "V" || shortcut == "XT" || shortcut == "u" || shortcut == "v" || shortcut == "xt" || shortcut == "AA" || shortcut == "aa")) { //Koordination and Telefon
			if($('#hidd'+id).length > 0){
				$('#hidd'+id).hide().remove();
				$('#course_title'+id).val('');
			}

			$("#time"+id).live("keyup input paste", function(){
				setTimeout(jQuery.proxy(function() {
					this.val(this.val().replace(/[^0-9]/g, ''));
				}, $(this)), 0);
			});

			if(shortcut == "U" || shortcut == "u"){
				var uSelect = '<select id="uSelect'+id+'" name="uSelect[]" style="" class="course_uselect" onchange="insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');" onblur="insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');"><option value="mit Betroffenen">mit Betroffenen</option><option value="mit Leistungserbringer">mit Leistungserbringer</option></select>';
				var comment_class = 'course_comment_small';
			} else {
				var uSelect = '';
				var comment_class = 'course_comment';

			}

			var newInputs = '<div id="hidd'+id+'">\n\
				'+uSelect+'\n\
				<input type="text" id="time'+id+'"class="caret course_time" name="time[]" value="Zeit (in Minuten)" onfocus="if(this.value == \'Zeit (in Minuten)\') { this.value=\'\'}" onblur="if(this.value == \'\'){ this.value=\'Zeit (in Minuten)\' } else { appendto (\''+id+'\',this.value) } insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');" onkeydown="appendto(\''+id+'\',this.value);"/>\n\
				<textarea name="komment[]" id="komment'+id+'" class="'+comment_class+'" onfocus="if(this.value == \'Grund / Anlass\') { this.value=\'\'}" onblur="if(this.value == \'\'){ this.value=\'Grund / Anlass\' } else { appendto(\''+id+'\',this.value) } insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');" >Grund / Anlass</textarea> \n\
				<input type="text" id="date'+id+'" name="date[]" class="caret course_date" value="<?php echo date("d.m.Y"); ?>" onfocus="appendto(\''+id+'\',this.value);"  onblur="if(this.value == \'\'){ this.value=\'<?php echo date("d.m.Y"); ?>\' }"   change="if(this.value == \'\'){ this.value=\'Date\' } else { appendto(\''+id+'\',this.value) } insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');"/>\n\
				<input type="text" id="hourtime'+id+'" name="hourtime[]" class="timepick course_timepicker"  value="<?php echo date("H:i"); ?>"    onblur="if(this.value == \'\'){ this.value=\'<?php echo date("H:i"); ?>\' }"       onchange="insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');"/>\n\
			</div>';
			$('#listcoursesession_course_title'+id).append(newInputs);

			$('#komment'+id).elastic();
			$('#date'+id).datepicker({
				dateFormat: 'dd.mm.yy',
				showOn: "both",
				buttonImage: $('#calImg').attr('src'),
				buttonImageOnly: true,
				changeMonth: true,
				changeYear: true,
				nextText: '',
				prevText: '',
				onSelect: function(date) {
					appendto(id,date.value);
					insertsession(id,pid,total_cnt);
					$(this).focus();
					return false;
				}
			});

			$('#hourtime' + id).timepicker({
				onSelect : function(time_value) {
					if($('#date'+id).val()==""){
						$('#date'+id).val("<?php echo date('d.m.Y'); ?>");
					}
					appendto(id, time_value);
					insertsession(id, pid, total_cnt);
					$(this).focus();
					return false;
				},
				minutes : {
					interval : 5
				},
				showPeriodLabels : false,
				rows : 4,
				hourText : 'Stunde',
				minuteText : 'Minute'
			});

			$('#course_title' + id).hide();

			$('#listcoursesession_course_title' + id).show();
			appendto(id, '<?php echo date("d.m.Y"); ?>');
			if (jQuery.inArray(shortcut, ltrjs)) {
				$('#time' + id).focus();
			}

		} else if (shortcut == "D" || shortcut == "H" || shortcut == "d" || shortcut == "h" || ((shortcut == "HS" || shortcut == "hs") && has_hs_fields === false) ) { //Diagnosis and Hauptdiagnosen
			if ($('#hidd' + id).length > 0) {
				$('#hidd' + id).hide().remove();
				$('#course_title' + id).val('');
			}
			
			var $error_div = '';
			if(shortcut == "HS" || shortcut == "hs")
			{
				if($disable_hs_insert == '1') {
					var $error_div = '<div id="error' + id + '" class="verlauf_error_div" style="display:block;clear: both;"><?php echo $this->translate('hs_limit_patient_reached'); ?></div>';
				} else {
					var $error_div = '<div id="error' + id + '" class="verlauf_error_div" style="display:none;clear: both;"><?php echo $this->translate('hs_limit_patient_reached'); ?></div>';
				}
			}
			
			newInputs = '<div id="hidd'+id+'"><input name="icdnumber['
					+ id
					+ ']" id="icdnumber'
					+ id
					+ '" class="livesearchicdinp caret" value="ICD"  style="width:45px;" type="text" onfocus="if(this.value == \'ICD\') { this.value=\'\'}" onblur="if(this.value == \'\'){ this.value=\'ICD\' } else { appendto(\''
					+ id
					+ '\',this.value) } insertsession(\''
					+ id
					+ '\',\''
					+ pid
					+ '\',\''
					+ total_cnt
					+ '\');" /><div id="icddiagnodropdown'+id+'"  class="icdlivesearchdropdown" style="position: absolute; display:none;"></div><input name="diagnosis['
					+ id
					+ ']" id="diagnosis'
					+ id
					+ '" value="Beschreibung" size="33" class="livesearchinp caret course_diag_name" type="text"  onfocus="if(this.value == \'Beschreibung\') { this.value=\'\'}" onblur="if(this.value == \'\'){ this.value=\'Beschreibung\' } else { appendto(\''
					+ id
					+ '\',this.value) } insertsession(\''
					+ id
					+ '\',\''
					+ pid
					+ '\',\''
					+ total_cnt
					+ '\');" />     <input name="hidd_icdnumber['+id+']" value="" id="hidd_icdnumber'+id+'" type="hidden"> <input name="hidd_diagnosis['+id+']" value="" id="hidd_diagnosis'+id+'" type="hidden"><input name="hidd_tab['+id+']" value="" id="hidd_tab" type="hidden"></div> <div id="diagnodropdown'+id+'" class="samtablistDiognoDrp livesearchdropdown" style="position: absolute; display:none;"></div>'+$error_div+'';

			$('#listcoursesession_course_title' + id).append(newInputs);
			$('#course_title' + id).hide();
			$('#listcoursesession_course_title' + id).show();
			$('#icdnumber'+id).focus();

			//new version
			$('.livesearchicdinp').live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('icdnumber').length));
						reset_diagnosis(input_row);
			}).liveSearch({
						url : 'ajax/diagnosis?mode=icdnumber&q=',
						id : 'livesearch_admission_diagnosis',
						aditionalWidth : '560',
						noResultsDelay : '900',
						typeDelay : '900',
						returnRowId : function(input) {
					return parseInt($(input).attr('id').substr(('icdnumber').length));
						}
					});

			//livesearch diagnosis description ls
			$('.livesearchinp').live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('diagnosis').length));
						reset_diagnosis(input_row);
			}).liveSearch({
						url : 'ajax/diagnosis?q=',
						id : 'livesearch_admission_diagnosis',
						aditionalWidth : '0',
						noResultsDelay : '900',
						typeDelay : '900',
						returnRowId : function(input) {
					return parseInt($(input).attr('id').substr(('diagnosis').length));
						}
					});

			var has_hs_fields = true;
			
		//remove shortcut if user is trying to add more than one hs entry
		} else if ((shortcut == "HS" || shortcut == "hs") && has_hs_fields === true) {
			$('#course_type' + id).val('').focus();
			$('.verlauf_error_div').show();
			$('#course_title' + id).show();
			$('#hidd' + id).hide().remove();
			$('#course_title' + id).val('');
			
		} else if (shortcut == "P" || shortcut == "p") {
			$('#hidd' + id).remove();

			var medications_list = <?php echo json_encode($this->patient_medications); ?>;

			//create medication dropdown!
			var dropdown_list = '<select id="medications-' + id
					+ '" class="medications_dd" rel="' + id
					+ '" name="verlauf_edit[' + idminus
					+ ']" onchange="load_medi($(this)); insertsession(\'' + id
					+ '\',\'' + pid + '\',\'' + total_cnt + '\');">';

			$.each(medications_list, function(i, item) {

				if (i == '999999999') {
					dropdown_list += '<option value="0">' + item + '</option>';
				} else {
					dropdown_list += '<optgroup label="'+jsTranslate[i]+'">';
					$.each(item, function(key, value) {
						dropdown_list += '<option value="'+key+'">' + value
								+ '</option>';
					});
					dropdown_list += '</optgroup>';
				}
			});
			dropdown_list += '</select>';

			newInputs = '<div id="hidd'+id+'">'
					+ dropdown_list
					+ '<div id="medication-content-'+id+'" style="display:none;">';
			newInputs += '<input type="hidden" id="medi_id'+id+'" name="id_medication['+idminus+']" value=""/>';
			newInputs += '<input type="hidden" id="drid'+id+'" name="drid['+idminus+']" value=""/>';
			newInputs += '<input type="text" id="medi_change'+id+'"  class="med_data" name="medication_change['+idminus+']" value="" style="width:62px; text-align:left; float:left; padding:5px; margin-right:3px;" />';
			newInputs += '<input type="hidden" id="medi_replace'+id+'"  name="replace_with['+idminus+']" value=""/>';
			newInputs += '<input type="text" id="medi_name'
					+ id
					+ '" name="medication['
					+ idminus
					+ ']" class="course_medi_name_edit" value="" onblur="insertsession(\''
					+ id + '\',\'' + pid + '\',\'' + total_cnt + '\');" />';
			newInputs += '<input type="text" id="dosage'
					+ id
					+ '" name="dosage['
					+ idminus
					+ ']" value="" style="width:80px; text-align:left; padding:5px; margin-left:5px; float:left;" onblur="insertsession(\''
					+ id + '\',\'' + pid + '\',\'' + total_cnt + '\');" />';
			newInputs += '<input type="text" id="comments'
					+ id
					+ '" name="comments['
					+ idminus
					+ ']" value="" style="width:150px; text-align:left; padding:5px; margin-left:5px; float:left;" onblur="insertsession(\''
					+ id + '\',\'' + pid + '\',\'' + total_cnt + '\');" />';
			newInputs += '<label for="delete'+id+'" style="line-height: 32px; margin-left: 3px;">absetzen</label><input type="checkbox" id="delete'+id+'" name="delete[]" value="1" style="float:left; margin-left: 5px;line-height: 26px;margin-top: 10px;" /><br />';
			newInputs += '</div></div>';

			$('#listcoursesession_course_title' + id).append(newInputs);

			$('#course_title' + id).hide();
			$('#listcoursesession_course_title' + id).show();
		} else if (shortcut == "S" || shortcut == "s") {
			$('#hidd' + id).remove();

			var symptoms = <?php echo json_encode($this->symptoms_data); ?>;
			var symptoms_select = '<?php echo $this->sympt_view_select; ?>';

			//create sym dropdown!
			var dropdown_list = '<table class="datatable" id="verlauf">';
			$.each(symptoms, function(i, item) {
								if (i != '999999999') {
					dropdown_list += '<tr><td colspan="3"><b>' + i + '</b></td></tr>';
					$.each(item, function(key, value) {
						dropdown_list += '<tr>';
						dropdown_list += '<td>';
						dropdown_list += '<span>'
								+ value
								+ '</span>';
						dropdown_list += '<input type="hidden" value="'+key+'" id="symptom-'+id+'" name="symptom['+idminus+'][]" />';
						dropdown_list += '</td>';
						dropdown_list += '<td>';
						if (symptoms_select == "a") {
							dropdown_list += '<select  id="sym_value'+key+'-'+id+'" name="sym_value['+idminus+'][]"  class="sym_val" ><option value=""></option><option value="0">kein</option><option value="4">leicht</option><option value="7">mittel</option><option value="10">schwer</option> </select>';
						} else {
							dropdown_list += '<input type="text" id="sym_value'
									+ key
									+ '-'
									+ id
									+ '" name="sym_value['
									+ idminus
									+ '][]" value="" class="sym_val" onkeyup="isInteger(\''
									+ key
									+ '-'
									+ id
									+ '\')" style="width:25px; margin-left:5px; text-align:left; float:left; padding: auto;" />';
						}

						dropdown_list += '</td>';
						dropdown_list += '<td>';
						dropdown_list += '<input type="text" id="sym_coment'+id+'" name="sym_coment['+idminus+'][]" value="" class="sym_coment" style="width:235px; margin-left:5px; text-align:left; float:left; padding: auto;" />';
						dropdown_list += '</td>';
						dropdown_list += '</tr>';
					});
								}
							});
			dropdown_list += '</table>';

			newInputs = '<div id="hidd'+id+'">' + dropdown_list + '';
			newInputs += '</div>';

			$('#course_title' + id).hide();
			$('#listcoursesession_course_title' + id).append(newInputs);
			$('#listcoursesession_course_title' + id).show();

		} else if (shortcut == "SB" || shortcut == "sb") { //  Sanitatshausbestellung -> medical supply order 

			if ($('#hidd' + id).length > 0) {
				$('#hidd' + id).hide().remove();
				$('#course_title' + id).val('');
			}

			//var sb_usersSelect = '<?php $attrs = array("onblur" => "appendto(\''+id+'\',this.value);", "onchange"=>"insertsession(\''+id+'\',\''+pid+'\',\''+total_cnt+'\');", "style" => "width:150px; text-align:left; float:left;", "class" => "caret"); echo str_replace("\n", "", $this->formSelect("sb_user'+id+'", "", $attrs, $this->sb_users)); ?>';

			<?php
				foreach($this->sb_users as $sel_sb_user_id=>$sel_sb_user) {
					$sel_sb_str .= '<option value="'.$sel_sb_user_id.'">'.$sel_sb_user.'</option>';
				}
			?>

			var sb_usersSelect = '<select name="sb_user'
					+ id
					+ '" id="sb_user'
					+ id
					+ '" onblur="appendto('
					+ id
					+ ',this.value);" onchange="insertsession(\''
					+ id
					+ '\',\''
					+ pid
					+ '\',\''
					+ total_cnt
					+ '\');" style="width:150px; text-align:left; float:left;" class="caret"><?php echo $sel_sb_str;?></select>';
			newInputs = '<div id="hidd'+id+'">'
					+ sb_usersSelect
					+ '<textarea id="sb_order'
					+ id
					+ '"class="caret course_sb_order" name="sb_order[]" value="Sanitätshausbestellung" onfocus="if(this.value == \'Sanitätshausbestellung\') { this.value=\'\'}" onblur="if(this.value == \'\'){ this.value=\'Sanitätshausbestellung\' } else { appendto(\''
					+ id + '\',this.value) } insertsession(\'' + id + '\',\''
					+ pid + '\',\'' + total_cnt
					+ '\');">Sanitätshausbestellung</textarea></div>';

			$('#listcoursesession_course_title' + id).append(newInputs);

			$('#sb_order' + id).elastic();

			$('#course_title' + id).hide();

			$('#listcoursesession_course_title' + id).show();

			appendto(id, '<?php echo date("d.m.Y"); ?>');

			if (jQuery.inArray(shortcut, ltrjs)) {
				$('#sb_order' + id).focus();
			}
		} else {
			$('#course_title' + id).show();
			$('#hidd' + id).hide().remove();
			$('#course_title' + id).val('');
		}
	}

	function reset_diagnosis(input_row) {
		if ($('#hidd_tab' + input_row).val() != 'text') {
			$('#hidd_icdnumber' + input_row).val('');
			$('#hidd_diagnosis' + input_row).val('');
			$('#hidd_tab' + input_row).val('text');
		}
	}
	function selectDiagnosis(did, row) {
		$('#icdnumber' + row).val($('#diag_icd_' + did).val());
		$('#diagnosis' + row).val($('#diag_de_' + did).val());
		$('#hidd_icdnumber' + row).val($('#diag_id_' + did).val());
		$('#hidd_diagnosis' + row).val($('#diag_id_' + did).val());
		$('#hidd_tab' + row).val('dig');
		$('#icdnumber' + row).blur(); //why you no lost focus?
		$('#diagnosis' + row).focus();
	}

	function checkFields(formname) {
		$('.caret').each(function() {
			if ($(this).val() != "Name" && $(this).val != "Kommentar" && $(this).val() != "Dosierung" && $(this).val() != "TODO" && $(this).val() != "Beschreibung") {
						if (checkdischargednew(formname)) {
					var submitstr = "document." + formname + ".submit()";
							eval(submitstr);
						}
					} else {
				jConfirm('Empty fields, do you want to continue', '', function(r) {
									if (r && checkdischargednew(formname)) {
						var submitstr = "document." + formname + ".submit()";
										eval(submitstr);
										//return true;
									}
								});
						return false;
					}
				});
		return false;
	}
	
	function closediaearch(ele) {
		id = $(ele).attr('id');

		$('#diagnodropdown' + id).hide();
		$('#icddiagnodropdown' + id).hide();
		$('.focused').removeClass('focused');
	}

	$(document).ready(function() {
		var pid = $('#patientid').val();

		//calls for elastic, datepicker, timepicker
		$('.course_comment').elastic();

		$('.course_date').datepicker({
				dateFormat : 'dd.mm.yy',
				showOn : "both",
				buttonImage : $('#calImg').attr('src'),
				buttonImageOnly : true,
				changeMonth : true,
				changeYear : true,
				nextText : '',
				prevText : '',
				onSelect : function(date) {
				appendto($(this).attr('id').replace("date", ""), $(this).val());
				insertsession($(this).attr('id').replace("date", ""), pid, $('.LeftList01').length);
				$(this).focus();
				return false;
			}
		});
		$('.course_todo_date').datepicker({
				dateFormat : 'dd.mm.yy',
				showOn : "both",
				buttonImage : $('#calImg').attr('src'),
				buttonImageOnly : true,
				changeMonth : true,
				changeYear : true,
				nextText : '',
				prevText : '',
				onSelect : function(date) {
				appendto($(this).attr('id').replace("till", ""), $(this).val());
				insertsession($(this).attr('id').replace("till", ""), pid, $('.LeftList01').length);
				$(this).focus();
				return false;
			}
		});
		$('.course_timepicker').timepicker({
			onSelect : function(time_value) {

				if($('#date'+$(this).attr('id')).val()==""){
					$('#date'+$(this).attr('id')).val("<?php echo date('d.m.Y'); ?>");
				}
				appendto($(this).attr('id').replace("hourtime",""), $(this).val());
				insertsession($(this).attr('id').replace("hourtime",""),pid,$('.LeftList01').length);
					$(this).focus();
					return false;
				},
				minutes : {
					interval : 5
				},
				showPeriodLabels : false,
				rows : 4,
				hourText : 'Stunde',
				minuteText : 'Minute'
			});

		$('.livesearchicdinp').bind('change', function() {
			var input_row = parseInt($(this).attr('id').substr(('icdnumber').length));
			reset_diagnosis(input_row);
		}).liveSearch({
				url : 'ajax/diagnosis?mode=icdnumber&q=',
				id : 'livesearch_admission_diagnosis',
				aditionalWidth : '560',
				noResultsDelay : '900',
				typeDelay : '900',
				returnRowId : function(input) {
				return parseInt($(input).attr('id').substr(('icdnumber').length));
			}
		});

		//livesearch diagnosis description ls
		$('.livesearchinp').live('change', function() {
					var input_row = parseInt($(this).attr('id').substr(('diagnosis').length));
					reset_diagnosis(input_row);
				}).liveSearch({
					url : 'ajax/diagnosis?q=',
					id : 'livesearch_admission_diagnosis',
					aditionalWidth : '0',
					noResultsDelay : '900',
					typeDelay : '900',
					returnRowId : function(input) {
						return parseInt($(input).attr('id').substr(('diagnosis').length));
					}
				});

						// new display for filters
						//top
						$('.filter_block').hide();
						$('#filter_block_int').val('0');

						$('#verlauf_filter_options').click(function() {
							if ($('#filter_block_int').val() == '0') {
								$('.filter_block').show();
								$('#filter_block_int').val('1');
							} else {
								$('.filter_block').hide();
								$('#filter_block_int').val('0');
							}
						});

						//bottom
						$('.filter_block_bt').hide();
						$('#filter_block_bt_int').val('0');

						$('#verlauf_filter_options_bottom').click(function() {
							if ($('#filter_block_bt_int').val() == '0') {
								$('.filter_block_bt').show();
								$('#filter_block_bt_int').val('1');
							} else {
								$('.filter_block_bt').hide();
								$('#filter_block_bt_int').val('0');
							}

						});

						//ajax loader facebook
		jQuery.ias({
			container : '#ListBox',
			history : false,
			item : '.master_row',
			pagination : 'div.navigation',
			next : 'div.navigation a.next_link_button',
			loader : '<div class="row clearer parentdiv iefirst" id="maindiv_loading" style="width: 100%; text-align:center;"><?php echo $this->translate('fb_verlauf_loading');  ?> <img src="<?php echo RES_FILE_PATH;  ?>/images/loading.gif" style="margin 5px;" /></div>',
			onRenderComplete : function(items) {
				//here we filter verlauf data

				//1. get checked shortcuts
				var selected_shortcuts = new Array();

				$('.listcoursechecks_main_div input:checked').each(function() {
					check2();
				});
			}
		});

		$('#modal_delete').dialog({
			autoOpen : false,
			modal : true,
			resizable : false,
			width : 500,
			buttons : {
				"<?php echo $this->translate('yesconfirm'); ?>" : function() {
					switch ($('#modal_redir_type').val()) {
					case 'D':
						window.location = appbase + 'patient/patdiagnoedit?id=<?php echo $_REQUEST['id']; ?>';
						break;
					case 'M':
						window.location = appbase + 'patient/patientmedication?id=<?php echo $_REQUEST['id']; ?>';
						break;

					default:
						break;
					}
					$(this).dialog("close");
				},
				"<?php echo $this->translate('noconfirm'); ?>" : function() {
					$(this).dialog("close");
				}
			},
			close : function() {
				//reset message divs on close
				$('#modal_delete p').each(function() {
							$(this).hide();
						});

				$('#modal_delete').dialog('removebutton','Medications');
				$('#modal_delete').dialog('removebutton','Diagnosis');
			}
		});

		$('#delete_btm_med').dialog({
											autoOpen : false,
											modal : true,
											resizable : false,
											width : 500,
											buttons : {
												"<?php echo $this->translate('yesconfirm'); ?>" : function() {
					revert_medication($('#btm_medi_revert').val());
													$(this).dialog("close");
												},
												"<?php echo $this->translate('noconfirm'); ?>" : function() {
													$(this).dialog("close");
												}
											}
										});
					});

	function revert_medication(ids) {
		$.ajax({
			type : 'POST',
			url : 'ajax/revertbtmmedication',
			data : {
				course : ids
			},
			success : function(data) {
				var data_obj = jQuery.parseJSON(data);

				if (data_obj.error) {
					alert(data_obj.error);
				}
			}
		});
	}

	function load_medi(that) {
		var medi_data = that.val().split('-');
		var element_row = that.attr('rel');

		//clear inputs
		$('#medi_name' + element_row).val('');
		$('#dosage' + element_row).val('');
		$('#comments' + element_row).val('');
		$('#ListNew').block({
			message : "<h1>" + jsTranslate['loadingpleasewait'] + "</h1>",
			css : {
				border : 'none',
				padding : '15px',
				backgroundColor : '#000',
				'-webkit-border-radius' : '10px',
				'-moz-border-radius' : '10px',
				opacity : .5,
				color : '#fff'
			}
		});

		$.ajax({
					type : "POST",
			url : "patientcourse/requestmedicationdata?id=<?php echo $_REQUEST['id']; ?>&mid=" + medi_data[0] + "&mmid=" + medi_data[1],async : true,success : function(response) {
						var obj = $.parseJSON(response);

				$('#medi_name' + element_row).val('' + obj.medi_name + '');
				$('#medi_change' + element_row).val('' + obj.medi_change + '');
				$('#medi_replace' + element_row).val('' + obj.medi_replace + '');
						$('#dosage' + element_row).val('' + obj.dosage + '');
				$('#comments' + element_row).val('' + obj.comments + '');
						$('#delete' + element_row).val('' + obj.id + '');
				$('#delete' + element_row).attr('name','delete[' + obj.id + ']');
				$('#medi_id' + element_row).val('' + obj.medication_master_id + '');
						$('#drid' + element_row).val('' + obj.id + '');
						$('#medication-content-' + element_row).show('slow');
						$('#ListNew').unblock();
				selectdignosis('<?php echo $_REQUEST['id']; ?>',new Number(element_row + 1));

						$('#medi_change' + element_row).datepicker({
							dateFormat : 'dd.mm.yy',
							showOn : "both",
							buttonImage : $('#calImg').attr('src'),
							buttonImageOnly : true,
							changeMonth : true,
							changeYear : true,
							nextText : '',
							prevText : ''
						});
						$('#medi_change' + element_row).mask("99.99.9999");
					}
				});
	}
</script>

<div style="display: none;"> <img id="calImg" src="<?php echo RES_FILE_PATH;  ?>/images/calendar.png" alt="Popup" class="trigger" style="float:left;"> </div>
<?php echo $this->patientinfo ?>
<?php echo $this->tabmenus ?>
<div class="tab_container">

<br />
	<div id="MainContent">

	<div class="verlauf_bar verlauf_bar_top">
	<ul>
		<li class="verlauf_li_name" ><?php echo $this->translate('patientcoursedocs')?></li>
		<li class="verlauf_li_scroll"><a href="javascript:scroll(99999999,9999999)" id="downscroll"><span>Zum Ende der Seite scrollen</span><img src="<?php echo RES_FILE_PATH;  ?>/images/gobottom.png" alt="" /></a></li>
		<li class="verlauf_li_filter"><a href="javascript:void(0)" id="verlauf_filter_options"><span><?php echo $this->translate('Add filter')?></span><img src="<?php echo RES_FILE_PATH;  ?>/images/filter_add.png" /><input type="hidden" id="filter_block_int" value="" /></a></li>
		<li class="verlauf_li_print" ><a href="patientcourse/printcourse?id=<?echo $this->pid ?>" target="_blank"><span><?php echo $this->translate('Verlauf print')?></span><img src="<?php echo RES_FILE_PATH;  ?>/images/print.gif" /></a></li>
	</ul>
	</div>
	<div class="CheckBoxes filter_block" style="display:<?php echo $this->style ?>">
			<div class="listcoursechecks_main_div">

				<?php
				$cntr = '1';
				foreach($this->course_checks_arr as $k_course_chk=> $v_course_chk):

					$chkcntr = $view->checkcounter;
					$ischecked="";
					$isbold = "";
					$isitalic = '';
					$isunderline = '';
					$cheks = 0;

					if($v_course_chk['chk'] ==1)
					{
					  $ischecked = "checked='checked'";
					  $cheks = 1;
					}

					 if($v_course_chk['isbold']==1)
					 {
					   $isbold = "bold";
					 }

					 if($v_course_chk['isitalic']==1)
					 {
					   $isitalic = "italic";
					 }

					 if($v_course_chk['isunderline']==1)
					 {
					   $isunderline = "underline";
					 }
				?>
					<label>
						<input name="<?php echo $v_course_chk['cletter'];  ?>" id="cletter_<?php echo $cntr; ?>" type="checkbox" value="1" onclick="checkboxurl(this,0)" <?php echo $ischecked; ?> />
						<font color="#<?php echo $v_course_chk['font_color']; ?>" style="font-style:<?php echo $isitalic; ?>; font-weight:<?php echo $isbold; ?>; text-decoration:<?php echo $isunderline; ?>;"><?php echo $v_course_chk['ctype'];  ?></font>
					</label>
				<?php $cntr++; endforeach;  ?>
				<label>
					 <input name="wrong" id="wrong" type="checkbox" value="1" onclick="checkboxurl(this,1)" />
					<?php echo $this->translate('wrongfilter') ?>
				</label>
			</div>

			<div class="listcoursechecks_main_div">
				<?php if($this->hasSharedShortcuts):  ?>
				<label>
					<input name="_shared" id="shared" type="checkbox" value="1" onclick="checkboxurl(this,0)" />
					<font><?php echo $this->translate('hide_owned_entryes');  ?></font>
				</label>
				<?php endif;  ?>
			</div>
			<div class="listcoursechecks_main_div">
				<?php if($this->hasSharedShortcuts):  ?>
				<label>
					<input name="_owned" id="owned" type="checkbox" value="1" onclick="checkboxurl(this,0)" />
					<font><?php echo $this->translate('hide_other_client_entryes');  ?></font>
				</label>
				<?php endif;  ?>
			</div>
		</div>

		<br />
		<?php if($this->verlauf_sort_type == 't'):  ?>
		<div class="clearer"></div>
		<form action="<?php echo $this->act ?>" method="post" name="frmcourse" id="frmcourse" autocomplete="off" >
			<input type="hidden" id="1" name="triggerformid" value="1" />

			<div class="ListNew" style="display:<?php echo $this->coursestyle ?>" id="ListNew">
				<div class="LeftContent01 left" id="focusdate">
					<?php echo $this->curr_date ?>
				</div>
				<div class="RightContent01 left">
					<span class="err">
						<?php echo $this->error_shortcut; ?>
					</span>

					<?php echo $this->gridcoursetaks; ?>
				</div>
				<div class="ClrBoth"></div>
				<div class="ClrBoth"></div>
				<p>
					<input type="button" name="btnsubmit" id="btnsubmit-save" value="<?php echo $this->translate('save') ?>" class="button" onclick="checkdischargednew('frmcourse')" >
				</p>
			</div>
		</form>
	<?php endif;  ?>

<div id="ListBox" class="clearer"  style="display:<?php echo $this->style ?>" >
<?php $blockcounter = '1'; ?>
<?php
foreach($this->course_data as $k_course => $v_course):
$wrongfilterclass = "";
$greyclass = "";

if ($v_course['wrong'] == 1)
{
        $wrongfilterclass = "wrongfilter";
        $greyclass = "greyclass";
}

if (!empty($v_course['source_ipid']))
{
        $has_source = 'source_entry';
        $hide_wrong = '1';
}
else
{
        $has_source = '';
	$hide_wrong = '0';
}
?>
	<div class="row clearer parentdiv iefirst master_row <?php echo $wrongfilterclass; ?> <?php echo $greyclass; ?> <?php echo $has_source; ?> " id="maindiv_<?php echo $blockcounter; ?>" style="width:100%;">
		<div class="colLeft iesecond ">
			<?php if($this->verlauf_action == 'a'):  ?>
				<?php echo $v_course['date_dt']  ?>, <br /><?php echo $v_course['date_hm']  ?> <!-- create_date -->
				<br />
			<?php elseif($this->verlauf_action == 'd'):  ?>

			<?php $done_date = strtotime($v_course['date_dt'].' '.$v_course['date_hm'].':00')  ?>
			<?php $entry_date = strtotime($v_course['c_date_dt'].' '.$v_course['c_date_hm'].':00')  ?>
				<?php if( $done_date != $entry_date ):?>
					<div>
						<span class="done_date_block"><?php echo $v_course['date_dt']  ?>, <?php echo $v_course['date_hm']  ?> </span> <!-- done_date -->
						<span class="entry_date_block"><?php echo $v_course['c_date_dt']  ?>, <?php echo $v_course['c_date_hm']  ?></span>   <!-- create_date -->

					</div>
				<?php else:?>
					<span class="done_date_block"><?php echo $v_course['date_dt']  ?>, <?php echo $v_course['date_hm']  ?> </span> <!-- done_date -->
				<?php endif;  ?>

			<?php endif;  ?>
				<?php echo $v_course['user_lname']  ?>&nbsp;<?php echo $v_course['user_fname']  ?>
				<br />
		</div>
		<div class="colRight iethird">
			<div class="PatDisBlkleft">
			<?php if($this->userid == $v_course['user'] || $this->usertype == "SA"): ?>
				<?php if($hide_wrong == '0'):  ?>
				<?php echo $this->formCheckbox('wrongmain', $v_course['wrong'], array("onclick" => "openPopup(this,$blockcounter)", "id" => "$blockcounter", "class" => "divcheckbox"), array('1')); ?>
			<?php endif;  ?>
			<?php endif;  ?>
			</div>
			<div class="PatDisBlkRight">
				<?php if(!empty($v_course['summary'])):  ?>
					<?php foreach($v_course['summary'] as $k_summary => $v_summary):  ?>
<?php
	if ($v_summary['isserialized'] != 1) :
		 $v_summary['course_title'] = stripslashes(nl2br(str_replace(">", "&gt;", str_replace("<", "&lt;", $v_summary['course_title']))));
	endif;

	if ($v_summary['isbold'] == 1):
		$v_summary['isbold'] = "bold";
	endif;
	if ($v_summary['isitalic'] == 1):
		$v_summary['isitalic'] = "italic";
	endif;

	if ($v_summary['isunderline'] == 1):
		$v_summary['isunderline'] = "underline";
	endif;

	if (empty($v_summary['source_ipid'])):
		$letterclass = $v_summary['course_type'] . " _owned ";
	else:
		$letterclass = "_shared";
	endif;


	if ($v_summary['course_type'] == "W")
	{
	       $clientusers = $this->users;

	       $course = explode("|---------|", $v_summary['course_title']);
	       if (count($course) <= 1)
	       {
		       $course = explode("|", $v_summary['course_title']);
	       }

	       $courseusr = trim($course[1]);

	       if ($courseusr > 0 && is_numeric($courseusr))
	       {
		       $course_user = $clientusers[trim($course[1])];
		       $v_summary['course_title'] = "&nbsp; geplante Maßnahme: " . $course[0] . " | " . $course_user . " | " . $course[2];
	       }
	       else
	       {
		       $course_user = '-';
		       $v_summary['course_title'] = "&nbsp; geplante Maßnahme: " . $course[0] . " | " . $course_user . " | " . $course[2];
	       }
	}
	elseif ($v_summary['course_type'] == "D" || $v_summary['course_type'] == "H" || $v_summary['course_type'] == "HS")
	{
	       $course = explode("|", $v_summary['course_title']);


	       if (count($course) == 3)
	       {
		       $icd = $course[1];
		       $diagnosis_name = $course[2];

		       $v_summary['course_title'] = $icd . ' | ' . $diagnosis_name;
	       }
	}
	elseif ($v_summary['course_type'] == "SB")
	{
	       $client_sb_users = $this->sb_users;

	       $course = explode("|__|", $v_summary['course_title']);

	       $course_sb_usr = trim($course[0]);

	       if ($course_sb_usr > 0 && is_numeric($course_sb_usr))
	       {
		       $course_user = $client_sb_users[trim($course[0])];
		       $v_summary['course_title'] = "Sanitätshausbestellung an: " . $course_user . " <br/> " . $course[1];
	       }
	}
	elseif ($v_summary['course_type'] == "M" || $v_summary['course_type'] == "I" || $v_summary['course_type'] == "N" || $v_summary['course_type'] == "Q" || $v_summary['course_type'] == "P")
	{
		if(strpos($v_summary['course_title'], 'Änderung:') !== false || strpos($v_summary['course_title'], 'Ein Medikationseintrag wurde editiert:') !== false)
		{
			$separator = htmlentities('->');
			$tmp_arr = explode($separator, $v_summary['course_title']);
			
			if(count($tmp_arr) == '2')
			{
				// first remove <b></b> which where saved in db
				$tmp_arr[1] = strip_tags(html_entity_decode($tmp_arr[1]));
				
				
				$tmp_arr[1] = '<b>'.$tmp_arr[1].'</b>';
				$v_summary['course_title'] = implode($separator, $tmp_arr);
			}
		}
	}

	if ($v_summary['tabname'] == "discharge")
	{
		$v_summary['course_title'] = '<span style="background:#FC7272;">' . $v_summary['course_title'] . '</span>';
	}

	$wrongcheck = "";
	if ($v_summary['wrong'] != 1)
	{	$course_type = $v_summary['course_type'];
		$v_summary['course_type'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . $v_summary['course_type'] . '</font>';

		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . $v_summary['course_title'] . '</font>';
		$wrongfilterclass = "";
	}

	$wrongcheck = "";
	if ($v_summary['wrong'] == 1)
	{
		$wrongcheck = 'checked=checked';
	}


	$pid = $this->pid;

	if ($v_summary['tabname'] == "fileupload")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">Datei ' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '</a>' . ' wurde angeh&auml;ngt</font>';
	}

	if ($v_summary['tabname'] == "receiptupload")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '</a>' . ' </font>';
	}


	if ($v_summary['tabname'] == "discharge_planning")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/dischargeplanning?id=' . $pid . '">Entlassungsplanung hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "kvno_doctor_form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/kvnodoctorform?kvno_doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Besuchsbogen Arzt hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "lvn_doctor_form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/leverkusendoctorform?kvno_doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Besuchsbogen Arzt hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "bayern_doctorvisit")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/bayerndoctorvisit?bayern_doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Besuchsformular Bayern hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "sakvno_doctor_form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/sakvnodoctorform?kvno_doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Besuchsbogen Arzt hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "wl_doctor_form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/wldoctorform?kvno_doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Besuchsbogen Arzt hinzugefügt.</a>' . '</font>';
	}


	if ($v_summary['tabname'] == "contact_form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/contactform?cid=' . $v_summary['recordid'] . '&id=' . $pid . '">'.$v_summary['course_title'].'.</a>' . '</font>';
	}




	if (($v_summary['tabname'] == "kvno_assesment" && stripos($v_summary['course_title'], 'angelegt') !== false) || $v_summary['tabname'] == 'new_kvno_assesment')
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/kvnoassessment?id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}


	if ($v_summary['tabname'] == "kvno_assesment_new")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "entrance_assesment_new")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "entrance_assessment_from")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/entranceassessment?id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "rp_assessment")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}



	if ($v_summary['tabname'] == "recording_assesment")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "reassesment")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}


	if ($v_summary['tabname'] == "kvno_nurse_form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/kvnonurseform?kvno_nurse_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Besuchsbogen Pflege hinzugefügt.</a>' . '</font>';
	}


	if ($v_summary['tabname'] == "lvn_nurse_form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/leverkusennurseform?kvno_nurse_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Besuchsbogen Pflege hinzugefügt.</a>' . '</font>';
	}


	if ($v_summary['tabname'] == "visit_koordination_form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/visitkoordinationform?koordination_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Besuchsformular Koordination hinzugefügt.</a>' . '</font>';
	}


	if ($v_summary['tabname'] == "wl_nurse_form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/wlnurseform?kvno_nurse_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Besuchsbogen Pflege hinzugefügt.</a>' . '</font>';
	}


	if ($v_summary['tabname'] == "sakvno_nurse_form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/sakvnonurseform?kvno_nurse_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Besuchsbogen Pflege hinzugefügt.</a>' . '</font>';
	}





	if ($v_summary['tabname'] == "kvnoanlage7form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/kvnoanlage7form?kvno_anlage_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Besuchsbogen KVNO Anlage 7  hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "dgpanlage7form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/dgpanlage7form?kvno_anlage_id=' . $v_summary['recordid'] . '&id=' . $pid . '">DGP-Kerndatensatz - Besuchsbogen Anlage 7  hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "dgpkernform")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/dgpkernform?dgp_kern_id=' . $v_summary['recordid'] . '&id=' . $pid . '">DGP-Kerndatensatz  - Kerndatensatz für Palliativpatienten  hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "dgpsapvform")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/dgpsapvform?dgp_sapv_id=' . $v_summary['recordid'] . '&id=' . $pid . '">DGP-Kerndatensatz  - SAPV-Struktur-Modul  hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "ruhen")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/saruhenform?ruhen_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Ruhen der Teilnahme hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "feststellung")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/safeststellung?feststellung_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Feststellung des Nichtvorliegens der Teilnahmevorraussetzung  hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "genehmigungs")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/sagenehmig?genehmig_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Genehmigungsformular hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "anlage4awl")
	{
		if(!$v_summary['recordid'])
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patient/anlage4awl?id=' . $pid . '">Anlage 4a wurde erstellt</a>' . '</font>
				<input type="hidden" name="type" id="type_[[id]]" class="anlage" value="anlage" />';
		}
		else
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Anlage 4a wurde erstellt</a>' . '</font>
				<input type="hidden" name="type" id="type_[[id]]" class="anlage" value="anlage" />';
		}
	}

	if ($v_summary['tabname'] == "anlage4wl")
	{
		if(!$v_summary['recordid'])
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patient/anlage4wl?id=' . $pid . '">Anlage 4 wurde erstellt</a>' . '</font>
			<input type="hidden" name="type" id="type_[[id]]" class="anlage" value="anlage"/>';
		}
		else
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Anlage 4 wurde erstellt</a>' . '</font>
			<input type="hidden" name="type" id="type_[[id]]" class="anlage" value="anlage"/>';
		}
	}

	if ($v_summary['tabname'] == "kvnoanlage3a")
	{
		if(!$v_summary['recordid'])
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patient/kvnoanlage3a?id=' . $pid . '">Anlage 3a wurde erstellt</a>' . '</font>
			<input type="hidden" name="type" id="type_[[id]]" class="anlage" value="kvnoanlage3a"/>';
		}
		else
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Anlage 3a wurde erstellt</a>' . '</font>
			<input type="hidden" name="type" id="type_[[id]]" class="anlage" value="kvnoanlage3a"/>';
		}
	}

	if ($v_summary['tabname'] == "kvnoanlage3b")
	{
		if(!$v_summary['recordid'])
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patient/kvnoanlage3b?id=' . $pid . '">Anlage 3b wurde erstellt</a>' . '</font>
			<input type="hidden" name="type" id="type_[[id]]" class="anlage" value="kvnoanlage3b"/>';
		}
		else
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Anlage 3b wurde erstellt</a>' . '</font>
			<input type="hidden" name="type" id="type_[[id]]" class="anlage" value="kvnoanlage3b"/>';
		}
	}

	if ($v_summary['tabname'] == "drletter")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . 'Ein <a href="patient/doctorletter?id=' . $pid . '&lid=' . $v_summary['recordid'] . '&pdf=1">Brief</a> wurde erstellt' . '</font>';
	}

	if ($v_summary['tabname'] == "drletterfaxvor")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . 'Ein <a href="patient/doctorletter?id=' . $pid . '&lid=' . $v_summary['recordid'] . '&type=4&pdf=1">Brief</a> wurde erstellt' . '</font>';
	}

	if ($v_summary['tabname'] == "drlettertodes")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . 'Ein <a href="patient/doctorletter?id=' . $pid . '&lid=' . $v_summary['recordid'] . '&type=7&pdf=1">Brief</a> wurde erstellt' . '</font>';
	}

	if ($v_summary['tabname'] == "drletter_erstverordnung_zapv")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . 'Ein <a href="patient/doctorletter?id=' . $pid . '&lid=' . $v_summary['recordid'] . '&type=23&pdf=1">Brief</a> wurde erstellt' . '</font>';
	}
	
	if ($v_summary['tabname'] == "drletter_folgeverordnung_zapv")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . 'Ein <a href="patient/doctorletter?id=' . $pid . '&lid=' . $v_summary['recordid'] . '&type=24&pdf=1">Brief</a> wurde erstellt' . '</font>';
	}

	if ($v_summary['tabname'] == "wl_doctor_letter")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . 'Ein <a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Brief</a> wurde erstellt' . '</font>';
	}
	if ($v_summary['tabname'] == "MdkSchne")
	{
		if(!$v_summary['recordid'])
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/mdkschneform?id=' . $pid . '">MDK Schnellbegutachtungsbogen</a> wurde erstellt' . '</font>';
		}
		else
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">MDK Schnellbegutachtungsbogen</a> wurde erstellt' . '</font>';
		}
	}
	if ($v_summary['tabname'] == "MdkSchne_form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/mdkschneform?id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "FinalDocumentation_form")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patient/formfive?id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}


	if ($v_summary['tabname'] == "Stammblattsapv")
	{
		if(!$v_summary['recordid'])
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/stammblattsapv?id=' . $pid . '">Stammblatt</a> wurde erstellt' . '</font>';
		}
		else
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Stammblatt</a> wurde erstellt' . '</font>';
		}
	}

	if ($v_summary['tabname'] == "Stammblatt4")
	{
		if(!$v_summary['recordid'])
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/stammblatt4?id=' . $pid . '">Stammblatt IV</a> wurde erstellt' . '</font>';
		}
		else
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Stammblatt IV</a> wurde erstellt' . '</font>';
		}
	}

	if ($v_summary['tabname'] == "PatientStammblattsapv")
	{
		if(!$v_summary['recordid'])
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/patientstammblattsapv?id=' . $pid . '">Patientenstammblatt </a> wurde erstellt' . '</font>';
		}
		else
		{
			$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">Patientenstammblatt </a> wurde erstellt' . '</font>';
		}
	}

	if ($v_summary['tabname'] == "patient_death")
	{
		$course_title = '<span  style="background: none repeat scroll 0 0 #FC7272;" > ' . $course_title . ' </span>';
	}

	if ($v_summary['tabname'] == "formone")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . 'Formular <a href="patient/formone?id=' . $pid . '">SAPV-Einzelfallevaluation</a> wurde erstellt.' . '</font>';
	}

	if ($v_summary['tabname'] == "bre_recording_report")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/recordingreport?id=' . $pid . '&fid='.$v_summary['recordid'].'">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "nie_recording_report")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/nierecordingform?id=' . $pid . '&fid='.$v_summary['recordid'].'">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "sapv_questionnaire")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/sapvquestionnaire?id=' . $pid . '&qid='.$v_summary['recordid'].'">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "hospiz_questionnaire")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/hospizquestionnaire?id=' . $pid . '&qid='.$v_summary['recordid'].'">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "contact_form_save")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}
	if ($v_summary['tabname'] == "mdk_schne_instance")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "FinalDocumentation_instance")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "barthelscorepdf")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="stats/patientfileupload?doc_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}
	
	if ($v_summary['tabname'] == "barthelscore_form_save")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/barthelscore?&id=' . $pid . '&fid='.$v_summary['recordid'].'">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "zapv_assessment_admission")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/zapvassessment?form_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '</a>' . '</font>';
	}
	if ($v_summary['tabname'] == "zapv_assessment_consulting")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/zapvberatungassessment?form_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '</a>' . '</font>';
	}
	if ($v_summary['tabname'] == "zapv_assessment_end")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/zapvendeassessment?form_id=' . $v_summary['recordid'] . '&id=' . $pid . '">' . $v_summary['course_title'] . '</a>' . '</font>';
	}


	if ($v_summary['tabname'] == "wl_anlage7")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patient/palliativversorgunga7?id=' . $pid . '">Formular Anlage 7 hinzugefügt.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "questionnaireb")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/questionnaireb?id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

	if ($v_summary['tabname'] == "questionnairec")
	{
		$v_summary['course_title'] = '<font color="#' . $v_summary['font_color'] . '" style="font-style:' . $v_summary['isitalic'] . ';font-weight:' . $v_summary['isbold'] . ';text-decoration:' . $v_summary['isunderline'] . ';">' . '<a href="patientform/questionnairec?id=' . $pid . '">' . $v_summary['course_title'] . '.</a>' . '</font>';
	}

?>
					<div class="iefourth row clearer ListOuter <?php echo $letterclass; ?>">
						<div>
							<div class="colleft2_inpwid " style="display:none;">
								<input type="checkbox" name="wrong[<?php echo $v_summary['id']; ?>]" class="block_<?php echo $blockcounter; ?>" id="<?php echo $v_summary['id']; ?>" value="1" <?php echo $wrongcheck; ?> />
								<input type="hidden" value="<?php echo $course_type;  ?>" id="course_type_<?php echo $v_summary['id']; ?>" name="courses_types[]" class="courses_types_<?php echo $blockcounter; ?>" rel="<?php echo $v_summary['recordid']; ?>"/> &nbsp;
							</div>
							<div class="LeftChar greyfontclass wrc_<?php echo $blockcounter; ?>" id="wrc_<?php echo $v_summary['id'];  ?>"><?php echo $v_summary['course_type'];  ?></div>
							<div class="iesix colRight2 greyfontclass wrt_<?php echo $blockcounter; ?>" id="wrt_<?php echo $v_summary['id'];  ?>" ><?php echo $v_summary['course_title'];  ?></div>
							<div class="clearer"></div>

							<input type="hidden" name="oldcolor" id="old_<?php echo $v_summary['id'];  ?>" value="<?php echo $v_summary['font_color'];  ?>" />
						</div>
					</div>
					<?php endforeach;  ?>
				<?php endif;  ?>
				<div class="clearer"></div>
				<div class="ListCourseSumm" id="wrongcomment_<?php echo $blockcounter; ?>"><?php echo $v_course['wrongcomment'];  ?></div>
			</div>
			<div class="clearer"></div>
		</div>
	</div>
<?php $blockcounter++;  ?>
<?php endforeach;  ?>
</div>
<?php
if ($this->verlauf_facebook_load == 'y' && $_REQUEST['page'] <= $this->max_pages && $_REQUEST['page'] != '0'):
	if (empty($_REQUEST['page'])):
		$page = '1';
	else:
		$_REQUEST['page']++;
		$page = $_REQUEST['page'];
	endif;
?>
		<?php if($this->max_pages != '0'):  ?>
		<div class="navigation" id="navigation"><a href="patientcourse/patientcourse?id=<?php echo $_REQUEST['id']; ?>&page=<?php echo $page; ?>&mod=minimal" class="next_link_button" ></a></div>
		<?php endif;  ?>
<?php endif;  ?>

		<div class="ClrBoth"></div>

	<?php if($this->verlauf_sort_type == 'b'):  ?>
		<form action="<?php echo $this->act ?>" method="post" name="frmcourse" id="frmcourse" autocomplete="off" >
			<input type="hidden" id="1" name="triggerformid" value="1" />

			<div class="ListNew" style="display:<?php echo $this->coursestyle ?>" id="ListNew">
				<div class="LeftContent01 left" id="focusdate">
					<?php echo $this->curr_date ?>
				</div>
				<div class="RightContent01 left">
					<span class="err">
						<?php echo $this->error_shortcut; ?>
					</span>

					<?php echo $this->gridcoursetaks; ?>
				</div>
				<div class="ClrBoth"></div>
				<div class="ClrBoth"></div>
				<p>
					<input type="button" name="btnsubmit" id="btnsubmit-save-b" value="<?php echo $this->translate('save') ?>" class="button" onclick="checkdischargednew('frmcourse')" >
				</p>
			</div>
		</form>
	<?php endif;  ?>
 	<div class="verlauf_bar verlauf_bar_bottom">
	<ul>
		<li class="verlauf_li_name" > </li>
		<li class="verlauf_li_scroll"><a href="javascript:scroll(0,0)" id="btmscroll"><span>Zum Anfang der Seite scrollen</span><img src="<?php echo RES_FILE_PATH;  ?>/images/top.png" alt=""/></a></li>
		<li class="verlauf_li_filter"><a href="javascript:void(0)" id="verlauf_filter_options_bottom"><span><?php echo $this->translate('Add filter')?></span><img src="<?php echo RES_FILE_PATH;  ?>/images/filter_add.png" /><input type="hidden" id="filter_block_bt_int" value="" /></a></li>
		<li class="verlauf_li_print" ><a href="patientcourse/printcourse?id=<?echo $this->pid ?>" target="_blank"><span><?php echo $this->translate('Verlauf print')?></span><img src="<?php echo RES_FILE_PATH;  ?>/images/print.gif" /></a></li>
	</ul>
				</div>

	<div class="CheckBoxes filter_block_bt" style="display:<?php echo $this->style ?>">
			<div class="listcoursechecks_main_div">

				<?php
				$cntr = '1';
				foreach($this->course_checks_arr as $k_course_chk=> $v_course_chk):

					$chkcntr = $view->checkcounter;
					$ischecked="";
					$isbold = "";
					$isitalic = '';
					$isunderline = '';
					$cheks = 0;

					if($v_course_chk['chk'] ==1)
					{
					  $ischecked = "checked='checked'";
					  $cheks = 1;
					}

					 if($v_course_chk['isbold']==1)
					 {
					   $isbold = "bold";
					 }

					 if($v_course_chk['isitalic']==1)
					 {
					   $isitalic = "italic";
					 }

					 if($v_course_chk['isunderline']==1)
					 {
					   $isunderline = "underline";
					 }
				?>
					<label>
						<input name="<?php echo $v_course_chk['cletter'];  ?>" id="cletter_<?php echo $cntr; ?>" type="checkbox" value="1" onclick="checkboxurl(this,0)" <?php echo $ischecked; ?> />
						<font color="#<?php echo $v_course_chk['font_color']; ?>" style="font-style:<?php echo $isitalic; ?>; font-weight:<?php echo $isbold; ?>; text-decoration:<?php echo $isunderline; ?>;"><?php echo $v_course_chk['ctype'];  ?></font>
					</label>
				<?php $cntr++; endforeach;  ?>
				<label>
					<input name="wrong" id="wrong" type="checkbox" value="1" onclick="checkboxurl(this,1)" />
					<?php echo $this->translate('wrongfilter') ?>
				</label>
			</div>

			<div class="listcoursechecks_main_div">
				<?php if($this->hasSharedShortcuts):  ?>
				<label>
					<input name="_shared" id="shared" type="checkbox" value="1" onclick="checkboxurl(this,0)" />
					<font><?php echo $this->translate('hide_owned_entryes');  ?></font>
				</label>
				<?php endif;  ?>
			</div>
			<div class="listcoursechecks_main_div">
				<?php if($this->hasSharedShortcuts):  ?>
				<label>
					<input name="_owned" id="shared" type="checkbox" value="1" onclick="checkboxurl(this,0)" />
					<font><?php echo $this->translate('hide_other_client_entryes');  ?></font>
				</label>
				<?php endif;  ?>
			</div>
		</div>
	<div class="shortcutlist">
		<?php echo $this->cshortcuts ?>
	</div>
</div>
</div>

<script type="text/javascript">
		var callcheck2 = <?php echo $this->callcheck2 ?>;

		<?php if($this->verlauf_sort_type == 'b'): ?>
		$('html,body').animate({scrollTop: $("#btmscroll").offset().top}, 500, 'easeOutCubic');
		<?php endif; ?>

</script>

<div id="modal_delete">
	<p id="delete_medis" style="display:none;">
		<?php echo $this->translate('medis_redirect'); ?>
	</p>
	<p id="delete_diag" style="display:none;">
		<?php echo $this->translate('diag_redirect'); ?>
	</p>
	<p id="delete_medis_diag" style="display:none;">
	</p>
	<input type="hidden" value="" id="modal_redir_type" name="modal_redir_type" />
</div>
<input type="hidden" value="<?php echo $this->pid; ?>" id="patientid" />

<div id="delete_btm_med">
	<p>
		<?php echo $this->translate('revert_btm_medi_to_source'); ?>
		<input type="hidden" name="btm_medi_revert" value="" id="btm_medi_revert" />
	</p>
</div>
