<?php

$this->headLink()->appendStylesheet(RES_FILE_PATH.'/css/pharmaindex/medi_pharmaindex.css');
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/pharmaindex/medi_pharmaindex.js');
 $this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/medicationnew_edit.css');



 //$this->headLink()->appendStylesheet(RES_FILE_PATH.'/css/page-css/contact_form_style.css');
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/autogrow/jquery.elastic.js');
$this->headScript()->appendFile(RES_FILE_PATH . '/javascript/dragdiv/dragdivpatient.js');
$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/jquery.blockUI.js');


$this->headScript()
->appendFile(RES_FILE_PATH . '/javascript/inputmask/dist/jquery.inputmask.bundle.js')
->appendFile(RES_FILE_PATH . '/javascript/pms/jquery.sum.js')
->appendFile(RES_FILE_PATH . '/javascript/dateUtil.js')
->appendFile(RES_FILE_PATH . '/javascript/views/patientform/contactform.js');

$contact_form_lang = $this->translate('contact_form_lang');


$allowed_blocks = $this->allowed_blocks;

$sapv_only_blocks = $this->sapv_only_blocks;
$contact_form_details = $this->contact_form_details;
$patient_befund_values = $this->patient_befund_values;
$patient_ebm_values = $this->patient_ebm_values;

$patient_ebmi_values = $this->patient_ebmi_values;
$patient_ebmii_values = $this->patient_ebmii_values;

$patient_goa_values = $this->patient_goa_values;

$patient_goai_values = $this->patient_goai_values;
$patient_goaii_values = $this->patient_goaii_values;
$patient_xbdt_goaii_values = $this->patient_xbdt_goaii_values;
$patient_xbdt_ebmii_values = $this->patient_xbdt_ebmii_values;

$patient_measures_values = $this->patient_measures_values;

$patient_sgbxi_actions_values = $this->patient_sgbxi_actions_values;
$patient_ebm_ber_values = $this->patient_ebm_ber_values;
$patient_classification_values = $this->patient_classification_values;
$patient_bra_sapv_values = $this->patient_bra_sapv_values;

$patient_bowel_movement_values = $this->patient_bowel_movement_values;



$patient_client_symptoms = $this->patient_client_symptoms;

$opened_blocks = $this->opened_blocks;
$vital_signs_arr = $this->vital_signs_arr;

$kvno_visit_type = $this->kvno_visit_type;



	$client_users = $this->client_users;
	$additional_users = $this->additional_users;
	$form_create_user = $this->form_create_user;





$patient_ipos_values = $this->patient_ipos_values;

$patient_pflegeipos_values = $this->patient_pflegeipos_values;
$patient_talkwith_values = $this->patient_talkwith_values;
$patient_soap_values = $this->patient_soap_values;
$patient_soap_pflege_values = $this->patient_soap_pflege_values;
$patient_soap_soza_values = $this->patient_soap_soza_values;
$patient_procedures_values = $this->patient_procedures_values;

//$patient_todos_values = $this->patient_todos_values;

$patient_talkback_values = $this->patient_talkback_values;
$patient_lmu_physmed_documentation_values = $this->patient_lmu_physmed_documentation_values;
$patient_lmu_psydoc_values = $this->patient_lmu_psydoc_values;
$patient_lmu_spirit_values = $this->patient_lmu_spirit_values;
$patient_lmu_phone_values = $this->patient_lmu_phone_values;
$patient_lmu_documentation_values = $this->patient_lmu_documentation_values;

if(in_array('med_time_dosage',$allowed_blocks)) {
	$this->headScript()
		->appendFile(RES_FILE_PATH.'/javascript/views/patientnew/medicationeditblocks.js?'.date('Ymd'))
		->appendFile(RES_FILE_PATH.'/javascript/jquery.tablesorter.js');	
} 

if(in_array('todos',$allowed_blocks)) {
	$this->headScript()->appendFile(RES_FILE_PATH.'/javascript/chosen_v1.6.2/chosen.jquery.js');
	$this->headLink()->appendStylesheet(RES_FILE_PATH.'/javascript/chosen_v1.6.2/chosen_2016.09.22.css');
}



$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/ispc-mobile-besuch.css');
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/ispc-mobile-contact-form.css');

?>
<script type="text/javascript">
	var jscount = '0';
	var jsmedcount = '0';
	var medcount = '<?php echo $this->mcntr + 1 ?>';
	var medcount_s = '<?php echo $this->mcntr_s + 1 ?>';
	var jcount = '<?php echo $this->jscount + 1 ?>';
	var dcntr = '<?php echo $this->dcntr ?>';
	var medblur = Array();
	var jsusers = <?php echo $this->jsusers; ?>;
	var detailscookies = '<?php echo $this->detailscookies; ?>';
	var sapv_box_ids = '<?php echo json_encode($sapv_only_blocks); ?>';

	var cl_sym_count = '<?php echo count($patient_client_symptoms) + 1 ?>';
	
	var contactform_default_visit_length = '<?php echo $this->contactform_default_visit_length ?>';

	// required for don't leave page
	var submited = false;
	var changes = false;
	var route_error = "<?php echo $this->route_error; ?>";// TODO-1211
	
	<?php if( ! in_array('med_time_dosage',$allowed_blocks)) : ?>
	
	//medications
	function selectMedications(mid, row)
	{
		$('#medication'+row).val($('#medi_me_'+mid).val());
		$('#comment'+row).val($('#medi_comment_'+mid).val());
		$('#hidd_medication'+row).val($('#medi_id_'+mid).val());
	}
	function reset_medications(input_row)
	{
		if($('#hidd_medication'+input_row).val()){
			$('#hidd_medication'+input_row).val('');
			//$('#drid'+input_row).val('');
		}
	}

	<?php endif; ?>
	
	function createnewmedic()
	{
		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}

		var userdrop = '<select name="add[verordnetvon]['+medcount+']" class="medis_small_select">'+usrstr+'</select>';
		var trInnerHtml = $('<tr id="medadd'+medcount+'"><td align="left" valign="top"></td><td align="left" valign="top"><input name="add[medication]['+medcount+']" value="" id="medication'+medcount+'" type="text" class="livesearchmedinp med"><input name="add[hidd_medication]['+medcount+']" value="" id="hidd_medication'+medcount+'" type="hidden"></td><td align="left" valign="top"><input  name="add[dosage]['+medcount+']" id="dosage" class="dosage" value=""  /></td><td align="left" valign="top"><input  name="add[comments]['+medcount+']" value="" id="comment'+medcount+'"   /></td><td></td><td valign="top" style="padding-right:5px;">'+userdrop+'</td><td align="left" valign="top"><a href="javascript:void(0)" onclick="removeElem(\'#medadd'+medcount+'\')"><img src="<?php echo RES_FILE_PATH; ?>/images/action_delete.png" border="0" /></a></td></tr>');

		$('#listpatientmedicationedit_medicationtable').append(trInnerHtml);

		$('#medication'+medcount).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});
		medcount++;
		
	}

	function createnewmedicrowbedarf()
	{

		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}



		var userdrop = '<select name="verordnetvon['+medcount+']" class="medis_small_select">'+usrstr+'</select>';

		var trInnerHtml = $('<tr id="medadd'+medcount+'"><td></td><td align="left" valign="top"><input name="addbedarf[medication]['+medcount+']" value="" id="medication'+medcount+'" type="text" class="livesearchmedinp med"><input name="addbedarf[hidd_medication]['+medcount+']" value="" id="hidd_medication'+medcount+'" type="hidden"><div id="medidropdown'+medcount+'" style="position:absolute;display:none;" class="listPatMedEd livesearchdropdown"></div></td><td align="left" valign="top"><input  name="addbedarf[dosage]['+medcount+']" id="dosage" class="dosage" value=""  /></td><td align="left" valign="top"><input  name="addbedarf[comments]['+medcount+']" value=""  id="comment'+medcount+'" /></td><td></td><td align="left" valign="top">'+userdrop+'</td><td align="left" valign="top"><a href="javascript:void(0)" onclick="removeElem(\'#medadd'+medcount+'\')"><img src="<?php echo RES_FILE_PATH; ?>/images/action_delete.png" border="0" /></a></td></tr>');
		$('#listpatientmedicationedit_bedarfsmedicationtable').append(trInnerHtml);


		$('#medication'+medcount).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('keydown paste', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});
		medcount++;
	}
	function createnewmedicrowiv()
	{

		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}



		var userdrop = '<select name="verordnetvon['+medcount+']" class="medis_small_select">'+usrstr+'</select>';

		var trInnerHtml = $('<tr id="medaddiv'+medcount+'"><td></td><td align="left" valign="top"><input name="addiv[medication]['+medcount+']" value="" id="medication'+medcount+'" type="text" class="livesearchmedinp med"><input name="addiv[hidd_medication]['+medcount+']" value="" id="hidd_medication'+medcount+'" type="hidden"><div id="medidropdown'+medcount+'" style="position:absolute;display:none;" class="listPatMedEd livesearchdropdown"></div></td><td align="left" valign="top"><input  name="addiv[dosage]['+medcount+']" id="dosage" class="dosage" value=""  /></td><td align="left" valign="top"><input  name="addiv[comments]['+medcount+']" value="" id="comment'+medcount+'"  /></td><td></td><td align="left" valign="top">'+userdrop+'</td><td align="left" valign="top"><a href="javascript:void(0)" onclick="removeElem(\'#medaddiv'+medcount+'\')"><img src="<?php echo RES_FILE_PATH; ?>/images/action_delete.png" border="0" /></a></td></tr>');

		$('#listpatientmedicationedit_ivmedicationtable').append(trInnerHtml);

		$('#medication'+medcount).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});
		medcount++;
	}
	function createnewschmerzpumpe()
	{
		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}



		var userdrop = '<select name="add_schmerze[verordnetvon]['+medcount+']">'+usrstr+'</select>';

		var trInnerHtml = $('<tr id="medadd_schmerze'+medcount+'"><td align="left" valign="top"><input name="add_schmerze[medication]['+medcount+']" value="" id="medication'+medcount+'" type="text" class="livesearchmedinp med"><input name="add_schmerze[hidd_medication]['+medcount+']" value="" id="hidd_medication'+medcount+'" type="hidden"><div id="medidropdown'+medcount+'" style="position:absolute;display:none;" class="listPatMedEd livesearchdropdown"></div></td><td align="left" valign="top"><input  name="add_schmerze[dosage]['+medcount+']" id="dosage" class="dosage" value=""  /></td><td align="left" valign="top">'+userdrop+'</td><td align="left" valign="top"><a href="javascript:void(0)" onclick="removeElem(\'#medadd_schmerze'+medcount+'\')"><img src="<?php echo RES_FILE_PATH; ?>/images/action_delete.png" border="0" /></a></td></tr>');

		$('#medaddtable_schmerze').append(trInnerHtml);


		$('#medication'+medcount).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});

		medcount++;
	}

	function createnewschmerzpumpeedit()
	{
		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}

		var userdrop = '<select name="add_schmerze[verordnetvon]['+medcount_s+']">'+usrstr+'</select>';

		var trInnerHtml = $('<tr id="medadd_schmerze'+medcount_s+'"><td></td><td align="left" valign="top"><input name="add_schmerze[medication]['+medcount_s+']" value="" id="medication'+medcount_s+'" type="text" class="livesearchmedinp med"><input name="add_schmerze[hidd_medication]['+medcount_s+']" value="" id="hidd_medication'+medcount_s+'" type="hidden"><div id="medidropdown'+medcount_s+'" style="position:absolute;display:none;" class="listPatMedEd livesearchdropdown"></div></td><td align="left" valign="top"><input  name="add_schmerze[dosage]['+medcount_s+']" id="dosage" class="dosage" value=""  /></td><td></td><td align="left" valign="top">'+userdrop+'</td><td align="left" valign="top"><a href="javascript:void(0)" onclick="removeElem(\'#medadd_schmerze'+medcount_s+'\')"><img src="<?php echo RES_FILE_PATH; ?>/images/action_delete.png" border="0" /></a></td></tr>');

		$(trInnerHtml).insertBefore('#cDetails');

		$('#medication'+medcount_s).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});

		medcount_s++;
	}
	
	
	function create_new_symptom_item()
	{
		var sym_row_class = "";
		if(cl_sym_count % 2){
			sym_row_class = " cl_sym_row_odd";
		} else{
			sym_row_class = " cl_sym_row_even";
		}
		
		

		<?php
			//TODO-1296
            if(is_array($this->client_syms) && count($this->client_syms)>1) {
                usort($this->client_syms, array(new Pms_Sorter('name'), "_strcmp"));
            }
		
			$sel_str ="";
			$sel_str .= '<option value=""></option>';
			foreach($this->client_syms  as $group_id => $group_details) {
				//TODO-1296
                if(is_array($group_details['symps']) && count($group_details['symps'])>1) {
                    usort($group_details['symps'], array(new Pms_Sorter('description'), "_strcmp"));
                }
				$sel_str .= '<optgroup label="'.$group_details['name'].'">';
				foreach($group_details['symps'] as $k=>$syms){
					$sel_str .= '<option value="'.$syms['id'].'">'.$syms['description'].'</option>';
				}
				$sel_str .= '</optgroup>';
			}
		?>

		var symptom_name_drop = '<select name="clientsymptoms['+cl_sym_count+'][symptom_id]"  class="sym_name_drop" ><?php echo $sel_str;?></select>';
		var severity_drop = '<select name="clientsymptoms['+cl_sym_count+'][severity]" class="sym_severety"><option value=""></option><option value="0">kein</option><option value="4">leicht</option><option value="7">mittel</option><option value="10">schwer</option></select>';
		var sorrowfully_options = '<input type="radio"  name="clientsymptoms['+cl_sym_count+'][sorrowfully]" value="1"/><label>Ja</label><input type="radio"  name="clientsymptoms['+cl_sym_count+'][sorrowfully]" value="2"/><label>Nein</label>';
		//var sym_comment = '<input type="text"   name="clientsymptoms['+cl_sym_count+'][comment]" value=""   class="sym_comment" />';
	    var sym_comment = '<textarea  name="clientsymptoms['+cl_sym_count+'][comment]" value=""   class="sym_comment" rows=1 style="height:20px;"></textarea>';
		var sym_care_instruction = '<textarea  cols="" rows=""  class="sym_care_instruction" name="clientsymptoms['+cl_sym_count+'][care_specifications]"></textarea>';
		var sym_custom = '<input type="hidden" name="clientsymptoms['+cl_sym_count+'][custom]"  value="1"> ';

		var tr_start = '<tr id="cl_sym'+cl_sym_count+'"  data-cl_line="'+cl_sym_count+'" class="sym_default_row '+sym_row_class+'">';
//		var td_symptom_count='<td> # '+cl_sym_count+'</td>'
		var td_symptom_count='<td> # </td>'
		var td_symptom_name='<td>'+symptom_name_drop+'</td>'
		var td_symptom_severity='<td align="center">'+severity_drop+'</td>'
		var td_symptom_sorrowfully='<td align="center">'+sorrowfully_options+'</td>'
		var td_symptom_comment='<td>'+sym_comment+'</td>'
		var td_symptom_remove='<td align="left" valign="top"><a href="javascript:void(0)" onclick="remove_sym_line(\''+cl_sym_count+'\')"><img src="images/action_delete.png" border="0" /></a></td>'
		var tr_end = '</tr>';

		var td_symptom_care_line='<tr id="care_cl_sym'+cl_sym_count+'"  class="sym_default_row bbotttom '+sym_row_class+'"><td colspan="6"><b><?php echo $this->translate("Sym care instructions: "); ?></b><br/>'+sym_care_instruction+sym_custom+'</td> <td></td> </tr>'

		var new_line = ""; 
		 	new_line += tr_start 
			new_line += td_symptom_count 
			new_line += td_symptom_name 
			new_line += td_symptom_severity 
			new_line += td_symptom_sorrowfully 
			new_line += td_symptom_comment 
			new_line += td_symptom_remove 
			new_line += tr_end;
			new_line += td_symptom_care_line;
		 	
		var line_obj = $('.client_symptomatics').append(new_line);
		line_obj.find('textarea.sym_comment').elastic();
		
		cl_sym_count++;
	}	
	
	function removeElem(ids) {
		$(ids).remove();
	}

	function remove_sym_line(line_id) {
		
		$("#cl_sym"+line_id).remove();
		$("#care_cl_sym"+line_id).remove(); 
		//cl_sym_count--;
	}
	
	function removeSchmerzeMedication(mid,pid)
	{
		if(mid>0)
		{
			ajaxCallserver({
				url:'patient/patientmedication?mid='+mid+'&id='+pid+'&act=del&noredir=1'
        				+ '&_deleted_medis_contactform_cid=<?= ! empty($_REQUEST['cid']) ? (int)$_REQUEST['cid'] : 0 ;?>'
                        + "&_cfhiddennounce=" + $("#cfhiddennounce").val()
			});
		}
		$("#medadd_schmerze"+mid).remove();
	}
	
	function removeMedicationKvno(mid,pid)
	{
		if(mid>0)
		{
			ajaxCallserver({
				url:'patient/patientmedication?mid='+mid+'&id='+pid+'&act=del&noredir=1'
        				+ '&_deleted_medis_contactform_cid=<?= ! empty($_REQUEST['cid']) ? (int)$_REQUEST['cid'] : 0 ;?>'
                        + "&_cfhiddennounce=" + $("#cfhiddennounce").val()
			});
		}
		$("#line_"+mid).remove();
	}
	
	function delmedicationRow(did,patidencrypted)
	{

		if(did)
		{

			ajaxCallserver({
				url:'patient/patientmedication?id='+patidencrypted+'&delid='+did+'&mid='+did+'&act=del&noredir=1' //mid for trigger when deleteing the row
        				+ '&_deleted_medis_contactform_cid=<?= ! empty($_REQUEST['cid']) ? (int)$_REQUEST['cid'] : 0 ;?>'
                        + "&_cfhiddennounce=" + $("#cfhiddennounce").val()
			});
		}
	}
	
	var deleted_medis_contactform_cid_patientcourse_id = function (pc_ids) {
        //"THIS PC ID MUST BE LINKED WITH THIS NEW CF"
        $.each(pc_ids, function (i, pc_id) {
            $('<input>', {
                'type'  : "hidden",
                'name'  : "deleted_medis_contactform_cid_patientcourse_id[]",
                'value' : pc_id
            }).prependTo("form#contact_form");
        });
    }
	
	function renewMedicationKvno(mid,pid)
	{
		if(mid>0){
			ajaxCallserver({
				url:'patient/patientmedication?mid='+mid+'&id='+pid+'&act=rnw&noredir=1'
        				+ '&_deleted_medis_contactform_cid=<?= ! empty($_REQUEST['cid']) ? (int)$_REQUEST['cid'] : 0 ;?>'
                        + "&_cfhiddennounce=" + $("#cfhiddennounce").val()
			});
		}
		$("#line_r_"+mid).remove();
	}

	// make the textarea grow
	  $(function() {
		 $.getmedicationblocks = function() {
				
				var url = '<?php echo APP_BASE; ?>patientnew/medicationeditblocks?id=<?php echo $_REQUEST["id"]; ?>';

				//show a loading gif
				$('.medication_new').html('<br/><div class="loadingdiv" align="center"><img src="<?php echo RES_FILE_PATH; ?>/images/ajax-loader.gif"><br /><?php echo $this->translate(loadingpleasewait); ?></div><br/>');


				xhr = $.ajax({
					url : url,
					cache : false,
					success : function(response) {
						$('.medication_new').html(response);
						medicationeditblocks_ready();
					}
				});
			}
			
		 	<?php if(in_array('med_time_dosage',$allowed_blocks)) : ?> 
				 
			$.getmedicationblocks();
				
			<?php endif; ?>
				
		$('input.livesearchmedinp, input.med_date, input.dosage, input.comment, input.med, select.user_selector, select.user_selector_schmerze').live('change keyup', function(){

		      if($(this).hasClass('livesearchmedinp')){
			      var input_row = parseInt($(this).attr('id').substr(('medication').length)); //med name
		      } else if($(this).hasClass('med_date')) {
			      var input_row = parseInt($(this).attr('id').substr(('med_date').length)); //change date
		      } else if($(this).hasClass('dosage')) {
			      var input_row = parseInt($(this).attr('id').substr(('dosage').length)); //dosage
		      } else if($(this).hasClass('comment') || $(this).hasClass('med')) {
			      var input_row = parseInt($(this).attr('id').substr(('comment').length)); //comment
		      } else if ($(this).hasClass('user_selector')) {
			      var input_row = parseInt($(this).attr('id').substr(('verordnetvon-').length)); //user selector
		      } else if ($(this).hasClass('user_selector_schmerze')) {
			      var input_row = parseInt($(this).attr('id').substr(('add_schmerze-verordnetvon-').length)); //user selector schmerzepumpe
		      }
		      $('#edited' + input_row).val('1');
	      });

		$('.med_date').datepicker({
			dateFormat: 'dd.mm.yy',
			buttonImageOnly: true,
			changeMonth: true,
			changeYear: true,
			nextText: '',
			prevText: '',
			onSelect: function(){
				var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
				$('#edited' + input_row).val('1');
				
				changes = true;
			}
		});

		$(".med_date").mask("99.99.9999");
	        $('textarea').elastic();

		//livesearch medications
		$('.livesearchmedinp').live('change', function() {
			var input_row = parseInt($(this).attr('id').substr(('medication').length));
			reset_medications(input_row);
			
		}).liveSearch({
			url: 'ajax/medications?q=',
			id: 'livesearch_admission_medications',
			aditionalWidth: '300',
			noResultsDelay: '900',
			typeDelay: '900',
			returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
		});

		$(".renew_ajx, .renew_ajx_bedarfs, .renew_ajx_ivmeds, .renew_ajx_schmerz").live('click', function(e){

			e.preventDefault();
			medcount++;
			//get row id
			var tridrn = $(this).closest('tr').attr('id');

			//get medication edit count rows
			var cntren = Number(medcount) +1;
			//split row id and get numeric medis id
			var id = tridrn.split('_');
			var that = $(this);
			$("#"+tridrn).each(function() {
				var dateren = "<?php echo date('d.m.Y')?>";
				var medsren = $(this).find(".medsrn_"+id[2]).text();
				var pid = "<?php echo $_GET['id']; ?>";
				var dsgren = $(this).find(".dsgrn_"+id[2]).text();
				var commren = $(this).find(".commrn_"+id[2]).text();
				var usrnameren = $(this).find(".usrnamern_"+id[2]).text();
				var usr_addren = $(this).find(".usr_id_add_"+id[2]).text();
				var hidd_medisren = $(this).find(".hidd_medicationrn_"+id[2]).text();
				var usrren = $(this).find(".usrid_"+id[2]).text();
				var users = <?php echo  $this->jsusers; ?>;
				var options = '';
				var i = 1;

				$.each(users, function(key, value){
					if(key == usrren){
						options += "<option selected=\"selected\" value=\""+key+"\">"+value+"</option>"
					} else {
						options += "<option value=\""+key+"\">"+value+"</option>"
					}
				});

				/*========= MEDICATION RENEW =============*/
				if($(that).hasClass('renew_ajx')) {
					var trrenewNou = "<tr id=\"line_"+id[2]+"\" alt=\""+cntren+"\"><td align=\"left\" class=\"date_line_"+id[2]+"\" valign=\"top\">\n\
							<input name=\"medication_change["+cntren+"]\" id=\"medication_change_"+id[2]+"\" class=\"med_date date_line_"+id[2]+"\" value=\""+dateren+"\"  rel=\"med_date"+cntren+"\" >\n\
							<input name=\"replace_with["+cntren+"]\"   value=\"change\" type=\"hidden\"></td><td align=\"left\" valign=\"top\">\n\
							<input name=\"medication["+cntren+"]\" value=\""+medsren+"\" id=\"medication"+cntren+"\" type=\"text\" class=\"livesearchmedinp med meds_line_"+id[2]+"\">\n\
							<input name=\"hidd_medication["+cntren+"]\" value=\""+hidd_medisren+"\" id=\"hidd_medication"+cntren+"\" type=\"hidden\">\n\
							<input type=\"hidden\" id=\"drid\" name=\"drid["+cntren+"]\" value=\""+id[2]+"\">\n\
							<input type=\"hidden\" id=\"edited"+cntren+"\" name=\"edited["+cntren+"]\" value=\"0\" /></td><td align=\"left\" valign=\"top\">\n\
							<input name=\"dosage["+cntren+"]\" id=\"dosage"+cntren+"\" class=\"dosage dsg_line_"+id[2]+"\" value=\""+dsgren+"\"></td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
							<input name=\"comments["+cntren+"]\" class=\"med comm_line_"+id[2]+"\" value=\""+commren+"\" id=\"comment"+cntren+"\"></td><td width=\"120\" id=\"line_"+id[2]+"_row\" align=\"left\" valign=\"top\" class=\"usrname_line_"+id[2]+"\">"+usrnameren+"</td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
							<select name=\"verordnetvon["+cntren+"]\" id=\"verordnetvon-"+cntren+"\" class=\"user_selector\">"+options+"</select>\n\
							</td><td align=\"left\" valign=\"top\"><div style=\"float:left;\"><a href=\"javascript:void(0)\" class=\"remove_tr\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_delete.png\"  border=\"0\"></a></div></td></tr>";
					var ls_field_id = cntren;
					$("#listpatientmedicationedit_medicationtable").append(trrenewNou);
					$('#medication_change_'+id[2]).datepicker({
						dateFormat: 'dd.mm.yy',
						buttonImageOnly: true,
						changeMonth: true,
						changeYear: true,
						nextText: '',
						prevText: '',
						onSelect: function(){
							var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
							$('#edited' + input_row).val('1');
							changes = true;
						}
					});

				/*========= BEDARF MEDICATION RENEW =============*/

				} else if($(that).hasClass('renew_ajx_bedarfs')) {
					var trrenewNou = "<tr id=\"line_"+id[2]+"\" alt=\""+cntren+"\"><td align=\"left\" class=\"date_line_"+id[2]+"\" valign=\"top\">\n\
					<input name=\"medication_change["+cntren+"]\" id=\"medication_b_change_"+id[2]+"\" class=\"med_date date_line_"+id[2]+"\" value=\""+dateren+"\" rel=\"med_date"+cntren+"\" >\n\
					<input name=\"replace_with["+cntren+"]\"   value=\"change\" type=\"hidden\"></td><td align=\"left\" valign=\"top\">\n\
					<input name=\"medication["+cntren+"]\" value=\""+medsren+"\" id=\"medication"+cntren+"\" type=\"text\" class=\"livesearchmedinp med meds_line_"+id[2]+"\">\n\
					<input name=\"hidd_medication["+cntren+"]\" value=\""+hidd_medisren+"\" id=\"hidd_medication"+cntren+"\" type=\"hidden\">\n\
					<input type=\"hidden\" id=\"drid\" name=\"drid["+cntren+"]\" value=\""+id[2]+"\">\n\
					<input type=\"hidden\" id=\"edited"+cntren+"\" name=\"edited["+cntren+"]\" value=\"0\" /></td><td align=\"left\" valign=\"top\">\n\
					<input name=\"dosage["+cntren+"]\" id=\"dosage"+cntren+"\" class=\"dosage dsg_line_"+id[2]+"\" value=\""+dsgren+"\"></td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
					<input name=\"comments["+cntren+"]\" class=\"med comm_line_"+id[2]+"\" value=\""+commren+"\" id=\"comment"+cntren+"\"></td><td width=\"120\" id=\"line_"+id[2]+"_row\" align=\"left\" valign=\"top\" class=\"usrname_line_"+id[2]+"\">"+usrnameren+"</td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
					<select name=\"verordnetvon["+cntren+"]\" id=\"verordnetvon-"+cntren+"\" class=\"user_selector\">"+options+"</select></td><td align=\"left\" valign=\"top\"><div style=\"float:left;\"><a href=\"javascript:void(0)\" class=\"remove_tr_bedarf\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_delete.png\"  border=\"0\"></a></div></td></tr>";
					var ls_field_id = cntren;

					$("#listpatientmedicationedit_bedarfsmedicationtable").append(trrenewNou);
					$('#medication_b_change_'+id[2]).datepicker({
						dateFormat: 'dd.mm.yy',
						buttonImageOnly: true,
						changeMonth: true,
						changeYear: true,
						nextText: '',
						prevText: '',
						onSelect: function(){
							var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
							$('#edited' + input_row).val('1');
							changes = true;
						}
					});

				/*========= SCHMERZ MEDICATION RENEW =============*/
				} else if($(that).hasClass('renew_ajx_schmerz')) {
					var trrenewNou = "<tr id=\"medadd_schmerze"+id[2]+"\" alt=\""+id[2]+"\">\n\
				<td align=\"left\" class=\"date_medadd_schmerze"+id[2]+"\" valign=\"top\">\n\
				<input name=\"add_schmerze[medication_change]["+id[2]+"]\" id=\"medication_sc_change_"+id[2]+"\" class=\"med_date date_line_"+id[2]+"\" value=\""+dateren+"\" rel=\"med_date"+cntren+"\" >\n\
				<input name=\"add_schmerze[replace_with]["+id[2]+"]\" value=\"change\" rel=\"med_date"+cntren+"\" type=\"hidden\"></td>\n\
							<td align=\"left\" valign=\"top\">\n\
					<input name=\"add_schmerze[medication]["+id[2]+"]\" value=\""+medsren+"\" id=\"medication"+id[2]+"\" type=\"text\" class=\"livesearchmedinp med meds_medadd_schmerze"+id[2]+"\" rel=\""+cntren+"\">\n\
								<input name=\"add_schmerze[hidd_medication]["+id[2]+"]\" value=\""+hidd_medisren+"\" id=\"hidd_medication"+id[2]+"\" type=\"hidden\">\n\
					<input type=\"hidden\" id=\"drid"+id[2]+"\" name=\"add_schmerze[drid]["+id[2]+"]\" value=\""+id[2]+"\">\n\
					<input type=\"hidden\" id=\"edited"+cntren+"\" name=\"edited["+cntren+"]\" value=\"0\" /></td>\n\
					<td align=\"left\" valign=\"top\">\n\
					<input name=\"add_schmerze[dosage]["+id[2]+"]\" id=\"dosage"+cntren+"\" class=\"dosage dsg_medadd_schmerze"+id[2]+"\" value=\""+dsgren+"\">\n\
							</td>\n\
							<td width=\"120\" align=\"left\" valign=\"top\" class=\"usrname_medadd_schmerze"+id[2]+"\">"+usrnameren+"</td>\n\
							<td align=\"left\" valign=\"top\"><select name=\"verordnetvon["+id[2]+"]\" id=\"add_schmerze-verordnetvon-"+id[2]+"\" class=\"user_selector\">"+options+"</select></td>\n\<td><a href=\"javascript:void(0)\" onclick=\"delmedicationRow('"+id[2]+"', '"+idpd+"')\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_delete.png\" border=\"0\" class=\"remove_tr_schmerze\" /></a>\n\
							</td>\n\
							</tr>";
					$(trrenewNou).insertBefore('#cDetails');

					var ls_field_id = id[2];
					$('#medication_sc_change_'+id[2]).datepicker({
					dateFormat: 'dd.mm.yy',
					buttonImageOnly: true,
					changeMonth: true,
					changeYear: true,
					nextText: '',
						prevText: '',
						onSelect: function(){
							var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
							$('#edited' + input_row).val('1');
							changes = true;
						}
				});

				/*========= IV MEDICATION RENEW =============*/


				} else if($(that).hasClass('renew_ajx_ivmeds')) {
					var trrenewNou = "<tr id=\"line_"+id[2]+"\" alt=\""+cntren+"\"><td align=\"left\" class=\"date_line_"+id[2]+"\" valign=\"top\">\n\
							<input name=\"medication_change["+cntren+"]\" id=\"medication_iv_change_"+id[2]+"\" class=\"med_date date_line_"+id[2]+"\" value=\""+dateren+"\"  rel=\"med_date"+cntren+"\" >\n\
							<input name=\"replace_with["+cntren+"]\"   value=\"change\" type=\"hidden\"></td><td align=\"left\" valign=\"top\">\n\
							<input name=\"medication["+cntren+"]\" value=\""+medsren+"\" id=\"medication"+cntren+"\" type=\"text\" class=\"livesearchmedinp med meds_line_"+id[2]+"\">\n\
							<input name=\"hidd_medication["+cntren+"]\" value=\""+hidd_medisren+"\" id=\"hidd_medication"+cntren+"\" type=\"hidden\">\n\
							<input type=\"hidden\" id=\"drid\" name=\"drid["+cntren+"]\" value=\""+id[2]+"\">\n\
							<input type=\"hidden\" id=\"edited"+cntren+"\" name=\"edited["+cntren+"]\" value=\"0\" /></td><td align=\"left\" valign=\"top\">\n\
							<input name=\"dosage["+cntren+"]\" id=\"dosage"+cntren+"\" class=\"dosage dsg_line_"+id[2]+"\" value=\""+dsgren+"\"></td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
							<input name=\"comments["+cntren+"]\" class=\"med comm_line_"+id[2]+"\" value=\""+commren+"\" id=\"comment"+cntren+"\" /></td><td width=\"120\" id=\"line_"+id[2]+"_row\" align=\"left\" valign=\"top\" class=\"usrname_line_"+id[2]+"\">"+usrnameren+"</td><td align=\"left\" id=\"line_"+id[2]+"_row\" valign=\"top\">\n\
							<select name=\"verordnetvon["+cntren+"]\" id=\"verordnetvon-"+cntren+"\" class=\"user_selector\" >"+options+"</select></td><td align=\"left\" valign=\"top\"><div style=\"float:left;\"><a href=\"javascript:void(0)\" class=\"remove_tr_iv\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_delete.png\"  border=\"0\"></a></div></td></tr>";
					$("#listpatientmedicationedit_ivmedicationtable").append(trrenewNou);
					var ls_field_id = cntren;
					$('#medication_iv_change_'+id[2]).datepicker({
						dateFormat: 'dd.mm.yy',
						buttonImageOnly: true,
						changeMonth: true,
						changeYear: true,
						nextText: '',
						prevText: '',
						onSelect: function(){
							var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
							$('#edited' + input_row).val('1');
							changes = true;
						}
					});
				}

				$('#medication'+ls_field_id).bind('keyup keydown change paste',function(){
					//livesearch medications ls
					$(this).live('keydown paste', function() {
						var input_row = parseInt($(this).attr('id').substr(('medication').length));
						reset_medications(input_row);
					}).liveSearch({
						url: 'ajax/medications?q=',
						id: 'livesearch_admission_medications',
						aditionalWidth: '300',
						noResultsDelay: '900',
						typeDelay: '900',
						returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
					});
				});

				$('#jsmedadd').val(cntren);
				renewMedicationKvno(id[2], pid);
				var medsren = '';
			});
		});



		/*========= REMOVE MEDICATION RENEW =============*/
		$(".remove_tr").live('click', function(){
			var trid = $(this).closest('tr').attr('id');
			var cnt = $("#"+trid).attr('alt');
			var id = trid.split('_');
			var pid = "<?php echo $_GET['id']; ?>";

			$("#"+trid).each(function() {
				var date = "<?php echo date('d.m.Y')?>";
				var meds = $(this).find(".meds_"+trid).val();
				var dsg = $(this).find(".dsg_"+trid).val();
				var comm = $(this).find(".comm_"+trid).val();
				var hidd_medis = $(this).find("#hidd_medication"+cnt).val();
				var usr_add = $(this).find(".usrname_"+trid).text();
				var usr = $(this).find("#verordnetvon-"+cnt+" option:selected").text();
				var usr_id = $(this).find("#verordnetvon-"+cnt+" option:selected").val();
				var trnou = "<tr class=\"row\" id=\"line_r_"+id[1]+"\"><td height=\"20\" align=\"left\" class=\"datern_"+id[1]+"\" valign=\"top\">"+date+"</td><td height=\"20\" align=\"left\" valign=\"top\" class=\"hidd_medicationrn_"+id[1]+"\" style=\"display: none;\">"+hidd_medis+"</td><td align=\"left\" valign=\"top\" class=\"medsrn_"+id[1]+"\"><font color=\"#777777\">"+meds+"</font> </td><td align=\"left\" valign=\"top\" class=\"dsgrn_"+id[1]+"\">"+dsg+"</td><td align=\"left\" valign=\"top\" class=\"commrn_"+id[1]+"\">"+comm+"</td><td align=\"left\" valign=\"top\"><a href=\"javascript:void(0)\" class=\"renew_ajx\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_renew.png\" border=\"0\"></a></td><td height=\"20\" align=\"left\" valign=\"top\" class=\"usrnamern_"+id[1]+"\">"+usr_add+"</td><td height=\"20\" align=\"left\" valign=\"top\">"+usr+"</td><td valign=\"top\" height=\"20\" align=\"left\" class=\"usrid_"+id[1]+"\" style=\"display:none;\">"+usr_id+"</td></tr>";
				$("#listpatientmedication_contenttabel").append(trnou);
				removeMedicationKvno(id[1],pid);
			});

		});

		/*======================= REMOVE IV MEDICATION ROW ======================================*/
		$(".remove_tr_iv").live('click', function(){
			var trid = $(this).closest('tr').attr('id');
			var cnt = $("#"+trid).attr('alt');
			var id = trid.split('_');
			var pid = "<?php echo $_GET['id']; ?>";

			$("#"+trid).each(function() {
				var date = "<?php echo date('d.m.Y')?>";
				var meds = $(this).find(".meds_"+trid).val();
				var dsg = $(this).find(".dsg_"+trid).val();
				var comm = $(this).find(".comm_"+trid).val();
				var hidd_medis = $(this).find("#hidd_medication"+cnt).val();
				var usr_add = $(this).find(".usrname_"+trid).text();
				var usr = $(this).find("#verordnetvon-"+cnt+" option:selected").text();
				var usr_id = $(this).find("#verordnetvon-"+cnt+" option:selected").val();

				var trnou = "<tr class=\"row\" id=\"line_r_"+id[1]+"\"><td height=\"20\" align=\"left\" class=\"datern_"+id[1]+"\" valign=\"top\">"+date+"</td><td height=\"20\" align=\"left\" valign=\"top\" class=\"hidd_medicationrn_"+id[1]+"\" style=\"display: none;\">"+hidd_medis+"</td><td align=\"left\" valign=\"top\" class=\"medsrn_"+id[1]+"\"><font color=\"#777777\">"+meds+"</font> </td><td align=\"left\" valign=\"top\" class=\"dsgrn_"+id[1]+"\">"+dsg+"</td><td align=\"left\" valign=\"top\" class=\"commrn_"+id[1]+"\">"+comm+"</td><td align=\"left\" valign=\"top\"><a href=\"javascript:void(0)\" class=\"renew_ajx_ivmeds\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_renew.png\" border=\"0\"></a></td><td height=\"20\" align=\"left\" valign=\"top\" class=\"usrnamern_"+id[1]+"\">"+usr_add+"</td><td height=\"20\" align=\"left\" valign=\"top\">"+usr+"</td><td valign=\"top\" height=\"20\" align=\"left\" class=\"usrid_"+id[1]+"\" style=\"display:none;\">"+usr_id+"</td></tr>";
				$("#listpatientmedication_contenttabel").append(trnou);
				removeMedicationKvno(id[1],pid);
			});

		});



		/*======================= REMOVE BEDARF MEDICATION ROW ======================================*/
		$(".remove_tr_bedarf").live('click', function(){
			var trid = $(this).closest('tr').attr('id');
			var cnt = $("#"+trid).attr('alt');
			var id = trid.split('_');
			var pid = "<?php echo $_GET['id']; ?>";

			$("#"+trid).each(function() {
				var date = "<?php echo date('d.m.Y')?>";
				var meds = $(this).find(".meds_"+trid).val();
				var dsg = $(this).find(".dsg_"+trid).val();
				var comm = $(this).find(".comm_"+trid).val();
				var hidd_medis = $(this).find("#hidd_medication"+cnt).val();
				var usr_add = $(this).find(".usrname_"+trid).text();
				var usr = $(this).find("#verordnetvon-"+cnt+" option:selected").text();
				var usr_id = $(this).find("#verordnetvon-"+cnt+" option:selected").val();

				var trnou = "<tr class=\"row\" id=\"line_r_"+id[1]+"\"><td height=\"20\" align=\"left\" class=\"datern_"+id[1]+"\" valign=\"top\">"+date+"</td><td height=\"20\" align=\"left\" valign=\"top\" class=\"hidd_medicationrn_"+id[1]+"\" style=\"display: none;\">"+hidd_medis+"</td><td align=\"left\" valign=\"top\" class=\"medsrn_"+id[1]+"\"><font color=\"#777777\">"+meds+"</font> </td><td align=\"left\" valign=\"top\" class=\"dsgrn_"+id[1]+"\">"+dsg+"</td><td align=\"left\" valign=\"top\" class=\"commrn_"+id[1]+"\">"+comm+"</td><td align=\"left\" valign=\"top\"><a href=\"javascript:void(0)\" class=\"renew_ajx_bedarfs\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_renew.png\" border=\"0\"></a></td><td height=\"20\" align=\"left\" valign=\"top\" class=\"usrnamern_"+id[1]+"\">"+usr_add+"</td><td height=\"20\" align=\"left\" valign=\"top\">"+usr+"</td><td valign=\"top\" height=\"20\" align=\"left\" class=\"usrid_"+id[1]+"\" style=\"display:none;\">"+usr_id+"</td></tr>";
				$("#listpatientmedication_contenttabel").append(trnou);
				removeMedicationKvno(id[1],pid);
			});

		});


		/*======================= REMOVE SCHMERZPUMP MEDICATION ROW ======================================*/
		$(".remove_tr_schmerze").live('click', function(){
			var trid = $(this).closest('tr').attr('id');
			var cnt = $("#"+trid).attr('alt');
			var id = trid.split('medadd_schmerze');

			var pid = "<?php echo $_REQUEST['id']; ?>";


			$("#"+trid).each(function() {
				var date = "<?php echo date('d.m.Y')?>";
				var meds = $(this).find(".meds_"+trid).val();
				var dsg = $(this).find(".dsg_"+trid).val();

				var comm = '';
				var hidd_medis = $(this).find("#hidd_medication"+cnt).val();
				var drid = $(this).find("#drid"+cnt).val();
				var usr_add = $(this).find(".usrname_"+trid).text();
				var usr = $(this).find("#add_schmerze-verordnetvon-"+cnt+" option:selected").text();
				var usr_id = $(this).find("#add_schmerze-verordnetvon-"+cnt+" option:selected").val();

				var trnou = "<tr class=\"row\" id=\"line_r_"+drid+"\"><td height=\"20\" align=\"left\" class=\"datern_"+drid+"\" valign=\"top\">"+date+"</td><td height=\"20\" align=\"left\" valign=\"top\" class=\"hidd_medicationrn_"+drid+"\" style=\"display: none;\">"+hidd_medis+"</td>\n\
						<td class=\"drid"+drid+"\" style=\"display: none;\">"+drid+"</td>\n\
						<td align=\"left\" valign=\"top\" class=\"medsrn_"+drid+"\"><font color=\"#777777\">"+meds+"</font> </td><td align=\"left\" valign=\"top\" class=\"dsgrn_"+drid+"\">"+dsg+"</td><td align=\"left\" valign=\"top\" class=\"commrn_"+drid+"\">"+comm+"</td><td align=\"left\" valign=\"top\"><a href=\"javascript:void(0)\" class=\"renew_ajx_schmerz\"><img src=\"<?php echo RES_FILE_PATH; ?>/images/action_renew.png\" border=\"0\"></a></td><td height=\"20\" align=\"left\" valign=\"top\" class=\"usrnamern_"+drid+"\">"+usr_add+"</td><td height=\"20\" align=\"left\" valign=\"top\">"+usr+"</td><td valign=\"top\" height=\"20\" align=\"left\" class=\"usrid_"+drid+"\" style=\"display:none;\">"+usr_id+"</td></tr>";
				$("#listpatientmedication_contenttabel").append(trnou);
				$("#medadd_schmerze"+id[1]).remove();
	    });
		});
	    });
//medications


	// make the textarea grow
	$(function() {
		$('textarea').elastic();
	});

	function getSelected(dbvalue,fieldname)
	{
		var fieldarray = document.getElementsByName(fieldname);
		for(i=0; i<fieldarray.length;i++)
		{
			if(fieldarray[i].value==dbvalue)
			{
				fieldarray[i].checked = true;
			}
		}
	}

	function showbox(val)
	{
		if(val.value=="4")
		{
			$("#otherdivid").show();
		}else{
			$("#otherdivid").hide();
		}
	}

	function isInteger(k)
	{
	 	var s = document.getElementById('input_value'+k).value;
	 	var chars = "0123456789";

	 	if(s>10)
	 	{
			document.getElementById('input_value'+k).value = "";
			return false;
	 	}

	 	var i;
	 	s = s.toString();
		for (i = 0; i < s.length; i++)
		{
			var c = s.charAt(i);
			if (chars.indexOf(c)==-1)
			{
	 			document.getElementById('input_value'+k).value = "";
	 			return false;
			}
		}
		return true;
	}
	
	function isIntegerServices(k)
	{
	 	var s = document.getElementById('inputvalue'+k).value;
	 	var chars = "0123456789";

	 	if(s>10)
	 	{
			document.getElementById('inputvalue'+k).value = "";
			return false;
	 	}

	 	var i;
	 	s = s.toString();
		for (i = 0; i < s.length; i++)
		{
			var c = s.charAt(i);
			if (chars.indexOf(c)==-1)
			{
	 			document.getElementById('inputvalue'+k).value = "";
	 			return false;
			}
		}
		return true;
	}
	
	//weird "leave page" function
	var dontLeave = function(e) {
		if (changes === true && submited === false) {
			return "<?php echo $this->translate('no_save_leave_alert'); ?>";
		}
	}

	window.onbeforeunload = dontLeave;

	$(document).ready(function(){
		// TODO-1211
 		if(route_error == 1){
 			alert('<?php echo $this->translate('route_calculation_error'); ?>')
 		}
 		
		//allow submit without "leave page" alert
		$('#submitform,#pdfexport').live('click', function() {
			submited = true;
			changes = false;
		});
		
		 $('input,textarea,select').live('change',function(){
		//console.log($(this).val());
		submited = false;
		changes = true;
		}) ;
		
		 $( ".datepick" ).datepicker({
				dateFormat: 'dd.mm.yy',
				showOn: "both",
				buttonImage: $('#calImg').attr('src'),
				buttonImageOnly: true,
				changeMonth: true,
				changeYear: true,
				nextText: '',
				prevText: ''
			}).mask("99.99.9999");

		$("#date").mask("99.99.9999");
		//init sapv checking with loaded data
		check_sapv();
		date_validations();

		$('*').keypress(function(event){
		        if(event.keyCode == 13 && event.target.nodeName!='TEXTAREA')
		        {
				event.preventDefault();
				return false;
		        }
		});

		//km distance validation
		if($('#fahrtstreke_km').length > 0)
		{
			$('#fahrtstreke_km').val($('#fahrtstreke_km').val().replace(',', '.').replace(/[^\d.]/g, ''));
		
			$('#fahrtstreke_km').keyup(function() {
				var $this = $(this);
				var $final_var = $this.val().replace(',', '.').replace(/[^\d.]/g, '');
				if($final_var >= '0')
				{
					$this.val($final_var);
				}
				else
				{
					$this.val('');
				}
			});
		}

		if($('#fahrtstreke_km1').length > 0)
		{
			$('#fahrtstreke_km1').val($('#fahrtstreke_km1').val().replace(',', '.').replace(/[^\d.]/g, ''));

			$('#fahrtstreke_km1').keyup(function() {
				var $this = $(this);
				var $final_var = $this.val().replace(',', '.').replace(/[^\d.]/ig, '');
				if($final_var >= '0')
				{
					$this.val($final_var);
				}
				else
				{
					$this.val('');
				}
			});
		}

		//**********************last checkbox row ***********************//

		var somatisch   =   ["1","2","4","5","6","7","8","10"];
		var koord   =   ["11","16","17"];
		var psycho   =   ["9","12","13","14","15"];
		var checkme = '';

	<?php if (empty($_REQUEST['cid'])): ?>
		$('#koord').attr('checked', true);
	<?php endif; ?>

		$(".kvnosymp_input").blur(function(){
			var sympid = $(this).attr('id').replace('input_value','');
			var somatisch_chk = 0;
			var koord_chk = 0;
			var psycho_chk = 0;

			$.each(somatisch, function(i, obj) {
				if($('#input_value' + obj).val() > 2){
					somatisch_chk = 1;
				}
			});


			$.each(psycho, function(i, obj) {
				if($('#input_value' + obj).val() > 2){
					psycho_chk = 1;
				}
			});

			$.each(koord, function(i, obj) {
				if($('#input_value' + obj).val() > 2){
					koord_chk = 1;
				}
			});

			if(somatisch_chk == 0 && psycho_chk == 0){
				koord_chk = 1;
			}

			if(somatisch_chk == 1){
				$('#somatisch').attr('checked', true)
				$('#koord').attr('checked', false)
			} else {
				$('#somatisch').attr('checked', false)
			}

			if(psycho_chk == 1){
				$('#psycho').attr('checked', true)
				$('#koord').attr('checked', false)
			} else {
				$('#psycho').attr('checked', false)
			}

			if(koord_chk == 1){
				$('#koord').attr('checked', true)
			}
		});

	$('#psycho').bind('click',function(){
		if($('#psycho').attr('checked') == true) {
			$('#koord').attr('checked', false)
		}
	});

	$('#ethisch').bind('click',function(){
		if($('#ethisch').attr('checked') == true) {
			$('#koord').attr('checked', false)
		}
	});

	$('#somatisch').bind('click',function(){
		if($('#somatisch').attr('checked') == true) {
			$('#koord').attr('checked', false)
		}
	});
//**********************last checkbox row end ***********************//


//**************************************** befund radio *********************************//
	if($('#kopfb:checked').val() == 2){
		$('#kopf_textdiv').show();
	}

	if($('#thoraxb:checked').val() == 2){
		$('#thorax_textdiv').show();
	}

	if($('#abdomenb:checked').val() == 2){
		$('#abdomen_textdiv').show();
	}

	if($('#extremitatenb:checked').val() == 2){
		$('#extremitaten_textdiv').show();
	}

	if($('#haut_wundenb:checked').val() == 2){
		$('#haut_wunden_textdiv').show();
	}

	if($('#neurologisch_psychiatrischb:checked').val() == 2){
		$('#neurologisch_psychiatrisch_textdiv').show();
	}

	$("input[name=kopf]").bind('click',function() {

		if($(this).val() == 2){
			$('#kopf_textdiv').show();
		} else {
			$('#kopf_text').val("");
			$('#kopf_textdiv').hide();
		}
	});
	$("input[name=thorax]").bind('click',function() {
		if($(this).val() == 2){
			$('#thorax_textdiv').show();
		} else {
			$('#thorax_text').val("");
			$('#thorax_textdiv').hide();
		}
	});
	$("input[name=abdomen]").bind('click',function() {
		if($(this).val() == 2){
			$('#abdomen_textdiv').show();
		} else {
			$('#abdomen_text').val("");
			$('#abdomen_textdiv').hide();
		}
	});
	$("input[name=extremitaten]").bind('click',function() {
		if($(this).val() == 2){
			$('#extremitaten_textdiv').show();
		} else {
			$('#extremitaten_text').val("");
			$('#extremitaten_textdiv').hide();
		}
	});
	$("input[name=haut_wunden]").bind('click',function() {
		if($(this).val() == 2){
			$('#haut_wunden_textdiv').show();
		} else {
			$('#haut_wunden_text').val("");
			$('#haut_wunden_textdiv').hide();
		}
	});
	$("input[name=neurologisch_psychiatrisch]").bind('click',function() {
		if($(this).val() == 2){
			$('#neurologisch_psychiatrisch_textdiv').show();
		} else {
			$('#neurologisch_psychiatrisch_text').val("");
			$('#neurologisch_psychiatrisch_textdiv').hide();
		}
	});
//***************************************** befund radio end ***********************************//

//**************************************** Stammdaten checkboxes *********************************//
            // port
	    if($('#kvno_port_notok:checked').val() == 2){
				$('#kvno_port_textdiv').show();
			}

			$("input[name=kvno_port]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_port_textdiv').show();
				} else {
					$('#kvno_port_text').val("");
					$('#kvno_port_textdiv').hide();
				}
			});

			// besonderer Aus-/ Eingang
			if($('#kvno_kunstliche_notok:checked').val() == 2){
				$('#kvno_kunstliche_textdiv').show();
			}

			$("input[name=kvno_kunstliche]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_kunstliche_textdiv').show();
				} else {
					$('#kvno_kunstliche_text').val("");
					$('#kvno_kunstliche_textdiv').hide();
				}
			});

			//Pumps
			if($('#kvno_pumpe_notok:checked').val() == 2){
				$('#kvno_pumps_textdiv').show();
			}

			$("input[name=kvno_pumps]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_pumps_textdiv').show();
				} else {
					$('#kvno_pumps_text').val("");
					$('#kvno_pumps_textdiv').hide();
				}
			});

			//DK
			if($('#kvno_dauerkatheter_notok:checked').val() == 2){
				$('#kvno_dk_textdiv').show();
			}

			$("input[name=kvno_dk]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_dk_textdiv').show();
				} else {
					$('#kvno_dk_text').val("");
					$('#kvno_dk_textdiv').hide();
				}
			});

			// Peg
			if($('#kvno_peg_notok:checked').val() == 2){
				$('#kvno_peg_textdiv').show();
			}

			$("input[name=kvno_peg]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_peg_textdiv').show();
				} else {
					$('#kvno_peg_text').val("");
					$('#kvno_peg_textdiv').hide();
				}
			});

			// Darm
			if($('#kvno_darm_notok:checked').val() == 2){
				$('#kvno_darm_textdiv').show();
			}

			$("input[name=kvno_darm]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_darm_textdiv').show();
				} else {
					$('#kvno_darm_text').val("");
					$('#kvno_darm_textdiv').hide();
				}
			});

			//Blase
			if($('#kvno_blase_notok:checked').val() == 2){
				$('#kvno_blase_textdiv').show();
			}

			$("input[name=kvno_blase]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_blase_textdiv').show();
				} else {
					$('#kvno_blase_text').val("");
					$('#kvno_blase_textdiv').hide();
				}
			});

			//Luftrohre
			if($('#kvno_luftrohre_notok:checked').val() == 2){
				$('#kvno_luftrohre_textdiv').show();
			}

			$("input[name=kvno_luftrohre]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_luftrohre_textdiv').show();
				} else {
					$('#kvno_luftrohre_text').val("");
					$('#kvno_luftrohre_textdiv').hide();
				}
			});

			//Ablaufsonde
			if($('#kvno_ablaufsonde_notok:checked').val() == 2){
				$('#kvno_ablaufsonde_textdiv').show();
			}

			$("input[name=kvno_ablaufsonde]").bind('click',function() {

				if($(this).val() == 2){
					$('#kvno_ablaufsonde_textdiv').show();
				} else {
					$('#kvno_ablaufsonde_text').val("");
					$('#kvno_ablaufsonde_textdiv').hide();
				}
			});
//*****************************************Stammdaten checkboxes  end ***********************************//


//*****************************************Duplicate visits ***********************************//
		$('#duplicate_visits').dialog({
			autoOpen: false,
			title: '<?php echo $this->translate('overlapping_event_modal_title'); ?>',
			modal: true,
			buttons: {
				"<?php echo $this->translate('noconfirm'); ?>": function() {
					$('#submitform').attr('disabled',false);
					$( this ).dialog( "close" );
				},
				"<?php echo $this->translate('yesconfirm'); ?>": function() {
					$('#submitform').attr('disabled',true);

					 $('.asubmitform').attr('disabled',true);
					 $(".ui-button:first").attr("disabled", true)
					 .addClass("ui-state-disabled").next("button").attr("disabled", true)
					 .addClass("ui-state-disabled");

					 $(":button:contains('Ja')").attr("disabled",true).addClass( 'ui-state-disabled' );
					 $(":button:contains('Nein')").remove();
					 $(":button:contains('Ja')").remove();
					 
					 var nein = '<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-disabled" role="button" disabled="disabled"><span class="ui-button-text">Nein</span></button>';
					 var ja = '<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only ui-state-disabled" role="button" disabled="disabled"><span class="ui-button-text">Ja</span></button>';
					$('.ui-dialog-buttonpane').html('<div class="ui-dialog-buttonset">'+nein+ja+'</div>');
					
					
					$('#contact_form').submit();
				}
			},
			create:function () {
		        $(this).closest(".ui-dialog")
		            .find(".ui-button:first") // the first button
		            .addClass("asubmitform");
		    },
		    close:function () {
		    	$('.asubmitform').attr('disabled',false),
				 $(".ui-button:first").attr("disabled", false)
				 .removeClass("ui-state-disabled").next("button").attr("disabled", false)
				 .removeClass("ui-state-disabled");
			}
		});

		function rowBuilder(that) {
			return '<tr>'
				+'<td>'+that.id+'</td>'
				+'<td>'+that.user_details.first_name+ ' ' + that.user_details.last_name +'</td>'
				+'<td>'+that.start_date+'</td>'
				+'<td>'+that.end_date+'</td>'
				+'</tr>';
		}

		$('#pdfexport').bind('click', function() {
			setTimeout(function () {$('input[type=submit]').attr('disabled', true);}, 150);
			setTimeout(function () {$('input[type=submit]').attr('disabled', false);}, 8000);
		});
		
			
		
		$('#pdfexport').bind('click', function(event) {
			event.preventDefault();
			$(document).userSession().checksession('abort', function(result) { // new function
				if(result === false) {
					event.stopImmediatePropagation(); //stop going forward
				} else {
					$('#generate_pdf').val('1');
			
					$('#submitform').attr('disabled',true);
					$('#save_create_doctorletter').attr('disabled',true);
					$('#save_visit_edit_letter').attr('disabled',true);
					$('#pdfexport').attr('disabled',true);
					$('#contact_form').submit();
				}
			}); // new function end
		});
		
		$('#pdfexport').bind('click', function() {
			setTimeout(function () {$('button[type=button]').attr('disabled', true);}, 150);
			setTimeout(function () {
				$('button[type=button]').attr('disabled', false);
				$('#generate_pdf').val('');
			}, 6000);
		});
		
		
		
		$('#submitform').bind('click', function(event) { //new function
			event.preventDefault();
			$(document).userSession().checksession('abort', function(result) {
				if(result === false) {
					event.stopImmediatePropagation(); //stop going forward
				} else {
					date_validations()
					var error = 0;
					var ajax_done = 0;
		
					$("input[name=kvno_medizini_a]:checked").each(function(){
						if($(this).val() ==  3){
							if($("textarea[name=kvno_sonstiges]").val().length == 0){
								error = 1;
							}
						}
					});
		
// 					if($('#begin_date_h').val() > $('#end_date_h').val()) {
// 						error = 2;
// 					}
		
		
// 					if($('#begin_date_h').val() == $('#end_date_h').val()) {
// 						if($('#begin_date_m').val() >= $('#end_date_m').val()) {
// 							error = 3;
// 						}
// 					}
		
		
// 					if($('#date').val() == '') {
// 						error = 4;
// 					}
		
// 					if($('#begin_date_h').val() == "" || $('#end_date_h').val() == "" || $('#begin_date_m').val() == "" || $('#end_date_m').val() == "") {
// 						error = 5;
// 					}
		
// 					if(error == 1) {
// 						jAlert('Bitte füllen Sonstiges / Kommentar');
// 						return false;
// 					} else if(error == 2) {
// 						jAlert('Die Zeit der Beendigung des Besuchs sollte später sein als die Anfangszeit.');
// 						return false;
// 					} else if(error == 3) {
// 						jAlert('Die Zeit der Beendigung des Besuchs sollte später sein als die Anfangszeit.');
// 						return false;
// 					} else if(error == 4) {
// 						jAlert('Bitte füllen Beginn datum');
// 						return false;
// 					}else if(error == 5) {
// 						jAlert('Bitte füllen zeit');
// 						return false;
// 					}
		
					if(error == '0'){
						$.ajax({
							type: 'POST',
							url: 'ajax/overlappingcheck?id=<?php echo $_REQUEST['id']; ?>&uid=<?php echo $this->user_id;?>',
							data: {
								visit_type: 'CF',
								begin_h: $('#begin_date_h').val(),
								begin_m: $('#begin_date_m').val(),
								end_h: $('#end_date_h').val(),
								end_m: $('#end_date_m').val(),
								visit_start: $('#date').val(),
								over_midnight: $('#over_midnight').val(),
								edit_id: '<?php if (!empty($_REQUEST['cid'])): echo $_REQUEST['cid']; else: echo '0';	endif; ?>'
		
							},
							beforeSend:function(){
								//				loading image
								$('#submitform').attr('disabled',true);
								$('#submitform').addClass('loading_button');
								$('#pdfexport').attr('disabled',true);
								$('#pdfexport').addClass('loading_button');
								
								$('#save_visit').val(''); //just precaution
								$('#generate_pdf').val('');
							},
							success:function(data){
								$('button#submitform').removeClass('loading_button');
								$('div.error_fetching').remove();
								$('#submitform').attr('disabled',false);
								$('#pdfexport').attr('disabled',false);
								$('button#pdfexport').removeClass('loading_button');
		
								$('#save_visit').val('1');
								$('#generate_pdf').val('');
								
								var visitdata = jQuery.parseJSON(data);
		
								$('#visits_body').html(''); //reset table tbody
		

								if(visitdata.error != 0)
								{
									jAlert(visitdata.error);
									return false;
								} 
								else if(visitdata.error == 0 && visitdata.confirmation != 0)
								{
									jConfirm(visitdata.confirmation, '<?php echo $this->translate("atention"); ?>', function(r) {
										if(r)
										{
		
											$('#over_midnight').val('1');
											$('#submitform').attr('disabled',true);
											$('#pdfexport').attr('disabled',true);
											$('#contact_form').submit();		
										} 
										else 
										{
											$('#over_midnight').val('0');
											$('.billable_days_option').hide();
											$('.billable_days_option').html('');
											jAlert(visitdata.denied_confirmation);
											return false;
										}
									}); 
								} 
								else
								{
									if(visitdata.intersected == 1){
									$('#duplicate_visits').dialog('open');
									return false; // used with modal
		
								} else {
									$('#submitform').attr('disabled',true);
									$('#pdfexport').attr('disabled',true);
										$('#contact_form').submit();
									}
								}
							},
							error:function(){
								ajax_done = 1;
								// failed request; give feedback to user
							}
						});
					}
				}
			});
		});

		$('select').change(function(){
			$('#submitform').attr('disabled',false);
		});

		/*--------------------------------------------------------------------------------------------------------*/
		/*---------------------------------------------------EBM------------------------------------------------*/
		/*----------------------------------------------------------------------------------------------------------*/
		function date_validations(){
			var  begin_date_h = $('#begin_date_h').val();
			var  begin_date_m = $('#begin_date_m').val();
			var  end_date_h = $('#end_date_h').val();
			var  end_date_m = $('#end_date_m').val();
			var  date =  $('#date').val();
			
// 			alert($('#begin_date_h').val());
// 			alert($('#end_date_h').val());
			
			if( begin_date_h  > end_date_h) 
			{
				$('#over_midnight').val('1');
			}
			else
			{
				$('#over_midnight').val('0');
			}
			
		}

		function midnight_validations(){
			var  begin_date_h = $('#begin_date_h').val();
			var  begin_date_m = $('#begin_date_m').val();
			var  end_date_h = $('#end_date_h').val();
			var  end_date_m = $('#end_date_m').val();
			var  date =  $('#date').val();
			
			
			if( begin_date_h  > end_date_h) 
			{
				$('#over_midnight').val('1');
			}
			else
			{
				$('#over_midnight').val('0');
				$('.billable_days_option').hide();
				$('.billable_days_option').html('');
			}	

			$.ajax({
					type: 'POST',
					url: 'ajax/overmidnightcheck?id=<?php echo $_REQUEST['id']; ?>&uid=<?php echo $this->user_id;?>',
					data: {
						visit_type: 'CF',
						begin_h: $('#begin_date_h').val(),
						begin_m: $('#begin_date_m').val(),
						end_h: $('#end_date_h').val(),
						end_m: $('#end_date_m').val(),
						visit_start: $('#date').val(),
						over_midnight: $('#over_midnight').val(),
						edit_id: '<?php if (!empty($_REQUEST['cid'])): echo $_REQUEST['cid']; else: echo '0';	endif; ?>'

					},
				 
					success:function(data){
						var visitdata = jQuery.parseJSON(data);

						$('.billable_days_option').html(''); //reset table tbody
						

						if(visitdata.error != 0)
						{
							jAlert(visitdata.error);
							return false;
						} 
						else if(visitdata.error == 0  && $('#over_midnight').val() == "1")
						{
							$('.billable_days_option').show();
							var over_midnight_label = '<label><?php echo $contact_form_lang['please select the billable date']; ?></label>'
									var div_start = "<ul class='cbrdList'>";
							var start ='<li><input type="radio" name="billable_date"  '+visitdata.start_checked+'  value="start"><label>'+visitdata.start_date_dmy+'</label></li>'
							var end = '<li><input type="radio"  name="billable_date" '+visitdata.end_checked+' value="end"><label>'+visitdata.end_date_dmy+'</label></li>'
									var div_end = "</ul>";
// 							var start = '<label><input type="radio" name="billable_date"  '+visitdata.start_checked+'  value="'+visitdata.start_date+'">'+visitdata.start_date_dmy+'</label>'
// 							var end = '<label><input type="radio"  name="billable_date" '+visitdata.end_checked+' value="'+visitdata.end_date+'">'+visitdata.end_date_dmy+'</label>'
							$('.billable_days_option').html(over_midnight_label+div_start+start+end+div_end);
						} 
						else
						{
							$('.billable_days_option').hide();
						}									
					},
					error:function(){
						ajax_done = 1;
						// failed request; give feedback to user
					}
				});
		}

		$(".date_change").live('change',function(){
				date_validations();
				midnight_validations();
		});
		/*--------------------------------------------------------------------------------------------------------*/
		/*---------------------------------------------------EBM------------------------------------------------*/
		/*----------------------------------------------------------------------------------------------------------*/
		function ebmconditions(){
			$.ajax({
				type: 'POST',
				url: 'ajax/ebmblockconditions?id=<?php echo $_REQUEST['id']; ?>',
				data: {
 					begin_date_h: $('#begin_date_h').val(),
 					begin_date_m: $('#begin_date_m').val(),
 					end_date_h: $('#end_date_h').val(),
 					end_date_m: $('#end_date_m').val(),
					date: $('#date').val()
				},

				success:function(data){
					var conditionsdata = jQuery.parseJSON(data);

					if(conditionsdata.unforseen_i == 1){
						$('#unforseen_i').attr('checked', true)
					} else {
						$('#unforseen_i').attr('checked', false)
					}
					if(conditionsdata.unforseen_ii == 1){
						$('#unforseen_ii').attr('checked', true)
					} else {
						$('#unforseen_ii').attr('checked', false)
					}

				},
				error:function(){
					ajax_done = 1;
				}
			});
		}

		$(".ebmconditions").live('change',function(){
				ebmconditions();
				goaconditions();
		});

		$(function() {
			$('#date').datepicker({
				dateFormat: 'dd.mm.yy',
				showOn: "both",
				changeMonth: true,
				changeYear: true,
				nextText: '',
				prevText: '',
				maxDate: '<?php echo date('d.m.Y'); ?>',
				onSelect: function(){
					load_sgbv_actions($(this).val());
					load_goaii_actions($(this).val());
					load_ebmii_actions($(this).val());
					ebmconditions();
					goaconditions();
					check_sapv();
					midnight_validations();
					changes = true;
					formdate_haschanged(this);
				}
			});
			
			<?php if(strlen($_REQUEST['cid'])==0): ?>
			load_goaii_actions();
			load_ebmii_actions();
			ebmconditions();
			<?php endif; ?>
		});

		/*-------------------------------------------------------------------------------------------------------*/
		/*---------------------------------------------------GOA------------------------------------------------*/
		/*-------------------------------------------------------------------------------------------------------*/

		$('#charge_i_y1').live('click',function(){
			if($('#charge_i_y1:checked').is(':checked') ){
				$('#charge_i_y1').attr('checked', true);
				$('#charge_i_y2').attr('checked', false);
			} else{
				$('#charge_i_y1').attr('checked', false);
			}
		});

		$('#charge_ii_y1').live('click',function(){
			if($('#charge_ii_y1:checked').is(':checked') ){
				$('#charge_ii_y1').attr('checked', true);
				$('#charge_ii_y2').attr('checked', false);
			} else{
				$('#charge_ii_y1').attr('checked', false);
			}
		});

		$('#charge_i_y2').live('click',function(){
			if($('#charge_i_y2:checked').is(':checked') ){
				$('#charge_i_y2').attr('checked', true);
				$('#charge_i_y1').attr('checked', false);
			} else{
				$('#charge_i_y2').attr('checked', false);
			}
		});

		$('#charge_ii_y2').live('click',function(){
			if($('#charge_ii_y2:checked').is(':checked') ){
				$('#charge_ii_y2').attr('checked', true);
				$('#charge_ii_y1').attr('checked', false);
			} else{
				$('#charge_ii_y2').attr('checked', false);
			}
		});

		function goaconditions(){

			if($('#consultation:checked').is(':checked') ){
				var consulting = 1;
			} else{
				var consulting = 0;
			}
			if($('#recipe_transfer:checked').is(':checked') ){
				var recipe_transfer = 1;
			} else{
				var recipe_transfer = 0;
			}
			if($('#expert_advice:checked').is(':checked') ){
				var expert_advice = 1;
			} else{
				var expert_advice = 0;
			}

			if($('#discussion_of_impact:checked').is(':checked') ){
				var discussion_of_impact = 1;
			} else{
				var discussion_of_impact = 0;
			}
			if($('#consultant_discussion:checked').is(':checked') ){
				var consultant_discussion = 1;
			} else{
				var consultant_discussion = 0;
			}
			if($('#detailed_report:checked').is(':checked') ){
				var detailed_report = 1;
			} else{
				var detailed_report = 0;
			}

			$.ajax({
				type: 'POST',
				url: 'ajax/goablockconditions?id=<?php echo $_REQUEST['id']; ?>',
				data: {
					consulting: consulting,
					recipe_transfer: recipe_transfer,
					expert_advice: expert_advice,

					discussion_of_impact: discussion_of_impact,
					consultant_discussion: consultant_discussion,
					detailed_report: detailed_report,

					begin_date_h: $('#begin_date_h').val(),
 					begin_date_m: $('#begin_date_m').val(),
 					end_date_h: $('#end_date_h').val(),
 					end_date_m: $('#end_date_m').val(),
					date: $('#date').val()
				},

				success:function(data){
					var conditionsdata = jQuery.parseJSON(data);

					if(conditionsdata){

					if(conditionsdata.charge_i_y1 == 1){
						$('#charge_i_y1').attr('checked', true)
						$('#charge_i_y2').attr('checked', false)
					} else {
						$('#charge_i_y1').attr('checked', false)
					}
					if(conditionsdata.charge_i_y2 == 1){
						$('#charge_i_y2').attr('checked', true)
						$('#charge_i_y1').attr('checked', false)
					} else {
						$('#charge_i_y2').attr('checked', false)
					}
					if(conditionsdata.charge_i_y3 == 1){
						$('#charge_i_y3').attr('checked', true)
					} else {
						$('#charge_i_y3').attr('checked', false)
					}

					if(conditionsdata.charge_ii_y1 == 1){
						$('#charge_ii_y1').attr('checked', true)
						$('#charge_ii_y2').attr('checked', false)
					} else {
						$('#charge_ii_y1').attr('checked', false)
					}
					if(conditionsdata.charge_ii_y2 == 1){
						$('#charge_ii_y2').attr('checked', true)
						$('#charge_ii_y1').attr('checked', false)
					} else {
						$('#charge_ii_y2').attr('checked', false)
					}
					if(conditionsdata.charge_ii_y3 == 1){
						$('#charge_ii_y3').attr('checked', true)
					} else {
						$('#charge_ii_y3').attr('checked', false)
					}

					}
				},
				error:function(){
					ajax_done = 1;
				}
			});

		}

		$(".goa_conditions").live('click',function(){
			goaconditions();
	});

		/*--------------------------------------------------------------------------------------------------------------------*/
		/*---------------------------------------------------SGBV-------------------------------------------------------------*/
		/*--------------------------------------------------------------------------------------------------------------------*/

		$('.add_action').live('click',function(){
			 $('#add_action_block').dialog('open');
		 });

		$('#add_action_block').dialog({
		    autoOpen: false,
		    modal: true,
		    width: 350,
		   	height: 200,
		   	title:  "<?php echo $this->translate('custom action add'); ?>",
		   	open: function(){
		   		$('#action_name').val('');
		   	},
		    buttons:{
			"<?php echo $this->translate('save'); ?>": function(){

				$('.asubmitform').attr('disabled',true);
				 $(".ui-button:first").attr("disabled", true)
				 .addClass("ui-state-disabled").next("button").attr("disabled", true)
				 .addClass("ui-state-disabled");


				var error = 0;
				var ajax_done = 0;

					$.ajax({
						type: 'POST',
						url: 'ajax/savecusomaction?id=<?php echo $_REQUEST['id']; ?>',
						data: {
							action_name: $('#action_name').val()
						},

						success:function(data){
							var actionsdata = jQuery.parseJSON(data);
// 							$('#social_actions_list').append('<tr class="custom_action"><td><input type="checkbox" name="social_action['+actionsdata.action_id+']"  id="social_action['+actionsdata.action_id+']"  value="1" /></td><td><label for="social_action['+actionsdata.action_id+']">'+actionsdata.action_name+'</label></td></tr>')

							var row = '<li class="custom_action">';
							row += '<input type="checkbox" name="social_action['+actionsdata.action_id+']"  id="social_action['+actionsdata.action_id+']"  value="1" />';
							row += '<label for="social_action['+actionsdata.action_id+']">'+actionsdata.action_name+'</label>';
							row += '</li>';
							$('#social_actions_list').append(row);
							
							$('#add_action_block').dialog('close');

						},
						error:function(){
							ajax_done = 1;
						}
					});

			},
			"<?php echo $this->translate('cancel'); ?>": function(){
				$('#action_name').val('');
				$('#add_action_block').dialog('close');
			}
		    },


		    create:function () {
		        $(this).closest(".ui-dialog")
		            .find(".ui-button:first") // the first button
		            .addClass("asubmitform");
		    },
		    close:function () {
		    	$('.asubmitform').attr('disabled',false),
				 $(".ui-button:first").attr("disabled", false)
				 .removeClass("ui-state-disabled").next("button").attr("disabled", false)
				 .removeClass("ui-state-disabled");
		    }
		});

		$('.delete_action').live('click',function(){
		 	var action_id = $(this).attr('rel');
			$('#delete_action_id').val(action_id);


			 $('#delete_action_block').dialog('open');
		 });

		$('#delete_action_block').dialog({
		    autoOpen: false,
		    modal: true,
		    width: 350,
		   	height: 200,
		   	title:  "<?php echo $this->translate('delete action'); ?>",
		   	open: function(){
		   	},
		    buttons:{
			"<?php echo $this->translate('delete'); ?>": function(){

				var error = 0;
				var ajax_done = 0;

					$.ajax({
						type: 'POST',
						url: 'ajax/deletecusomaction?id=<?php echo $_REQUEST['id']; ?>',
						data: {
							delete_action_id: $('#delete_action_id').val()
						},

						success:function(data){
							var actionsdata = jQuery.parseJSON(data);

// 							$('#social_actions_list tr#action_row_'+actionsdata.delete_action_id).remove();
							$('#social_actions_list li#action_row_'+actionsdata.delete_action_id).remove();

							$('#delete_action_block').dialog('close');

						},
						error:function(){
							ajax_done = 1;
						}
					});
			},

			"<?php echo $this->translate('cancel'); ?>": function(){
				$('#delete_action_id').val('');
				$('#delete_action_block').dialog('close');
			}
		    }
		});
	//remove custom items
	$('.remove_item').live('click', function(){
		$(this).parent().parent().hide('slow').remove();
	});
		
		//2017.04.13
		link_contacty_with_contactn();

	}); //$(document).ready END

	
	//2017.04.13 - linkem without radio
	function link_contacty_with_contactn() {
		$(".link_contacty_with_contactn").change(function() {
		    var checked = $(this).is(':checked');
		    $(".link_contacty_with_contactn" , $(this).parent()).prop('checked',false);
		    if(checked) {
		        $(this).prop('checked',true);
		    }
		});
	}
	
	
	function check_sapv(){
		$.ajax({
			type: 'POST',
			url: 'ajax/checksapv?id=<?php echo $_REQUEST['id']; ?>',
			data: {
				date: $('#date').val()
			},
			success:function(data){
				var returned_data = jQuery.parseJSON(data);
				$('#has_sapv').val(returned_data.result);

				if(returned_data.result == '0'){
					$.each(jQuery.parseJSON(sapv_box_ids), function(index, value) {
						$('#'+index).hide();

					});
				} else {
					$('.contactform_dragvbox').show();
				}
			},
			error:function(){
				var ajax_done = 1;
			}
		});
	}
	
	function load_sgbv_actions(date)
	{
		var table = '';
		
		if($('#grow16').is(':visible')) {
			$('#sgbv').block({
				css: {
					border: 'none',
					padding: '5px',
					backgroundColor: '#000',
					'-webkit-border-radius': '5px',
					'-moz-border-radius': '5px',
					opacity: .5,
					color: '#fff',
					height: 'auto'
				},
				message: '<h1 style="padding:5px;">Verarbeitung</h1><img src="<?php echo RES_FILE_PATH.'/images/ajax-loader-bar.gif'; ?>">'
			});
		}

		
		
		$.ajax({
			type: 'POST',
			url: 'ajax/loadsgbvactions',
			data: {
				id: '<?php echo $_REQUEST['id']; ?>',
				formid: '<?php echo $_REQUEST['cid']; ?>',
				type: 'cf',
				date: date
			},
			success:function(data){				
				$('#social_actions_list').html(data);
				$('#sgbv').unblock();
				
			},
			error:function(){
				var ajax_done = 1;
			}
		});
	}
 

	function load_goaii_actions(date)
	{
		var table = '';

		if($('#grow15').is(':visible')) {
			$('#goaii').block({
				css: {
					border: 'none',
					padding: '5px',
					backgroundColor: '#000',
					'-webkit-border-radius': '5px',
					'-moz-border-radius': '5px',
					opacity: .5,
					color: '#fff',
					height: 'auto'
				},
				message: '<h1 style="padding:5px;">Verarbeitung</h1><img src="<?php echo RES_FILE_PATH.'/images/ajax-loader-bar.gif'; ?>">'
			});
		}



		$.ajax({
			type: 'POST',
			url: 'ajax/loadxbdtgoaiiactions',
			data: {
				id: '<?php echo $_REQUEST['id']; ?>',
				formid: '<?php echo $_REQUEST['cid']; ?>',
				type: 'cf',
				date: date
			},
			success:function(data){
				$('#goaii_actions').html(data);
				$('#goaii').unblock();

			},
			error:function(){
				var ajax_done = 1;
			}
		});
	}
	
	function load_ebmii_actions(date)
	{
		var table = '';

		if($('#grow13').is(':visible')) {
			$('#ebmii').block({
				css: {
					border: 'none',
					padding: '5px',
					backgroundColor: '#000',
					'-webkit-border-radius': '5px',
					'-moz-border-radius': '5px',
					opacity: .5,
					color: '#fff',
					height: 'auto'
				},
				message: '<h1 style="padding:5px;">Verarbeitung</h1><img src="<?php echo RES_FILE_PATH.'/images/ajax-loader-bar.gif'; ?>">'
			});
		}



		$.ajax({
			type: 'POST',
			url: 'ajax/loadxbdtebmiiactions',
			data: {
				id: '<?php echo $_REQUEST['id']; ?>',
				formid: '<?php echo $_REQUEST['cid']; ?>',
				type: 'cf',
				date: date
			},
			success:function(data){
				$('#ebmii_actions').replaceWith(data);
				$('#ebmii').unblock();

			},
			error:function(){
				var ajax_done = 1;
			}
		});
	}

	
	function createnewitem(set_id,sympt_id)
	{
		var trInnerHtml ='';
		var complex_zapv_select = <?php echo json_encode($this->complex_zapv_select); ?>
		
		trInnerHtml ='<tr>';
		trInnerHtml+='<td><select name="symp['+set_id+'][details_multiple_select]['+sympt_id+'][]" class="sympt_details_select">';
		trInnerHtml+='<option value="0"> <?php echo $this->translate("select details"); ?> </option>';
			$.each(complex_zapv_select[sympt_id], function(select_key, select_value){
				trInnerHtml+='<option value="'+select_key+'">'+select_value+'</option>';
			});
		trInnerHtml+='</select></td>';
		trInnerHtml+='<td><a href="javascript:void(0)" class="remove_item"  ><img src="<?php echo RES_FILE_PATH; ?>/images/action_delete.png" border="0"></a></td>';
		trInnerHtml+='</tr>';
		
		$('#add_new_medi_'+sympt_id).before(trInnerHtml);
 
	}

	
	
	// ---------------- Sapvfb3 ------------------------------


	function saveCheckboxes(chkbx,elname,category)
	{

		if(chkbx.checked)
		{
			var cmt = category+"  :  "+elname;

			$("<input type='hidden' name='comments_l[]' id='comment_"+chkbx.value+"' value='"+cmt+"' />").appendTo("#contact_form");
		}
		else
		{
			$("#comment_"+chkbx.value).remove();
		}

	}

	function updateCheckboxes(chkbx,elname,category,valid)
	{

		if(chkbx.checked)
		{
			var cmt = category+"  :  "+elname;

			$("<input type='hidden' name='upcomments["+valid+"]["+chkbx.value+"]' id='upcomments_"+chkbx.value+"' value='"+cmt+"' />").appendTo("#contact_form");
		}
		else
		{
			var cmt = category+"  :  "+elname;
			$("<input type='hidden' name='upcomments["+valid+"]["+chkbx.value+"]' id='upcomments_"+chkbx.value+"' value='"+cmt+"' />").appendTo("#contact_form");
		}

	}
	
	
	<?php if(empty($_REQUEST['cid'])): ?>
		function addMinutes(time, minsToAdd) {
			function D(J){ return (J<10? '0':'') + J};

			var piece = time.split(':');

			var mins = piece[0]*60 + +piece[1] + +minsToAdd;

			return D(mins%(24*60)/60 | 0) + ':' + D(mins%60);  
		}

			function set_end_time(end_time) {
				if(end_time !== 'undefined') {
				var end_time_split = end_time.split(':');

				$('#end_date_h').val(end_time_split[0]);
				$('#end_date_m').val(end_time_split[1]);
			}
		}


		$(document).on('change', '#begin_date_h, #begin_date_m', function(){
			var current_time = $('#begin_date_h').val()+":"+$('#begin_date_m').val()+":00";
			set_end_time(addMinutes(current_time, contactform_default_visit_length));
			$('#time_division_remain').val(calculate_time_diff());
		});
	<?php endif; ?>
	

	var chks;
	var formid;
	function updatePatientInformation(modname,fldname,formid,chk,patid,drp)
	{
		if(chk.checked == true && drp != "kontactnumber" && fldname != 'living_will'){
			chks = 1;
		} else {
			chks = 0;
		}
		
		if(fldname=="living_will"){
			togglediv(drp,chk.value);
			ajaxcall(modname,fldname,chk.value,patid,formid);
			$("#living_will_from").val('');
			$("#living_will_deposited").val('');
		}

		if(drp=='drop' || drp=='rad' || drp == 'fam' || drp == 'vig' || drp == 'sta' || drp == "kontactnumber")
		{
			chks = chk.value;

			if(drp == "kontactnumber" && chk.checked == false){
				chks = "";
			}
		}

		if(drp == "ern"){
			var values = new Array();
			$.each($("input[name='ernahrung[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		
		if(drp == "kun"){
			var values = new Array();
			$.each($("input[name='kunstliche[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		
		if(drp == "ori"){
			var values = new Array();
			$.each($("input[name='orientierung[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		
		if(drp == "aus"){
			var values = new Array();
			$.each($("input[name='ausscheidung[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		if(drp == "hil"){
			var values = new Array();
			$.each($("input[name='hilfsmittel[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		if(drp == "wun"){
			var values = new Array();
			$.each($("input[name='wunsch[]']:checked"), function() {
				values.push($(this).val());
				chks = values;
			});
		}

		if(fldname=="peg" || fldname=="port" || fldname=="bed" || fldname=="walker" || fldname=="wheelchair" || fldname=="goable" || fldname=="nachtstuhl" || fldname=="wechseldruckmatraze")
		{
			var len = $("#"+fldname+'more').val().length;
			if(chks==0 && len >0)
			{
				jConfirm('<?php echo $this->translate('wantstouncheck'); ?>', '', function(r) {
					if(r)
					{
						togglediv(drp,chks);
						ajaxcall(modname,fldname,chks,patid,formid);
						$("#"+fldname+'more').val('');
					}
					else
					{
						chk.checked = true;
					}

				});
				return false;
			}
			else
			{
				togglediv(drp,chks);
				ajaxcall(modname,fldname,chks,patid,formid);
			}
		}
		else
		{
		    if(fldname != 'living_will'){
			ajaxcall(modname,fldname,chks,patid,formid);
		    }
		}
	}

	
	function ajaxcall(modname,fldname,chks,patid,formid){
		if(isdischarged==1){
			jConfirm('<?php echo $this->translate('dischargealert'); ?>', '', function(r) {
				if(r){


					if (fldname =='ishospiz'){
						if($("#ishospiz").is(":checked")){
							if(hospiz_users_nr > 0){
								$( "#assignhospizusers" ).dialog('open');
							}
						}else if(!$("#ishospiz").is(":checked")){
							if(hospiz_assusers > 0){
								$( "#removehospizusers" ).dialog('open');
							}
						}

					}
					if (fldname =='ishospizverein'){
						if($("#ishospizverein").is(":checked")){
							if(hospizverein_users_nr > 0){
								$( "#assignhospizvereinusers" ).dialog('open');
							}
						}else if(!$("#ishospizverein").is(":checked")){
							if(hospizverein_assusers > 0){
								$( "#removehospizvereinusers" ).dialog('open');
							}
						}
					}
					ajaxCallserver({url:appbase+'patient/updatepatientinfo?modname='+modname+'&fldname='+fldname+'&chkval='+encodeURIComponent(chks)+'&patid='+patid+'&formid='+formid});
				}
			});

			return false;
		} else {

			if (fldname =='ishospiz'){
				if($("#ishospiz").is(":checked")){
					if(hospiz_users_nr > 0){
						$( "#assignhospizusers" ).dialog('open');
					}
				}else if(!$("#ishospiz").is(":checked")){
					if(hospiz_assusers > 0){
						$( "#removehospizusers" ).dialog('open');
					}
				}

			}
			if (fldname =='ishospizverein'){
				if($("#ishospizverein").is(":checked")){
					if(hospizverein_users_nr > 0){
						$( "#assignhospizvereinusers" ).dialog('open');
					}
				}else if(!$("#ishospizverein").is(":checked")){
					if(hospizverein_assusers > 0){
						$( "#removehospizvereinusers" ).dialog('open');
					}
				}
			}
			ajaxCallserver({url:appbase+'patient/updatepatientinfo?modname='+modname+'&fldname='+fldname+'&chkval='+encodeURIComponent(chks)+'&patid='+patid+'&formid='+formid});
		}
	}
	
	function calculate_time_diff(){
		var  begin_date_h = parseInt($('#begin_date_h').val());
		var  begin_date_m = parseInt($('#begin_date_m').val());
		var  end_date_h = parseInt($('#end_date_h').val());
		var  end_date_m = parseInt($('#end_date_m').val());
		var  minutes = 0;	
		var  hours = 0;	

		if( begin_date_h  > end_date_h) 
		{
			hours = (24 - begin_date_h) + end_date_h;
		}
		else
		{
			hours = end_date_h - begin_date_h
		}	
		minutes = hours*60  - begin_date_m + end_date_m;
		if (minutes<0) minutes=0;
		return parseInt(minutes) || 0;
	}
	
	function signs_haschanged ( _this )
	{
		$(_this).data("haschanged", "1");
	}

	function formdate_haschanged ( _this )
	{
		var haschanged = false;
		
		if ( ! $(".signs_haschanged").length ) {
			return false;
		}
		$(".signs_haschanged").each(function(){
			if($(_this).data("haschanged") == "1") {
				haschanged = true;
				return false;
			}
		});
		
		if ( ! haschanged ) {
			
			switch($(_this).attr("id")) {
			
				case "begin_date_h":
					$("#signs_date_h").val( $(_this).val() );
				break;
				
				case "begin_date_m":
					$("#signs_date_m").val( $(_this).val() );
				break;
				
				case "date":
					$("#kvno_signs_date").val( $(_this).val() );
				break;
			}
		}
	}
	
</script>
 <style>
 .medication_block{
 	float: none!important;
 }
 .medication_edit_table{
 	width: auto!important;
 }
 </style>
<form action="" name="contact_form" method="post" id="contact_form">

<?= $this->formHidden('cfhiddennounce', md5(mt_rand(1,1000000). 'cf_salt' .  mt_rand(1,1000000)) , array('id'=> 'cfhiddennounce'));?>
<?= $this->formHidden('cfhiddencid', (int)$_REQUEST['cid'] , array('id'=> 'cfhiddencid'));?>

<input type="hidden" name="has_sapv" id="has_sapv" value="0" />
 <div style="display: none"> <img id="calImg" src="<?php echo RES_FILE_PATH;  ?>/images/calendar.png" alt="Popup" class="trigger"> </div>
  
  <div id="Einzel" class="tab_container"> <br />

<h1 class="mobile besuch"><?php echo $this->translate('contact_form_name');  ?> - <span><?php echo $this->formtype_name;  ?></span></h1>

<div class="besuch">
	<ul class="infoblock">
		<li class="name">
			<span>Name, Vorname</span>
			<h2><?php echo $this->lastname.', '.$this->firstname;?></h2>
		</li>
		<li class="address">
			<span>Adresse</span>
			<h2><?php echo $this->street.', '.$this->zip.' '.$this->patcity;?></h2>
		</li>
		<li class="number">
			<span>Patientennummer</span>
			<h2><?php echo $this->epid;?></h2>
		</li>
		<li class="date">
			<span>Geb.-Datum</span>
			<h2><?php echo $this->birth;?></h2>
		</li>
	</ul>
</div>





<div id="Kvno_MainContenOuter" class="anfrageMainOuter Black_border">
 <div class="kvno_doctor_form">

<?php
$contact_form_files = $this->form_files;
$users_data = $this->users_data;
$form_blocks_order = $this->blocks_order;

if(count($form_blocks_order[0]['box_order'])>0)
{
	$box_order = explode(',', $form_blocks_order[0]['box_order']);
}
else
{
	$box_order = Pms_CommonData::contact_form_blocks();
}

$ebm_goa_blocks = $this->ebm_goa_blocks;
$measures_blocks = $this->measures_blocks;
$sgbxi_actions_blocks = $this->sgbxi_actions_blocks;
$ebm_ber_blocks = $this->ebm_ber_blocks;

$ebm_ber_categories = $this->ebm_ber_categories;


?>
	<div class="clearer"></div>
<?php if(count($contact_form_files)>0):  ?>
<!--  ############################################################################## -->
<!--  ################################  FILES  ##################################### -->
<!--  ############################################################################## -->
<br/>&nbsp;
<br/>&nbsp;
<div class="contactform_dragvbox" id="files">
		<h2> +  <?php echo $this->translate('file_history'); ?></h2>
		<div class="contactform_dragvbox_content" style="display: none;">
			<table class="datatable">
				<tr>
					<th>#</th>
					<th><?php echo $this->translate('title'); ?></th>
					<th style="width:55px;"><?php echo $this->translate('filetype'); ?></th>
					<th><?php echo $this->translate('user'); ?></th>
					<th style="width:80px;"><?php echo $this->translate('date'); ?></th>
				</tr>
				<?php $i = 1;
				foreach ($contact_form_files as $k_contact_file => $v_contact_file): ?>
					<tr>
						<td><a href="<?php echo APP_BASE . 'stats/patientfileupload?doc_id='.$v_contact_file['id'].'&id='.$_REQUEST['id'];?>"><?php echo $i; ?></a></td>
						<td><a href="<?php echo APP_BASE . 'stats/patientfileupload?doc_id='.$v_contact_file['id'].'&id='.$_REQUEST['id'];?>"><?php echo $v_contact_file['title']; ?></a></td>
						<td><a href="<?php echo APP_BASE . 'stats/patientfileupload?doc_id='.$v_contact_file['id'].'&id='.$_REQUEST['id'];?>"><?php echo $v_contact_file['file_type']; ?></a></td>
						<td><a href="<?php echo APP_BASE . 'stats/patientfileupload?doc_id='.$v_contact_file['id'].'&id='.$_REQUEST['id'];?>"><?php echo $users_data[$v_contact_file['create_user']]['first_name'].', '.$users_data[$v_contact_file['create_user']]['last_name']; ?></a></td>
						<td><a href="<?php echo APP_BASE . 'stats/patientfileupload?doc_id='.$v_contact_file['id'].'&id='.$_REQUEST['id'];?>"><?php echo date('d.m.Y', strtotime($v_contact_file['create_date'])); ?></a></td>
					</tr>
				<?php $i++; endforeach; ?>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;  ?>

<?php foreach($box_order as $k_box=>$v_box):?>
<?php if($v_box == 'time'): ?>
<!--  ############################################################################## -->
<!--  ######################### Time Block  ####################################### -->
<!--  ############################################################################## -->
<div class="time_block besuch">
    <div class="inputs">
	   <div class="container double">
	       <div class="column col1 timeselect">
    
        	   <label>Beginn :</label>
               <select name="begin_date_h" id="begin_date_h" class="ebmconditions date_change first" onchange="formdate_haschanged(this)">
        			<option value="00">00</option>
        			<?php for ($i=1; $i<=23; $i++){?>
        				 <option value="<?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?>" <?php if(str_pad($i, 2, "0", STR_PAD_LEFT) == $contact_form_details['begin_date_h'] ){ echo 'selected="selected"';}?>><?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?></option>
        			<?php }?>
        		</select>

        		<select name="begin_date_m" id="begin_date_m"  class="ebmconditions date_change last" onchange="formdate_haschanged(this)">
        		<option value="00">00</option>
        			<?php for ($i=1; $i<=59; $i++){?>
        			 	<option value="<?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?>" <?php if(str_pad($i, 2, "0", STR_PAD_LEFT) == $contact_form_details['begin_date_m'] ){ echo 'selected="selected"';}?>><?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?></option>
        			<?php }?>
        		</select>
            </div>
            <div class="column col-sep"><span>—</span></div>
			<div class="column col2 timeselect">
                <label>Ende:</label>
        		<select name="end_date_h"  id="end_date_h"  class="ebmconditions date_change first">
        			<option value="00">00</option>
        			<?php for ($i=1; $i<=23; $i++){?>
        				 <option value="<?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?>" <?php if(str_pad($i, 2, "0", STR_PAD_LEFT) == $contact_form_details['end_date_h'] ){ echo 'selected="selected"';}?>><?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?></option>
        			<?php }?>
        		</select>

        		<select name="end_date_m"  id="end_date_m"  class="ebmconditions date_change last">
        			<option value="00">00</option>
        			<?php for ($i=1; $i<=59; $i++){?>
        				 <option value="<?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?>" <?php if(str_pad($i, 2, "0", STR_PAD_LEFT) == $contact_form_details['end_date_m'] ){ echo 'selected="selected"';}?>><?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?></option>
        			<?php }?>
        		</select>
            </div>
            
 			<div class="column fullwidth">
                <input type="text" name="date" id="date"  value="<?php echo $contact_form_details['date'] ?>"   class="embconditions date" onchange="formdate_haschanged(this)"/>
                <input type="hidden" id="over_midnight" name="over_midnight" value="<?php echo $contact_form_details['over_midnight']?>">
            </div>
 
            <div class="billable_days_option column <?= ($contact_form_details['over_midnight'] == "1")?'visible_div':' hidden_div' ?>">
                <label><?php echo $contact_form_lang['please select the billable date']; ?></label>
                    <ul class="cbrdList">
                        <li>
                          <input name="billable_date" value="start" type="radio" <?php if( date('d.m.Y',strtotime($contact_form_details['billable_date'])) == date('d.m.Y',strtotime($contact_form_details['start_date']))  ): ?> checked="checked" <?php endif;?>  />
            		      <label> <?php echo date('d.m.Y',strtotime($contact_form_details['start_date']));?> </label>
                        </li>
                        <li>
                            <input name="billable_date" value="end" type="radio"  <?php if( date('d.m.Y',strtotime($contact_form_details['billable_date'])) == date('d.m.Y',strtotime($contact_form_details['end_date']))): ?> checked="checked" <?php endif;?>  />
                            <label><?php echo date('d.m.Y',strtotime($contact_form_details['end_date']));?> </label>
            	        </li>
            	</ul>
            </div>
            
	   </div>
    </div>
</div>
 	<br style="clear: both"/>
<!--  ############################################################################## -->
<?php endif;?>



<?php if(in_array('drivetime',$allowed_blocks) && $v_box == 'drivetime'): ?>
<!--  ############################################################################## -->
<!--  ################ driving time and kilometers   ############################## -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="drivetime">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_drivetime') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>

        
		<div class="contactform_dragvbox_content besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow1"  >
		<div class="inputs">
		  <div class="container">
		  
		  <div class="column">
			<label class="kvno_top_labels">Fahrtzeit: </label>
			<select name="fahrtzeit">
				<option value="--">--</option>
				<?php for ($i=1; $i<=$this->driving_time_limit; $i++){?>
					<option value="<?php echo $i; ?>" <?php if($i == $contact_form_details['fahrtzeit']){ echo 'selected="selected"';}?>><?php echo $i; ?></option>
				<?php }?>
			</select>
			<?php echo '<!--'.$contact_form_details['fahrtzeit'].'-->';?>
		  </div>
		  
		  <div class="column">
			<label class="kvno_top_labels">Fahrtstrecke (Km):</label><input type="text" name="fahrtstreke_km" id="fahrtstreke_km" value="<?php echo $contact_form_details['fahrtstreke_km'];?>" />
            <?php if ($this->clientModules[182]) : ?>
                <label class="kvno_top_labels" ><?=$this->translate('Accompanied by a Ligetis expert?')?></label>
                <ul class="cbrdList">
                <li>
                <?=$this->formRadio('expert_accompanied', $contact_form_details['expert_accompanied'], ['labelClass'=>'radios','labelUnwrapp'=>true,'labelPlacemnent'=>'append' ], ['yes' => 'Ja', 'no'=> 'Nein']);?>
                </li>
            <?php endif;?>
            </ul>
		  </div>
		  </div>
		  </div>
            
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>


<?php if(in_array('drivetime_doc',$allowed_blocks) && $v_box == 'drivetime_doc'): ?>
<!--  ############################################################################## -->
<!--  ################ driving time documentation  and kilometers   ############################## -->
<!--  ############################################################################## -->
<div class="contactform_dragvbox"  id="drivetime">
    <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
        <?php echo $this->translate('block_drivetime_doc') ?>
        <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
    </div>
	
    <div class="contactform_dragvbox_content  besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow1">
        <div class="inputs">
            <div class="container">
	  
                <div class="column">
                    <label for="import">Fahrtzeit:</label>
                    <select name="fahrtzeit1">
                        <option value="--">--</option>
                        <?php for ($i=1; $i<=$this->driving_time_limit; $i++){?>
                        <option value="<?php echo $i; ?>" <?php if($i == $this-> drivetime_doc['fahrtzeit1']){ echo 'selected="selected"';}?>><?php echo $i; ?></option>
                        <?php }?>
                    </select>
                </div>
        		<div class="column">     
                    <label for="export">Fahrtstrecke (Km):</label>
                    <input type="text" name="fahrtstreke_km1"  id="fahrtstreke_km1" value="<?php if(empty($this->drivetime_doc['fahrtstreke_km1'])) {echo ''; } else {echo $this->drivetime_doc['fahrtstreke_km1']; }?>"> 
                </div>			
        		
        		<div class="column">     
                    <label for="export">Dokumentationszeit:</label>
                    <input type="text" name="fahrt_doc1" id = "fahrt_doc1"  value="<?php if(empty($this->drivetime_doc['fahrt_doc1'])) {echo ''; } else {echo $this->drivetime_doc['fahrt_doc1']; }?>">                    
        		</div>
            </div>
		</div>
	</div>
</div>
<!--  ############################################################################## -->
<?php endif; ?>


<?php if(in_array('visitplan',$allowed_blocks)  && $v_box == 'visitplan'): ?>
<!--  ############################################################################## -->
<!--  ########################## Besuch war   ###################################### -->
<!--  ############################################################################## -->
<div class="contactform_dragvbox"  id="visitplan">
    <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
        <?php echo $this->translate('block_visitplan') ?>
        <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
    </div>	
    <div class="contactform_dragvbox_content  besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow2">
        <div class="inputs">
            <div class="container">
    			<div class="columnvisit_quality">
    				<label class="kvno_top_labels">Besuch war:</label>
    				<ul class="cbrdList">
    					<li>
    						<input type="radio" id="visit_planned" name="quality" value="1" <?php if($contact_form_details['quality'] == '1'): ?> checked="checked" <?php endif; ?> />
    						<label for="visit_planned">geplant</label>
    					</li>
    					<li>
    						<input type="radio" id="visit_unplanned" name="quality" value="2"  <?php if($contact_form_details['quality'] == '2'): ?> checked="checked" <?php endif; ?>  />
    						<label for="visit_unplanned">ungeplant</label>
    					</li>
    					<li>
    						<input type="radio" id="visit_acute" name="quality" value="3"  <?php if($contact_form_details['quality'] == '3'): ?> checked="checked" <?php endif; ?>  />
    						<label for="visit_acute">akut</label>
    					</li>
    					
    					<li>
    						<input type="radio" id="visit_sapv_emergeny" name="quality" value="4"  <?php if($contact_form_details['quality'] == '4'): ?> checked="checked" <?php endif; ?>  />
    						<label for="visit_sapv_emergeny">SAPV-Notdienst</label>
    					</li>
    					
    				</ul>
    			</div>
    		</div>
        </div>
    </div>
</div>
<!--  ############################################################################## -->
<?php endif; ?>



<?php if(in_array('symp',$allowed_blocks) && $v_box == 'symp'): ?>
<?php $set_id = 1; ?>
 <!--  ############################################################################## -->
 <!--  #############################  Symptomatics   ################################ -->
 <!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="symp">
		<h2> + <?php echo $this->translate('block_symp') ?></h2>
		<div class="contactform_dragvbox_content" id="grow3"  style="display:<?php if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
			<table  border="0" cellpadding="2" cellspacing="2" class="kvno_symptomatics" width="100%">
				<tr style="border-bottom:1px solid #ccc;  line-height: 30px">
					<th width="35%"><b>Item</b></th>
					<th width="10%" style="text-align: center;"><b>Letzter Wert</b></th>
					<th width="13%" style="text-align: center;"><b>Aktueller Wert</b></th>
					<th width="40%"><b>Kommentar</b></th>
				</tr>

				<?php if($this->sympt_view_select == 'a'): ?>
					<?php
					$none = array(0);
					$weak = array(1,2,3,4);
					$average = array(5,6,7);
					$strong = array(8,9,10);
					$atributes_values = array(0=>'kein',1=>'leicht',2=>'leicht',3=>'leicht',4=>'leicht',5=>'mittel',6=>'mittel',7=>'mittel',8=>'schwer',9=>'schwer',10=>'schwer');
				?>

				 	<?php foreach($this->symptomarr as $value):	?>
						<tr  style=" border-bottom:1px dotted #ccc">
							<td ><?php echo ($value['sym_description'])?></td>
							<td style="text-align: center; "><span><?php echo $atributes_values [$value['input_value']];?></span>
								<input type="hidden" name="symp[<?php echo $set_id;?>][current_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<select name="symp[<?php echo $set_id;?>][input_value][<?php echo $value['symptomid']?>]"   id="input_value<?php echo $value['symptomid']?>"    class="symp_input">
									<option value="0" <?php if( in_array($value['entered_value'],$none)):?> selected="selected" <?php endif; ?>  >kein</option>
									<option value="4" <?php if( in_array($value['entered_value'],$weak)):?> selected="selected" <?php endif; ?> >leicht</option>
									<option value="7" <?php if( in_array($value['entered_value'],$average)):?> selected="selected" <?php endif; ?> >mittel</option>
									<option value="10" <?php if( in_array($value['entered_value'],$strong)):?> selected="selected" <?php endif; ?> >schwer</option>
									<option value="" <?php if( $value['entered_value'] == NULL ){echo 'selected="selected"'; } else{}     ?>  ></option>
								</select>
								<input type="hidden" name="symp[<?php echo $set_id;?>][setid]" value="1" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][complex]" value="0" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][alias]" value="no" />
								</td>
							<td class="kvno_komentinput"><input type="text" name="symp[<?php echo $set_id;?>][comment][<?php echo $value['symptomid']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>

				 <?php else: ?>

					<?php foreach($this->symptomarr as $value):?>
						<tr  style=" border-bottom:1px dotted #ccc">
							<td ><?php echo ($value['sym_description'])?></td>
							<td style="text-align: center; "><span><?php echo $value['input_value'];?></span>
								<input type="hidden" name="symp[<?php echo $set_id;?>][current_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<input type="text" name="symp[<?php echo $set_id;?>][input_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['entered_value']?>" class="kvnosymp_input" id="input_value<?php echo $value['symptomid']?>" onkeyup="isInteger([<?php echo $value['symptomid']?>])" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][setid]" value="1" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][complex]" value="0" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][alias]" value="no" />
							</td>
							<td class="kvno_komentinput"><input type="text" name="symp[<?php echo $set_id;?>][comment][<?php echo $value['symptomid']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>
				<?php endif;?>
				<tr>
				<td  colspan="4">&nbsp;</td>
				</tr>
				<tr></tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>

<?php if(in_array('service_entry',$allowed_blocks) && $v_box == 'service_entry'): ?>

 <!--  ############################################################################## -->
 <!--  #############################  Service Entry  ################################ -->
 <!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="service_entry">
		<h2> + <?php echo $this->translate('block_service_entry') ?></h2>
		<div class="contactform_dragvbox_content" id="grow3"  style="display:<?php if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
			<table  border="0" cellpadding="2" cellspacing="2" class="kvno_symptomatics" width="100%">
				<tr style="border-bottom:1px solid #ccc;  line-height: 30px">
					<th width="35%"><b>Item</b></th>
					<th width="10%" style="text-align: center;"><b>Letzter Wert</b></th>
					<th width="13%" style="text-align: center;"><b>Aktueller Wert</b></th>
					<th width="40%"><b>Kommentar</b></th>
				</tr>
         <?php 
         ?>
					<?php foreach($this->servarr as $value):?>
						<tr  style=" border-bottom:1px dotted #ccc">
							<td ><?php echo ($value['item_name'])?></td>
							<td style="text-align: center; "><span><?php echo $value['input_value'];?></span>
								<input type="hidden" name="services[curent_value][<?php echo $value['service_id']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<input type="text" name="services[input_value][<?php echo $value['service_id']?>]" value="<?php echo $value['entered_value']?>" class="kvnosymp_input" 
								id="inputvalue<?php echo $value['service_id']?>" onkeyup="isIntegerServices([<?php echo $value['service_id']?>])" />
								
							</td>
							<td class="kvno_komentinput"><input type="text" name="services[comment][<?php echo $value['service_id']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>
				
				<tr>
				<td  colspan="4">&nbsp;</td>
				</tr>
				<tr></tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>


<?php if(in_array('symp_zapv',$allowed_blocks) && $v_box == 'symp_zapv'): ?>
<?php $set_id = 4; ?>
 <!--  ############################################################################## -->
 <!--  #############################  Symptomatics ZAPV  ################################ -->
 <!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="symp_zapv">
		<h2> + <?php echo $this->translate('block_symp_zapv') ?></h2>
		<div class="contactform_dragvbox_content" id="grow3"  style="display:<?php if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
			<table  border="0" cellpadding="2" cellspacing="2" class="kvno_symptomatics" width="100%">
				<tr style="border-bottom:1px solid #ccc;  line-height: 30px">
					<th width="35%"><b>Item</b></th>
					<th width="10%" style="text-align: center;"><b>Letzter Wert</b></th>
					<th width="13%" style="text-align: center;"><b>Aktueller Wert</b></th>
					<th width="40%"><b>Kommentar</b></th>
				</tr>

				<?php if($this->sympt_view_select == 'a'): ?>
					<?php
					$none = array(0);
					$weak = array(1,2,3,4);
					$average = array(5,6,7);
					$strong = array(8,9,10);
					$atributes_values = array(0=>'kein',1=>'leicht',2=>'leicht',3=>'leicht',4=>'leicht',5=>'mittel',6=>'mittel',7=>'mittel',8=>'schwer',9=>'schwer',10=>'schwer');
				?>

				 	<?php foreach($this->symptomarr_zapv as $value):	?>
						<tr  style=" border-bottom:1px dotted #ccc">
							<td ><?php echo ($value['sym_description'])?></td>
							<td style="text-align: center; "><span><?php echo $atributes_values [$value['input_value']];?></span>
								<input type="hidden" name="symp[<?php echo $set_id;?>][current_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<select name="symp[<?php echo $set_id;?>][input_value][<?php echo $value['symptomid']?>]"   id="input_value<?php echo $value['symptomid']?>"    class="symp_input">
									<option value="0" <?php if( in_array($value['entered_value'],$none)):?> selected="selected" <?php endif; ?>  >kein</option>
									<option value="4" <?php if( in_array($value['entered_value'],$weak)):?> selected="selected" <?php endif; ?> >leicht</option>
									<option value="7" <?php if( in_array($value['entered_value'],$average)):?> selected="selected" <?php endif; ?> >mittel</option>
									<option value="10" <?php if( in_array($value['entered_value'],$strong)):?> selected="selected" <?php endif; ?> >schwer</option>
									<option value="" <?php if( $value['entered_value'] == NULL ){echo 'selected="selected"'; } else{}     ?>  ></option>
								</select>
								<input type="hidden" name="symp[<?php echo $set_id;?>][setid]" value="4" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][complex]" value="0" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][alias]" value="other_alias" />
							</td>
							<td class="kvno_komentinput"><input type="text" name="symp[<?php echo $set_id;?>][comment][<?php echo $value['symptomid']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>

				 <?php else: ?>

					<?php foreach($this->symptomarr_zapv as $value):?>
						<tr  style=" border-bottom:1px dotted #ccc">
							<td ><?php echo ($value['sym_description'])?></td>
							<td style="text-align: center; "><span><?php echo $value['input_value'];?></span>
								<input type="hidden" name="symp[<?php echo $set_id;?>][current_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<input type="text" name="symp[<?php echo $set_id;?>][input_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['entered_value']?>" class="kvnosymp_input" id="input_value<?php echo $value['symptomid']?>" onkeyup="isInteger([<?php echo $value['symptomid']?>])" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][setid]" value="4" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][complex]" value="0" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][alias]" value="other_alias" />
							</td>
							<td class="kvno_komentinput"><input type="text" name="symp[<?php echo $set_id;?>][comment][<?php echo $value['symptomid']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>
				<?php endif;?>
				<tr>
				<td  colspan="4">&nbsp;</td>
				</tr>
				<tr></tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>

<?php if(in_array('symp_zapv_complex',$allowed_blocks) && $v_box == 'symp_zapv_complex'): ?>
<?php $set_id = 4; ?>
 <!--  ############################################################################## -->
 <!--  #############################  Symptomatics ZAPV Complex  ################################ -->
 <!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="symp_zapv_complex">
		<h2> + <?php echo $this->translate('block_symp_zapv_complex') ?></h2>
		<div class="contactform_dragvbox_content" id="grow3"  style="display:<?php if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
			<table  border="0" cellpadding="2" cellspacing="2" class="kvno_symptomatics" width="100%">
				<tr style="border-bottom:1px solid #ccc;  line-height: 30px">
					<th width="28%"><b>Item</b></th>
					<th width="25%" style="text-align: center;"><b></b></th>
					<th width="10%" style="text-align: center;"><b>Letzter<br/>Wert</b></th>
					<th width="10%" style="text-align: center;"><b>Aktueller<br/> Wert</b></th>
					<th width="27%"><b>Kommentar</b></th>
				</tr>

				<?php if($this->sympt_view_select == 'a'): ?>
					<?php
					$none = array(0);
					$weak = array(1,2,3,4);
					$average = array(5,6,7);
					$strong = array(8,9,10);
					$atributes_values = array(0=>'kein',1=>'leicht',2=>'leicht',3=>'leicht',4=>'leicht',5=>'mittel',6=>'mittel',7=>'mittel',8=>'schwer',9=>'schwer',10=>'schwer');
				?>

				 	<?php foreach($this->symptomarr_zapv_complex as $value):	?>
						<tr  style=" border-bottom:1px dotted #ccc">
							<td valign="top"><?php echo ($value['sym_description'])?>
							<br/>
							<a href="javascript:createnewitem(<?php echo $set_id;?>,<?php echo $value['symptomid']?>)">
									<img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="20" height="20" />
								</a>
							</td>
							<td >
							<table class="symptom_details">
							<? if(!empty($value['details'])):?>
								<? foreach($value['details'] as $dk=>$d_value) :?>
								<tr>
									<td>
										<select name="symp[<?php echo $set_id;?>][details_multiple_select][<?php echo $value['symptomid']?>][]" class="sympt_details_select">
											<option value="0"> <?php echo $this->translate('select details'); ?> </option>
												<?php foreach($value['zapv_select'] as $det_id => $det_val): ?>
											<option value="<?php echo $det_id; ?>" <?php if($d_value == $det_id):?> selected="selected"  <?php endif;?> >  <?php echo $det_val; ?> </option>
											<?php endforeach; ?>
										</select>
									</td>
									<td>
										<?php if(count($value['details']) > 1 && $dk != 0):?>
										<a class="remove_item"><img src="<?php echo RES_FILE_PATH;  ?>/images/action_delete.png"></a>
										<? endif;?>
									</td>
									</tr>
								<? endforeach; ?>
							<? else:?>
								<tr>
									<td>
									<select name="symp[<?php echo $set_id;?>][details_multiple_select][<?php echo $value['symptomid']?>][]" class="sympt_details_select">
								<option value="0"> <?php echo $this->translate('select details'); ?> </option>
								<?php foreach($value['zapv_select'] as $det_id => $det_val): ?>
								<option value="<?php echo $det_id; ?>" <?php if($value['details'] == $det_id):?> selected="selected"  <?php endif;?> >  <?php echo $det_val; ?> </option>
								<?php endforeach; ?>
								</select>
									</td>
									<td>
										
									</td>
								</tr>
							<? endif; ?>	
								
							<tr id="add_new_medi_<?php echo $value['symptomid']?>">
								<td colspan="2"></td>
							</tr>
							</table>
								<input type="hidden" name="symp[<?php echo $set_id;?>][details_select][<?php echo $value['symptomid']?>]" value="<?php echo $value['details_select']?>" /> 
							</td>
							
							<td style="text-align: center; "><span><?php echo $atributes_values [$value['input_value']];?></span>
								<input type="hidden" name="symp[<?php echo $set_id;?>][current_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<select name="symp[<?php echo $set_id;?>][input_value][<?php echo $value['symptomid']?>]"   id="input_value<?php echo $value['symptomid']?>"    class="symp_input">
									<option value="0" <?php if( in_array($value['entered_value'],$none)):?> selected="selected" <?php endif; ?>  >kein</option>
									<option value="4" <?php if( in_array($value['entered_value'],$weak)):?> selected="selected" <?php endif; ?> >leicht</option>
									<option value="7" <?php if( in_array($value['entered_value'],$average)):?> selected="selected" <?php endif; ?> >mittel</option>
									<option value="10" <?php if( in_array($value['entered_value'],$strong)):?> selected="selected" <?php endif; ?> >schwer</option>
									<option value="" <?php if( $value['entered_value'] == NULL ){echo 'selected="selected"'; } else{}     ?>  ></option>
								</select>
								<input type="hidden" name="symp[<?php echo $set_id;?>][setid]" value="4" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][complex]" value="1" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][alias]" value="alias" />
							</td>
							<td class="kvno_komentinput"><input type="text" name="symp[<?php echo $set_id;?>][comment][<?php echo $value['symptomid']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>

				 <?php else: ?>

					<?php foreach($this->symptomarr_zapv_complex as $value):?>
						<tr style=" border-bottom:1px dotted #ccc">
							<td >
								<?php echo ($value['sym_description'])?>
								<br/>
								<a href="javascript:createnewitem(<?php echo $set_id;?>,<?php echo $value['symptomid']?>)">
									<img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="30" height="30" />
								</a>
							</td>
							<td>
							<table class="symptom_details">
							<? if(!empty($value['details'])):?>
								<? foreach($value['details'] as $dk=>$d_value) :?>
								<tr>
									<td>
										<select name="symp[<?php echo $set_id;?>][details_multiple_select][<?php echo $value['symptomid']?>][]" class="sympt_details_select">
								<option value="0"> <?php echo $this->translate('select details'); ?> </option>
								<?php foreach($value['zapv_select'] as $det_id => $det_val): ?>
											<option value="<?php echo $det_id; ?>" <?php if($d_value == $det_id):?> selected="selected"  <?php endif;?> >  <?php echo $det_val; ?> </option>
											<?php endforeach; ?>
										</select>
									</td>
									<td>
										<?php if(count($value['details']) > 1 && $dk != 0):?>
										<a class="remove_item"><img src="<?php echo RES_FILE_PATH;  ?>/images/action_delete.png"></a>
										<? endif;?>
									</td>
									</tr>
								<? endforeach; ?>
							<? else:?>
								<tr>
									<td>
									<select name="symp[<?php echo $set_id;?>][details_multiple_select][<?php echo $value['symptomid']?>][]" class="sympt_details_select">
										<option value="0"> <?php echo $this->translate('select details'); ?> </option>
											<?php foreach($value['zapv_select'] as $det_id => $det_val): ?>
								<option value="<?php echo $det_id; ?>"  <?php if($value['details'] == $det_id):?> selected="selected"  <?php endif;?> ><?php echo $det_val; ?> </option>
								<?php endforeach; ?>
								</select>
									</td>
									<td>

									</td>
								</tr>
							<? endif; ?>	
								
							<tr id="add_new_medi_<?php echo $value['symptomid']?>">
								<td colspan="2">
								
								</td>
							</tr>
							</table>
								<input type="hidden" name="symp[<?php echo $set_id;?>][details_select][<?php echo $value['symptomid']?>]" value="<?php echo $value['details_select']?>" />
							</td>
							<td style="text-align: center; "><span><?php echo $value['input_value'];?></span>
								<input type="hidden" name="symp[<?php echo $set_id;?>][current_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['input_value']?>" />
							</td>
							<td class="kvno_tinyinpt">
								<input type="text" name="symp[<?php echo $set_id;?>][input_value][<?php echo $value['symptomid']?>]" value="<?php echo $value['entered_value']?>" class="kvnosymp_input" id="input_value<?php echo $value['symptomid']?>" onkeyup="isInteger([<?php echo $value['symptomid']?>])" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][setid]" value="4" />
								<input type="hidden" name="symp[<?php echo $set_id;?>][complex]" value="1" />	
								<input type="hidden" name="symp[<?php echo $set_id;?>][alias]" value="alias" />
							</td>
							<td class="kvno_komentinput"><input type="text" name="symp[<?php echo $set_id;?>][comment][<?php echo $value['symptomid']?>]" value="<?php echo $value['comment']?>" /></td>
						</tr>
					<?php endforeach;?>
				<?php endif;?>
				<tr>
				<td  colspan="4">&nbsp;</td>
				</tr>
				<tr></tr>
			</table>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>



<?php if(in_array('med',$allowed_blocks) && $v_box == 'med'): ?>
<!--  ############################################################################## -->
<!--  #############################  Medication   ################################ -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="med">
		<h2> + <?php echo $this->translate('block_med')?></h2>
		<div class="contactform_dragvbox_content" id="grow4"  style="display:<?php if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
			<div>
				<div class="medication_type_block">
				<div class="medication_container" >
					<?php echo $this->medications; ?>
					<div class="add_new_medi">
						<a href="javascript:createnewmedic()">
							<img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="20" height="20" />
							<div class="add_new_medi_link"><?php echo $this->translate('addnewmedication'); ?></div>
						</a>
					</div>
				</div>
				<div class="clearer"></div>
				</div>

				<div class="medication_type_block">
				<div class="medication_container" >
					<?php echo $this->bedarfsmedications; ?>
					<div class="add_new_medi">
						<a href="javascript:createnewmedicrowbedarf();">
							<img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="20" height="20" />
							<div class="add_new_medi_link"><?php echo $this->translate('addnewmedication'); ?></div>
						</a>
					</div>
				</div>
				<div class="clearer"></div>
				</div>

				<div class="medication_type_block">
				<div class="medication_container" >
					<?php echo $this->ivmedications; ?>
					<div class="add_new_medi">
						<a href="javascript:createnewmedicrowiv();">
							<img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="20" height="20" />
							<div class="add_new_medi_link"><?php echo $this->translate('addnewmedication'); ?></div>
						</a>
					</div>
				</div>
				<div class="clearer"></div>
				</div>

				<div class="medication_type_block">
				<div class="medication_container" >
					<p><b>Schmerzpumpe Medikation:</b></p>
					<?php echo $this->schmerze_medicgrid; ?>
				</div>
				<div class="clearer"></div>
				</div>

				<div class="medication_type_block">
				<div class="medication_container">
					<p><b><?php echo $this->translate('discontinuedmedlist'); ?></b></p>
					<input type="hidden" value="<?php echo $this->jsmedadd; ?>" id="jsmedadd" />
					<?php echo $this->delmedications ?>
				</div>
				<div class="clearer"></div>
				</div>
			<br style="clear:both;" />
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>

<?php if(in_array('befund',$allowed_blocks) && $v_box == 'befund'): ?>
<?php 
    $befund_values = array(
            'kopf',
            'thorax',
            'abdomen',
            'extremitaten',
            'haut_wunden',
            'neurologisch_psychiatrisch'
    );
?>
<!--  ############################################################################## -->
<!--  ################################# Befund   ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="befund">
	    <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_befund') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow5"  >
		<div class="inputs">
		<?php $befundl = 1;foreach($befund_values as $k => $befund_value):?>
		
		<?php  $befund_checked[$befund_value]['r1'] = $patient_befund_values[$befund_value] == '1' ? 'checked="checked"' : "" ;?> 
		<?php  $befund_checked[$befund_value]['r2'] = $patient_befund_values[$befund_value] == '2' ? 'checked="checked"' : "" ;?> 
		
			<!-- element --> 
			<div class="container">
				<div class="column">
					<label><?php echo $this->translate($befund_value.'_label')?></label>
					<ul class="cbrdList">
						<li><input type="radio" name="<?php echo $befund_value;?>" id="rd1<?php echo $befund_value;?>" <?php echo  $befund_checked[$befund_value]['r1']; ?> /><label for="rd1<?php echo $befund_value;?>">krankheitsentsprechend</label></li>
						<li><input type="radio" name="<?php echo $befund_value;?>" id="rd2<?php echo $befund_value;?>" <?php echo  $befund_checked[$befund_value]['r2']; ?> /><label for="rd2<?php echo $befund_value;?>">Befund</label></li>
					</ul>	
				</div>
				<div class="column">
					<input type="text" value="<?php echo $patient_befund_values[$befund_value.'_text'];?>">				
				</div>
			</div>
			<!-- //element -->
		
	    <?php if($befundl < count($befund_values)):?>
		<div class="lineSeparator"></div>
		<?php endif;?>
		<?php $befundl++; endforeach;?>
		</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>





<?php if(in_array('ecog',$allowed_blocks)  && $v_box == 'ecog'): ?>
<!--  ############################################################################## -->
<!--  ################################# Karnofsky   ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="ecog">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_ecog') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		
		<div class="contactform_dragvbox_content  besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow6"    >
		<div class="inputs">
		  <div class="container">
		  
		  <div class="column">
					  <label>Karnofsky :</label>
				 <select name="karnofsky" id="karnofsky">
					<option value="" <?php if(  $contact_form_details['karnofsky'] == 'NULL' || empty( $contact_form_details['karnofsky'])) {echo  'selected="selected"';}?> ><?php echo $this->translate('please_select');  ?></option>
					<?php foreach($this->karnofsky as $karnofsky_value => $karnofsky_details):?>
						<option value="<?php echo  $karnofsky_details['value']; ?>" <?php if(  $contact_form_details['karnofsky'] == $karnofsky_details['value'] ) {echo  'selected="selected"';}?> ><?php echo $karnofsky_details['label'];?></option>
					<?php endforeach;?>
				</select>
            </div>
            </div>
            </div>
 
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>



<?php if(in_array('com',$allowed_blocks)  && $v_box == 'com'): ?>
<!--  ############################################################################## -->
<!--  #############################  Kommentar   ################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="com">
		<div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_com') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow7" >
            <div class="inputs">
                <div class="container">
                    <div class="column">
    			         <label>Sonstiges / Kommentar: (Übertrag in Verlauf)</label>
            			 <textarea name="comment_block"><?php echo $contact_form_details['comment_block'];?></textarea>
		             </div>
                </div>
           </div>
		</div>
	</div>
 <!--  ############################################################################## -->
<?php endif; ?>
<?php if(in_array('careinstructions',$allowed_blocks) && $v_box == 'careinstructions'): ?>
 <!--  ############################################################################## -->
<!--  #############################  Pflege-Anweisung ############################## -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="careinstructions">
		<div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_careinstructions') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow8" >
            <div class="inputs">
                <div class="container">
                    <div class="column">
    			         <label>Pflege-Anweisung:</label>
            			 <textarea name="care_instructions"  ><?php echo $contact_form_details['care_instructions'];?></textarea>
		             </div>
                </div>
           </div>
		</div>
	</div>	
	
 <!--  ############################################################################## -->
<?php endif; ?>


<?php if(in_array('internalcomment',$allowed_blocks)  && $v_box == 'internalcomment'): ?>
 <!--  ############################################################################# -->
<!--  ############################################################################## -->
<!--  ###########################  Interner Kommentar  ############################# -->
<!--  ############################################################################## -->
 
    <div class="contactform_dragvbox" id="internalcomment">
		<div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_internalcomment') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow9" >
            <div class="inputs">
                <div class="container">
                    <div class="column">
    			         <label>Interner Kommentar:</label>
            			 <textarea name="internal_comment"  ><?php echo $contact_form_details['internal_comment'];?></textarea>
		             </div>
                </div>
           </div>
		</div>
	</div>	
	
	
	
	
 <!--  ############################################################################## -->
<?php endif; ?>




<?php if(in_array('com_ph',$allowed_blocks) && $v_box == 'com_ph'): ?>
<!--  ############################################################################## -->
<!--  #############################  Apotheke   #################################### -->
<!--  ############################################################################## -->
	
    <div class="contactform_dragvbox" id="com_ph">
		<div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_com_ph') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow10" >
            <div class="inputs">
                <div class="container">
                    <div class="column">
    			         <label>Kommentar Medikation / Pumpe / Apotheke:</label>
            			 <textarea name="comment_apotheke"  ><?php echo $contact_form_details['comment_apotheke'];?></textarea>
		             </div>
                </div>
           </div>
		</div>
	</div>	
	
	
<!--  ############################################################################## -->
<?php endif;?>

<?php if(in_array('anam',$allowed_blocks) && $v_box == 'anam'): ?>
<!--  ############################################################################## -->
<!--  #############################  Anamnese   #################################### -->
<!--  ############################################################################## -->
    <div class="contactform_dragvbox" id="anam">
		<div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_anam') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow11" >
            <div class="inputs">
                <div class="container">
                    <div class="column">
    			         <label>Anamnese:</label>
            			 <textarea name="case_history"  ><?php echo $contact_form_details['case_history'];?></textarea>
		             </div>
                </div>
           </div>
		</div>
	</div>		
	
	
<!--  ############################################################################## -->
<?php endif;?>

<?php if(in_array('ebm',$allowed_blocks) && $v_box == 'ebm'): ?>
<!--  ############################################################################## -->
<!--  #################################  EBM  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="ebm">
	     <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_ebm') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow12"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">
            			<ul class="cbrdList">
            			<?php foreach($ebm_goa_blocks['ebm'] as $ke=>$value_ebm):?>
            			<?php if($value_ebm['available'] == '1'):?>
            					<li>
            
            					<?php if( $patient_ebm_values[$value_ebm['form_item_id']] !== null): ?>
            						<input type="checkbox" name="egblock[ebm][<?php echo $value_ebm['id'];?>]" <?php if(!empty($value_ebm['form_item_id'])): ?> id="<?php echo $value_ebm['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_ebm_values[$value_ebm['form_item_id']] == '1'):?> checked="checked"<?php endif;?>  />
            					<?php else:?>
            						<input type="checkbox" name="egblock[ebm][<?php echo $value_ebm['id'];?>]" <?php if(!empty($value_ebm['form_item_id'])): ?> id="<?php echo $value_ebm['form_item_id'];?>" <?php endif;?> value="1" <?php if($patient_ebmi_values[$value_ebm['id']] == '1'):?> checked="checked"<?php endif;?>  />
            					<?php endif;?>
            						<label for="<?php echo $value_ebm['form_item_id'];?>"><?php echo $value_ebm['option_name'];?></label>
            					</li>
            			<?php endif; ?>
            
            			<?php endforeach; ?>
            			</ul>
			         </div>
			     </div>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php if(in_array('ebmii',$allowed_blocks) && $v_box == 'ebmii'): ?>
<!--  ############################################################################## -->
<!--  #################################  EBM II ##################################### -->
<!--  ############################################################################## -->
    <div class="contactform_dragvbox" id="ebmii">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_ebmii') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
        
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow13"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">
            			<ul class="cbrdList">
            			<?php foreach($ebm_goa_blocks['ebmii'] as $keii=>$value_ebmii):?>
            			<?php if($value_ebmii['available'] == '1'):?>
            					<li>
            							<?php if($value_ebmii['source'] == "xbdt"):?>
            								<input type="checkbox" name="egblock[ebmii][<?php echo $value_ebmii['id'];?>][value]"   value="1" <?php if($patient_xbdt_ebmii_values[$value_ebmii['id']]['value'] == '1'):?> checked="checked"<?php endif;?>   id="<?php echo $value_ebmii['source'].$value_ebmii['id'];?>"    />
            								<input type="hidden"  name="egblock[ebmii][<?php echo $value_ebmii['id'];?>][patient_xbdt_action_id]" value="<?php echo  $patient_xbdt_ebmii_values[$value_ebmii['id']]['patient_xbdt_action_id'] ; ?>" />
                						    <label  for="<?php echo $value_ebmii['source'].$value_ebmii['id'];?>"><?php echo $value_ebmii['option_name'];?></label> 
            							<?php else:?>
            								<input type="checkbox" name="egblock[ebmii][<?php echo $value_ebmii['id'];?>][value]"  value="1"  <?php if($patient_ebmii_values[$value_ebmii['id']] == '1'):?> checked="checked"<?php endif;?>         <?php if(!empty($value_ebmii['form_item_id'])): ?> id="<?php echo $value_ebmii['form_item_id'];?>" <?php else:?> id="<?php echo $value_ebmii['source'].$value_ebmii['id'];?>" <?php endif;?>      />
            						    <label  <?php if(!empty($value_ebmii['form_item_id'])): ?> for="<?php echo $value_ebmii['form_item_id'];?>" <?php else:?> for="<?php echo $value_ebmii['source'].$value_ebmii['id'];?>" <?php endif;?> ><?php echo $value_ebmii['option_name'];?></label> 
            							<?php endif;?>
            							<input type="hidden"  name="egblock[ebmii][<?php echo $value_ebmii['id'];?>][source]" value="<?php echo $value_ebmii['source']?>" />
            					</li>
            			<?php endif; ?>
            			<?php endforeach; ?>
            			</ul>
			         </div>
			     </div>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php if(in_array('goa',$allowed_blocks) && $v_box == 'goa'): ?>
<!--  ############################################################################## -->
<!--  #################################  GOA   ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="goa">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_goa') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow14"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">
            			<ul class="cbrdList">
                			<?php foreach($ebm_goa_blocks['goa'] as $kg=>$value_goa):?>
                			<?php if($value_goa['available'] == '1'):?>
                				<li>
                						<?php if( $patient_goa_values[$value_goa['form_item_id']] !== null): ?>
                							<input type="checkbox" name="egblock[goa][<?php echo $value_goa['id'];?>]" <?php if(!empty($value_goa['form_item_id'])): ?> id="<?php echo $value_goa['form_item_id'];?>" <?php endif;?>  <?php if(!empty($value_goa['form_item_class'])): ?> class="<?php echo $value_goa['form_item_class'];?>" <?php endif;?> value="1" <?php if($patient_goa_values[$value_goa['form_item_id']] == '1'):?> checked="checked"<?php endif;?>  />
                						<?php else: ?>
                							<input type="checkbox" name="egblock[goa][<?php echo $value_goa['id'];?>]" <?php if(!empty($value_goa['form_item_id'])): ?> id="<?php echo $value_goa['form_item_id'];?>" <?php endif;?>  <?php if(!empty($value_goa['form_item_class'])): ?> class="<?php echo $value_goa['form_item_class'];?>" <?php endif;?> value="1" <?php if($patient_goai_values[$value_goa['id']] == '1'):?> checked="checked"<?php endif;?>  />
                						<?php endif; ?>
                						 <label <?php if(!empty($value_goa['form_item_id'])): ?> for="<?php echo $value_goa['form_item_id'];?>" <?php else:?> for="<?php echo 'goa'.$value_goa['id'];?>" <?php endif;?> ><?php echo $value_goa['option_name'];?></label> 
                				</li>
                			<?php endif;?>
			                 <?php endforeach; ?>
			             </ul>
			         </div>
			     </div>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>


<?php if(in_array('goaii',$allowed_blocks) && $v_box == 'goaii'): ?>
<!--  ############################################################################## -->
<!--  #################################  GOA II  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="goaii">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_goaii') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow15"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">
                        <div id="goaii_actions">
                			<ul class="cbrdList"  >
                			<?php foreach($ebm_goa_blocks['goaii'] as $kgii=>$value_goaii):?>
                				<?php if($value_goaii['available'] == '1'):?>
                				    <li>
                						<?php if($value_goaii['source'] == "xbdt"):?>
                							<input type="checkbox" name="egblock[goaii][<?php echo $value_goaii['id'];?>][value]" value="1" <?php if($patient_xbdt_goaii_values[$value_goaii['id']]['value'] == '1'):?> checked="checked"<?php endif;?>  id="<?php  echo !empty($value_goaii['form_item_id']) ? $value_goaii['form_item_id'] : 'goaii'.$value_goaii['id'] ?>"   />
                    						<label><?php echo $value_goaii['option_id'];?> - <?php echo $value_goaii['option_name'];?></label>
                							<input type="hidden"  name="egblock[goaii][<?php echo $value_goaii['id'];?>][patient_xbdt_action_id]" value="<?php echo  $patient_xbdt_goaii_values[$value_goaii['id']]['patient_xbdt_action_id'] ; ?>" />
                						<?php else:?>
                							<input type="checkbox" name="egblock[goaii][<?php echo $value_goaii['id'];?>][value]" value="1" <?php if($patient_goaii_values[$value_goaii['id']] == '1'):?> checked="checked"<?php endif;?>   id="<?php  echo !empty($value_goaii['form_item_id']) ? $value_goaii['form_item_id'] : 'goaii'.$value_goaii['id'] ?>"  />
                	       					<label><?php echo $value_goaii['option_id'];?> - <?php echo $value_goaii['option_name'];?></label>
                						<?php endif;?>
                							<input type="hidden"  name="egblock[goaii][<?php echo $value_goaii['id'];?>][source]" value="<?php echo $value_goaii['source']?>" />
                				    </li>
                				<?php endif;?>
                			<?php endforeach; ?>
                			</ul>
			             </div>
			         </div>
			     </div>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>



<?php if(in_array('sgbv',$allowed_blocks) && $v_box == 'sgbv'): ?>
<!--  ############################################################################## -->
<!--  #############################  SGBV / SAPV  ################################## -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="sgbv">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_sgbv') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
	
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow16"   >
            <div class="inputs">
                <div class="container">
                    <div class="column">
            			<ul  class="cbrdList"   id="social_actions_list">
            				<?php foreach($this->sgbv_actions as $action=>$action_details):?>
            				<li  id="action_row_<?php echo $action_details['id']?>"  class="<?php if ($action_details['custom'] == '1' && $action_details['extra'] == '0'){echo 'custom_action'; } else { echo 'regular_action'; } ?>"  >
            					<input type="checkbox" id="social_action[<?php echo $action_details['id']?>]" name="social_action[<?php echo $action_details['id']?>]" value="1" <?php if($this->patient_sgbv[$action_details['id']] == '1'):?> checked="checked" <?php endif; ?> />
            					<label for="social_action[<?php echo $action_details['id']?>]"><?php echo $action_details['action_name'];?></label>
            				</li>
            	 			<?php endforeach;?>
            			</ul>
			         </div>
        			 <div class="column">
        					<button class="btnTextBlue add_action"><?php echo $this->translate('add_custom_action')?></button>
        			 </div>
                </div>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>




<?php if(in_array('classification',$allowed_blocks) && $v_box == 'classification'): ?>
<!--  ############################################################################## -->
<!--  #################################  Classification  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="Classification">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_classification') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
	
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow17"   >
		  <div class="inputs">
                <div class="container">
                    <div class="column">
                    <ul class="cbrdList">
                        <li>
    						<input type="checkbox" name="beratung" id="beratung" value="1" <?php if($patient_classification_values['beratung'] == '1'):?> checked="checked"<?php endif;?>  />
    						<label for="beratung"><?php echo $this->translate('block_option_beratung');  ?></label>
    					</li>
    
    					<li>
    						<input type="checkbox" name="koordination"  id="koordination" value="1" <?php if($patient_classification_values['koordination'] == '1'):?> checked="checked"<?php endif;?>   />
    						<label for="koordination"><?php echo $this->translate('block_option_koordination');  ?></label>
    					</li>
    
    					<li>
    						<input type="checkbox" name="intern"  id="intern" value="1" <?php if($patient_classification_values['intern'] == '1'):?> checked="checked"<?php endif;?>   />
    						<label for="intern"><?php echo $this->translate('block_option_intern')  ?></label>
    					</li>
    					<li>
    						<input type="checkbox" name="psyhosocial"  id="psyhosocial" value="1" <?php if($patient_classification_values['psyhosocial'] == '1'):?> checked="checked"<?php endif;?>   />
    						<label for="psyhosocial"><?php echo $this->translate('block_option_psyhosocial')  ?></label>
    					</li>
    					<li>
    						<input type="checkbox" name="grief_endcall"  id="grief_endcall" value="1" <?php if($patient_classification_values['grief_endcall'] == '1'):?> checked="checked"<?php endif;?>   />
    						<label for="grief_endcall"><?php echo $this->translate('block_option_grief_endcall')  ?></label>
    					</li>
                            
                    </ul>
			</div>
			</div>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>




<?php if(in_array('bra_sapv',$allowed_blocks) && $v_box == 'bra_sapv'): ?>
<!--  ############################################################################## -->
<!--  #################################bra_sapv  BRA - SAPV Team - Hausarzt Einsatz  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="bra_sapv">
		<div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_bra_sapv') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow18"  >
           <div class="inputs">
                <div class="container">
                    <div class="column">		
                    <ul class="cbrdList"  >
                       <li>
                            <input type="checkbox" name="sapv_team_doctor" id="PCT05" value="1" <?php if($patient_bra_sapv_values['sapv_team_doctor'] == '1'):?> checked="checked"<?php endif;?>  />
					       <label for="PCT05">Einsatz SAPV Team mit Hausarzt (PCT05 - HF02)</label>
					   </li>
			         </ul>
			         </div>
			     </div>
            </div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>



<?php if(in_array('additional_users',$allowed_blocks) && $v_box == 'additional_users'): ?>
<?

?>
<!--  ############################################################################## -->
<!--  ################################# Display all users of client  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="additional_users">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_additional_users') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow19"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">		
            			<ul class="cbrdList" >
        					<?php	foreach ($client_users as $kuser => $vuser):?>
        					<?php if($vuser['id'] ==  $form_create_user): ?>
        					<li>
    							<input type="checkbox" disabled="disabled" checked="checked"  />
    						    <label for="additional_users[<?php echo $vuser['id']?>]"><?php echo $vuser['user_title'].' '.$vuser['last_name'].', '.$vuser['first_name'];?></label>
    							<input type="hidden"  id="additional_users[<?php echo $vuser['id']?>]" name="additional_users[<?php echo $vuser['id']; ?>][value]" value="1"  />
    							<input type="hidden" name="additional_users[<?php echo $vuser['id']; ?>][creator]" value="1" />
        					</li>
        					<?php else:?>
        					<li>
        						<input type="checkbox" id="additional_users[<?php echo $vuser['id']?>]" name="additional_users[<?php echo $vuser['id']; ?>][value]" value="1"  <?php if( in_array($vuser['id'],$additional_users)):?> checked="checked" <?php endif; ?> />
                                <label for="additional_users[<?php echo $vuser['id']?>]"><?php echo $vuser['user_title'].' '.$vuser['last_name'].', '.$vuser['first_name'];?></label>
        						<input type="hidden" name="additional_users[<?php echo $vuser['id']; ?>][creator]" value="0" />
        					</li>
        
        					<?php endif;?>
        
        					<?php endforeach; ?>
            			</ul>
			         </div>
			     </div>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>



<?php if(in_array('sgbxi',$allowed_blocks) && $v_box == 'sgbxi'): ?>
<!--  ############################################################################## -->
<!--  #################################  SGBV XI ( Qualitätssicherungsbesuch )  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="sgbxi">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_sgbxi') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow20"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">		
                        <ul class="cbrdList" >
                            <li>
        						<input type="checkbox" name="sgbxi_quality" id="sgbxi_quality" value="1" <?php if($contact_form_details['sgbxi_quality'] == '1'):?> checked="checked"<?php endif;?>  />
        						<label for="sgbxi_quality"><?php echo $this->translate('block_option_quality');  ?></label>
                            </li>
                        </ul>
                    </div>
                </div>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>




<?php
 if(in_array('measures',$allowed_blocks) && $v_box == 'measures'): ?>
<!--  ############################################################################## -->
<!--  #################################  MEASURES Maßnahmen  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="measures">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_measures') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow21"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">		
            			<ul class="cbrdList" >
                			<?php foreach($measures_blocks as $kmeasures=>$value_measures):?>
                			<?php if($value_measures['available'] == '1'):?>
            					<li>
            						<input type="checkbox" name="egblock[measures][<?php echo $value_measures['id'];?>]" <?php if(!empty($value_measures['form_item_id'])): ?> id="<?php echo $value_measures['form_item_id'];?>" <?php else: ?> id="<?php echo 'measures'.$value_measures['id'];?>" <?php endif;?> value="1" <?php if($patient_measures_values[$value_measures['id']] == '1'):?> checked="checked"<?php endif;?>  />
            						<label <?php if(!empty($value_measures['form_item_id'])): ?> for="<?php echo $value_measures['form_item_id'];?>" <?php else: ?> for="<?php echo 'measures'.$value_measures['id'];?>" <?php endif;?>><?php echo $value_measures['option_name'];?></label>
            					</li>
                			<?php endif; ?>
                			<?php endforeach; ?>
            			</ul>
			         </div>
			     </div>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>



<?php if(in_array('befund_txt',$allowed_blocks) && $v_box == 'befund_txt'): ?>
<!--  ############################################################################## -->
<!--  ############################# BEFUND text ############################## -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="befund_txt">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_befund_txt') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow22"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">	
             			<textarea name="befund_txt"><?php echo $contact_form_details['befund_txt'];?></textarea>
             		</div>
                </div>
            </div>             		
		</div>
	</div>
 <!--  ############################################################################## -->
<?php endif; ?>


<?php if(in_array('free_visit',$allowed_blocks) && $v_box == 'free_visit'): ?>
<!--  ############################################################################## -->
<!--  #################################  Nicht berechnen in internen Rechnungen  ##################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="sgbxi">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_free_visit') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow23"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">	
                        <ul class="cbrdList">
                            <li>
        						<input type="checkbox" name="free_visit" id="free_visit" value="1" <?php if($contact_form_details['free_visit'] == '1'):?> checked="checked"<?php endif;?>  />
        						<label for="free_visit"><?php echo $this->translate('block_option_free_visit');  ?></label>
    						</li>
                        </ul>
                    </div>
                </div>
            </div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>




<?php if(in_array('therapy',$allowed_blocks) && $v_box == 'therapy'): ?>
<!--  ############################################################################## -->
<!--  ############################# Therapie text ############################## -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="therapy">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_therapy') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow24"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">
     			        <textarea name="therapy_txt"><?php echo $contact_form_details['therapy_txt'];?></textarea>
     			    </div>
     			</div>
     		</div>
        </div>
	</div>
 <!--  ############################################################################## -->
<?php endif; ?>




<?php
 if(in_array('sgbxi_actions',$allowed_blocks) && $v_box == 'sgbxi_actions'): ?>
<!--  ############################################################################## -->
<!--  #######################  sgbxi_actions SGB XI Leistungen  #################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="sgbxi_actions">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_sgbxi_actions') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow25"  >		
            <div class="inputs">
                <div class="container">
                    <div class="column">		
            			<ul class="cbrdList" >
                			<?php foreach($sgbxi_actions_blocks as $ksgbxia=>$v_sgbxi_act):?>
                			<?php if($v_sgbxi_act['available'] == '1'):?>
                					<li>
                						<input type="checkbox" name="egblock[sgbxi_actions][<?php echo $v_sgbxi_act['id'];?>]"  value="1" <?php if($patient_sgbxi_actions_values[$v_sgbxi_act['id']] == '1'):?> checked="checked"<?php endif;?> id="<?php echo $v_box.$v_sgbxi_act['id'] ?>"   />
                						<label for="<?php echo $v_box.$v_sgbxi_act['id'] ?>"><?php echo $v_sgbxi_act['option_name'];?></label>
                					</li>
                			<?php endif; ?>
                			<?php endforeach; ?>
			             </ul>
			         </div>
			     </div>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php
 if(in_array('ebm_ber',$allowed_blocks) && $v_box == 'ebm_ber'): ?>
<!--  ############################################################################## -->
<!--  #######################  ebm_ber EBM BER_Anthrocare. #################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="ebm_ber">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_ebm_ber') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow26"  >	
            <div class="inputs">
                <div class="container">
                    <div class="column">		
            			<?php foreach($ebm_ber_blocks  as $cat_id=>$cat_values):?>
            			<ul class="cbrdList" >
            				<li>
            					<?php echo $cat_values['category'];?>
            				</li>
            				<?php foreach($cat_values['actions'] as $kebmber=>$v_ebm_ber):?>
            					<?php if($v_ebm_ber['available'] == '1'):?>
            							<li>
            								 <input type="checkbox" name="egblock[ebm_ber][<?php echo $v_ebm_ber['id'];?>]" id="act[ebm_ber][<?php echo $v_ebm_ber['id'];?>]"  value="1" <?php if($patient_ebm_ber_values[$v_ebm_ber['id']] == '1'):?> checked="checked"<?php endif;?>  />
            								 <label for="act[ebm_ber][<?php echo $v_ebm_ber['id'];?>]" ><?php echo $v_ebm_ber['option_name'];?></label>
            							</li>
            					<?php endif; ?>
            				<?php endforeach; ?>
            			</ul>
            			<?php endforeach; ?>
			         </div>
			     </div>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

<?php
 if(in_array('vital_signs',$allowed_blocks) && $v_box == 'vital_signs'): ?>
<!--  ############################################################################## -->
<!--  #######################  vital_signs Vitalwerte #################### -->
<!--  ############################################################################## -->

<div class="contactform_dragvbox" id="vital_signs">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_vital_signs') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow27"  >	
		<div class="inputs">
			
			<div class="container double">
				<div class="column fullwidth">
					<label>Datum:</label>								<!-- TODO-3554 Lore 27.10.2020 -->
					<input type="text" name="signs_date" id="kvno_signs_date" readonly="readonly" class="date datepick signs_haschanged" value="<?php echo date('d.m.Y',strtotime($vital_signs_arr['signs_date'])); ?>"/>
				</div>
		 
				<div class="column col1 timeselect">	
					<label>Zeit:</label>
					<select name="signs_date_h" id="signs_date_h" class="first signs_haschanged" data-haschanged="<?php if( ! empty($_REQUEST['cid'])) {echo '1';} else {echo '0';} ?>" onchange="signs_haschanged(this)";>
						<option value="00">00</option>
						<?php for ($i=1; $i<=23; $i++){?>
						<option value="<?php echo str_pad($i, 2 ,"0" ,STR_PAD_LEFT); ?>" <?php if(( ! empty($_REQUEST['cid']) && str_pad($i,2,"0",STR_PAD_LEFT) == date('H',strtotime($vital_signs_arr['signs_date']))) ||  ( empty($_REQUEST['cid']) && str_pad($i,2,"0",STR_PAD_LEFT) == $contact_form_details['begin_date_h'])){echo 'selected="selected"';}?>><?php echo str_pad($i ,2, "0",STR_PAD_LEFT); ?></option>								
						<?php }?>
					</select>
					
                     <select name="signs_date_m" id="signs_date_m" class="last signs_haschanged" data-haschanged="<?php if( ! empty($_REQUEST['cid'])) {echo '1';} else {echo '0';} ?>" onchange="signs_haschanged(this)";>
						<option value="00">00</option>
						<?php for ($i=1; $i<=59; $i++){?>
						<option value="<?php echo str_pad($i, 2 ,"0" ,STR_PAD_LEFT); ?>" <?php if(( ! empty($_REQUEST['cid']) &&  str_pad($i,2,"0",STR_PAD_LEFT) == date('i',strtotime($vital_signs_arr['signs_date']))) || ( empty($_REQUEST['cid']) && str_pad($i,2,"0",STR_PAD_LEFT) == $contact_form_details['begin_date_m'] )){echo 'selected="selected"';}?>><?php echo str_pad($i ,2, "0",STR_PAD_LEFT); ?></option>
						<?php }?>
			     	</select>
				</div>
			</div>
			
			<div class="lineSeparator"></div>
			
			<div class="container double">
				
				<!-- element -->
				<div class="column col1">	
					<label>RR</label>
					<input type="text" name="blood_pressure_a"  value="<?php if(empty($vital_signs_arr['blood_pressure_a']) || $vital_signs_arr['blood_pressure_a'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr['blood_pressure_a'],'2', ',', '.');} ?>"/>		 
				</div>
				<div class="column col-sep"><span> / </span></div>
				<div class="column col2">
					<label>mmHg</label>
					<input type="text" name="blood_pressure_b"  value="<?php if (empty($vital_signs_arr['blood_pressure_b']) || $vital_signs_arr['blood_pressure_b'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr['blood_pressure_b'],'2', ',', '.');} ?>" />		
				</div>
				
				
				
				<!-- element -->
				<div class="column col1">	
					<label>Puls</label>
					<input type="text" name="puls"   value="<?php if(empty($vital_signs_arr['puls']) || $vital_signs_arr['puls'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr['puls'],'2',',','.');} ?>"/>		 
				</div>
				<div class="column col-sep-big"><span> /min. </span></div>

				
				
				<!-- element -->
				<div class="column col1">	
					<label>Atemfrequenz</label>
					<input type="text" name="respiratory_frequency"   value="<?php if(empty($vital_signs_arr['respiratory_frequency']) || $vital_signs_arr['respiratory_frequency'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr['respiratory_frequency'],'2',',','.');} ?>" class="rightAlign"/>		 
				</div>
				<div class="column col-sep-big"><span> /min. </span></div>
				<!-- element -->
				
				
				<div class="column col1">	
					<label>Temperatur</label>
					<input type="text" name="temperature"  value="<?php if(empty($vital_signs_arr['temperature']) || $vital_signs_arr['temperature'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr['temperature'],'2',',','.');} ?>" />		 
				</div>
				<div class="column col-sep"><span><sup>0</sup>C </span></div>
				<div class="column col2">
					<label>&nbsp;</label>
					 <select name="temperature_dd" class="last">
						 	<option value="1" <?php if(  $vital_signs_arr['temperature_dd'] == '1' ) {echo  'selected="selected"';}?> >im Ohr</option>
						 	<option value="2" <?php if(  $vital_signs_arr['temperature_dd'] == '2' ) {echo  'selected="selected"';}?> >oral</option>
						 	<option value="3" <?php if(  $vital_signs_arr['temperature_dd'] == '3' ) {echo  'selected="selected"';}?> >rektal</option>
							<!-- TODO-3513 Lore 12.10.2020 -->
							<option value="4" <?php if(  $vital_signs_arr['temperature_dd'] == '4' ) {echo  'selected="selected"';}?> >in der Blase</option>
						 	<option value="5" <?php if(  $vital_signs_arr['temperature_dd'] == '5' ) {echo  'selected="selected"';}?> >axillar</option>
						 	<option value="6" <?php if(  $vital_signs_arr['temperature_dd'] == '6' ) {echo  'selected="selected"';}?> >an der Stirn</option>
					 </select>
				</div>
				<!-- element -->
				<div class="column col1">	
					<label>Sauerstoffsättigung</label>
					<input type="text" name="oxygen_saturation"   value="<?php if(empty($vital_signs_arr['oxygen_saturation']) || $vital_signs_arr['oxygen_saturation'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr['oxygen_saturation'],'2',',','.');} ?>"  />		 
				</div>
				<div class="column col-sep-big"><span>%</span></div>
				
				
				
				<!-- element -->
				<div class="column col1">	
					<label>BZ</label>
					<input type="text" name="blood_sugar"   value="<?php if(empty($vital_signs_arr['blood_sugar']) || $vital_signs_arr['blood_sugar'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr['blood_sugar'],'2',',','.');} ?>" />		 
				</div>
				<div class="column col-sep-big"><span> </span></div>
				
				
				<!-- element -->
				<div class="column col1">	
					<label>Gewicht</label>
					<input type="text" name="weight"  value="<?php if(empty($vital_signs_arr['weight']) || $vital_signs_arr['weight'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr['weight'],'2',',','.');} ?>"/>	 
				</div>
				<div class="column col-sep-big"><span>kg</span></div>
				
				
				<!-- element -->
				<div class="column col1">	
					<label>Größe</label>
					<input type="text" name="height" value="<?php if(empty($vital_signs_arr['height']) || $vital_signs_arr['height'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr['height'],'2',',','.');} ?>" />		 
				</div>
				<div class="column col-sep-big"><span>cm</span></div>
				
				
				
				<?php if($this->show_head_circumference == "1"):?>
				<!-- element -->
				<div class="column col1">	
					<label>Kopfumfang</label>
					<input type="text" name="head_circumference"  value="<?php if(empty($vital_signs_arr['head_circumference']) || $vital_signs_arr['head_circumference'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr['head_circumference'],'2',',','.');} ?>"/> 
				</div>
				<div class="column col-sep-big"><span>cm</span></div>
				<?php endif;?>
				
				
				<!-- element -->
				<div class="column col1">	
					<label>Bauchumfang</label>
					<input type="text" name="waist_circumference"   value="<?php if(empty($vital_signs_arr['waist_circumference']) || $vital_signs_arr['waist_circumference'] == '0.00') {echo '';} else {echo number_format($vital_signs_arr['waist_circumference'],'2',',','.');} ?>"/> 
				</div>
				<div class="column col-sep-big"><span>cm</span></div>
				<!-- element -->
			</div>
		</div>
	</div>
</div>

<!--  ############################################################################## -->
<?php endif; ?>



<?php
 if(in_array('bowel_movement',$allowed_blocks) && $v_box == 'bowel_movement'): ?>
<!--  ############################################################################## -->
<!--  #######################   Stuhlgang or bowel movement   #################### -->
<!--  ############################################################################## -->
<?php
if (isset($patient_bowel_movement_values['bowel_movement_date'])){
	$myTime = date("d.m.Y", strtotime($patient_bowel_movement_values['bowel_movement_date']));
}else{
	$myTime = date("d.m.Y");
}
?>
<style>
	.yellow_bg{
		background-color: #ffffe0;
	}
</style>
<script type="text/javascript">
	$(document).ready(function(){	
		$('#bowel_movement_date').datepicker({
			dateFormat: 'dd.mm.yy',
			showOn: "both",
			buttonImage: $('#calImg').attr('src'),
			buttonImageOnly: true,
			changeMonth: true,
			changeYear: true,
			nextText: '',
			prevText: '',
			maxDate: '<?php echo date("d.m.Y"); ?>'
		})
			.mask("99.99.9999")
			.css({"margin":"0"});
		$('#bowel_movement_table tr')
			.focusin(function() {$(this).addClass("yellow_bg")})
			.focusout(function() {$(this).removeClass("yellow_bg")});
		
	});
</script>
	<div class="contactform_dragvbox" id="bowel_movement">
		<div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_bowel_movement') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow28"  >
			<div class="inputs">
			<div class="container">
				<div class="column">
					<ul class="cbrdList">
						<li>
                            <input type="checkbox" name="bowel_movement[bowel_movement]" id="bowel_movement_option" value="1" <?php if($patient_bowel_movement_values['bowel_movement'] == '1'): ?> checked="checked"<?php endif; ?>  />
                            <label for="bowel_movement_option"><?php echo $this->translate('block_option_bowel_movement'); ?></label>
                        </li>
					</ul>	
				</div>
				<div class="column">
					<input type="text" name="bowel_movement[bowel_movement_date]"  class="date" id="bowel_movement_date"    value="<?php echo $myTime; ?>"  />
				</div>
				<div class="column">
					<label><?php echo $this->translate('block_bowel_movement_description'); ?></label>
					<textarea name="bowel_movement[bowel_movement_description]" id="bowel_movement_description" class="textarea_full"><?php if(isset($patient_bowel_movement_values['bowel_movement_description'])) echo $patient_bowel_movement_values['bowel_movement_description']; ?></textarea>
				</div>
			</div>

		</div>
			

		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>

 <?php 
if(in_array('hospiz_imex',$allowed_blocks) && $v_box == 'hospiz_imex'): ?>
<!--  ############################################################################## -->
<!--  #######################   Hospiz II(hospiz_imex)   #################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id=hospiz_imex>
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('hospiz_imex') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow29"  >
			<div class="inputs">
			<div class="container">
				<div class="column">
				    <label for="import"><?php echo $this->translate('import_hospiz'); ?></label>
				    <input type="text" name="import" size="63" value="<?php if(empty($this->patient_hzimex['import'])) {echo ''; } else {echo $this->patient_hzimex['import']; }?>"> 
				</div>
				<div class="column">
				    <label for="export"><?php echo $this->translate('export_hospiz'); ?></label>
				    <input type="text" name="export" size="63" value="<?php if(empty($this->patient_hzimex['export'])) {echo ''; } else {echo $this->patient_hzimex['export']; }?>"> 
				</div>
			     </div>
			     </div>
			</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>
 

<?php
 if(in_array('hospiz_medi',$allowed_blocks) && $v_box == 'hospiz_medi'): ?>
<!--  ############################################################################## -->
<!--  #######################   Hospiz I(hospiz_medi)   #################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="hospiz_medi">
	    <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('hospiz_medi') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content  besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow30"  >
            <div class="inputs whitecontainer">
                <div class="container">
            			<?php foreach($this->medication_hp as $type => $medication_n):?>
        				    <h3 class="header"><?php  echo $this->translate('medication_'.$type); ?></h3>
        				    <div class="lineSeparator"></div>
            				<?php foreach($medication_n as $med_id => $val): ?>
            				
            				<!-- element -->
            				<div class="column">
            					<label>Medikation</label>
            					<div class="fieldText"><?php echo  $val['medication']; ?>	</div>
            					 <input type="hidden" name="hospiz_med[<?php echo  $med_id; ?>][medication]"  value=" <?php echo  $val['medication']; ?>">
            				</div>
            				<div class="column">
            					<label>Medikation Dosierung	</label>
            					<div class="fieldText"><?php echo  $val['dosage']; ?></div>
            					<input type="hidden" name="hospiz_med[<?php echo  $med_id; ?>][dosage]"  value=" <?php echo  $val['dosage']; ?>">	
            				</div>
            				<div class="column">
            					<ul class="cbrdList double">
            						<li><input type="checkbox" name="hospiz_med[<?php echo  $med_id; ?>][sprepared]"  value="1" <?php  if($this->patient_hzmedi[ $med_id]['sprepared'] ==1 ):  ?> checked ="checked" <?php endif; ?>  id="hospiz_med_s<?php echo  $med_id.$type; ?>" /> <label for="hospiz_med_s<?php echo  $med_id.$type; ?>">Gestellt</label></li>
            						<li><input type="checkbox" name="hospiz_med[<?php echo  $med_id; ?>][given]"      value="1" <?php  if($this->patient_hzmedi[ $med_id]['given']     ==1 ):  ?> checked ="checked" <?php endif; ?>  id="hospiz_med_g<?php echo  $med_id.$type; ?>" /> <label for="hospiz_med_g<?php echo  $med_id.$type; ?>">Verabreicht</label></li>
            					</ul>	
            				</div>
            				<!-- element -->
            				<div class="lineSeparator"></div>
                           <?php  endforeach; ?>
            			<?php endforeach;?>
                    </div>
                </div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>




<?php
 if(in_array('med_time_dosage',$allowed_blocks) && $v_box == 'med_time_dosage'): ?>
<!--  ############################################################################## -->
<!--  #######################   Medication New   #################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="med_time_dosage">
		<h2> + <?php echo $this->translate('block_med_time_dosage'); ?></h2>
		<div class="contactform_dragvbox_content" id="grow28"  style="display:<?php if($opened_blocks[$v_box] == '1'): echo 'block'; else: echo 'none'; endif;?>;">
			 <div class="medication_new" style="display: block; float:none; width: 100%; height: 100%;">
			 
			 </div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>





<?php //if((in_array('ipos',$allowed_blocks) || in_array('lmu_visit',$allowed_blocks)) && $v_box == 'ipos' && (in_array('pflegeipos',$allowed_blocks)==false)): ?>
<?php if(in_array('ipos',$allowed_blocks) && $v_box == 'ipos'): ?>
<!--  ############################################################################## -->
<!--  ###############################  IPOS   ###################################### -->
<!--  ############################################################################## -->
	<?php $iposhist=$this->patient_ipos_hist_values;?>

<script>

    $(document).ready(function(){
		
		$('#ipos_date').datepicker();
		
        if($('#lmu_pmba_sympt').length==1){
            var newwrap=$("<div class='ipos'></div>");
            $(newwrap).append($('#lmu_pmba_sympt'));
            $($('#ipos div')[3]).after(newwrap);
            $('#lmu_pmba_sympt .contactform_dragvbox_content').hide();


                var iposaddrows=$('.iposappendable tr input[type=text]').length;
                $('#ipos').on('change','#ipos ul.linktoipos input[type=checkbox]', function(){
                    if($(this).attr('checked')=="checked"){
                        var newel=$('.iposappendable .jsclonepool').clone();
                        $(newel).removeClass('jsclonepool');
                        iposaddrows=iposaddrows+1;
                        $(newel).find('input').each(function(){
                            var elemn = $(this).attr('name');
                            elemn = elemn.replace('0', iposaddrows);
                            $(this).attr('name', elemn);
                        });

                        $(newel).find('input[type=text]').val($(this).val());
                        $(newel).show();

                        $('.iposappendable').append(newel);
                    }
                    else{
                        var elemn = $(this).val();
                        $('.iposappendable').find('input').each(function(){

                            if ($(this).val()==elemn) {
                                $(this).parents('tr').remove();
                            }
                        });
                    }
                });


        }
    });

</script>
<style type="text/css">
input.long{
	width:700px;
	margin-left:1em;
	}
	
div.ipos  td.seven_first{
	width:210px;
	}
div.ipos  td.seven_other{
	width:88px;
	text-align:center;
	vertical-align:middle;
	
	}	
div.ipos  td.legend{
	background-color:#e1e1e1;
	font-size: 10px;
	}
	
div.ipos{
	margin-top:1em;
	}
tr.zebra{
	background-color:#F4F4F4;
	}
div.iposhighlighter tr:hover td{
	background-color:#c0ffc0;
	}

}

</style>
    <?php if (!in_array('ipos',$allowed_blocks)):?>
        <div class="contactform_dragvbox iposbodywrap"  id="ipos" style="display:none;" onlyondemand="onlyondemand">
    <?php else:?>
        <div class="contactform_dragvbox iposbodywrap"  id="ipos" >
    <?php endif;?>


		<h2> + <? echo $this->translate('block_ipos') ?></h2>
		<div class="contactform_dragvbox_content" id="ipos"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
		<div class="ipos">
				<table border="0" cellspacing="2" cellpadding="2" style="width:100%;">
					<tr>
						<td colspan="4"><b>Ermittlung</b></td>
					</tr>
					<tr>
						<td style="width:150px;">
							Zeitpunkt der Erhebung
						</td>
						<td colspan="3">
							<?php
							$thistime=strtotime($patient_ipos_values['date']);
							if($thistime>strtotime('2010-01-01 20:00:00')){
								$thisdate=date('d.m.Y', $thistime);
								$thishours=date('H', $thistime);
								$thismins=date('i', $thistime);
								
							}else{
								$thisdate=date('d.m.Y');
								$thishours=date('H');
								$thismins=date('i');
							}

							$thisuser=($patient_ipos_values['user']!="")? $patient_ipos_values['user'] : $this->form_create_user;
							$thistraffic=$this->patient_traffic_status;
							if($patient_ipos_values['status']){
								$thistraffic=$this->patient_traffic_status;
								}
							?>
							<input type="hidden" name="ipos[status]" value="<?php echo $thistraffic;?>"> 
							<input type="text" name="ipos[date]"  id="ipos_date" style="width:80px;padding:3px;" value="<? echo $thisdate; ?>" />,
							
							<select name="ipos[date_h]" style="margin-left:8px;">
								<option value="00">00</option>
								<?php for ($i=1; $i<=23; $i++){?>
									 <option value="<?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?>" <?php if(str_pad($i, 2, "0", STR_PAD_LEFT) == $thishours ){ echo 'selected="selected"';}?>><?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?></option>
								<?php }?>
							</select>
							:
							<select name="ipos[date_m]">
								<option value="00">00</option>
								<?php for ($i=15; $i<=59; $i=$i+15){?>
									 <option value="<?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?>" <?php if(str_pad($i, 2, "0", STR_PAD_LEFT) == $thismins ){ echo 'selected="selected"';}?>><?php echo str_pad($i, 2, "0", STR_PAD_LEFT); ?></option>
								<?php }?>
							</select>
							Uhr
						</td>
					</tr>
					<tr>
						<td>
							Erhoben von:
						</td>
						<td colspan="3">
						<select name="ipos[user]" style="width:170px;">
							<option value="0">Mitarbeiter auswählen</option>
                            <?php
                            $ipospreseluser=$patient_ipos_values['user'];
                            if(!$ipospreseluser){
                            $ipospreseluser=$this->form_create_user;
                            }

                            ?>
							<?php	foreach ($client_users as $kuser => $vuser):?>
							<option value="<?php echo $vuser['id'] ?>" <?php if ($vuser['id'] == $ipospreseluser) echo "selected"?>><? echo $vuser['last_name'].' '.$vuser['first_name'];?></option>
							<?php endforeach;?>
						</select>
						</td>
					</tr>
					<tr>
										<tr>
											<td></td>
						<td>
							<input type="radio" name="ipos[ipos0]" value="selbst" <?php if ($patient_ipos_values['ipos0']=="selbst") echo "checked"; ?>> selbst
						</td>
						<td>
							<input type="radio" name="ipos[ipos0]" value="Professionelle" <?php if ($patient_ipos_values['ipos0']=="fremd") echo "checked"; ?>> Professionelle
						</td>
						<td>
							<input type="radio" name="ipos[ipos0]" value="Angehörige" <?php if ($patient_ipos_values['ipos0']=="proxy") echo "checked"; ?>> Angehörige
						</td>
					</tr>
				</table>
		</div>

			<div class="ipos">
				<table border="0" cellspacing="2" cellpadding="2" style="width:100%;">
					<tr>
						<td colspan="2"><b>1. Welche Hauptprobleme hatte der Patient* <u>in den letzten 3 Tagen?</u></b><br><small>Um die Fragen möglichst kurz zu halten, wird im Folgenden nur „der Patient“ genannt. Gemeint ist immer „die Patientin/der Patient“.</small></td>
					</tr>
					<tr>
						<td>&nbsp;a)</td>
						<td><input type="text" name="ipos[ipos1a]" value="<?php echo $patient_ipos_values['ipos1a']; ?>" class="long"></td>
					</tr>
					<tr>
						<td>&nbsp;b)</td>
						<td><input type="text" name="ipos[ipos1b]" value="<?php echo $patient_ipos_values['ipos1b']; ?>" class="long"></td>
					</tr>
					<tr>
						<td>&nbsp;c)</td>
						<td><input type="text" name="ipos[ipos1c]" value="<?php echo $patient_ipos_values['ipos1c']; ?>" class="long"></td>
					</tr>
				</table>
			</div>
			<div class="ipos iposhighlighter">
				<table class="iposappendable" border="0" cellspacing="2" cellpadding="2" style="width:100%;">
					<tr>
						<td colspan="8"><b>2. Bitte kreuzen Sie an, wie sehr der Patient <u>in den letzten 3 Tagen</u> von folgenden Symptomen beeinträchtigt war:</b></td>
					</tr>
					<tr>
						<td class="seven_first legend"></td>
						<td class="seven_other legend">Gar nicht</td>
						<td class="seven_other legend">Ein wenig</td>
						<td class="seven_other legend">Mäßig</td>
						<td class="seven_other legend">Stark</td>
						<td class="seven_other legend">Extrem stark</td>
						<td class="seven_other legend">Nicht beurteilbar (z.B. bewusstlos)</td>
					</tr>
					<tr>
						<td class="seven_first">Schmerzen</td>						
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos2a']==$val) echo 'checked'; ?> name="ipos[ipos2a]"></td>						
						<?php endforeach; ?>
					</tr>
					<tr class="zebra">
						<td class="seven_first">Atemnot</td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos2b']==$val) echo 'checked'; ?> name="ipos[ipos2b]"></td>						
						<?php endforeach; ?>
					</tr>
					<tr>
						<td class="seven_first">Schwäche oder fehlende Energie</td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos2c']==$val) echo 'checked'; ?> name="ipos[ipos2c]"></td>						
						<?php endforeach; ?>
					</tr>
					<tr class="zebra">
						<td class="seven_first">Übelkeit (das Gefühl, erbrechen zu müssen)</td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos2d']==$val) echo 'checked'; ?> name="ipos[ipos2d]"></td>						
						<?php endforeach; ?>
					</tr>
					<tr>
						<td class="seven_first">Erbrechen</td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos2e']==$val) echo 'checked'; ?> name="ipos[ipos2e]"></td>						
						<?php endforeach; ?>
					</tr>
					<tr class="zebra">
						<td class="seven_first">Appetitlosigkeit</td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos2f']==$val) echo 'checked'; ?> name="ipos[ipos2f]"></td>						
						<?php endforeach; ?>
					</tr>
					<tr>
						<td class="seven_first">Verstopfung</td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos2g']==$val) echo 'checked'; ?> name="ipos[ipos2g]"></td>						
						<?php endforeach; ?>
					</tr>
					<tr class="zebra">
						<td class="seven_first">Mundtrockenheit oder schmerzhafter Mund</td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos2h']==$val) echo 'checked'; ?> name="ipos[ipos2h]"></td>						
						<?php endforeach; ?>
					</tr>
					<tr>
						<td class="seven_first">Schläfrigkeit</td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos2i']==$val) echo 'checked'; ?> name="ipos[ipos2i]"></td>						
						<?php endforeach; ?>
					</tr>
					<tr class="zebra">
						<td class="seven_first">eingeschränkte Mobilität</td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos2j']==$val) echo 'checked'; ?> name="ipos[ipos2j]"></td>						
						<?php endforeach; ?>
					</tr>


					<tr class="jsclonepool" style="display:none;">
						<td class="seven_first"> <input  type="text" name="ipos_add[0][key]"  style="width:180px;" value=""></td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input type="radio" value="<?php echo $val;?>" <?php if (0===$val) echo 'checked'; ?> name="ipos_add[0][value]"></td>
						<?php endforeach; ?>
					</tr>

                    <tr><td class="legend" style="font-size:12px; font-weight:bold; padding-top:3px; padding-bottom:2px;" colspan="7">Bitte nennen Sie weitere Symptome, die aus Ihrer Sicht den Patienten in den letzten 3 Tagen beeinträchtigt haben.</td></tr>

                    <?php
                    $items=array();
                    $iposlist=array();

                    if($iposhist['ipos_add']){
                        foreach ($iposhist['ipos_add'] as $add_k=>$add_v){
                            if (!($items[$add_k])) $items[$add_k]=0;
                        }
                    }
                    if ($this->patient_ipos_add_values){
                        $items=$this->patient_ipos_add_values;
                    }
                    ?>
					
					
					<?php $iposaddcount=0;?>
					<?php foreach ($items as $ia_k=>$ia_v):?>
					<?php $iposaddcount+=1;?>
					<tr <?php if ($iposaddcount%2==0) echo 'class="zebra"';?>>
						<td class="seven_first"> <input  type="text" name="ipos_add[<?php echo $iposaddcount;?>][key]"  style="width:180px;" value="<?php echo $ia_k; ?>"></td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input type="radio" value="<?php echo $val;?>" <?php if ($this->patient_ipos_add_values[$ia_k]==$val) echo 'checked'; ?> name="ipos_add[<?php echo $iposaddcount;?>][value]"></td>						
						<?php endforeach; ?>
					</tr>
					<?php endforeach;?>

                    <?php for ($i=0;$i<3;$i++):?>
                    <?php $iposaddcount+=1;?>
                    <tr <?php if ($iposaddcount%2==0) echo 'class="zebra"';?>>
                        <td class="seven_first"> <input  type="text" name="ipos_add[<?php echo $iposaddcount;?>][key]"  style="width:180px;" value=""></td>
                        <?php foreach (array(6,5,4,3,2,0) as $val): ?>
                        <td class="seven_other"> <input type="radio" value="<?php echo $val;?>" <?php if (0==$val) echo 'checked'; ?> name="ipos_add[<?php echo $iposaddcount;?>][value]"></td>
                        <?php endforeach; ?>
                    </tr>
                    <?php endfor;?>
				</table>
			</div>

			<div class="ipos">
				<table border="0" cellspacing="2" cellpadding="2" style="width:100%;">
					<tr>
						<td class="seven_first legend"></td>
						<td class="seven_other legend">Gar nicht</td>
						<td class="seven_other legend">Selten</td>
						<td class="seven_other legend">Manchmal</td>
						<td class="seven_other legend">Meistens</td>
						<td class="seven_other legend">Immer</td>
						<td class="seven_other legend">Nicht beurteilbar (z.B. bewusstlos)</td>
						</tr>
					<tr>						
						<td class="seven_first"><b>3. War der Patient wegen seiner Erkrankung oder Behandlung besorgt oder beunruhigt?<br/><br/></b></td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos3']==$val) echo 'checked'; ?> name="ipos[ipos3]" ></td>						
						<?php endforeach; ?>
					</tr>
					<tr class="zebra">						
						<td class="seven_first"><b>4. Waren die Familie/ Freunde des Patienten seinetwegen besorgt oder beunruhigt?<br/><br/></b></td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos4']==$val) echo 'checked'; ?> name="ipos[ipos4]"></td>						
						<?php endforeach; ?>
					</tr>
					<tr>						
						<td class="seven_first"><b>5. Denken Sie, dass er traurig bedrückt war?<br/><br/></b></td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos5']==$val) echo 'checked'; ?> name="ipos[ipos5]"></td>						
						<?php endforeach; ?>
					</tr>
				</table>	
			</div>
			<div class="ipos">
				<table>
					<tr>
						<td class="seven_first legend"></td>
						<td class="seven_other legend">Immer</td>
						<td class="seven_other legend">Meistens</td>
						<td class="seven_other legend">Manchmal</td>
						<td class="seven_other legend">Selten</td>
						<td class="seven_other legend">Gar nicht</td>
						<td class="seven_other legend">Nicht beurteilbar (z.B. bewusstlos)</td>
					</tr>					
					<tr>						
						<td class="seven_first"><b>6. Denken Sie, dass er im Frieden mit sich selbst war?</b></td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos6']==$val) echo 'checked'; ?> name="ipos[ipos6]"></td>						
						<?php endforeach; ?>
					</tr>
                    <tr class="zebra">
                        <td class="seven_first"><b>7. Konnte der Patient seine Gefühle mit seiner Familie oder seinen Freunden teilen, so viel wie er wollte?</b></td>
                        <?php foreach (array(6,5,4,3,2,0) as $val): ?>
                        <td class="seven_other"> <input class="ipossum"  type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos7']==$val) echo 'checked'; ?> name="ipos[ipos7]"></td>
                        <?php endforeach; ?>
                    </tr>
                    <tr>
                        <td class="seven_first"><b>8. Hat der Patient so viele Informationen erhalten, wie er wollte?</b></td>
                        <?php foreach (array(6,5,4,3,2,0) as $val): ?>
                        <td class="seven_other"> <input class="ipossum"  type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos8']==$val) echo 'checked'; ?> name="ipos[ipos8]"></td>
                        <?php endforeach; ?>
                    </tr>

				</table>	
			</div>
			<div class="ipos">
					<table>
					<tr>
						<td class="seven_first legend"></td>
						<td class="seven_other legend">Probleme angegangen / Keine Probleme</td>
						<td class="seven_other legend">Probleme größtenteils angegangen</td>
						<td class="seven_other legend">Probleme teilweise angegangen</td>
						<td class="seven_other legend">Probleme kaum angegangen</td>
						<td class="seven_other legend">Probleme nicht angegangen</td>
						<td class="seven_other legend">Nicht beurteilbar (z.B. bewusstlos)</td>
					</tr>					
					<tr>						
						<td><b>9. Wurden in den letzten 3 Tagen praktische Probleme angegangen, die Folge seiner Erkrankung sind (z.B. finanzieller oder persönlicher Art)?</b></td>
						<?php foreach (array(6,5,4,3,2,0) as $val): ?>						
							<td class="seven_other"> <input class="ipossum" type="radio" value="<?php echo $val;?>" <?php if ($patient_ipos_values['ipos9']==$val) echo 'checked'; ?> name="ipos[ipos9]"></td>						
						<?php endforeach; ?>
					</tr>
				</table>
			</div>
			
			<div class="ipos">
				<script>
				function sum_ipos(){
					var sum=0;
					var elecount=0;
					$('input.ipossum').each(function(){
						
						if($(this).attr('checked')=='checked'){
							elecount++;
							switch($(this).val()){
								case "2":
									sum=sum+4;
									break;
								case "3":
									sum=sum+3;
									break;
								case "4":
									sum=sum+2;
									break;
								case "5":
									sum=sum+1;
									break;
								}
							}
						});
					$('#iposscoresum').text(sum);
					$('#iposscoresumhidden').val(sum);
					}
				$(document).ready(function(){
					$('input.ipossum').change(sum_ipos);
					
					sum_ipos();
					});
				</script>
				<h2>Gesamtscore:				<span style="display:inline-block; font-size:18px; padding:8px;" id="iposscoresum"></span></h2>
				<input name="ipos[score]" type="hidden" id="iposscoresumhidden" value="0">
			</div>			
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>








			
<?php $blockname = "lmu_visit"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  #########################  Visite renamed to Status ########################## -->
 <!--  ############################################################################## -->
	<?php $f_values = $this->patient_lmu_visit_values[0];?>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('Status') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<input type="hidden" name="<?php echo $blockname;?>[klau_diag]" value="<?php echo $f_values['klau_diag'];?>">
		<input type="hidden" name="<?php echo $blockname;?>[klau_frage]" value="<?php echo $f_values['klau_frage'];?>">
		<div class="contactform_dragvbox_content besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow200"  >
            <div class="inputs">
                <div class="container double">
                    <div class="column">
                        <label>Krankheitsphase</label>
                        <?php   $fm_name="phase";?>
        				<?php 	$ms_name=$blockname.$fm_name;?>
        				<?php 	$verbs = array('1'=>'stabil', '2'=>'fluktuierende Symptome', '3'=>'erwartet verschlechternd', '4'=>'sterbend');?>
        				<?php 	$preselect = ($f_values[$fm_name]===Null)? "" : $f_values[$fm_name.''];?>
        				<input type="hidden" id="lmu_visit_iposenabled" name="<?php echo $blockname;?>[iposenabled]" value="<?php echo $f_values['iposenabled'];?>">
					
    					<select id="lmuvisit_kphase" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]">
    						<?php foreach ($verbs as $key=>$val):?>
    							<?php $selected= ($preselect==$key)? "selected":"";?>
    							<option <?php echo $selected;?> value="<?php echo $key;?>"><?php echo $val;?></option>
    						<?php endforeach; ?>
    					</select>
		          </div>
		          
		          <div class="column">
		              <label> Karnofsky: </label>
                        <?php   $fm_name="karnofsky";?>
                        <?php 	$ms_name=$blockname.$fm_name;?>
    					<select name="<?php echo $blockname;?>[<?php echo $fm_name;?>]">
    						<option value="" <?php if(  $f_values[$fm_name.''] == 'NULL' || empty($f_values[$fm_name.''])) {echo  'selected="selected"';}?> > </option>
    						<?php foreach($this->karnofsky_clinik as $karnofsky_value => $karnofsky_details):?>
    							<option value="<?php echo  $karnofsky_details['value']; ?>" <?php if(  $f_values[$fm_name.''] == $karnofsky_details['value'] ) {echo  'selected="selected"';}?> ><?php echo $karnofsky_details['label'];?></option>
    						<?php endforeach;?>
    					</select>
		          </div>
        		  <div class="column">
        		      <label>Bewusstsein</label>
    					<?php   $fm_name="bewusstsein";?>
    					<?php 	$ms_name=$blockname.$fm_name;?>
    					<?php 	$verbs = array('', 'wach', 'somnolent', 'soporös', 'komatös');?>
    					<select name="<?php echo $blockname;?>[<?php echo $fm_name;?>]">
    						<?php foreach ($verbs as $key=>$val):?>
    							<?php $selected= ($f_values[$fm_name] == $val)? "selected":"";?>
    							<option <?php echo $selected;?> value="<?php echo $val;?>"><?php echo $val;?></option>
    						<?php endforeach; ?>
    					</select>        		      
        		  </div>
		          <div class="column">
        		      <label>Orientierung</label>
        		      <ul class="cbrdList double">
        		      <li>
        		      <?php $fm_name="ort"; $a_name = "orient_".$fm_name;?>
					<?php $ms_name=$blockname.$fm_name;?>
					<?php $selected= ($f_values[$fm_name.'']==1)? "checked":"";?>
					<input onChange="if ($(this).attr('checked')){$('.orient_b').attr('checked',false);}" class="orient_a" type="checkbox" value="1" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" <?php echo $selected;?> /> 
					<label>Ort</label>
					 </li>
					<li>
					<?php $fm_name="person"; $a_name = "orient_".$fm_name;?>
					<?php $ms_name=$blockname.$fm_name;?>
					<?php $selected= ($f_values[$fm_name.''] ==1 )? "checked":"";?>
					<input onChange="if ($(this).attr('checked')){$('.orient_b').attr('checked',false);}" class="orient_a" type="checkbox" value="1" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" <?php echo $selected;?> /> 
					<label>Person</label>
					 </li>
					<li>
					<?php $fm_name="situation"; $a_name = "orient_".$fm_name;?>
					<?php $ms_name=$blockname.$fm_name;?>
					<?php $selected= ($f_values[$fm_name.''] == 1)? "checked":"";?>
					<input onChange="if ($(this).attr('checked')){$('.orient_b').attr('checked',false);}" class="orient_a" type="checkbox" value="1" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" <?php echo $selected;?> /> 
					<label>Situation</label>
					 </li>
					<li>
					<?php $fm_name="zeit";?>
					<?php $ms_name=$blockname.$fm_name; $a_name = "orient_".$fm_name;?>
					<?php $selected= ($f_values[$fm_name.''] == 1)? "checked":"";?>
					<input onChange="if ($(this).attr('checked')){$('.orient_b').attr('checked',false);}" class="orient_a" type="checkbox" value="1" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" <?php echo $selected;?> /> 
					<label>Zeit</label>
                    </li>  
					<li>
                    <?php $fm_name="keineorient";?>
                    <?php $ms_name=$blockname.$fm_name; $a_name = $fm_name;?>
                    <?php $selected= ($f_values[$fm_name.'']==1)? "checked":"";?>
                    <input class="orient_b" style="margin-left:24px;" onChange="if ($(this).attr('checked')){$('.orient_a').attr('checked',false);}" type="checkbox" value="1" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" <?php echo $selected;?> /> 
                    <label>Keine Orientierung</label>
        		     </li>
        		      </ul>
		          </div>
		
		
		
		</div>
		</div>
		</div>
		
	</div>
<!--  ############################################################################## -->
<?php endif;?>














<?php $blockname="talkwith";?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
<!--  ############################################################################## -->
<!--  ###############################  talkwith ################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox" id="<?php echo $blockname;?>">
		<h2> + <? echo $this->translate('block_talkwith') ?></h2>
			<div class="contactform_dragvbox_content" id="talkwith"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>; min-height:30px;" >
						
			<table>
				<tr>
					<td width="200px;">	
						<b>Kontakt mit:</b>
					</td>
					<td style="vertical-align:top;">
						
					<?php   $fm_name="contact";?>
					<?php 	$ms_name=$blockname.$fm_name;?>
					<?php 	$verbs = array('', 'Patient', 'Angehörige', 'Partner/Partnerin/Lebensgefährte/Lebenbensgefährtin/Ehefrau/Ehemann', 'Kinder (0-5 Jahre)', 'Kinder (6-13 Jahre)', 'Kinder (14-17 Jahre)', 'Kinder (ab 18 Jahre)', 'Eltern', 'Dolmetscher', 'KH Pflege', 'KH Arzt', 'Einweiser', 'Hausarzt',  'gesetzl. Betreuuer', 'Pflegedienst', 'Pflegeheim', 'SAPV', 'Hospiz', 'Sanitätshaus', 'Kostenträger', 'Sonstige');?>
								
					<input id="<?php echo $ms_name.'_val';?>" type="hidden" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" value="<?php echo $patient_talkwith_values[$fm_name];?>"/>					
					<ul class="pseudomultiselect" id="<?php echo $ms_name;?>">
						<li>
						<select onChange="checkbox_ms('<?php echo $ms_name;?>')">
							<?php foreach ($verbs as $key=>$val):?>
								<option> <?php echo $val;?></option>
							<?php endforeach; ?>
						</select>
						</li>
					</ul>
					</td>
				</tr>
				<tr>
					<td></td>
					<td>weitere Angaben:<input type=text" name="<?php echo $blockname;?>[contact_more]" style="width:100%;" value="<?php echo $patient_talkwith_values['contact_more'];?>" /></td>
				</tr>
			</table>
			
			<table style="display:none">
				<tr>
					<td width="200px;">	
						<b>Weitere Teilnehmer:</b>
					</td>
					<td style="vertical-align:top;">
					<?php   $fm_name="helpers";?>
					<?php 	$ms_name=$blockname.$fm_name;?>
					<?php 	$verbs = array('', 'Chefarzt/in', 'Oberarzt/in', 'Stationsarzt/in', 'Pflegedienst', 'Sozialdienst', 'Psychotherapie', 'Seelsorge', 'Physikalische Therapie', 'Atemtherapie', 'Apotheke', 'Sonstige');?>
								
					<input id="<?php echo $ms_name.'_val';?>" type="hidden" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" value="<?php echo $patient_talkwith_values[$fm_name];?>"/>					
					<ul class="pseudomultiselect" id="<?php echo $ms_name;?>">
						<li>
						<select onChange="checkbox_ms('<?php echo $ms_name;?>')">
							<?php foreach ($verbs as $key=>$val):?>
								<option> <?php echo $val;?></option>
							<?php endforeach; ?>
						</select>
						</li>
					</ul>
					</td>
				</tr>
				<tr>
					<td></td>
					<td>weitere Angaben:<input type=text" name="<?php echo $blockname;?>[helpers_more]" style="width:100%;" value="<?php echo $patient_talkwith_values['helpers_more'];?>" />
					
					
					
					
					
					</td>
				</tr>
			</table>
		</div>
	</div>
	
<!--  ############################################################################## -->
<?php endif;?>
 
 


<?php $blockname="talkback"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  ################################  Talkback ################################### -->
 <!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + Rücksprache</h2>
		<div class="contactform_dragvbox_content" id="grow2"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
			<table>

			<tr>
				<td style="vertical-align:top;" width="200px">	
					<b>Rücksprache erfolgt mit:</b>
				</td>
				<td style="vertical-align:top;" width="500px">
					<?php   $fm_name="optionvalue";?>
					<?php 	$ms_name=$blockname.$fm_name;?>
					<?php 	$verbs = array('', 'Arzt', 'Pflege', 'Sozialarbeit', 'Haus-Seelsorge', 'Atemtherapie', 'PhysMed', 'Psychologie');?>
					<input id="<?php echo $ms_name.'_val';?>" type="hidden" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]" value="<?php echo $patient_talkback_values[0][$fm_name];?>"/>					
					<ul class="pseudomultiselect" id="<?php echo $ms_name;?>">
						<li>
						<select onChange="checkbox_ms('<?php echo $ms_name;?>')">
							<?php foreach ($verbs as $key=>$val):?>
								<option><?php echo $val;?></option>
							<?php endforeach; ?>
						</select>
						</li>
					</ul>
				</td>
			</tr>
			<tr>
				<td style="vertical-align:top;">Memo:</td>
				<td style="vertical-align:top;">					
					<textarea class="textarea_full" name="<?php echo $blockname;?>[freetext]" style="vertical-align:top;"><?php echo $patient_talkback_values[0]['freetext'];?></textarea>	
				</td>
			</tr>
			</table>
			
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>			
		
 
		
		
<?php $blockname="lmu_pmba_body"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  ####  LMU Palliativmedizinisches Basisassesment Körperliche Untersuchung  #### -->
 <!--  ############################################################################## -->
 	<?php $f_values = $this->patient_lmu_pmba_body_values;?>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + Körperliche Untersuchung</h2>
		<div class="contactform_dragvbox_content" id="grow2"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
			<table>
			<tr>
				<?php $fkey='allgemeinzustand_freetext';?>
				<td style="width:200px; vertical-align:top;">
					<b>Allgemeinzustand und Ernährungszustand</b>
				</td>
				<td style="width:280px;">
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>]"><?php echo $f_values[$fkey];?></textarea>
				</td>
				<td style="width:260px; vertical-align:top;">
					<?php $fkey='allgemeinzustand_dropdown';?>
					<select style="width:260px;" name="<?php echo $blockname;?>[<?php echo $fkey;?>]" >
						<?php $verbs = array('', 'guter Allgemeinzustand', 'reduzierter Allgemeinzustand', 'stark reduzierter Allgemeinzustand');
						foreach ($verbs as $key=>$val):?>
							<?php 
								$selected='';
								if ($f_values[$fkey] ==  $val) $selected='selected';
							?>
							<option <?php echo $selected;?> ><?php echo $val;?></option>
						<?php endforeach; ?>
					</select>
					<br/>
					<?php $fkey='ernaehrung_dropdown';?>
					<select style="width:260px;" name="<?php echo $blockname;?>[<?php echo $fkey;?>]" >
						<?php $verbs = array('','guter Ernährungszustand', 'reduzierter Ernährungszustand', 'stark reduzierter Ernährungszustand');
						foreach ($verbs as $key=>$val):?>
							<?php 
								$selected='';
								if ($f_values[$fkey] ==  $val) $selected='selected';
							?>
							<option <?php echo $selected;?> ><?php echo $val;?></option>
						<?php endforeach; ?>
					</select>	
					<br/>					
					<?php   $fm_name="allgemeinzustand_checkboxen";?>
					<?php 	$verbs = array(	
											'Normale Hydratation', 
											'Keine Effloreszenzen', 
											'unauffällige Hautfarbe'										
											);?>
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>
				</td>
			</tr>

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='kopfundhals';?>
				<td style="vertical-align:top;">
					<b>Kopf und Hals</b>
				</td>
				<td >
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">					
					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	
											'unauffälliger Zahnstatus', 
											'Mundhöhle/Zunge/Rachen ohne path. Befund', 
											'keine Venenstauung',
											'Schleimhäute unauffällig'										
											);?>
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>		
				</td>
			</tr>

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='lunge';?>
				<td style="vertical-align:top;">
					<b>Lunge</b>
				</td>
				<td>
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">	
					<div style="vertical-align:baseline;">
						<table>
						<tr>
							<td width="90px">
								Atemfrequenz 
							</td>
							<td>
								<input style="width:30px;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freq]" value="<?php echo $f_values[$fkey.'_freq'];?>"> / min.
							</td>
						</tr>
						</table>

					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$ms_name=$blockname.$fm_name;?>
					<?php 	$verbs = array(	
											'perkutorisch unauffällig', 
											'seitengleich belüftet', 
											'Vesikuläratmen über allen LF',
											'Keine feuchten oder trockenen RGs'										
											);?>
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>	
					</div>		
				</td>
			</tr>

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='herz';?>
				<td style="vertical-align:top;">
					<b>Herz</b>
				</td>
				<td >
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">	
					<div style="vertical-align:baseline;">
						<table>
						<tr>
							<td width="90px">
								Frequenz:
							</td>
							<td>
								<input style="width:30px;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freq]" value="<?php echo $f_values[$fkey.'_freq'];?>"> / min.
							</td>
						</tr>
						<tr>
							<td>
								RR:
							</td>
							<td>
								<input style="width:60px;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_rr]" value="<?php echo $f_values[$fkey.'_rr'];?>">
							</td>
						</tr>
						</table>

					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	
											'Normofrequent', 
											'rhythmisch', 
											'Herztöne rein, keine VTG',									
											);?>
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>
					</div>		
				</td>
			</tr>

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='abdomen';?>
				<td style="vertical-align:top;">
					<b>Abdomen</b>
				</td>
				<td >
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">					
					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	 
											'Bauchdecke weich', 
											'Kein Druckschmerz', 
											'keine Resistenzen',
											'Darmgeräusche über allen 4 Quad.'										
											);?>				
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>			
				</td>
			</tr>
			
			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='becken';?>
				<td style="vertical-align:top;">
					<b>Becken- und Geschlechtsorgane</b>
				</td>
				<td >
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">					
					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	
											'kein Druck- oder Klopfschmerz über dem Nierenlager', 									
											);?>
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>			
				</td>
			</tr>
			
			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='extremitaeten';?>
				<td style="vertical-align:top;">
					<b>Extremitäten</b>
				</td>
				<td>
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">					
					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	
											'Extremitäten frei beweglich', 	
											'Gelenke nicht schmerzhaft',
											'Keine Ödeme',
											'Keine trophischen Störungen'								
											);?>				
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>			
				</td>
			</tr>			

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='nervensystem';?>
				<td style="vertical-align:top;">
					<b>Nervensystem</b>
				</td>
				<td>
					<textarea style="width:250px;height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">					
					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	
											'Stimme, Sprache und Gehör normal', 	
											'Visus intakt',
											'Okulomotorik und Pupillenreaktion unauffällig',
											'Reflexstatus unauffällig',	
											'Gangbild und Koordination unauffällig',
											'Keine Sensibilitätsstörung',
											'Keine motorischen Defizite',
											'Kein Tremor oder Myoklonie'
											);?>				
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>			
				</td>
			</tr>

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey='psyche';?>
				<td style="vertical-align:top;">
					<b>Psyche</b>
				</td>
				<td>
					<textarea style="width:250px; height:90%;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
				<td style="vertical-align:top;">					
					<?php   $fm_name=$fkey."_multiselect";?>
					<?php 	$verbs = array(	
											'keine affektive Störung', 	
											'normaler Antrieb',
											'keine Denkstörungen',
											'keine Angststörung',	
											'keine Wahrnehmungsstörung',
											'nicht suizidal',
											);?>
					<ul>
					<?php foreach ($verbs as $key=>$val):?>
						<li>
							<input name="<?php echo $blockname;?>[<?php echo $fm_name.$key;?>]" type="checkbox" value="<?php echo $val;?>" <?php if($f_values[$fm_name.$key])echo 'checked="checked"';?>> <?php echo $val;?>
						</li>
					<?php endforeach; ?>
					</ul>		
				</td>
			</tr>						
			</table>
			<h4>Portkatheter/zentrale Zugänge, „invasive Schläuche“:  (in Situ/ letzter Wechsel)</h4>
			<?php $fm_name='zugaenge';?>
			<textarea style="width:99%;" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]"><?php echo $f_values[$fm_name];?></textarea>
			<h4>OP-Wunden: Verbände/Fäden ex?</h4>
			<?php $fm_name='wunden';?>
			<textarea style="width:99%;" name="<?php echo $blockname;?>[<?php echo $fm_name;?>]"><?php echo $f_values[$fm_name];?></textarea>		
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>	
		

<?php $blockname="lmu_pmba_pain"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  ########## LMU Palliativmedizinisches Basisassesment Schmerzanamnese ######### -->
 <!--  ############################################################################## -->
 	<?php $f_values = $this->patient_lmu_pmba_pain_values;?>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + Schmerzanamnese</h2>
		<div class="contactform_dragvbox_content" id="grow2"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
		<h4>Hauptschmerz</h4>
			<table style="width:100%;">
			<tr>
				<td>
				<b>Schmerzanamnese</b>  (Vorgeschichte, Beginn, Häufigkeit, Auslöser, Verstärkung und Linderung):
				</td>
			</tr>
			<tr>
				<td>
				<textarea style="width:99%" type="text" name="<?php echo $blockname;?>[beginn]"><?php echo $f_values['beginn'];?></textarea>
				</td>
			</tr>
			<tr>
				<td>
				<b>Charakter und Qualität:</b>
				</td>
			</tr>
			<tr>
				<td>
				<table width="100%">
				<tr>
					<td rowspan="2" width="200px">
						<input type="checkbox" name="<?php echo $blockname;?>[Nozizeptiver]" <?php if ($f_values['Nozizeptiver']) echo "checked";?> value="1">
						Nozizeptiver Schmerz
					</td>
					<td width="200px">
						<input type="checkbox" name="<?php echo $blockname;?>[Somatisch]" <?php if ($f_values['Somatisch']) echo "checked";?> value="1">
						Somatisch
					</td>
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[Somatisch_gutlokalisierbar]" <?php if ($f_values['Somatisch_gutlokalisierbar']) echo "checked";?> value="1">
						gut lokalisierbar
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Somatisch_scharfbegrenzt]" <?php if ($f_values['Somatisch_scharfbegrenzt']) echo "checked";?> value="1">
						scharf begrenzt
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Somatisch_stechend]" <?php if ($f_values['Somatisch_stechend']) echo "checked";?> value="1">
						stechend
					</td>
				</tr>
				<tr style="border-top:1px solid grey;">
					<td >
						<input type="checkbox" name="<?php echo $blockname;?>[Viszeral]" <?php if ($f_values['Viszeral']) echo "checked";?> value="1">
						Viszeral
					</td>
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[Viszeral_schlechtlokalisierbar]" <?php if ($f_values['Viszeral_schlechtlokalisierbar']) echo "checked";?> value="1">
						schlecht lokalisierbar
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Viszeral_dumpf]" <?php if ($f_values['Viszeral_dumpf']) echo "checked";?> value="1">
						dumpf / tief
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Viszeral_krampfartig]" <?php if ($f_values['Viszeral_krampfartig']) echo "checked";?> value="1">
						krampfartig / kolikartig
					</td>
				</tr>
				<tr style="border-top:1px solid grey;">
					<td rowspan="2">
						<input type="checkbox" name="<?php echo $blockname;?>[NeuropathischerSchmerz]" <?php if ($f_values['NeuropathischerSchmerz']) echo "checked";?> value="1">
						Neuropathischer Schmerz
					</td>
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[Neuralgiform]" <?php if ($f_values['Neuralgiform']) echo "checked";?> value="1">
						Neuralgiform
					</td>
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[neuraligi_stechend]" <?php if ($f_values['neuraligi_stechend']) echo "checked";?> value="1">
						stechend / schneidend
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[neuraligi_blitzartig]" <?php if ($f_values['neuraligi_blitzartig']) echo "checked";?> value="1">
						blitzartig einschießend
						<br/>
					</td>
				</tr>
				<tr style="border-top:1px solid grey;">
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[Dauerschmerz]" <?php if ($f_values['Dauerschmerz']) echo "checked";?> value="1">
						Dauerschmerz
					</td>
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[Dauerschmerz_brennend]" <?php if ($f_values['Dauerschmerz_brennend']) echo "checked";?> value="1">
						brennend
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Dauerschmerz_bohrend]" <?php if ($f_values['Dauerschmerz_bohrend']) echo "checked";?> value="1">
						bohrend
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Dauerschmerz_Dysaesthesie]" <?php if ($f_values['Dauerschmerz_Dysaesthesie']) echo "checked";?> value="1">
						Dysästhesie
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Dauerschmerz_Hyperaesthesie]" <?php if ($f_values['Dauerschmerz_Hyperaesthesie']) echo "checked";?> value="1">
						Hyperästhesie
					</td>
				</tr>
				<tr style="border-top:1px solid grey;">
					<td >
						<input type="checkbox" name="<?php echo $blockname;?>[MyofaszialerSchmerz]" <?php if ($f_values['MyofaszialerSchmerz']) echo "checked";?> value="1">
						Myofaszialer Schmerz
					</td>
					<td >
					</td>
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[Myofaszialer_einschliessend]" <?php if ($f_values['Myofaszialer_einschliessend']) echo "checked";?> value="1">
						einschießend
						<br/>
						<input type="checkbox" name="<?php echo $blockname;?>[Myofaszialer_trigger]" <?php if ($f_values['Myofaszialer_trigger']) echo "checked";?> value="1">
						durch Triggerpunkte auslösbar
						<br/>
					</td>
				</tr>
				<tr style="border-top:1px solid grey;">
					<td>
						<input type="checkbox" name="<?php echo $blockname;?>[totalpain]" <?php if ($f_values['totalpain']) echo "checked";?> value="1">
						V. a. „Total Pain“
					</td>
					<td>
					</td>
					<td>
					</td>
				</tr>
				</table>
				</td>
			</tr>
			<tr>
				<td>
					<table width="100%">
					<tr>
						<td width="200px;"><b>Dauer:</b></td>
						<td>
							<input type="checkbox" name="<?php echo $blockname;?>[dauer_Kontinuierlich]" <?php if ($f_values['dauer_Kontinuierlich']) echo "checked";?> value="1">
							Kontinuierlich
						</td>
						<td>
							<input type="checkbox" name="<?php echo $blockname;?>[dauer_intermittierend]" <?php if ($f_values['dauer_intermittierend']) echo "checked";?> value="1">
							intermittierend
						</td>
						<td>
							<input type="checkbox" name="<?php echo $blockname;?>[dauer_Schmerzattacken]" <?php if ($f_values['dauer_Schmerzattacken']) echo "checked";?> value="1">
							Schmerzattacken
						</td>
					</tr>
					<tr>
						<td></td>
						<td colspan="3">
							<textarea style="width:99%" type="text" name="<?php echo $blockname;?>[dauer_freetext]"><?php echo $f_values['dauer_freetext'];?></textarea>
						</td>
					</tr>
					<tr>
						<td><b>Lokalisation:</b></td>
						<td colspan="3" style="vertical-align:top;">
							<textarea style="width:99%" type="text" name="<?php echo $blockname;?>[lokalisation]"><?php echo $f_values['lokalisation'];?></textarea>
						</td>
					</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					<h4>Weitere Schmerzen</h4>
				</td>
			</tr>
			<tr>
				<td>
					<table width="100%">
						<tr>
							<td width="200px" style="vertical-align:top;">
								<b>Lokalisation:</b>
							</td>
							<td>
								<textarea style="width:99%" type="text" name="<?php echo $blockname;?>[weitere_lokalisation]"><?php echo $f_values['weitere_lokalisation'];?></textarea>
							</td>
						</tr>
						<tr>
							<td style="vertical-align:top;">
								<b>Kurzbeschreibung:</b>
							</td>
							<td>
								<textarea style="width:99%" type="text" name="<?php echo $blockname;?>[weitere_kurzbeschreibung]"><?php echo $f_values['weitere_kurzbeschreibung'];?></textarea>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td>
					<h4>Schmerzmedikamente</h4>
				</td>
			</tr>
			<tr>
				<td>
					<table width="100%">
						<tr>
							<td width="200px" style="vertical-align:top;">
								<b>Bisherige Schmerzmedikamente:</b>
							</td>
							<td>
								<textarea style="width:99%" type="text" name="<?php echo $blockname;?>[bisher_medis]"><?php echo $f_values['bisher_medis'];?></textarea>
							</td>
						</tr>
					</table>
					
				</td>
			</tr>
			</table>
			
		</div>
	</div>

	
<!--  ############################################################################## -->
<?php endif;?>	


		
		
		
		
		
		
		
		
		
		
<?php $blockname="lmu_pmba_wishes"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  ############  LMU Palliativmedizinisches Basisassesment Wünsche   ############ -->
 <!--  ############################################################################## -->
 	<?php $f_values = $this->patient_lmu_pmba_wishes_values;?>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
    	<div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            Wünsche und Erwartungen des Patienten und seiner Angehörigen
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
 
		<div class="contactform_dragvbox_content besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow2"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">
    			         <span>(auch bezüglich tumorspezifischer Therapie, lebensverlängernder Maßnahmen, Reanimation)</span>
            			 <textarea name="<?php echo $blockname;?>[text]"><?php echo $contact_form_details['comment_block'];?></textarea>
		             </div>
                </div>
           </div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>
		
		
		
		
		
<?php $blockname="lmu_pmba_aufklaerung"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  #######  LMU Palliativmedizinisches Basisassesment Aufklärungsstand   ######## -->
 <!--  ############################################################################## -->
 	<?php $f_values = $this->patient_lmu_pmba_aufklaerung_values;?>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
           <?php echo $this->translate('Aufklärungsstand/Krankheitsverarbeitung Patient/ ggf. Angehörige') ?>
           <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		
		<div class="contactform_dragvbox_content besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow201"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">
                        <textarea class="textarea_full" name="<?php echo $blockname;?>[text]" style="vertical-align:top;"><?php echo $f_values['text'];?></textarea>
		            </div>
                </div>
            </div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>





<?php if(in_array('todos',$allowed_blocks) && $v_box == 'todos'): ?>
<?php 
	$block_todos = $this->block_todos ; 
	$patient_todos_values = $block_todos['patient_todos_values'];

	$flat_todo_users = array();
	foreach($block_todos['todo_users'] as $k=>$row_user) {
		if ( ! is_array( $row_user)) { $row_user = array($k => $row_user); }
		$flat_todo_users = array_merge($flat_todo_users, $row_user );
	}
?>
<!--  ############################################################################## -->
<!--  ###############################  todo ######################################## -->
<!--  ############################################################################## -->
	<script type="text/javascript">
	$(document).ready(function(){
 
		 $( ".todo_date" ).datepicker({
				dateFormat: 'dd.mm.yy',
				showOn: "both",
				buttonImage: $('#calImg').attr('src'),
				buttonImageOnly: true,
				changeMonth: true,
				changeYear: true,
				nextText: '',
				prevText: ''
			}).mask("99.99.9999");
		 
		$(".todo_date").mask("99.99.9999");
		
		
		
		$('.todo_selectbox' , $("#todos")).chosen({
			placeholder_text_single: translate('please select'),
			placeholder_text_multiple : translate('please select'),
			multiple:1,
			width:'250px',
			"search_contains": true,
			no_results_text: translate('noresultfound')
		});
		
	});

	function todo_checkinput( element )
	{
		var parent = $(element).parents("tr.todorow");	
		if ( $(".todo_text", parent).val() != "" && $(".todo_selectbox", parent).val() !== null)
		{
			$(parent).next("tr.todorow"). show();					
		}
		return;
		/*
		var elename=$(element).attr('name');
		var todo_id=elename.slice(elename.indexOf('[')+1,elename.indexOf('[')+2);

		if ($("select[name='todos["+todo_id+"][user]']").val()!=0 && $("input[name='todos["+todo_id+"][text]']").attr('value')!=""){			
			$("#todos_"+(parseInt(todo_id)+1)).show();
			}
		*/
		}
		
	function add_new_todo_for_assistenzarzt(text){
		var uid="<?php echo intval($this->assistenzarzt_id);?>";
		var el=$('.todotable:visible').last();
		$(el).find('.todo_text').val(text);
		$(el).find("select option[value='"+uid+"']").attr('selected', 'true').change();
		}
		
	</script>			
	<div class="contactform_dragvbox" id="todos">
		<h2> + <? echo $this->translate('block_todos') ?></h2>
		<div class="contactform_dragvbox_content" id="todos"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >


		<table class="todotable datatable table-striped">
			<tr>
				<th width="300px">Aufgabe</th>
				<th >zu erledigen von</th>
				<th width="150px" >zu erledigen am</th>
			</tr>
		<?php foreach ($patient_todos_values as $rownum=>$row): ?>
				<tr>
					<td>
						<span style="padding:2px"><?php echo $row['text'];?></span>
					</td>
					<td>
						<span style="padding:2px">
						
						<?php	
						$todo_users = array();					
						foreach ($row['additional_info'] as $row_user) {
							$todo_users[] = $flat_todo_users[$row_user];
						}
						echo implode(" | ", $todo_users);
						?>		
						</span>
					</td>
					<td>
						<span style="padding:2px"><?php echo strftime("%d.%m.%Y",strtotime($row['date'])); ?></span>
					</td>
				</tr>
		<?php endforeach; ?>
		
		<?php for ($rownum=0; $rownum<6; $rownum++ ): ?>
			<tr class="todorow" <?php if ($rownum > 0 ) {echo 'style="display:none"';}?>>
				<td style="vertical-align:top">
					<input class="todo_text" type="text" name="todos[<?php echo $rownum;?>][text]" value="" style="width:310px;" onChange="todo_checkinput(this)">
				</td>
				<td style="vertical-align:top" >						
					<?php 
						echo $this->formSelect(
							"todos[{$rownum}][user][]", 
							null, 
							array(
								"class" => "todo_selectbox",
								"multiple" => true,
								"size" => 1,
								"onChange" => "todo_checkinput(this)",
								"disable" => array("0")
							),
							$block_todos['todo_users']
						);
					?>	
				</td>
				<td style="vertical-align:top; padding-left:2px;">
					<input type="text" name="todos[<?php echo $rownum;?>][date]" class="todo_date"  style="width:60px;" value="<?php echo strftime("%d.%m.%Y",strtotime('now')); ?>"   class="embconditions" />
				</td>
			</tr>
			
		<?php endfor; ?>	


		</table>	
		
		</div>
	</div>
	
<!--  ############################################################################## -->
<?php endif;?>

		
		

		
	

<?php if(in_array('kvno_visit_type',$allowed_blocks)  && $v_box == 'kvno_visit_type'): ?>
<!--  ############################################################################## -->
<!--  ########################## Besuch war   ###################################### -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="kvno_visit_type">
	     <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_kvno_visit_type') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		
		<div class="contactform_dragvbox_content besuch  <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="grow38"  >
            <div class="inputs">
                <div class="container">
                    <div class="column">
					<label><?php echo $this->translate('block_kvno_visit_type_label'); ?>:</label>
					<ul class="cbrdList">
						<li>
							<input type="checkbox" id="ethisch" name="kvno_visit_type[ethically]" value="1" <?php if($kvno_visit_type['ethically'] == "1"): ?> checked="checked" <?php endif; ?> />
							<label for="ethisch">ethisch</label>
						</li>
						<li>
							<input type="checkbox" id="somatisch" name="kvno_visit_type[somatic]" value="1"  <?php if($kvno_visit_type['somatic'] == "1"): ?> checked="checked" <?php endif; ?>  />
							<label for="somatisch">somatisch</label>
						</li>
						<li>
							<input type="checkbox" id="psycho" name="kvno_visit_type[psychosocial]" value="1"  <?php if($kvno_visit_type['psychosocial'] == "1"): ?> checked="checked" <?php endif; ?>  />
							<label for="psycho">psycho-sozial</label>
						</li>
						<li>
							<input type="checkbox" id="koord" name="kvno_visit_type[coordination]" value="1"  <?php if($kvno_visit_type['coordination'] == "1"): ?> checked="checked" <?php endif; ?>  />
							<label for="koord">Koordination</label>
						</li>
					</ul>
				</div>
				</div>
				</div>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif; ?>
 
 
 
 
 
 
 
 <?php if(in_array('bavaria_options',$allowed_blocks)  && $v_box == 'bavaria_options'): ?>
<!--  ############################################################################## -->
<!--  ########################## Besuch war   ###################################### -->
<!--  ############################################################################## -->



	<div class="contactform_dragvbox"  id="bavaria_options">
		<h2> + <?php echo $this->translate('block_bavaria_options') ?></h2>
 		<div class="contactform_dragvbox_content bayern_dragvbox_content" id="grow39"  style="display:<?php if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >

<div class="bayern_doctor_vboxes">
	<div class="bayern_vboxes_left">

		<div class="bayern_dragvbox" id="item_1">
			<h2 class="">Beratung - Einsatzort / -art</h2>
			<div     id="grow1" class="bayern_dragvbox_content">
			<div class="bayern_sapvfb3_content">
				<table class="bayern_sapvfb3_table">
					<tr>
						<td width="95%"><label for="cbx_1">Hausbesuch in Privatwohnung</label></td>
						<td width="5%">
							<?php if( is_array($this->sapvalarr)):?>
      							<input type="checkbox" id="cbx_1" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Hausbesuch in Privatwohnung','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)" value="1" <?php if(in_array('1',$this->sapvalarr)) { echo ' checked="checked"';}?> />
							<?php else :?>
								<input type="checkbox" id="cbx_1" name="symptom[]" value="1" onclick="saveCheckboxes(this,'Hausbesuch in Privatwohnung','<?php echo $this->cat1;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label for="cbx_2">Besuch im Krankenhaus / Palliativstation</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
     						<input type="checkbox" id="cbx_2"  value="2" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Besuch im Krankenhaus / Palliativstation','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('2',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
							<input type="checkbox" id="cbx_2"  value="2" name="symptom[]" onclick="saveCheckboxes(this,'Besuch im Krankenhaus / Palliativstation','<?php echo $this->cat1;?>')" />
						<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label for="cbx_3">Besuch in stationärer Pflegeeinrichtung / Hospiz</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
     						<input type="checkbox" id="cbx_3"  value="3" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Besuch in stationärer Pflegeeinrichtung / Hospiz','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('3',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
							<input type="checkbox" id="cbx_3"  value="3" name="symptom[]" onclick="saveCheckboxes(this,'Besuch in stationärer Pflegeeinrichtung / Hospiz','<?php echo $this->cat1;?>')" />
						<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label for="cbx_6" >Telefonate/ E-Mails</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
							<input type="checkbox" id="cbx_6" value="6" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Telefonate/ E-Mails','<?php echo $this->cat1;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('6',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
						<?php else :?>
							<input type="checkbox" id="cbx_6" value="6" name="symptom[]" onclick="saveCheckboxes(this,'Telefonate/ E-Mails','<?php echo $this->cat1;?>');">
						<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label for="cbx_61" >24h-Bereitschaft</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
     						<input type="checkbox" id="cbx_61"  value="61" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'24h-Bereitschaft','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('61',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
							<input type="checkbox" id="cbx_61"  value="61" name="symptom[]" onclick="saveCheckboxes(this,'24h-Bereitschaft','<?php echo $this->cat1;?>')" />
						<?php endif;?>
						</td>
					</tr>
					<tr  >
						<td>20.00 – 6.00 Uhr</td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
     						<input type="checkbox" id="cbx_7" class="visit_interval"  value="7" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'20.00 – 6.00 Uhr','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('7',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
							<input type="checkbox" id="cbx_7" class="visit_interval"  value="7" name="symptom[]" onclick="saveCheckboxes(this,'20.00 – 6.00 Uhr','<?php echo $this->cat1;?>')" />
						<?php endif;?>
						</td>
					</tr>

				</table>
			</div>
			</div>
		</div>

		<div class="bayern_dragvbox" id="item_2">
			<h2 class="">Koordination - Absprache mit/ Beratung von  FachkollegInnen</h2>
			<div   id="grow2" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
				<table class="bayern_sapvfb3_table">
					<tr>
						<td width="95%"><label for="cbx_8" >behandelnde Ärzte</label></td>
						<td width="5%">
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_8"  value="8" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'behandelnde Ärzte','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('8',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_8"  value="8" name="symptom[]" onclick="saveCheckboxes(this,'behandelnde Ärzte','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_9" >amb. und stationäre Pflege</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_9"  value="9" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'amb. und stationäre Pflege','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('9',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
								<input type="checkbox" id="cbx_9"  value="9" name="symptom[]" onclick="saveCheckboxes(this,'amb. und stationäre Pflege','<?php echo $this->cat2;?>')" />
						<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_10" >Koordinatoren des amb. Hospiz</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_10"  value="10" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Koordinatoren des amb. Hospiz','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('10',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
								<input type="checkbox" id="cbx_10"  value="10" name="symptom[]" onclick="saveCheckboxes(this,'Koordinatoren des amb. Hospiz','<?php echo $this->cat2;?>')" />
						<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_11" >Med.-pfleg. Palliative Care Fachkraft</label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_11"  value="11" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Med.-pfleg. Palliative Care Fachkraft','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('11',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
								<input type="checkbox" id="cbx_11"  value="11" name="symptom[]" onclick="saveCheckboxes(this,'Med.-pfleg. Palliative Care Fachkraft','<?php echo $this->cat2;?>')" />
						<?php endif;?>
						</td>
					</tr>

					<tr>
						<td><label  for="cbx_12" >PalliativmedizinerIn</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_12"  value="12" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'PalliativmedizinerIn','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('12',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_12"  value="12" name="symptom[]" onclick="saveCheckboxes(this,'PalliativmedizinerIn','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_19" >Klinik- Aufnahme bzw. Entlassung</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_19"  value="19" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Klinik- Aufnahme bzw. Entlassung','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('19',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_19"  value="19" name="symptom[]" onclick="saveCheckboxes(this,'Klinik- Aufnahme bzw. Entlassung','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>

					</tr>
					<tr>
						<td><label  for="cbx_62" >HomeCare</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_62"  value="62" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'HomeCare','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('62',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_62"  value="62" name="symptom[]" onclick="saveCheckboxes(this,'HomeCare','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>

					</tr>

				</table>
				</div>
			</div>
		</div>

		<div class="bayern_dragvbox" id="item_3">
			<h2 class="">Teilversorgung - palliativärztlich-pflegerische Maßnahmen</h2>
			<div   id="grow3" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
				<table class="bayern_sapvfb3_table">
					<tr>
						<td  width="95%"><label  for="cbx_20" ><b>Schmerztherapie<b> Erstberatung</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_20"  value="20" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Schmerztherapie Erstberatung','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('20',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_20"  value="20" name="symptom[]" onclick="saveCheckboxes(this,'Schmerztherapie Erstberatung','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_21" ><span>Verlaufskontrolle</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_21" value="21" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Verlaufskontrolle','<?php echo $this->cat1;?>', <?php echo $this->sapv_id ;?> )"    <?php if(in_array('21',$this->sapvalarr)) { echo ' checked="checked"';}?> />
							<?php else :?>
								<input type="checkbox" id="cbx_21" value="21" name="symptom[]" onclick="saveCheckboxes(this,'Verlaufskontrolle','<?php echo $this->cat1;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_22" ><b>REASSESSMENT Krisenintervention</b></label></td>
						<td>
						<?php if( is_array($this->sapvalarr)):?>
     						<input type="checkbox" id="cbx_22"  value="22" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'REASSESSMENT Krisenintervention','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('22',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
						<?php else :?>
							<input type="checkbox" id="cbx_22"  value="22" name="symptom[]" onclick="saveCheckboxes(this,'REASSESSMENT Krisenintervention','<?php echo $this->cat3;?>')" />
						<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_23" ><b>Symptomkontrolle</b> Erstberatung</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_23"  value="23" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Symptomkontrolle  Erstberatung','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('23',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_23"  value="23" name="symptom[]" onclick="saveCheckboxes(this,'Symptomkontrolle  Erstberatung','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_24" ><span>Verlaufskontrolle</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr) && in_array('24',$this->sapvalarr)):?>
								<input type="checkbox" id="cbx_24" value="24" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Verlaufskontrolle','<?php echo $this->cat2;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('24',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_24" value="24" name="symptom[]" onclick="saveCheckboxes(this,'Verlaufskontrolle','<?php echo $this->cat2;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_25" ><b>REASSESSMENT   Krisenintervention</b></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_25"  value="25" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'REASSESSMENT Krisenintervention','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('25',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_25"  value="25" name="symptom[]" onclick="saveCheckboxes(this,'REASSESSMENT Krisenintervention','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_26" ><span>individueller Notfallplan</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_26"  value="26" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'individueller Notfallplan','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('26',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_26"  value="26" name="symptom[]" onclick="saveCheckboxes(this,'individueller Notfallplan','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_27" ><span>Terminalphase</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_27"  value="27" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Terminalphase','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('27',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_27"  value="27" name="symptom[]" onclick="saveCheckboxes(this,'Terminalphase','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_28" ><span>Maßnahmen im <b>Todesfall</b></span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_28"  value="28" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Maßnahmen im Todesfall','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('28',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_28"  value="28" name="symptom[]" onclick="saveCheckboxes(this,'Maßnahmen im Todesfall','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_31" >Medikation subkutan / i.v. / i.m.</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_31" value="31" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Medikation subkutan / i.v. / i.m.','<?php echo $this->cat3;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('31',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_31" value="31" name="symptom[]" onclick="saveCheckboxes(this,'Medikation subkutan / i.v. / i.m.','<?php echo $this->cat3;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_34" ><span>Mundpflege</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_34"  value="34" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Mundpflege','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('34',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_34"  value="34" name="symptom[]" onclick="saveCheckboxes(this,'Mundpflege','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_35" ><span>Wundversorgung</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_35"  value="35" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Wundversorgung','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('35',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_35"  value="35" name="symptom[]" onclick="saveCheckboxes(this,'Wundversorgung','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_36" ><span>Abführmaßnahmen</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr) ):?>
	     						<input type="checkbox" id="cbx_36"  value="36" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Abführmaßnahmen','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('36',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_36"  value="36" name="symptom[]" onclick="saveCheckboxes(this,'Abführmaßnahmen','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_37" ><span>Stomata-Kontinenzberatung</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_37"  value="37" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Stomata-Kontinenzberatung','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('37',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_37"  value="37" name="symptom[]" onclick="saveCheckboxes(this,'Stomata-Kontinenzberatung','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_38" ><span>Lagerungsmaßnahmen</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_38"  value="38" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Lagerungsmaßnahmen','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('38',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_38"  value="38" name="symptom[]" onclick="saveCheckboxes(this,'Lagerungsmaßnahmen','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_39" ><span>Einsatz von Hilfsmitteln</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_39" value="39" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Einsatz von Hilfsmitteln','<?php echo $this->cat3;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('39',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_39" value="39" name="symptom[]" onclick="saveCheckboxes(this,'Einsatz von Hilfsmitteln','<?php echo $this->cat3;?>');">
							<?php endif;?>
						</td>
					</tr>
				</table>
				</div>
			</div>
		</div>

	</div>

	<div class="bayern_vboxes_right">

		<div class="bayern_dragvbox" id="item_4">
			<h2 class="">Teilversorgung - Psychosoziale Beratung und Begleitung</h2>
			<div   id="grow4" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
				<table class="bayern_sapvfb3_table">
					<tr>
						<td  width="95%"><label  for="cbx_40" >Krankheitsbewältigung</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_40"  value="40" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Krankheitsbewältigung','<?php echo $this->cat4;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('40',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_40"  value="40" name="symptom[]" onclick="saveCheckboxes(this,'Krankheitsbewältigung','<?php echo $this->cat4;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_41" >Unterstützung in akuten Krisen</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_41"  value="41" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Unterstützung in akuten Krisen','<?php echo $this->cat4;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('41',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_41"  value="41" name="symptom[]" onclick="saveCheckboxes(this,'Unterstützung in akuten Krisen','<?php echo $this->cat4;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_42" >Situation der Angehörigen/ Bezugspersonen</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_42"  value="42" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Situation der Angehörigen/ Bezugspersonen','<?php echo $this->cat4;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('42',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_42"  value="42" name="symptom[]" onclick="saveCheckboxes(this,'Situation der Angehörigen/ Bezugspersonen','<?php echo $this->cat4;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_43" >Familienkonferenz</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_43"  value="43" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Familienkonferenz','<?php echo $this->cat4;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('43',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_43"  value="43" name="symptom[]" onclick="saveCheckboxes(this,'Familienkonferenz','<?php echo $this->cat4;?>')" />
							<?php endif;?>
						</td>
					</tr>
				</table>
				</div>
			</div>
		</div>

		<div class="bayern_dragvbox" id="item_6">
			<h2 class="">Teilversorgung - Ethisch-rechtliche Beratung</h2>
			<div   id="grow6" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
					<table class="bayern_sapvfb3_table">
						<tr>
							<td  width="95%"><label  for="cbx_46" >Selbstbestimmung und Patientenverfügung</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_46"  value="46" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Selbstbestimmung und Patientenverfügung','<?php echo $this->cat6;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('46',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_46"  value="46" name="symptom[]" onclick="saveCheckboxes(this,'Selbstbestimmung und Patientenverfügung','<?php echo $this->cat6;?>')" />
							<?php endif;?>
						</td>
						</tr>
						<tr class="bayern_box_alt">
							<td><label  for="cbx_63" >palliative Sedierung</label></td>
							<td>
								<?php if( is_array($this->sapvalarr)):?>
		     						<input type="checkbox" id="cbx_63"  value="63" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'palliative Sedierung','<?php echo $this->cat6;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('63',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
								<?php else :?>
									<input type="checkbox" id="cbx_63"  value="63" name="symptom[]" onclick="saveCheckboxes(this,'palliative Sedierung','<?php echo $this->cat6;?>')" />
								<?php endif;?>
							</td>
						</tr>
						<tr>
							<td><label  for="cbx_64" >Indikationsänderung</label></td>
							<td>
								<?php if( is_array($this->sapvalarr)):?>
									<input type="checkbox" id="cbx_64" value="64" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Indikationsänderung','<?php echo $this->cat6;?>', <?php echo $this->sapv_id ;?> )"    <?php if(in_array('64',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
								<?php else :?>
									<input type="checkbox" id="cbx_64" value="64" name="symptom[]" onclick="saveCheckboxes(this,'Indikationsänderung','<?php echo $this->cat6;?>');">
								<?php endif;?>
							</td>
						</tr>

					</table>
				</div>
			</div>
		</div>

		<div class="bayern_dragvbox" id="item_7">
			<h2 class="">Teilversorgung - Unterstützung in der Trauer</h2>
			<div  id="grow7" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
					<table class="bayern_sapvfb3_table">
						<tr>
							<td  width="95%"><label  for="cbx_51" >Unterstützung der Hinterbliebenen nach dem Tod</label></td>
							<td>
								<?php if( is_array($this->sapvalarr)):?>
		     						<input type="checkbox" id="cbx_51"  value="51" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Unterstützung der Hinterbliebenen nach dem Tod','<?php echo $this->cat7;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('51',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
								<?php else :?>
									<input type="checkbox" id="cbx_51"  value="51" name="symptom[]" onclick="saveCheckboxes(this,'Unterstützung der Hinterbliebenen nach dem Tod','<?php echo $this->cat7;?>')" />
								<?php endif;?>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>

		<div class="bayern_dragvbox" id="item_8">
			<h2 class="">Vollversorgung - Palliativmedizinische Leistungen</h2>
			<div  id="grow8" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
					<table class="bayern_sapvfb3_table">
						<tr>
							<td  width="95%"><label  for="cbx_53" >Schmerzpumpe: Anlage / Einstellung</label></td>
							<td width="5%">
								<?php if( is_array($this->sapvalarr)):?>
									<input type="checkbox" id="cbx_53" value="53" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Schmerzpumpe: Anlage / Einstellung','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('53',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
								<?php else :?>
									<input type="checkbox" id="cbx_53" value="53" name="symptom[]" onclick="saveCheckboxes(this,'Schmerzpumpe: Anlage / Einstellung','<?php echo $this->cat8;?>');">
								<?php endif;?>
							</td>
						</tr>
						<tr class="bayern_box_alt">
							<td><label  for="cbx_60" >Versorgung Port – zentraler Zugang</label></td>
							<td>
								<?php if( is_array($this->sapvalarr)):?>
									<input type="checkbox" id="cbx_60" value="60" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Versorgung Port – zentraler Zugang','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('60',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
								<?php else :?>
									<input type="checkbox" id="cbx_60" value="60" name="symptom[]" onclick="saveCheckboxes(this,'Versorgung Port – zentraler Zugang','<?php echo $this->cat8;?>');">
								<?php endif;?>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>

	</div>

</div>

<br style="clear: both;"/>

			<div class="bayern_dragvbox" id="item_8">
			<h2 style="width: 98.7%;"> + Leistungserfassung</h2>
			<div  id="grow8" class="bayern_dragvbox_content">
				<div class="bayern_sapvfb3_content">
				<table width="100%"> 
				<tr>
				<td  width="50%">
					<table class="bayern_sapvfb3_table  more_sapvfb3">
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th colspan="2">Beratung - Einsatzort / -art</th>
					</tr>
					<tr>
						<td  width="85%"><label for="cbx_4" >Besuch in Arztpraxis</label></td>
						<td  width="15%">
								<?php if( is_array($this->sapvalarr)):?>
		     						<input type="checkbox" id="cbx_4"  value="4" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Besuch in Arztpraxis','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('4',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
								<?php else :?>
									<input type="checkbox" id="cbx_4"  value="4" name="symptom[]" onclick="saveCheckboxes(this,'Besuch in Arztpraxis','<?php echo $this->cat1;?>')" />
								<?php endif;?>
							</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_5" >Beratung im Büro</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_5"  value="5" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Beratung im Büro','<?php echo $this->cat1;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('5',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_5"  value="5" name="symptom[]" onclick="saveCheckboxes(this,'Beratung im Büro','<?php echo $this->cat1;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th colspan="2">Koordination - Absprache mit/ Beratung von  FachkollegInnen</th>
					</tr>
					<tr>
						<td><label  for="cbx_13" >soziale Dienste</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_13"  value="13" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'soziale Dienste','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('13',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_13"  value="13" name="symptom[]" onclick="saveCheckboxes(this,'soziale Dienste','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_14" >ehrenamtliche HospizhelferIn</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_14"  value="14" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'ehrenamtliche HospizhelferIn','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('14',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_14"  value="14" name="symptom[]" onclick="saveCheckboxes(this,'ehrenamtliche HospizhelferIn','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_15" >therapeutische Hilfen</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_15"  value="15" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'therapeutische Hilfen','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('15',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_15"  value="15" name="symptom[]" onclick="saveCheckboxes(this,'therapeutische Hilfen','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_16" >seelsorgerliche Fachstelle</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_16"  value="16" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'seelsorgerliche Fachstelle','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('16',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_16"  value="16" name="symptom[]" onclick="saveCheckboxes(this,'seelsorgerliche Fachstelle','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_17" >sozial-rechtliche Beratung</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_17"  value="17" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'sozial-rechtliche Beratung','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('17',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_17"  value="17" name="symptom[]" onclick="saveCheckboxes(this,'sozial-rechtliche Beratung','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_18" >fachliche Nacht- bzw. Sitzwache</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_18"  value="18" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'fachliche Nacht- bzw. Sitzwache','<?php echo $this->cat2;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('18',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_18"  value="18" name="symptom[]" onclick="saveCheckboxes(this,'fachliche Nacht- bzw. Sitzwache','<?php echo $this->cat2;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th colspan="2">Teilversorgung - palliativärztlich-pflegerische Maßnahmen</th>
					</tr>
					<tr>
						<td><label  for="cbx_29"><b>Flüssigkeit und Ernährung</b><br/><span>enterale Ernährung</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_29" value="29" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Flüssigkeit und Ernährung','<?php echo $this->cat3;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('29',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_29" value="29" name="symptom[]" onclick="saveCheckboxes(this,'Flüssigkeit und Ernährung','<?php echo $this->cat3;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr  class="bayern_box_alt">
						<td><label  for="cbx_30" ><span>parenterale Ernährung</span></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_30" value="30" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'parenterale Ernährung','<?php echo $this->cat3;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('30',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_30" value="30" name="symptom[]" onclick="saveCheckboxes(this,'parenterale Ernährung','<?php echo $this->cat3;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr >
						<td><label  for="cbx_32" ><b>Dauerkatheter, Magensonde</b> Anlage / Wechsel</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_32" value="32" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Dauerkatheter, Magensonde Anlage / Wechsel','<?php echo $this->cat3;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('32',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_32" value="32" name="symptom[]" onclick="saveCheckboxes(this,'Dauerkatheter, Magensonde Anlage / Wechsel','<?php echo $this->cat3;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr  class="bayern_box_alt">
						<td><label  for="cbx_33" ><b>Beratung zur Pflege/Anleitung Pflege</b></label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_33"  value="33" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Beratung zur Pflege/Anleitung Pflege','<?php echo $this->cat3;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('33',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_33"  value="33" name="symptom[]" onclick="saveCheckboxes(this,'Beratung zur Pflege/Anleitung Pflege','<?php echo $this->cat3;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th colspan="2">Teilversorgung - Sozialrechtliche Beratung</th>
					</tr>
					<tr>
						<td><label  for="cbx_44" >selbst erbracht</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_44"  value="44" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'selbst erbracht','<?php echo $this->cat5;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('44',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_44"  value="44" name="symptom[]" onclick="saveCheckboxes(this,'selbst erbracht','<?php echo $this->cat5;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_45" >Vermittlung Fachstelle</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_45" value="45" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Vermittlung Fachstelle','<?php echo $this->cat5;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('45',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_45" value="45" name="symptom[]" onclick="saveCheckboxes(this,'Vermittlung Fachstelle','<?php echo $this->cat5;?>');">
							<?php endif;?>
						</td>
					</tr>

					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					</table>
					</td>
					<td  width="50%">
					<table class="bayern_sapvfb3_table  more_sapvfb3" style="padding:0px; width: 355px!important;">
					<tr>
						<td width="85%">&nbsp;</td>
						<td  width="15%">&nbsp;</td>
					</tr>

					<tr>
						<th colspan="2">Teilversorgung - Ethisch-rechtliche Beratung</th>
					</tr>
					<tr>
						<td width="85%"><label  for="cbx_47" >Gesetzliche Vertretung</label></td>
						<td width="15%">
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_47"  value="47" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Gesetzliche Vertretung','<?php echo $this->cat6;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('47',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_47"  value="47" name="symptom[]" onclick="saveCheckboxes(this,'Gesetzliche Vertretung','<?php echo $this->cat6;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_48" >Erstellung individueller Verfügungen</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_48"  value="48" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Erstellung individueller Verfügungen','<?php echo $this->cat6;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('48',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_48"  value="48" name="symptom[]" onclick="saveCheckboxes(this,'Erstellung individueller Verfügungen','<?php echo $this->cat6;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_49" >Ethische Konfliktsituation</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_49"  value="49" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Ethische Konfliktsituation','<?php echo $this->cat6;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('49',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_49"  value="49" name="symptom[]" onclick="saveCheckboxes(this,'Ethische Konfliktsituation','<?php echo $this->cat6;?>')" />
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_50" >PEG als lebensverlängernde Maßnahme</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
	     						<input type="checkbox" id="cbx_50"  value="50" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'PEG als lebensverlängernde Maßnahme','<?php echo $this->cat6;?>',<?php echo $this->sapv_id; ?>)"  <?php if(in_array('50',$this->sapvalarr)) { echo ' checked="checked"';}?>   />
							<?php else :?>
								<input type="checkbox" id="cbx_50"  value="50" name="symptom[]" onclick="saveCheckboxes(this,'PEG als lebensverlängernde Maßnahme','<?php echo $this->cat6;?>')" />
							<?php endif;?>
						</td>
					</tr>

					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th colspan="2">Teilversorgung - Unterstützung in der Trauer</th>
					</tr>
					<tr>
						<td class="brd_bottom"><label  for="cbx_52" >Vermittlung in Trauerbegleitung</label></td>
						<td class="brd_bottom">
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_52" value="52" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Vermittlung in Trauerbegleitung','<?php echo $this->cat7;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('52',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_52" value="52" name="symptom[]" onclick="saveCheckboxes(this,'Vermittlung in Trauerbegleitung','<?php echo $this->cat7;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<td colspan="2">&nbsp;</td>
					</tr>
					<tr>
						<th colspan="2">Vollversorgung - Palliativmedizinische Leistungen</th>
					</tr>
					<tr>
						<td><label  for="cbx_54" >Pleurapunktion</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_54" value="54" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Pleurapunktion','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('54',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_54" value="54" name="symptom[]" onclick="saveCheckboxes(this,'Pleurapunktion','<?php echo $this->cat8;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_55" >Aszitespunktion</label></td>
						<td>
							<?php if( is_array($this->sapvalarr) && in_array('55',$this->sapvalarr)):?>
								<input type="checkbox" id="cbx_55" value="55" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Aszitespunktion','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('55',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_55" value="55" name="symptom[]" onclick="saveCheckboxes(this,'Aszitespunktion','<?php echo $this->cat8;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr>
						<td><label  for="cbx_56" >Transfusion</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_56" value="56" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Transfusion','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('56',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_56" value="56" name="symptom[]" onclick="saveCheckboxes(this,'Transfusion','<?php echo $this->cat8;?>');">
							<?php endif;?>
						</td>
					</tr>
					<tr class="bayern_box_alt">
						<td><label  for="cbx_57" >Medikamente epidural, intrathekal</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_57" value="57" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Medikamente epidural, intrathekal','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('57',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_57" value="57" name="symptom[]" onclick="saveCheckboxes(this,'Medikamente epidural, intrathekal','<?php echo $this->cat8;?>');">
							<?php endif;?>
						</td>
					</tr>

					<tr>
						<td><label  for="cbx_58" >Sonographie</label></td>
						<td>
							<?php if( is_array($this->sapvalarr)):?>
								<input type="checkbox" id="cbx_58" value="58" name="checkbox[<?php echo $this->sapv_id ;?>][]" onclick="updateCheckboxes(this,'Sonographie','<?php echo $this->cat8;?>', <?php echo $this->sapv_id ;?> )"   <?php if(in_array('58',$this->sapvalarr)) { echo ' checked="checked"';}?>  />
							<?php else :?>
								<input type="checkbox" id="cbx_58" value="58" name="symptom[]" onclick="saveCheckboxes(this,'Sonographie','<?php echo $this->cat8;?>');">
							<?php endif;?>
						</td>
					</tr>

					</table>
					</td>
					</tr>
					</table>
				</div>
			</div>
		</div>
 </div>
 </div>
 <!--  ############################################################################## -->
<?php endif; ?>
 
 
 
 
 
 
 
 
 
 
<?php $blockname="lmu_pmba_psysoz"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  ##### LMU Palliativmedizinisches Basisassesment Psychosoziale Anamnese ####### -->
 <!--  ############################################################################## -->
 	<?php $f_values = $this->patient_lmu_pmba_psysoz_values;?>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + Psychosoziale Anamnese</h2>
		<div class="contactform_dragvbox_content" id="grow2"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
		<h3>Familie und soziale Strukturen</h3>
			<table >
			<tr>
				<th width="150px" style="vertical-align:top;">					
					<b>Verwandtschaftsgrad</b>
				</th>
				<th width="40px" style="vertical-align:top;">					
					<b>Alter</b>
				</th>
				<th width="360px" style="vertical-align:top;">					
					<b>Bemerkung</b>
				</th>
				<th width="30px" style="vertical-align:top; align:center;">					
					<b>†</b>
				</th>
				<th width="150px" style="vertical-align:top;">					
					<b>Kontakt</b>
				</th>
			</tr>
			
			<?php $sections = array('vater'=>'Vater', 'mutter'=>'Mutter', 'partner'=>'Partner/in');?>
			<?php foreach ($sections as $fkey => $fvalue):?>
			<tr <?php if($fvalue=="Geschwister" || $fvalue=="Kinder") echo 'style="border-top:1px solid lightgrey;"';?>>
				<td>
					<b><?php echo $fvalue;?></b>
				</td>
				<td>
					<input type="text" style="width:20px;" name="<?php echo $blockname;?>[<?php echo $fkey;?>_age]"  value="<?php echo $f_values[$fkey . '_age'];?>"/>
				</td>
				<td>
					<input type="text" style="width:340px;"  name="<?php echo $blockname;?>[<?php echo $fkey;?>_note]" value="<?php echo $f_values[$fkey . '_note'];?>"/>
				</td>
				<td>
					<input type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_died]" <?php if ($f_values[$fkey . '_died']) echo "checked";?> value="1" />
				</td>
				<td>
					<input class="link_contacty_with_contactn" type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_contacty]" <?php if ($f_values[$fkey . '_contacty']) echo "checked";?> value="1" /> Ja &nbsp; &nbsp;
					<input class="link_contacty_with_contactn"  type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_contactn]" <?php if ($f_values[$fkey . '_contactn']) echo "checked";?> value="1" /> Nein
				</td>
			</tr>
			<?php endforeach;?>
			
			
			<script>
			function checkboxtoinput(elem){
				var cbv = $(elem).attr('checked');
				$(elem).prev().val(0);
				if (cbv=="checked") $(elem).prev().val(1);
				return;
				}
			function pmbapsysozmultiline(cname){
					var emptyrows=0;
					$('.'+cname).each(function(){
						var text="";
						$(this).find('input').each(function(){

							if($(this).attr('type')=='checkbox'){
								if($(this).attr('checked') == "checked") text=text+'X';
								} 
							else {
								text = text + $(this).val();			
								}
							});
						if (text=="") emptyrows++;
						});
					if(emptyrows==0){
						var newele = $('.'+cname+':last').clone();

						$('.'+cname+':last').after(newele);
						$(newele).find('input').each(function(){
							if($(this).attr('type')=='checkbox'){
								$(this).removeAttr('checked');
								} 
							else {
								$(this).val('');			
								}
							$(this).change(function(){pmbapsysozmultiline(cname)});
							});
						}
						

					}
					
				$(document).ready(function(){
		
				$('.multiline_geschwister input').change(function(){pmbapsysozmultiline('multiline_geschwister')});
				$('.multiline_kinder input').change(function(){pmbapsysozmultiline('multiline_kinder')});
				});

			</script>

			<?php $sections = array('geschwister'=>'Geschwister', 'kinder'=>'Kinder');//, 'geschwister2'=>'','geschwister3'=>'', 'kinder1'=>'Kinder', 'kinder2'=>'', 'kinder3'=>'');?>
			<?php foreach ($sections as $fkey => $fvalue):?>
			<?php $maxcount = max(count($f_values[$fkey . '_age']),3);?>
			<?php for ($ikey=0; $ikey < $maxcount; $ikey++):?>
			<tr class="multiline_<?php echo $fkey;?>" <?php if($ikey==0) echo 'style="border-top:1px solid lightgrey;"';?>>
				<td>
					<b><?php echo $fvalue;?></b>
				</td>
				<td>
					<input type="text" style="width:20px;" name="<?php echo $blockname;?>[<?php echo $fkey;?>_age][]"  value="<?php echo $f_values[$fkey . '_age'][$ikey];?>"/>
				</td>
				<td>
					<input type="text" style="width:340px;"  name="<?php echo $blockname;?>[<?php echo $fkey;?>_note][]" value="<?php echo $f_values[$fkey . '_note'][$ikey];?>"/>
				</td>
				<td>
					<input type="hidden" name="<?php echo $blockname;?>[<?php echo $fkey;?>_died][]" value=<?php if ($f_values[$fkey . '_died'][$ikey]){echo "1";}else{echo "0";};?> />
					<input type="checkbox" onchange="checkboxtoinput(this);" <?php if ($f_values[$fkey . '_died'][$ikey]) echo "checked";?> />
				</td>
				<td>
					<input type="hidden" name="<?php echo $blockname;?>[<?php echo $fkey;?>_contacty][]" value=<?php if ($f_values[$fkey . '_contacty'][$ikey]){echo "1";}else{echo "0";};?> />
					<input class="link_contacty_with_contactn" type="checkbox" onchange="checkboxtoinput(this)" <?php if ($f_values[$fkey . '_contacty'][$ikey]) echo "checked";?>  /> Ja &nbsp; &nbsp;
					<input type="hidden" name="<?php echo $blockname;?>[<?php echo $fkey;?>_contactn][]" value=<?php if ($f_values[$fkey . '_contactn'][$ikey]){echo "1";}else{echo "0";};?> />
					<input class="link_contacty_with_contactn" type="checkbox" onchange="checkboxtoinput(this)" <?php if ($f_values[$fkey . '_contactn'][$ikey]) echo "checked";?>  /> Nein
				</td>
			</tr>
			<?php endfor;?>			
			<?php endforeach;?>	
			</table>

		<h3>Beruf/Interessen/Kontext</h3>
		<textarea class="textarea_full" name="<?php echo $blockname;?>[beruf]" style="vertical-align:top;"><?php echo $f_values['beruf'];?></textarea>
      
		<h3>Psychosozialer Status</h3>
				<table style="width:100%;">
			<tr>
				<?php $fkey="wohnsituation";?>
				<td style="width:200px;">
					<b>Wohnsituation</b>
				</td>
				<td>
					<input type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_allein]" <?php if ($f_values[$fkey . '_allein']) echo "checked";?> value="1" /> allein &nbsp;
					<input type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_angehoerige]" <?php if ($f_values[$fkey . '_angehoerige']) echo "checked";?> value="1" /> mit Angehörigen &nbsp;
					<input type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_Zuhause]" <?php if ($f_values[$fkey . '_Zuhause']) echo "checked";?> value="1" /> Zuhause &nbsp;
					<input type="checkbox" name="<?php echo $blockname;?>[<?php echo $fkey;?>_Pflegeheim]" <?php if ($f_values[$fkey . '_Pflegeheim']) echo "checked";?> value="1" /> Pflegeheim
				</td>
 
			</tr>
			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey="Patientenverfuegung";?>
				<td style="width:200px;">
					<b>Patientenverfügung</b>
				</td>
				<td>

                    <select name="<?php echo $blockname;?>[<?php echo $fkey;?>_verfuegung]" >
                        <?php $verbs = array( 'nicht bekannt', 'Vorhanden', 'nicht vorhanden', 'geplant','abgelehnt');
            foreach ($verbs as $key=>$val):?>
                        <?php
								$selected='';
								if ($f_values[$fkey.'_verfuegung'] ==  $val) $selected='selected';
							?>
                        <option <?php echo $selected;?> ><?php echo $val;?></option>
                        <?php endforeach; ?>
                    </select>
                </td>
 
			</tr>

			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey="Vorsorgevollmacht";?>
				<td style="width:200px;">
					<b>Vorsorgevollmacht</b>
				</td>
				<td><select name="<?php echo $blockname;?>[<?php echo $fkey;?>_vollmacht]" >
                    <?php $verbs = array( 'nicht bekannt', 'Vorhanden', 'nicht vorhanden', 'geplant','abgelehnt');
            foreach ($verbs as $key=>$val):?>
                    <?php
								$selected='';
								if ($f_values[$fkey.'_vollmacht'] ==  $val) $selected='selected';
							?>
                    <option <?php echo $selected;?> ><?php echo $val;?></option>
                    <?php endforeach; ?>
                </select>
                    <table class="psysoz_cntperson" width="100%">
                        <tr>
                            <td></td>
                            <td>Kontaktperson:
                                <select class="psysoz_selectcntperson" name="<?php echo $blockname;?>[<?php echo $fkey;?>_selectedname]">
                                    <option>Auswählen</option>
                                    <?php if($f_values[$fkey . '_selectedname']):?>
                                        <option selected><?php echo $f_values[$fkey . '_selectedname'];?></option>
                                    <?php endif;?>
                                    <?php if((!$f_values[$fkey . '_selectedname']) && $f_values[$fkey . '_last_name']):?>
                                        <option selected><?php echo $f_values[$fkey . '_first_name'] .  " " . $f_values[$fkey . '_last_name'];?></option>
                                    <?php endif;?>
                                </select>
                            </td>
                        </tr>
                    </table>


				</td>
 
			</tr>
			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey="betreuung";?>
				<td style="width:200px;">
					<b>Betreuung</b>
				</td>
				<td><select name="<?php echo $blockname;?>[<?php echo $fkey;?>_betreuung]" >
                    <?php $verbs = array( 'nicht erforderlich/bekannt', 'Vorhanden', 'nicht vorhanden', 'angeregt/geplant','abgelehnt');
            foreach ($verbs as $key=>$val):?>
                    <?php
								$selected='';
								if ($f_values[$fkey.'_betreuung'] ==  $val) $selected='selected';
							?>
                    <option <?php echo $selected;?> ><?php echo $val;?></option>
                    <?php endforeach; ?>
                </select>
                    <table class="psysoz_cntperson" width="100%">
                        <tr>
                            <td></td>
                            <td>Kontaktperson:
                                <select class="psysoz_selectcntperson" name="<?php echo $blockname;?>[<?php echo $fkey;?>_selectedname]">
                                    <option>Auswählen</option>
                                    <?php if($f_values[$fkey . '_selectedname']):?>
                                        <option selected><?php echo $f_values[$fkey . '_selectedname'];?></option>
                                    <?php endif;?>
                                    <?php if((!$f_values[$fkey . '_selectedname']) && $f_values[$fkey . '_last_name']):?>
                                        <option selected><?php echo $f_values[$fkey . '_first_name'] .  " " . $f_values[$fkey . '_last_name'];?></option>
                                    <?php endif;?>
                                </select>
                            </td>
                        </tr>
                    </table>

				</td>
 
			</tr>
			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey="Pflegestufe";?>
				<td style="width:200px;">
					<b><?php echo $this->translate('carelevel'); ?></b>
				</td>
				<td>
				<!-- 
					<select name="<?php echo $blockname;?>[<?php echo $fkey;?>_stufe]" >
						<?php $verbs = array('Keine Pflegestufe', 'Pflegestufe 0', 'Pflegestufe 1', 'Pflegestufe 2','Pflegestufe 3','Pflegestufe 3+');
						foreach ($verbs as $key=>$val):?>
							<?php
								$selected='';
								if ($f_values[$fkey.'_stufe'] ==  $val) $selected='selected';
							?>
							<option <?php echo $selected;?> ><?php echo $val;?></option>
						<?php endforeach; ?>
					</select>
				 -->
				 	<?php
				 	
				 	$verbs = PatientMaintainanceStage::get_MaintainanceStage_array();
					echo $this->formSelect($blockname . "[" . $fkey . "_stufe]", $f_values[$fkey.'_stufe'] , null, $verbs);
					
					?>
					
					&nbsp;
					<input type="checkbox" value="1" style="margin-top:0px;vertical-align:middle;" name="<?php echo $blockname;?>[<?php echo $fkey;?>_hoeher]" <?php if ($f_values[$fkey.'_hoeher'] ==  1) echo 'checked="checked"';?> > Höherstufung beantragt &nbsp;&nbsp;
                    <input type="checkbox" value="1" style="margin-top:0px;vertical-align:middle;" name="<?php echo $blockname;?>[<?php echo $fkey;?>_neuantrag]" <?php if ($f_values[$fkey.'_neuantrag'] ==  1) echo 'checked="checked"';?> > Erstantrag

                </td>
 
			</tr>
			<tr style="border-top:1px solid lightgrey;">
				<?php $fkey="Hilfsmittelversorgung";?>
				<td style="width:200px;">
				  <b>Hilfsmittelversorgung</b>
				</td>
				<td>
					<textarea style="width:375px; vertical-align:top;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
				</td>
 
			</tr>
 
            <tr style="border-top:1px solid lightgrey;">
                <?php $fkey="wunschsterbeort";?>
                <td style="width:200px;">
                    <b>Wunschsterbeort</b>
                </td>
                <td>
                    <select name="<?php echo $blockname;?>[<?php echo $fkey;?>_val]">
                      <?php if(!empty($f_values[$fkey.'_val']) && !in_array($f_values[$fkey.'_val'],$this->list_sterbeort)):
                    	$this->list_sterbeort[] = $f_values[$fkey.'_val'];
						endif;
                     ?>
                        <?php foreach ($this->list_sterbeort as $sterbeort):?>
                            <?php
                            $selected='';
                            if ($f_values[$fkey.'_val'] ==  $sterbeort) $selected='selected';
                            ?>
                            <option <?php echo $selected;?>><?php echo $sterbeort;?></option>
                        <?php endforeach;?>
                    </select>
                </td>
 
            </tr>
 
            <tr style="border-top:1px solid lightgrey;">
                <?php $fkey="memopsysoz";?>
                <td style="width:200px;vertical-align:top;padding-top:5px;">
                    <b>Anmerkungen</b>
                </td>
                <td>
                    <textarea  style="width:100%; height:100px;" type="text" name="<?php echo $blockname;?>[<?php echo $fkey;?>_freetext]"><?php echo $f_values[$fkey.'_freetext'];?></textarea>
                </td>
                <td style="width:140px;">

                </td>
            </tr>
			</table>
			<br/>
			
			

        <h3>Lebenshintergrund</h3>
                <script>
            function lh_pseudoradio(elem){
                var thisboxval=$(elem).val();

                if(($(elem)).attr('checked')){
                    if(thisboxval=="1"){
                        $(elem).parent().find('input[type="text"]').val('').show();
                    } else{
                        $(elem).parent().find('input[type="text"]').hide();
                    }
                }

            }
        </script>
        <table style="border:none; width:100%;">
            <tr>
                <td style="width:200px;">
                    <b>Migrationshintergrund: </b>
                </td>
                <td>
                    <input type="radio" name="<?php echo $blockname;?>[migrationshintergrund]"  <?php if ($f_values['migrationshintergrund']=="1") echo "checked";?> value="1" onchange="lh_pseudoradio(this)"> Ja
                    <?php
                    $disp="display:none;";
                    if( $f_values['migrationshintergrund']=="1") $disp="";
                    ?>
                    <input type="text" name="<?php echo $blockname;?>[migrationshintergrund_freetext]"  value="<?php echo $f_values['migrationshintergrund_freetext'];?>" style="width:200px;<?php echo $disp;?>">
                    <br/>
                    <input type="radio" name="<?php echo $blockname;?>[migrationshintergrund]"  <?php if ($f_values['migrationshintergrund']=="2") echo "checked";?> value="2" onchange="lh_pseudoradio(this)"> Nein
                </td>
                <td style="width:140px;">

                </td>
            </tr>
            <tr>
                <td>
                    <b>Dolmetscher nötig: </b>
                </td>
                <td>
                    <input type="radio" name="<?php echo $blockname;?>[dolmetscher]"  <?php if ($f_values['dolmetscher']=="1") echo "checked";?>  value="1" onchange="lh_pseudoradio(this)"> Ja

                    <?php
                    $disp="display:none;";
                    if( $f_values['dolmetscher']=="1") $disp="";
                    ?>

                    <input type="text" name="<?php echo $blockname;?>[dolmetscher_freetext]"  value="<?php echo $f_values['dolmetscher_freetext'];?>" style="width:200px;<?php echo $disp;?>">
                    <br/>
                    <input type="radio" name="<?php echo $blockname;?>[dolmetscher]"  <?php if ($f_values['dolmetscher']=="2") echo "checked";?>  value="2"  onchange="lh_pseudoradio(this)"> Nein
                </td>
            </tr>
            <tr>
                <td>
                    <b>Religionszugehörigkeit: </b>
                </td>
                <td>
                    <script>
                        function lh_showandere(elem){
                            if($(elem).val() == "7"){
                                $(elem).parent().find('input[type="text"]').show();
                            } else{
                                $(elem).parent().find('input[type="text"]').hide();
                            }
                        }
                    </script>

					<?php echo $this->formSelect($blockname.'[religion]', $f_values['religion'], array ('onchange' => 'lh_showandere(this)'), $this->religions); ?>
                    <?php
                    $disp="display:none;";
                    if( $f_values['religion'] == "7") $disp="";
                    ?>
                    <input type="text" name="<?php echo $blockname;?>[religion_freetext]" value="<?php echo $f_values['religion_freetext'];?>" style="width:180px;<?php echo $disp;?>">
                </td>
                <td>

                </td>
            </tr>
        </table>
			</div>
	</div>

 




	

	
<!--  ############################################################################## -->
<?php endif;?>	




 
<?php $blockname="time_division"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
<?php $time_division_values = $this->time_division_block[0];?>
 <!--  ############################################################################## -->
 <!--  ##### time_division_block START ####### -->
 <!--  ############################################################################## -->
<style>
	.time_division_error {
		border-color :#FF0000;
	}
	.yellow_bg{
		background-color: #ffffe0;
	}
</style>
<script type="text/javascript">



$(document).ready(function(){
	
	<?php if(!isset($time_division_values['remain'])) :?>
	$('#time_division_remain').val(calculate_time_diff());
	<?php endif; ?>
	var old_minutes = [];
	old_minutes['time_division_on_patient'] = <?php if(isset($time_division_values['on_patient'])) echo $time_division_values['on_patient'];else echo '0' ; ?>;
	old_minutes['time_division_relatives'] = <?php if(isset($time_division_values['relatives'])) echo $time_division_values['relatives'];else echo '0' ; ?>;
	old_minutes['time_division_systemic'] = <?php if(isset($time_division_values['systemic'])) echo $time_division_values['systemic'];else echo '0' ; ?>;
	old_minutes['time_division_professional'] = <?php if(isset($time_division_values['professional'])) echo $time_division_values['professional'];else echo '0' ; ?>;

	$( "#begin_date_h, #begin_date_m, #end_date_h, #end_date_m" ).bind( "change", function() {
		var minutes = calculate_time_diff();
		$('#time_division_remain').val(minutes);
		old_minutes['time_division_on_patient']=0;
		old_minutes['time_division_relatives']=0;
		old_minutes['time_division_systemic']=0;
		old_minutes['time_division_professional']=0;
		$("input[id=time_division_on_patient], input[id=time_division_relatives], input[id=time_division_systemic], input[id=time_division_professional]")
			.trigger( "change" );
		
	});
	
	$('#time_division_table tr')
		.focusin(function() {$(this).addClass("yellow_bg")})
		.focusout(function() {$(this).removeClass("yellow_bg")});
	
	$("input[id=time_division_on_patient], input[id=time_division_relatives], input[id=time_division_systemic], input[id=time_division_professional]")
		.click(function (){
			if($(this).val() == "0")$(this).val("");
			//$(this).parent().parent().addClass("yellow_bg");
		})
		.keydown(function (e) {
			// Allow: backspace, delete, tab, escape, enter and .
			if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
				// Allow: home, end, left, right
				(e.keyCode >= 35 && e.keyCode <= 39)) 
			{
				// let it happen, don't do anything
				return;
			}
			// Ensure that it is a number and stop the keypress
			if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
				e.preventDefault();
			}
    	})
		.change(function() {
			var minutes = calculate_time_diff();	
			var minutes_spent = 0;
			//$(this).parent().parent().removeClass("yellow_bg");
			$("input[id=time_division_on_patient], input[id=time_division_relatives], input[id=time_division_systemic], input[id=time_division_professional]")
				.map(function(idx, elem) {
					minutes_spent = minutes_spent+ (parseInt($(elem).val()) || 0);
				})
				.get();
			if((minutes - minutes_spent)>=0){//time OK
				$('#time_division_remain').val(minutes - minutes_spent);
				old_minutes[$(this).attr('id')] = $(this).val();
				$(this).removeClass("time_division_error");
			}else{//time BAD too much time			
				$(this)
					.val( old_minutes[$(this).attr('id')])
					.addClass("time_division_error")
					.delay(800).queue(function(next){
						$(this).removeClass("time_division_error").dequeue();
					});
				$('#time_division_remain')
					.addClass("time_division_error")
					.delay(1000).queue(function(next){
						$(this).removeClass("time_division_error").dequeue();	
					});
			}		
		});
});
</script>
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
           <?php echo $this->translate('lang_block_time_division_title') ?>
           <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>
		<div class="contactform_dragvbox_content besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>" id="time_division_block"  >
    <div class="inputs">
	   <div class="container double">
	   <div class="column col1">
		<table id="time_division_table" class="datatable table-striped" style="width:100%">
		
		    <tr>
				<td width="120px" colspan="2"><label><?php echo $this->translate('lang_block_time_division_on_patient'); ?></label></td>
		    </tr>	
			<tr>
				<td width="60px"><input type="text" size="6" id="time_division_on_patient"  name="<?php echo $blockname;?>[on_patient]" value="<?php if(is_numeric($time_division_values['on_patient'])){echo (int)($time_division_values['on_patient']);} else {echo "0"; }?>"></td>
				<td><span><?php echo $this->translate('minutes'); ?></span></td>
			</tr>	
			
			<tr>
                <td colspan="2"><?php echo $this->translate('lang_block_time_division_relatives'); ?></td>
			</tr>			
			<tr>
				<td style="display: block; width: 100%"><?php echo $this->translate('lang_block_time_division_relatives'); ?></td>
				<td><input type="text" size="6" id="time_division_relatives" name="<?php echo $blockname;?>[relatives]" value="<?php if(is_numeric($time_division_values['relatives'])){echo (int)($time_division_values['relatives']);} else {echo "0"; }?>"></td>
				<td><?php echo $this->translate('minutes'); ?></td>
			</tr>			
			<tr>
				<td><?php echo $this->translate('lang_block_time_division_systemic'); ?></td>
				<td><input type="text" size="6" id="time_division_systemic" name="<?php echo $blockname;?>[systemic]" value="<?php if(is_numeric($time_division_values['systemic'])){echo (int)($time_division_values['systemic']);} else {echo "0"; }?>"></td>
				<td><?php echo $this->translate('minutes'); ?></td>
			</tr>	
			<tr>
				<td><?php echo $this->translate('lang_block_time_division_professional'); ?></td>
				<td><input type="text" size="6" id="time_division_professional" name="<?php echo $blockname;?>[professional]" value="<?php if(is_numeric($time_division_values['professional'])){echo (int)($time_division_values['professional']);} else {echo "0"; }?>"></td>
				<td><?php echo $this->translate('minutes'); ?></td>
			</tr>	
			<tr>
				<td><?php echo $this->translate('lang_block_time_division_remain'); ?></td>
				<td><input type="text" size="6" readonly="true" id="time_division_remain"  name="<?php echo $blockname;?>[remain]" value="<?php if(is_numeric($time_division_values['remain'])){echo (int)($time_division_values['remain']);} else {echo "0"; }?>"></td>
				<td><?php echo $this->translate('minutes'); ?></td>
			</tr>		
			<tr>
				<td><?php echo $this->translate('lang_block_time_division_on_call'); ?></td>
				<td colspan="2"><input type="checkbox" value='1' <?php if($time_division_values['on_call'] == "1"){echo "checked='checked'";}?>" id="time_division_on_call"  name="<?php echo $blockname;?>[on_call]"></td>
			</tr>	
			</table>
			</div>
			</div>
			</div>
		</div>
	</div>
 <!--  ##### time_division_block END ####### -->
<?php endif;?>	
 
 
 
 
 
 

<?php $blockname="tracheostomy"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
<?php $tracheostomy_values = $this->tracheostomy_block[0];?>
<?php
if (isset($tracheostomy_values['last_change']) && $tracheostomy_values['last_change'] !="0000-00-00 00:00:00"){
	$myTime_t = date("d.m.Y", strtotime($tracheostomy_values['last_change']));
}else{
	$myTime_t = date("d.m.Y",time());
}
?>
 <!--  ############################################################################## -->
 <!--  ##### Trachealkanüle tracheostomy block START ####### -->
 <!--  ############################################################################## -->
<style>
	.yellow_bg_tracheostomy{
		background-color: #ffffe0;
	}
</style>
<script type="text/javascript">
$(document).ready(function(){	
	//datapicker
	$("#tracheostomy_last_change" ).datepicker({
		dateFormat: 'dd.mm.yy',
		showOn: "focus",
		//buttonImage: $('#calImg').attr('src'),
		//buttonImageOnly: false,
		changeMonth: true,
		changeYear: true,
		nextText: '',
		prevText: ''
	}).mask("99.99.9999");
	//allow only numbers
	$("input[id=tracheostomy_cuff_pressure], input[id=tracheostomy_change_interval]")
		.click(function (){
			
		})
		.keydown(function (e) {
			// Allow: backspace, delete, tab, escape, enter and .
			if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
				// Allow: home, end, left, right
				(e.keyCode >= 35 && e.keyCode <= 39)) 
			{
				// let it happen, don't do anything
				return;
			}
			// Ensure that it is a number and stop the keypress
			if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
				e.preventDefault();
			}
    	});
	//table column class
	var $tds = $("#tracheostomy_table td");
	$("#tracheostomy_table td")
		.focusin(function() {
			var position = $(this).index(),
       		$tdsInColumn = $tds.filter(":nth-child(" + (position+1) + ")");
			$tdsInColumn.addClass("yellow_bg_tracheostomy");
		})
		.focusout(function() {$tds.removeClass("yellow_bg_tracheostomy")});

});	
</script>
	
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
		<h2> + <?php echo $this->translate('lang_block_tracheostomy_title');  ?></h2>
		<div class="contactform_dragvbox_content" id="tracheostomy_block"  style="display:<? if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
			<table  id="tracheostomy_table" class="datatable table-striped">
				<thead>
					<tr>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_size');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_designation');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_company');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_speaking_cannula');  ?></strong></td>
						<td width="80px"><strong><?php echo $this->translate('lang_block_tracheostomy_cuff_pressure');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_change_interval');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_last_change');  ?></strong></td>
						<td><strong><?php echo $this->translate('lang_block_tracheostomy_change_by');  ?></strong></td>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td><input type="text" size="10" name="<?php echo $blockname;?>[size]" value="<?php echo $tracheostomy_values['size']; ?>"></td>
						<td><input type="text" size="10" name="<?php echo $blockname;?>[designation]" value="<?php echo $tracheostomy_values['designation']; ?>"></td>
						<td><input type="text" size="10" name="<?php echo $blockname;?>[company]" value="<?php echo $tracheostomy_values['company']; ?>"></td>
						<td><select name="<?php echo $blockname;?>[speaking_cannula]">
							<option value=0 <?php if($tracheostomy_values['speaking_cannula'] == 0) echo"selected=selected"; ?> ><?php echo $this->translate('please select');  ?></option>
							<option value=1 <?php if($tracheostomy_values['speaking_cannula'] == 1) echo"selected=selected"; ?> ><?php echo $this->translate('option_yes');  ?></option>
							<option value=2 <?php if($tracheostomy_values['speaking_cannula'] == 2) echo"selected=selected"; ?> ><?php echo $this->translate('option_no');  ?></option>	
							</select>
						</td>
						<td><input type="text" id="tracheostomy_cuff_pressure"  style="width:60px;" name="<?php echo $blockname;?>[cuff_pressure]" value="<?php echo $tracheostomy_values['cuff_pressure']; ?>"></td><!-- only numbers -->
						<td><input type="text" id="tracheostomy_change_interval" size="10" name="<?php echo $blockname;?>[change_interval]" value="<?php echo $tracheostomy_values['change_interval']; ?>"></td><!-- only numbers -->
						<td><input type="text" id="tracheostomy_last_change" style="width:60px;" name="<?php echo $blockname;?>[last_change]" value="<?php echo $myTime_t; ?>" > </td>
						<td><input type="text" size="10" name="<?php echo $blockname;?>[change_by]" value="<?php echo $tracheostomy_values['change_by']; ?>"></td>
					</tr>
				</tbody>
			</table>
			
		
			
		</div>
	</div>
 <!--  ##### Trachealkanüle tracheostomy block END ####### -->
<?php endif;?>	 
 
 
 
 
<?php if(in_array('clientsymptoms',$allowed_blocks) && $v_box == 'clientsymptoms'): ?>
<?php $set_id = 1; ?>
 <!--  ############################################################################## -->
 <!--  #############################  clientsymptoms    ################################ -->
 <!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="clientsymptoms">
		<h2> + <?php echo $this->translate('block_clientsymptoms') ?></h2>
		<div class="contactform_dragvbox_content" id="grow3"  style="display:<?php if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
			<table  border="0" cellpadding="2" cellspacing="2" class="client_symptomatics" width="100%">
				<thead>
				<tr>
					<th>#</th>
					<th><?php echo $this->translate('cl_sym_name')?></th>
					<th><?php echo $this->translate('cl_sym_severity')?></th>
					<th><?php echo $this->translate('cl_sym_sorrowfully')?></th>
					<th><?php echo $this->translate('cl_sym_comment')?></th>
					<th><?php echo $this->translate('cl_sym_del')?></th>
				</tr>
				</thead>
				<tbody>
				<?php if(!empty($patient_client_symptoms)):?>
					<?php  
						$cs_nr = 1;
						foreach($patient_client_symptoms as $db_id=> $sym_details):
 
						if($cs_nr%2){
							$sym_row_class ="cl_sym_row_odd";
						} else {
							$sym_row_class ="cl_sym_row_even";
						}
					?>
						<tr id="cl_sym<?php echo $cs_nr;?>" class="sym_default_row  <?php echo $sym_row_class;?> ">
							<td>#<?php //echo $cs_nr?></td>
							<td>
								<?php 
								$sel_str ="";
								$sel_str .= '<option value=""></option>';
								foreach($this->client_syms  as $group_id => $group_details) 
								{
                                    //TODO-1296
                                    if(is_array($group_details['symps']) && count($group_details['symps'])>1) {
                                        usort($group_details['symps'], array(new Pms_Sorter('description'), "_strcmp"));
                                    }
									$sel_str .= '<optgroup label="'.$group_details['name'].'">';
 
									foreach($group_details['symps'] as $k=>$syms)
									{
										if($sym_details['symptom_id'] == $syms['id']){ 
											$selected[$db_id] = 'selected="selected"';
                                            $opt_selected = 'selected="selected"';
										} else {
											$selected[$db_id] = '';
											$opt_selected = '';
										}
										//$sel_str .= '<option value="'.$syms['id'].'"  '.$selected[$db_id].' >'.$syms['description'].'</option>';
										$sel_str .= '<option value="'.$syms['id'].'"  '.$opt_selected.' >'.$syms['description'].'</option>';
									}
 
									$sel_str .= '</optgroup>';
								}
								?>
								<select name="clientsymptoms[<?php echo $db_id; ?>][symptom_id]"  class="sym_name_drop" ><?php echo $sel_str;?></select>
							</td>
							<td>
								<select name="clientsymptoms[<?php echo $db_id; ?>][severity]" class="sym_severety">
									<option value=""></option>
									<option value="0" <?php if($sym_details['severity'] == "0"){ echo 'selected="selected"'; } ?> >kein</option>
									<option value="4" <?php if($sym_details['severity'] == "4"){ echo 'selected="selected"'; } ?> >leicht</option>
									<option value="7" <?php if($sym_details['severity'] == "7"){ echo 'selected="selected"'; } ?> >mittel</option>
									<option value="10" <?php if($sym_details['severity'] == "10"){ echo 'selected="selected"'; } ?> >schwer</option>
								</select>
							</td>
							<td>
								<input type="radio"  name="clientsymptoms[<?php echo $db_id; ?>][sorrowfully]" value="1" <?php if($sym_details['sorrowfully'] == "1"){ echo 'checked="checked"'; } ?>/><label>Ja</label>
								<input type="radio"  name="clientsymptoms[<?php echo $db_id; ?>][sorrowfully]" value="2" <?php if($sym_details['sorrowfully'] == "2"){ echo 'checked="checked"'; } ?>/><label>Nein</label>
							</td>
 
							<td>
                                <?php //TODO-1296; ?>
                                <!-- 
    								<input type="text"  name="clientsymptoms[<?php echo $db_id; ?>][comment]"  class="sym_comment"  value="<?php echo $sym_details['comment'];?>"/>
                                 -->
                                <textarea name="clientsymptoms[<?php echo $db_id; ?>][comment]"  class="sym_comment" ><?php echo $sym_details['comment'];?></textarea>
							</td>
 
							<td align="left" valign="top"><a href="javascript:void(0)" onclick="remove_sym_line(<?php echo $cs_nr ; ?>)"><img src="images/action_delete.png" border="0" /></a></td>
						</tr>
 
						<tr id="care_cl_sym<?php echo $cs_nr;?>"  class="sym_default_row bbotttom <?php echo $sym_row_class;?>">
							<td colspan="6">
								<b><?php echo $this->translate('Sym care instructions: '); ?></b><br/>
								<textarea  cols="" rows=""  class="sym_care_instruction" name="clientsymptoms[<?php echo $db_id; ?>][care_specifications]"><?php echo $sym_details['care_specifications']?></textarea>
								<input type="hidden" name="clientsymptoms[<?php echo $db_id; ?>][custom]"  value="0" >
							</td>
						</tr>
					<?php $cs_nr++; endforeach; ?>
				<?php endif; ?>
				</tbody>
			</table>
 
			<a href="javascript:create_new_symptom_item()" class="add_item_link">
				<?php echo $this->translate('addnewsymptom'); ?>
			</a>
		</div>
	</div>
<!--  ############################################################################## -->
<?php endif;?>






<?php
//ispc-2291 LYSOCARE blocks
?>

<?php 
if(in_array('puncture',$allowed_blocks)  && $v_box == 'puncture'): 
    $block_puncture = $this->block_puncture ;
    echo $block_puncture['__formHTML'];
endif;
?>


<?php 
if(in_array('infusion',$allowed_blocks)  && $v_box == 'infusion'): 
    $block_infusion = $this->block_infusion ;
    echo $block_infusion['__formHTML'];
endif;
?>


<?php 
if(in_array('infusiontimes',$allowed_blocks)  && $v_box == 'infusiontimes'): 
    $block_infusiontimes = $this->block_infusiontimes ;
    echo $block_infusiontimes['__formHTML'];
endif;
?>


<?php 
if(in_array('adverseevents',$allowed_blocks)  && $v_box == 'adverseevents'): 
    $block_adverseevents = $this->block_adverseevents ;
    echo $block_adverseevents['__formHTML'];
endif;
?>



<?php if(in_array('ventilation',$allowed_blocks)  && $v_box == 'ventilation'): ?>
<?php $block_ventilation_arr = $this->block_ventilation ; 


$lang_block_ventilation = $this->translate('lang_block_ventilation');
?>
<!--  ############################################################################## -->
<!--  ######################## ventilation =  Beatmung  ############################ -->
<!--  ############################################################################## -->
	<div class="contactform_dragvbox"  id="<?php echo $v_box;?>">
		<h2> + <?php echo $this->translate('block_ventilation') ?></h2>
		<div class="contactform_dragvbox_content" id="grow2"  style="display:<?php if($opened_blocks[$v_box] == '1'){ echo 'block';} else { echo 'none'; }?>;" >
				<div class="visit_quality">
					<table class="datatable table-striped block_ventilation_table">
						<tr>
							<td width="15%"> 
								<label>
								<?php echo $lang_block_ventilation['Modus'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[modus]", $block_ventilation_arr['modus'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['F_tot'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[f_tot]", $block_ventilation_arr['f_tot'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['Vt'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[vt]", $block_ventilation_arr['vt'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['MV'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[mv]", $block_ventilation_arr['mv'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['PEEP'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[peep]", $block_ventilation_arr['peep'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['PIP'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[pip]", $block_ventilation_arr['pip'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['O2_l_min'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[o2_l_min]", $block_ventilation_arr['o2_l_min'] , array()); ?>
							</td>
						</tr>
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['I_E'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formText("block_ventilation[i_e]", $block_ventilation_arr['i_e'] , array()); ?>
							</td>
						</tr>
			
						
						<tr>
							<td> 
								<label>
								<?php echo $lang_block_ventilation['freetext'];?>
								</label>
							</td>
							<td> 
								<?php echo $this->formTextarea("block_ventilation[freetext]", $block_ventilation_arr['freetext'], array("class"=>"textarea_full" , "style"=>"overflow: hidden; height: 40px;")); ?>
							</td>
						</tr>
						
					</table>
				
					
				</div>
		</div>
	</div>
<!--  ####################### ventilation =  Beatmung end #################################### -->
<?php endif; ?>

<?php if(in_array('invoice_condition',$allowed_blocks)  && $v_box == 'invoice_condition'): ?>
<?php 
$block_invoice_condition = $this->block_invoice_condition ;
$lang_block_invoice_condition = $this->translate('lang_block_invoice_condition');
?>
<!--  ######################## start invoice_condition =  Abrechnung Niedersachsen  ############################ -->
	<div class="contactform_dragvbox"  id="<?php echo $v_box;?>">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('block_invoice_condition') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>	
    	<div class="contactform_dragvbox_content  besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>"  >
            <div class="inputs">
                <div class="container">
    				<div class="visit_quality column" >
    		          <ul class="cbrdList">
                        <li>
    				        <label><?php echo $lang_block_invoice_condition['hide_on_invoice'];?></label>					
    					    <?php echo $this->formCheckbox("block_invoice_condition", $block_invoice_condition['selected'] , array('labelUnwrapp'=>true), $block_invoice_condition['values']); ?>
                        </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
	</div>
<!--  ######################## end invoice_condition =  Abrechnung Niedersachsen  ############################ -->
<?php endif; ?>
 
<?php $blockname="treatment_plan"; ?>
<?php if(in_array($blockname,$allowed_blocks) && $v_box == $blockname): ?>
 <!--  ############################################################################## -->
 <!--  ##### Behandlungsplan ####### -->
 <!--  ############################################################################## -->
 	<?php //$f_values = $this->patient_treatment_plan_values; ?>
 	
	<div class="contactform_dragvbox"  id="<?php echo $blockname; ?>">
        <div class="groupHeader <?=($opened_blocks[$v_box] == '1')?'expanded':'collapsed'?>" >
            <?php echo $this->translate('Behandlungsplan') ?>
            <button type="button" class="btnControl" onClick="boxToggle(this); return false;"></button>
        </div>			
		<div class="contactform_dragvbox_content  besuch <?=($opened_blocks[$v_box] == '1')?'':'display_none'?>"  >
            <div class="inputs">
                <div class="container">
    				<div class="column" >		 
                        <?php echo $this->formblocktreatmentplan;?>
                    </div>
                 </div>
            </div>
		</div>
	</div>
<!--  ######################## end Behandlungsplan  ############################ -->
<?php endif; ?>
 
<?php endforeach;  ?>
<input type="hidden" name="kvno_doc_id" value="<?php echo $this->kvno_doc_id;?>">
<br/><br/>
 <div class="kvno_buttons">
 <input type="hidden" name="iskvno" value ="1" />

<!-- <input name="submitform" id="submitform" type="submit" value="<?php echo $this->translate('save') ?>" />&nbsp;&nbsp; -->
<!-- <input name="pdfexport" id="pdfexport" type="submit" value="<?php echo $this->translate('generatepdf') ?>" /> -->

</div>


<table class="form_buttons_table">
	<tr>
		<td>
			<input type="hidden" name="submitform" id="save_visit" value=""  />&nbsp;&nbsp;
			<button type="button" id="submitform" class="submit_form" > <?php echo $this->translate('save') ?></button>
			
			<input type="hidden" name="pdfexport" id="generate_pdf" value="" />&nbsp;&nbsp;
			<button type="button" id="pdfexport"  class="submit_form"> <?php echo $this->translate('generatepdf') ?></button>
		
		</td>
	</tr>

</table>



</div>
</div>

  </div>
</form>

<div id="duplicate_visits">

	<p><?php echo $this->translate('overlapping_confirm');  ?></p>
</div>

<div class="add_action_block" id="add_action_block">
	<label><?php echo $this->translate('social_action_name'); ?></label>
	<input type="text" name="action_name" value="" id="action_name" />
</div>

<?php if ($this->bassis_prefill == "1"):?>

<div id="sync_prefill_widget" style="display:none;">
    <p>Es wurden Daten von einem anderen System empfangen. Diese Einträge können nun in dieses Assessment eingefügt werden.</p>
    <p>Dabei werden Inhalte für die unten aufgelisteten Blöcke übernommen:</p>
    <ul style="margin: 14px;list-style-type: square;">
        <li>Körperliche Untersuchung</li>
        <li>Schmerzanamnese</li>
        <li>Wünsche und Erwartungen des Patienten und seiner Angehörigen</li>
        <li>Aufklärungsstand/Krankheitsverarbeitung Patient/ ggf. Angehörige</li>
    </ul>

    <table>
        <tr>
            <td>Datensatz vom:</td>
            <td>
                <?php echo date('d.m.Y',strtotime($this->bassis_data['create_date']));?>
                <input type="hidden" class="sync_prefill_widget_rowid" value="<?php echo $this->bassis_data['id'];?>">
            </td>
        </tr>
    </table>
</div>


<script>
    $(document).ready(function(){
        var spf_open_dlg = function(){$('#sync_prefill_widget').dialog({
            title: 'Übertragene Eingaben übernehmen',
            width:  500,
            buttons: {
                "Ignorieren": function () {
                    var id = $('#sync_prefill_widget').find('.sync_prefill_widget_rowid').val();
                    var that = $(this);
                    $.ajax({
                        url: "ajax/marksyncbapacketdone",
                        data: {syncid: id}
                    }).done(function () {
                        $(that).dialog("close");
                    });
                },
                "Daten übernehmen": function () {
                    var syncid = $('#sync_prefill_widget').find('.sync_prefill_widget_rowid').val();
                    window.location.href = window.location.href + "&prefill_bassis=" + syncid;
                }
            }
        })};
		
        <?php if($this->bassis_data['done']==0):?>
            spf_open_dlg();
        <?php endif;?>

    });
</script>
<?php endif;?>