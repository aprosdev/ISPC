<!-- Maria:: Migration ISPC to CISPC 08.08.2020 -->
<?php
$this->headLink()->appendStylesheet(RES_FILE_PATH . '/css/page-css/kvno_assessment_style.css');
$x = json_encode($this->users);
?>
<link href="<?php echo RES_FILE_PATH; ?>/css/custom_modal.css" media="all" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="<?php echo RES_FILE_PATH; ?>/javascript/livesearch/directpatientsearch.js"></script>
<script type="text/javascript" src="<?php echo RES_FILE_PATH; ?>/javascript/livesearch/pflegedienste_edit_modal.js"></script>
<script type="text/javascript" src="<?php echo RES_FILE_PATH; ?>/javascript/livesearch/familydoc_edit_modal.js"></script>

<script type="text/javascript">
	var jarr = <?php echo $this->jdarr ?>;
	var jscount = '0';
	var jsmedcount = '0';
	var medcount = '<?php echo $this->mcntr + 1 ?>';
	var jcount = '<?php echo $this->jscount + 1 ?>';
	var dcntr = '<?php echo $this->dcntr ?>';
	var diagnosisblur = Array();
	var icddiagnosisblur = Array();
	var diagnosisblur_ed = Array();
	var medblur = Array();
	var jsusers = <?php echo $this->jsusers; ?>;
	var isdischarged = '<?php echo $this->isdischarged ?>';

var carediv = function(params)
{
   document.getElementById('listcarelevel').innerHTML=params.carelist;
}

	function redirect() {
		window.location.href = "<?php echo APP_BASE;  ?>patientform/kvnoassessment?id=<?php echo $_GET['id']?>";
	}

	$(document).ready(function(){

		window.onbeforeunload = null;
		$(document).on('change', '#kvnoassessment :input', function() {
			if(window.onbeforeunload === null)
			{
				window.onbeforeunload = function() { return "<?php echo $this->translate('no_save_leave_alert'); ?>"; }
			}
		});
		
		$('form').submit(function() {
// 			setTimeout(function () {$('input[type=submit]').attr('disabled', true);}, 150);
// 			setTimeout(function () {$('input[type=submit]').attr('disabled', false);}, 8000);
		});

		// time input for complete date
		$('.completedtime').mask("99:99"); //add hours and minute mask
		$('.completedtime').timepicker({
			onSelect : function(time_value) {
				$(this).focus();
				return false;
			},
			minutes : {
				interval : 5
			},
			showPeriodLabels : false,
			rows : 4,
			hourText : 'Stunde',
			minuteText : 'Minute'
		});
		
		
		// time input for start date
		$('.starttime').mask("99:99"); //add hours and minute mask
		$('.starttime').timepicker({
			onSelect : function(time_value) {
				$(this).focus();
				return false;
			},
			minutes : {
				interval : 5
			},
			showPeriodLabels : false,
			rows : 4,
			hourText : 'Stunde',
			minuteText : 'Minute'
		});
		
		
		
		
		$(".startdate").datepicker({
			dateFormat: 'dd.mm.yy',
			showOn: "both",
			buttonImage: $('#calImg').attr('src'),
			buttonImageOnly: true,
			changeMonth: true,
			changeYear: true,
			nextText: '',
			prevText: ''
		});
		
		
		
		$('input.livesearchmedinp, input.med_date, input.dosage, input.med, input.comment, select.user_selector').live('change keyup', function() {
			if ($(this).hasClass('livesearchmedinp')) {
				var input_row = parseInt($(this).attr('id').substr(('medication').length)); //med name
			} else if ($(this).hasClass('med_date')) {
				var input_row = parseInt($(this).attr('rel').substr(('med_date').length)); //change date
			} else if ($(this).hasClass('dosage')) {
				var input_row = parseInt($(this).attr('id').substr(('dosage').length)); //dosage
			} else if ($(this).hasClass('med') || $(this).hasClass('comment')) {
				var input_row = parseInt($(this).attr('id').substr(('comment').length)); //comment
			} else if ($(this).hasClass('user_selector')) {
				var input_row = parseInt($(this).attr('id').substr(('verordnetvon-').length)); //doctor
			}

			$('#edited' + input_row).val('1');
		});

		$('.med_date').datepicker({
			dateFormat: 'dd.mm.yy',
			buttonImageOnly: true,
			changeMonth: true,
			changeYear: true,
			nextText: '',
			prevText: '',
			onSelect: function(){
				var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
				$('#edited' + input_row).val('1');

			}
		});

		$(".med_date").mask("99.99.9999");
		$('#btnsave').live('click', function(event){
			$(this).attr('disabled', true);
			if(window.onbeforeunload)
			{
				window.onbeforeunload = null;
			}
// 			setTimeout(function () {$('input[type=submit]').attr('disabled', true);}, 150);
// 			setTimeout(function () {$('input[type=submit]').attr('disabled', false);}, 15000);
			event.preventDefault();
			$('#btnsubmith').val('');
			$('#btnsaveh').val('1');
			if(checkDiagnosisTypeSelected()){
			$('#kvnoassessment').attr('target', '_self').submit();
			}else{
				$('#btnsaveh').val('');
				$('#btnsubmith').val('');
				$(this).attr('disabled', false);
			}

		});

		$('#btnsubmit-pdf').live('click', function(event){
			$(this).attr('disabled', true);
			if(window.onbeforeunload)
			{
				window.onbeforeunload = null;
			}
// 			setTimeout(function () {$('input[type=submit]').attr('disabled', true);}, 150);
// 			setTimeout(function () {$('input[type=submit]').attr('disabled', false);}, 15000);
		
			event.preventDefault();
			$('#btnsaveh').val('');
			$('#btnsubmith').val('1');
			setTimeout('redirect()', 1000);

			$('#kvnoassessment').attr('target', '_blank').submit();

		});

		$('#kvnoassessment').bind("change", function(){
			ser_form = $(this).serialize();
			$.ajax({
				type: "POST",
				url: "patientform/kvnoassessment?id=<?php echo $_REQUEST['id']; ?>&mode=live",
				data: ser_form,
				async: true
			});
		});

		$(":input, textarea, select").bind('change', function(){
			if($.browser.msie){
				ser_form = $('#kvnoassessment').serialize();
				$.ajax({
					type: "POST",
					url: "patientform/kvnoassessment?id=<?php echo $_REQUEST['id']; ?>&mode=live",
					data: ser_form,
					async: true
				});
			}
		});

//		Housarzt & palliativ artz submit button ajax post
		$('#submit_btn').live('click', function(event){

			//fix for ie8 ->event.preventDefault() is not working in ie8 so we use event.returnValue=false;
			if (event.preventDefault) {
				event.preventDefault();
			} else {
				event.returnValue = false;
			}
			var curentDialogId = $(this).attr('alt');
			if(curentDialogId == "housarztDialogQPA"){
				var qpaqry = "&q=1";
			} else {
				var qpaqry = " ";
			}
			$().ajaxStart(function() {
				$('#ui-dialog-title-'+curentDialogId).html('<img src="<?php echo RES_FILE_PATH; ?>/images/ajax-title-loader.gif" width="14" />&nbsp;&nbsp;Loading...');
			}).ajaxStop(function() {
				if(curentDialogId == "housarztDialogQPA"){
					$('#ui-dialog-title-'+curentDialogId).text("Palliativarzt (QPA)");
				} else {
					$('#ui-dialog-title-'+curentDialogId).text("Hausarzt");
				}
			});

			var dataString = $("#frmuser").serialize();

			$.ajax({
				type: "POST",
				url: '<?php echo APP_BASE; ?>patient/familydocedit?id=<?php echo $this->pid ?>&noredir=1'+qpaqry,
				data: dataString,
				success: function() {
					$('#'+curentDialogId).dialog('close');
				},
				error: function(xhr, ajaxOptions, thrownError) {
				}
			});
		});

//		ambulance plfedge & ppd submit button ajax post
		$('#submit_btn_pfl').live('click', function(event){
			//fix for ie8 ->event.preventDefault() is not working in ie8 so we use event.returnValue=false;
			if (event.preventDefault) {
				event.preventDefault();
			} else {
				event.returnValue = false;
			}
			var curentDialogId = $(this).attr('alt');

			$().ajaxStart(function() {
				$('#ui-dialog-title-'+curentDialogId).html('<img src="<?php echo RES_FILE_PATH; ?>/images/ajax-title-loader.gif" width="14" />&nbsp;&nbsp;Loading...');
			}).ajaxStop(function() {
				if(curentDialogId == "ppDialog"){
					$('#ui-dialog-title-'+curentDialogId).text("Palliativpflege");
				} else if(curentDialogId == "pflegeDialog") {
					$('#ui-dialog-title-'+curentDialogId).text("ambulante Pflege");
				}
			});

			var dataString = $("#frmuserpfl").serialize();
			$.ajax({
				type: "POST",
				url: '<?php echo APP_BASE; ?>patient/pflegedienste?id=<?php echo $this->pid ?>&noredir=1',
				data: dataString,
				success: function(vars) {

					var obj = $.parseJSON(vars); //parse returned json pflid

//					update hidden id with returned pflid
					if(curentDialogId == "pflegeDialog"){
						$('#pflidhidden').val(obj.pflidInserted);
					} else {
						$('#pflidhiddenppd').val(obj.pflidInserted);
					}

					$('#'+curentDialogId).dialog('close');
				},
				error: function(xhr, ajaxOptions, thrownError) {
				}
			});
		})



		$("select#stage").change( function(){
				$('#erstantrag').attr('checked', false);
				$('#horherstufung').attr('checked', false);
		});

		if($("#kunstliche").is(":checked")){
		    $("#kunstlichemorediv").show("slow");
		} else {
		    $("#kunstlichemorediv").css("display","none");
			$("#kunstlichemore").val("");
		}

		$("#kunstliche").click(function(){
		    if ($("#kunstliche").is(":checked")){
			//show the hidden div
			$("#kunstlichemorediv").show("slow");
		    } else {
			//otherwise, hide it
			$("#kunstlichemorediv").hide("fast");
			$("#kunstlichemore").val(""); // we set this just for appearence, the magic is in stammdatenerweitert

		    }
		});

		if($('#kopfb:checked').val() == 2){
			$('#kopfmorediv').show("slow");
		}

		if($('#thoraxb:checked').val() == 2){
			$('#thoraxmorediv').show("slow");
		}

		if($('#abdomenb:checked').val() == 2){
			$('#abdomenmorediv').show("slow");
		}

		if($('#extremitatenb:checked').val() == 2){
			$('#extremitatenmorediv').show("slow");
		}

		if($('#hautb:checked').val() == 2){
			$('#hautmorediv').show("slow");
		}
		if($('#ps_nochunklar:checked').val() == 4){
		    $('#ps_nochunklar_div').show("slow");
		}
		if($('#a_nochunklar:checked').val() == 4){
   		 $('#a_nochunklar_div').show("slow");
		}

		$("input[name=kopf]").change(function() {

			if($(this).val() == 2){
				$('#kopfmorediv').show("slow");
			} else {
				$('#kopfmore').val("");
				$('#kopfmorediv').hide("slow");
			}
		});
		$("input[name=thorax]").change(function() {
			if($(this).val() == 2){
				$('#thoraxmorediv').show("slow");
			} else {
				$('#thoraxmore').val("");
				$('#thoraxmorediv').hide("slow");
			}
		});
		$("input[name=abdomen]").change(function() {
			if($(this).val() == 2){
				$('#abdomenmorediv').show("slow");
			} else {
				$('#abdomenmore').val("");
				$('#abdomenmorediv').hide("slow");
			}
		});
		$("input[name=extremitaten]").change(function() {
			if($(this).val() == 2){
				$('#extremitatenmorediv').show("slow");
			} else {
				$('#extremitatenmore').val("");
				$('#extremitatenmorediv').hide("slow");
			}
		});
		$("input[name=haut]").change(function() {
			if($(this).val() == 2){
				$('#hautmorediv').show("slow");
			} else {
				$('#hautmore').val("");
				$('#hautmorediv').hide("slow");
			}
		});
		$("input[name=psycho]").change(function() {
		    if($(this).val() == 4){
			$('#ps_nochunklar_div').show("slow");
		    } else {
		    $('#ps_nochunklar_txt').val("");
			$('#ps_nochunklar_div').hide("slow");
		    }
		});
		if($("#a_nochunklar").is(":checked")){
			$("#a_nochunklar_div").show("slow");
		} else {
		    $('#a_nochunklar_txt').val("");
			$("#a_nochunklar_div").hide("slow");
		}
		$('#a_nochunklar').live('click', function(){
			if($("#a_nochunklar").is(":checked")){
				$("#a_nochunklar_div").show("slow");
			} else {
			    $('#a_nochunklar_txt').val("");
				$("#a_nochunklar_div").hide("slow");
			}
		});
		$(".completed_chk").each(function(){
			if($(this).is(":checked")){
				$("#completeddiv-"+$(this).attr('rel')).show("slow");
		} else {
				$("#completeddiv-"+$(this).attr('rel')).hide("slow");
		}
		});

		$('#completed').live('change', function(){
			if($(this).is(":checked")){
				$("#completeddiv-"+$(this).attr('rel')).show("slow");
			} else {
				$("#completeddiv-"+$(this).attr('rel')).hide("slow");
			}
		});




		/*======================= RENEW MEDICATION  ======================================*/
		$(".renew_ajx, .renew_ajx_bedarfs").live('click', function(e){
			e.preventDefault();
			//get row id
			var tridrn = $(this).closest('tr').attr('id');
			//get medication edit count rows
			var cntren = Number($('#jsmedadd').val()) +1;

			//split row id and get numeric medis id
			var id = tridrn.split('_');
			var that = $(this);
			$("#"+tridrn).each(function() {
				var dateren = $(this).find(".datern_"+id[2]).text();
				var medsren = $(this).find(".medsrn_"+id[2]).text();
				var pid = "<?php echo $_GET['id']; ?>";
				var dsgren = $(this).find(".dsgrn_"+id[2]).text();
				var commren = $(this).find(".commrn_"+id[2]).text();
				var usrnameren = $(this).find(".usrnamern_"+id[2]).text();
				var usr_addren = $(this).find(".usr_id_add_"+id[2]).text();
				var hidd_medisren = $(this).find(".hidd_medicationrn_"+id[2]).text();
				var usrren = $(this).find(".usrid_"+id[2]).text();
				var users = <?php echo  json_encode($this->users); ?>;
				var options = '';
				var i = 1;

				$.each(users, function(key, value){
					if(key == usrren){
						options += "<option selected=\"selected\" value=\""+key+"\">"+value+"</option>"
					} else {
						options += "<option value=\""+key+"\">"+value+"</option>"
					}
				});



				if($(that).hasClass('renew_ajx')) {
					var date_now = "<?php echo date('d.m.Y')?>";
					var trrenewNou = '<tr id="line_'+id[2]+'" alt="'+cntren+'">';
					  trrenewNou += '<td align="left" valign="top"><input name="medication_change['+cntren+']" value="'+date_now+'" id="renew_change_date_'+cntren+'" type="text" class="med_date date_line_'+id[2]+' " rel="med_date'+cntren+'"><input name="replace_with['+cntren+']" value="change" type="hidden"></td>';
					  trrenewNou += '<td align="left" valign="top"><input name="medication['+cntren+']" value="'+medsren+'" id="medication'+cntren+'" type="text" class="livesearchmedinp med meds_line_'+id[2]+'"><input name="hidd_medication['+cntren+']" value="'+hidd_medisren+'" id="hidd_medication'+cntren+'" type="hidden"><input type="hidden" id="drid" name="drid['+cntren+']" value="'+id[2]+'"><input type="hidden" id="edited'+cntren+'" name="edited['+cntren+']" value="0" /><div id="medidropdown'+cntren+'" style="position:absolute;display:none;" class="listPatMedEd livesearchdropdown"></div></td>';
					  trrenewNou += '<td align="left" valign="top"><input name="dosage['+cntren+']" id="dosage'+cntren+'" class="dosage dsg_line_'+id[2]+'" value="'+dsgren+'"></td>';
					  trrenewNou += '<td align="left" id="line_'+id[2]+'_row" valign="top"><input name="comments['+cntren+']" class="med comm_line_'+id[2]+'" value="'+commren+'" id="comment'+cntren+'"></td>';
					  trrenewNou += '<td width="120" id="line_'+id[2]+'_row" align="left" valign="top" class="usrname_line_'+id[2]+'">'+usrnameren+'</td>';
					  trrenewNou += '<td align="left" id="line_'+id[2]+'_row" valign="top"><select name="verordnetvon['+cntren+']" id="verordnetvon-'+cntren+'" class="user_selector">'+options+'</select></td>';
					  trrenewNou += '<td align="left" valign="top"><a href="javascript:void(0)" class="remove_tr" ><img src="images/action_delete.png" border="0" /></a></td>';
					  trrenewNou += '</tr>';

				$("#listpatientmedicationedit_medicationtable").append(trrenewNou);

					$('#renew_change_date_'+cntren).datepicker({
						dateFormat: 'dd.mm.yy',
						buttonImageOnly: true,
						changeMonth: true,
						changeYear: true,
						nextText: '',
						prevText: '',
						onSelect: function(){
						var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
							$('#edited' + input_row).val('1');

						}
					});



				} else if($(that).hasClass('renew_ajx_bedarfs')) {

					var date_now = "<?php echo date('d.m.Y')?>";

					var trrenewNou = '<tr id="line_'+id[2]+'" alt="'+cntren+'">';
					trrenewNou += '<td align="left" valign="top"><input name="medication_change['+cntren+']" value="'+date_now+'" id="renew_bedarf_change_date_'+cntren+'" type="text" class="med_date date_line_'+id[2]+' " rel="med_date'+cntren+'" /><input name="replace_with['+cntren+']" value="change" type="hidden"></td>';
					trrenewNou += '<td align="left" valign="top"><input name="medication['+cntren+']" value="'+medsren+'" id="medication'+cntren+'" type="text" class="livesearchmedinp med meds_line_'+id[2]+'"><input name="hidd_medication['+cntren+']" value="'+hidd_medisren+'" id="hidd_medication'+cntren+'" type="hidden"><input type="hidden" id="drid" name="drid['+cntren+']" value="'+id[2]+'"><input type="hidden" id="edited'+cntren+'" name="edited['+cntren+']" value="0" /><div id="medidropdown'+cntren+'" style="position:absolute;display:none;" class="listPatMedEd livesearchdropdown"></div></td>';
					trrenewNou += '<td align="left" valign="top"><input name="dosage['+cntren+']" id="dosage'+cntren+'" class="dosage dsg_line_'+id[2]+'" value="'+dsgren+'"></td>';
					trrenewNou += '<td align="left" id="line_'+id[2]+'_row" valign="top"><input name="comments['+cntren+']" class="med comm_line_'+id[2]+'" value="'+commren+'" id="comment'+cntren+'"></td>';
					trrenewNou += '<td width="120" id="line_'+id[2]+'_row" align="left" valign="top" class="usrname_line_'+id[2]+'">'+usrnameren+'</td>';
					trrenewNou += '<td align="left" id="line_'+id[2]+'_row" valign="top"><select name="verordnetvon['+cntren+']" id="verordnetvon-'+cntren+'" class="user_selector">'+options+'</select></td>';
					trrenewNou += '</tr>';

					$("#listpatientmedicationedit_bedarfsmedicationtable").append(trrenewNou);

					$('#renew_bedarf_change_date_'+cntren).datepicker({
						dateFormat: 'dd.mm.yy',
						buttonImageOnly: true,
						changeMonth: true,
						changeYear: true,
						nextText: '',
						prevText: '',
						onSelect: function(){
							var input_row = parseInt($(this).attr('rel').substr(('med_date').length));
							$('#edited' + input_row).val('1');

						}
					});
				}

				$('#jsmedadd').val(cntren);
				renewMedicationKvno(id[2], pid);
				var medsren = '';


			});
		});

		/*======================= REMOVE MEDICATION ROW ======================================*/
		$(".remove_tr").live('click', function(){

			var trid = $(this).closest('tr').attr('id');
			var cnt = $("#"+trid).attr('alt');
			var id = trid.split('_');
			var pid = "<?php echo $_GET['id']; ?>";

			$("#"+trid).each(function() {

				var date = "<?php echo date('d.m.Y'); ?>";
				var meds = $(this).find(".meds_"+trid).val();
				var dsg = $(this).find(".dsg_"+trid).val();
				var comm = $(this).find(".comm_"+trid).val();
				var hidd_medis = $(this).find("#hidd_medication"+cnt).val();
				var usr_add = $(this).find(".usrname_"+trid).text();
				var usr = $(this).find("#verordnetvon-"+cnt+" option:selected").text();
				var usr_id = $(this).find("#verordnetvon-"+cnt+" option:selected").val();

				var trnou = '<tr class="row" id="line_r_'+id[1]+'">';
					trnou +='<td height="20" align="left" class="datern_'+id[1]+'" valign="top">'+date+'</td>';
					trnou +='<td height="20" align="left" valign="top" class="hidd_medicationrn_'+cnt+'" style="display: none;">'+hidd_medis+'</td>';
					trnou +='<td align="left" valign="top" class="medsrn_'+id[1]+'"><font color="#777777">'+meds+'</font> </td>';
					trnou +='<td align="left" valign="top" class="dsgrn_'+id[1]+'">'+dsg+'</td><td align="left" valign="top" class="commrn_'+id[1]+'">'+comm+'</td>';
					trnou +='<td align="left" valign="top"><a href="javascript:void(0)" class="renew_ajx"><img src="<?php echo RES_FILE_PATH; ?>/images/action_renew.png" border="0"></a></td>';
					trnou +='<td height="20" align="left" valign="top" class="usrnamern_'+id[1]+'">'+usr_add+'</td><td height="20" align="left" valign="top">'+usr+'</td>';
					trnou +='<td valign="top" height="20" align="left" class="usrid_'+id[1]+'" style="display:none;">'+usr_id+'</td>';
					trnou +='</tr>';

				$("#listpatientmedication_contenttabel").append(trnou);
				removeMedicationKvno(id[1],pid);
			});

		});

		//Hausarzt List to be saved in stammdaten
		$("#hausarzt").click(function(){
			if($(this).is(':checked')){
				var url = '<?php echo APP_BASE; ?>patient/familydocedit?id=<?php echo $this->pid ?>&mod=modal';
				var dialog = $("#housarztDialog");
				if ($("#housarztDialog").length == 0) {
					dialog = $('<div id="housarztDialog" style="display:hidden"></div>').appendTo('body');
			}

				// load remote content
				dialog.load(
				url,
				{},
				function(responseText, textStatus, XMLHttpRequest) {
					dialog.dialog({
						width: 600,
						height: 415,
						modal:true,
						resizable: false,
						title: "Hausarzt bearbeiten",
						open: function(){

							//familydoc ls
							$('#familydoc_id').live('change', function() {
								$('#hidd_docid').val('');
							}).liveSearch({
								url: 'ajax/sfamilydoctor?q=',
								id: 'livesearch_stamdatten_familydoc',
								noResultsDelay: '900',
								typeDelay: '900'
							});


							$('#submit_btn').attr('alt', 'housarztDialog');
						},
						close: function(){
							$('#housarztDialog').remove();
						}
		});
				}
			);
			}
		});

		//Hausarzt QPA List to be saved in stammdaten
		$("#palliativ").click(function(){
			if($(this).is(':checked')){
				var url = '<?php echo APP_BASE; ?>patient/familydocedit?id=<?php echo $this->pid ?>&mod=modal&q=qpa';
				var dialog = $("#housarztDialogQPA");
				if ($("#housarztDialogQPA").length == 0) {
					dialog = $('<div id="housarztDialogQPA" style="display:hidden"></div>').appendTo('body');
			}

				// load remote content
				dialog.load(
				url,
				{},
				function(responseText, textStatus, XMLHttpRequest) {
					dialog.dialog({
						width: 600,
						height: 465,
						modal:true,
						resizable: false,

						title: "Palliativarzt",
						open: function(){

							//familydoc ls
							$('#familydoc_id').live('change', function() {
								$('#hidd_docid').val('');
							}).liveSearch({
								url: 'ajax/sfamilydoctor?q=',
								id: 'livesearch_stamdatten_familydoc',
								noResultsDelay: '900',
								typeDelay: '900'
							});

							$('#submit_btn').attr('alt', 'housarztDialogQPA');
						},
						close: function(){
							$('#housarztDialogQPA').remove();
						}
		});
				}
			);
			}
		});


		//Pflegedienste List
		$("#pflege").click(function(){
			if($(this).is(':checked')){
				var url = 'patient/pflegedienste?id=<?php echo $this->pid ?>&mod=modal&pflid='+$('#pflidhidden').val();
				var dialog = $("#pflegeDialog");
				if ($("#pflegeDialog").length == 0) {
					dialog = $('<div id="pflegeDialog" style="display:hidden"></div>').appendTo('body');
			}

				// load remote content
				dialog.load(
				url,
				{},
				function(responseText, textStatus, XMLHttpRequest) {
					dialog.dialog({
						width: 610,
						height: 490,
						modal:true,
						resizable: false,

						title: "ambulante Pflege",
						open: function(){

							//pflegedienste ls
							$('#pflegedienste').live('change', function() {
								$('#hidd_pflegeid').val('');
							}).liveSearch({
								url: 'ajax/pflegedienste?q=',
								id: 'livesearch_stammdaten_pflege',
								aditionalWidth: '120',
								noResultsDelay: '900',
								typeDelay: '900'
							});
							$('#submit_btn_pfl').attr('alt','pflegeDialog');
						},
						close: function(){
							$('#pflegeDialog').remove();
						}
		});
				});
				}
		});

		//Palliativ Pflegedienste List (show only ones with PPD option)
		$("#palliativpf").click(function(){
			if($(this).is(':checked')){
				var url = 'patient/pflegedienste?id=<?php echo $this->pid ?>&mod=modal&pflid='+$('#pflidhiddenppd').val();
				var dialog = $("#ppDialog");
				if ($("#ppDialog").length == 0) {
					dialog = $('<div id="ppDialog" style="display:hidden"></div>').appendTo('body');
			}

				// load remote content
				dialog.load(url, {}, function(responseText, textStatus, XMLHttpRequest) {
					dialog.dialog({
						width: 610,
						height: 500,
						modal:true,
						resizable: false,
						title: "Palliativpflege",
						open: function(){
							//pflegedienste ls
							$('#pflegedienste').live('change', function() {
								$('#hidd_pflegeid').val('');
							}).liveSearch({
								url: 'ajax/pflegedienste?q=',
								id: 'livesearch_stammdaten_pflege',
								aditionalWidth: '120',
								noResultsDelay: '900',
								typeDelay: '900'
							});
							$('#submit_btn_pfl').attr('alt','ppDialog');
						},
						close: function(){
							$('#ppDialog').remove();
						}
		});
				});
				}
		});

		//add new row
		$.fn.locationPicker = function(options) {
			var anchorList = this;
			var init = function(){
				anchorList.each(function(){
					var parentRow = $(this).parent().parent();
					bindEventToDatePickers(parentRow);
					parentRow.find("a.removeRows").click(
					function(){

						parentRow.remove();
						var locid = $(this).attr('href').substr(1);
						if(locid>0)
						{
							ajaxCallserver({url:'patientform/removetodoajax?delid='+locid});
						}
						return false;
					}
				);


					$(this).click(function(){

						var newrow = $('<tr>'+parentRow.html()+'</tr>').insertAfter(parentRow);
						var tilldate = parentRow.find('input.patLocValidTill').val();


						newrow.find('.extradiv').hide();
						newrow.find('input').val('');
						newrow.find('input.patLocValidFrom').val(tilldate);
						newrow.find('select').val('');

						newrow.find("input.hasDatepick").removeClass('hasDatepick');
						newrow.find("input.hasDatepicker").removeAttr('id');
						newrow.find("input.hasDatepicker").removeClass('hasDatepicker');
						newrow.find("img.trigger").remove();
						newrow.find("img.ui-datepicker-trigger").remove();


						newrow.find("a.removeRows").attr('href','#0');


						newrow.find(".validDatepic").datepicker({
							dateFormat: 'dd.mm.yy',
							showOn: "both",
							buttonImage: $('#calImg').attr('src'),
							buttonImageOnly: true,
							changeMonth: true,
							changeYear: true,
							nextText: '',
							prevText: ''
						});

						newrow.find(".listPatiAddLink").locationPicker();

						return false;

					});

				});
			}


			var bindEventToDatePickers = function(parentRow){

				parentRow.find('.saveRows').bind('click',function(){

					var validfrom = parentRow.find('input.patLocValidFrom').val();
					var validtill = parentRow.find('input.patLocValidTill').val();
					var lid = parentRow.find('input.LocationId').val();
					var previd = parentRow.find('input.PrevId').val();

					if(previd.length<1)
					{
						jAlert('Select Previous Location');
						return false;
					}

					$.ajax({
						url:urls,
						mode: "abort",
						secureuri:false,
						fileElementId:'icon',
						dataType: 'json',
						success: function (data, status)
						{

							var locerror = "";
							for(i in data.error)
							{
								locerror  = locerror + data.error[i] + "<br>";
							}


							parentRow.find('input.LocationId').val(data.callBackParameters.lid);
							$(".locerror").hide();

							$(".locerror").html('<div style="color:red;" >'+locerror+'</div>').slideDown('slow');

						},
						error: function (data, status, e)
						{
						}
				})
				})
			}

			init();

		};
		
	});




		$(function(){

			$('#start_new').live('click', function(){
				$('#newassessment').show();

				$('.completeddate').each(function(){ //disable all completed date fields but not the last one
					if($(this).attr('name') != 'completeddate[0]'){
						$(this).attr('disabled', true);
					}
				})
			});

		$(".completeddate").datepicker({
			dateFormat: 'dd.mm.yy',
			showOn: "both",
			buttonImage: $('#calImg').attr('src'),
			buttonImageOnly: true,
			changeMonth: true,
			changeYear: true,
			nextText: '',
			prevText: '',
			onSelect: function(date_string) {
				var date = new Date(Date.parse($(this).datepicker('getDate')));
				//add 14 days
				//date.setDate(date.getDate()+14);
				//ISPC-2553 Lore 03.06.2020
				var reeval_days = '<?php echo $this->reeval_days; ?>';
				date.setDate(date.getDate()+parseInt(reeval_days,10));
				
				var newDate = date.toDateString()
				newDate = new Date(Date.parse(newDate));

				
				$('#reeval').val(formattedDate(newDate));
					}
});

		$(".validDatepic").datepicker({
			dateFormat: 'dd.mm.yy',
			showOn: "both",
			buttonImage: $('#calImg').attr('src'),
			buttonImageOnly: true,
			changeMonth: true,
			changeYear: true,
			nextText: '',
			prevText: ''
		});
			$(".listPatiAddLink").locationPicker();
		});


	function checkDiagnosisTypeSelected(){

		var err = "";
		var finalc = 0;

		for(var j=1;j<=dcntr;j++){
			var ct = 0;

			if(document.getElementById("diagnosis"+j) && $("#diagnosis"+j).val().length>0){
				var ltrs = document.getElementsByName('dtype['+j+']');

				for(var i=0;i<ltrs.length;i++){
					if(ltrs[i].checked==true){
						ct++;
					}
				}

				if(ct==0){
					finalc++;
				}
			}

		}

		if(finalc>0){
			jAlert('<?php echo $this->translate('selectdiagnosisfor'); ?>');
			return false;
		} else {
			checkdischarged('kvnoassessment');
		}
	}


	function checkdischarged(formname){

		if(isdischarged==1){
			jConfirm('<?php echo $this->translate('dischargealert'); ?>', '', function(r) {
				if(r){
					var submitstr = "document."+formname+".submit()";
					eval(submitstr);
				}
			});
			return false;
		}
		else
		{
			var submitstr = "document."+formname+".submit()";
			eval(submitstr);
		}

	}

	function getMetaIcd(mid){
		if(mid){
			ajaxCallserver({url:'diagnosis/fetchicdmeta?mid='+mid});
		} else {
			$("#meta_icdnumber").val("");
			$("#hidd_meta_diagnosis").val("");
		}
	}



	var callMeta = function(params){
		if(params.icdnumber.length>0){
			$("#meta_icdnumber").val(params.icdnumber);
		}
	}

	var chks;
	var formid;

	function updatePatientInformation(modname,fldname,formid,chk,patid,drp){
		if(chk.checked == true){
			chks = 1;
		} else {
			chks = 0;
		}
    	if(drp=='drop')
    	{
    	    chks = chk.value;
     	}
    	//ISPC-2508 Carmen 06.02.2020
		if(drp == "aus"){
			var values = new Array();
			$.each($("input[name='ausscheidung[]']:checked"), function() {
				values.push($(this).val());
				chks = values
			});
		}
		ajaxcall(modname,fldname,chks,patid,formid);
	}

	function ajaxcall(modname,fldname,chks,patid,formid){

		if(isdischarged==1){
			jConfirm('<?php echo $this->translate('dischargealert'); ?>', '', function(r) {
				if(r){
					ajaxCallserver({url:appbase+'patient/updatepatientinfo?modname='+modname+'&fldname='+fldname+'&chkval='+encodeURIComponent(chks)+'&patid='+patid+'&formid='+formid});
				}
			});

			return false;
		} else {
			ajaxCallserver({url:appbase+'patient/updatepatientinfo?modname='+modname+'&fldname='+fldname+'&chkval='+encodeURIComponent(chks)+'&patid='+patid+'&formid='+formid});
		}
	}
	function removeElem(ids) {
		$(ids).remove();
	}

	var fdocblur = true;

	function sendData(e){

	}
	var isdischarged = '[[isdis]]';

	function checkdischarged(formname)
	{

		if(isdischarged==1)
		{

			jConfirm('<?php echo $this->translate("dischargealert"); ?>', '', function(r) {
				if(r)
				{
					var submitstr = "document."+formname+".submit()";
					eval(submitstr);
				}

		});

			return false;
		}
		else
		{
			var submitstr = "document."+formname+".submit()";
			eval(submitstr);
		}

	}

	$(document).ready(function(){


		//livesearch diagnosis icd ls
		$('.livesearchicdinp').live('change', function() {
			var input_row = parseInt($(this).attr('id').substr(('icdnumber').length));
			reset_diagnosis(input_row);
		}).liveSearch({
			url: 'ajax/diagnosis?mode=icdnumber&q=',
			id: 'livesearch_admission_diagnosis',
			aditionalWidth: '400',
			noResultsDelay: '900',
			typeDelay: '900',
			returnRowId: function (input) {return parseInt($(input).attr('id').substr(('icdnumber').length));}
		});

		//livesearch diagnosis description ls
		$('.livesearchinp').live('change', function() {
			var input_row = parseInt($(this).attr('id').substr(('diagnosis').length));
			reset_diagnosis(input_row);
		}).liveSearch({
			url: 'ajax/diagnosis?q=',
			id: 'livesearch_admission_diagnosis',
			aditionalWidth: '50',
			noResultsDelay: '900',
			typeDelay: '900',
			returnRowId: function (input) {return parseInt($(input).attr('id').substr(('diagnosis').length));}
		});

		//livesearch medications
		$('.livesearchmedinp').live('change', function() {
			var input_row = parseInt($(this).attr('id').substr(('medication').length));
			reset_medications(input_row);
		}).liveSearch({
			url: 'ajax/medications?q=',
			id: 'livesearch_admission_medications',
			aditionalWidth: '300',
			noResultsDelay: '900',
			typeDelay: '900',
			returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
		});
		});

	function reset_diagnosis(input_row){
//		if($('#hidd_tab'+input_row).val() != 'text'){
			$('#hidd_icdnumber'+input_row).val('');
			$('#hidd_diagnosis'+input_row).val('');
			$('#hidd_tab'+input_row).val('text');
//		}
	}
	function selectDiagnosis(did, row)
	{
		$('#icdnumber'+row).val($('#diag_icd_'+did).val());
		$('#diagnosis'+row).val($('#diag_de_'+did).val());
		$('#hidd_icdnumber'+row).val($('#diag_id_'+did).val());
		$('#hidd_diagnosis'+row).val($('#diag_id_'+did).val());
		$('#hidd_tab'+row).val('dig');
	}

	function selectFamilyDoctor(doc_id)
	{
		if($('#fdoc_fn_'+doc_id).val().length > 0 && $('#fdoc_ln_'+doc_id).val().length > 0){
				var input_text = $('#fdoc_tn_'+doc_id).val() +' '+ $('#fdoc_ln_'+doc_id).val() +', '+ $('#fdoc_fn_'+doc_id).val();
		} else if($('#fdoc_ln_'+doc_id).length > 0) {
				var input_text = $('#fdoc_tn_'+doc_id).val() +' '+ $('#fdoc_ln_'+doc_id).val();
			} else if($('#fdoc_fn_'+doc_id).length > 0) {
				var input_text = $('#fdoc_tn_'+doc_id).val() +' '+ $('#fdoc_fn_'+doc_id).val();
		}

		$('#familydoc_id').val(input_text);
		$('#hidd_docid').val($('#fdoc_id_'+doc_id).val());

		$('#title').val($('#fdoc_tn_'+doc_id).val());
		$('#first_name').val($('#fdoc_fn_'+doc_id).val());
		$('#last_name').val($('#fdoc_ln_'+doc_id).val());

		$('#salutation').val($('#fdoc_sal_'+doc_id).val());
		$('#phone_practice').val($('#fdoc_ph_'+doc_id).val());
		$('#phone_private').val($('#fdoc_pr_'+doc_id).val());
		$('#street1').val($('#fdoc_st_'+doc_id).val());
		$('#zip').val($('#fdoc_zip_'+doc_id).val());
		$('#city').val($('#fdoc_ci_'+doc_id).val());
		$('#fax').val($('#fdoc_fax_'+doc_id).val());
	}

	function selectPflegedienst(pflid)
		{
		$('#hidd_pflegeid').val($('#pflege_id_'+pflid).val());
		$('#pflegedienste').val($('#pflege_nu_'+pflid).val());
		$('#first_name').val($('#pflege_fn_'+pflid).val());
		$('#last_name').val($('#pflege_ln_'+pflid).val());

		$('#street1').val($('#pflege_st_'+pflid).val());
		$('#zip').val($('#pflege_zip_'+pflid).val());
		$('#city').val($('#pflege_ci_'+pflid).val());
		$('#phone_practice').val($('#pflege_ph_'+pflid).val());
		$('#phone_emergency').val($('#pflege_phem_'+pflid).val());
		$('#fax').val($('#fax'+pflid).val());
	}
	function removeElem(ids)
				{
		$(ids).remove();
				}

	function removeElements(id1,id2)
	{
		$(id1).remove();
		$(id2).remove();
	}

	function removeElementsfromTab(id1,id2,rid)
	{
		if(rid>0){
			ajaxCallserver({url:'diagnosis/removerecord?rid='+rid});
		}

		$(id1).remove();
		$(id2).remove();
	}

	function removeMedicationKvno(mid,pid)
	{
		if(mid>0)
		{
			ajaxCallserver({
				url:'patient/patientmedication?mid='+mid+'&id='+pid+'&act=del&noredir=1'
			});
		}
		$("#line_"+mid).remove();
	}

	function renewMedicationKvno(mid,pid)
	{
		if(mid>0){
			ajaxCallserver({
				url:'patient/patientmedication?mid='+mid+'&id='+pid+'&act=rnw&noredir=1'
			});
		}
		$("#line_r_"+mid).remove();
	}
	function delmedicationRow(did,patidencrypted)
	{

		if(did && $('#hidd_medication'+did).val())
		{

			ajaxCallserver({
				url:'patient/patientmedication?id='+patidencrypted+'&delid='+did+'&mid='+did+'&act=del&noredir=1' //mid for trigger when deleteing the row
			});
		}
	}


	function newdiagnosisrow()
	{
		var radiostr = "";

		for(var i=0;i<jarr.length;i++)
		{
			radiostr += '<td id="dtypecheckbx_td"><input type="radio" name="dtype['+jcount+']" id="dtype'+jcount+'" value="'+jarr[i].id+'"></td>';
		}
 
 		var trInnerHtml = $('<tr id="stab'+jcount+'"><td valign="top" id="listadmissiondiagnosistd_i'+jcount+'"><input name="icdnumber['+jcount+']" id="icdnumber'+jcount+'" value="" size="10"  class="livesearchicdinp diagicd" type="text" /><div id="icddiagnodropdown'+jcount+'" style="position: absolute; display:none;" class="medicationDiagnDrp icdlivesearchdropdown"></div></td><td valign="top" id="listadmissiondiagnosistd_d'+jcount+'"><input name="diagnosis['+jcount+']" id="diagnosis'+jcount+'" value="" size="33" class="livesearchinp diagdesc" type="text" /><input name="hidd_icdnumber['+jcount+']" value="" id="hidd_icdnumber'+jcount+'" type="hidden"><input name="hidd_diagnosis['+jcount+']" value="" id="hidd_diagnosis'+jcount+'" type="hidden"><input type="hidden" id="hidd_tab'+jcount+'" name="hidd_tab['+jcount+']" value="" /><div id="diagnodropdown'+jcount+'" style="position: absolute; display:none;" class="medicationDiagnDrp livesearchdropdown"></div></td>'+radiostr+' <td  valign="middle" align="center"><a href="javascript:void(0)" onclick="removeElements(\'#stab'+jcount+'\',\'#meta_'+jcount+'\')"><img src="_ipad/images/action_delete.png" border="0" /></a></td></tr>');
 		
 		
		$('#samtab').append(trInnerHtml);

 

		$('#icdnumber'+jcount).bind('keydown paste',function(){
			$(this).live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('icdnumber').length));
				reset_diagnosis(input_row);
			}).liveSearch({
				url: 'ajax/diagnosis?mode=icdnumber&q=',
				id: 'livesearch_admission_diagnosis',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('icdnumber').length));}
			});
		});


		$('#diagnosis'+jcount).bind('keydown paste',function(e){
			$(this).live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('diagnosis').length));
				reset_diagnosis(input_row);
			}).liveSearch({
				url: 'ajax/diagnosis?q=',
				id: 'livesearch_admission_diagnosis',
				aditionalWidth: '50',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('diagnosis').length));}
			});
		});

		jcount++;
		dcntr = jcount;
	}

	function reset_medications(input_row)
	{
		if($('#hidd_medication'+input_row).val()){
			$('#hidd_medication'+input_row).val('');
			$('#drid'+input_row).val('');
		}
	}

	function selectMedications(mid, row)
	{
		$('#medication'+row).val($('#medi_me_'+mid).val());
		$('#comment'+row).val($('#medi_comment_'+mid).val());
		$('#hidd_medication'+row).val($('#medi_id_'+mid).val());
	}

	function createnewmedic()
	{
		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}

		var userdrop = '<select name="add[verordnetvon]['+medcount+']">'+usrstr+'</select>';
		var trInnerHtml = $('<tr id="medadd'+medcount+'"><td align="left" valign="top"><input name="add[medication]['+medcount+']" value="" id="medication'+medcount+'" type="text" class="livesearchmedinp med"><input name="add[hidd_medication]['+medcount+']" value="" id="hidd_medication'+medcount+'" type="hidden"></td><td align="left" valign="top"><input  name="add[dosage]['+medcount+']" id="dosage" class="dosage" value=""  /></td><td align="left" valign="top"><input  name="add[comments]['+medcount+']" value=""  id="comment'+medcount+'" /></td><td align="left" valign="top">'+userdrop+'</td><td width="60" align="left" valign="top"><a href="javascript:void(0)" onclick="removeElem(\'#medadd'+medcount+'\')"><img src="images/action_delete.png" border="0" /></a></td></tr>');

		$('#medaddtable').append(trInnerHtml);

		$('#medication'+medcount).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});
		medcount++;
	}

	function createnewmedicrowbedarf()
	{

		var usrstr = "";
		for(var i in jsusers)
		{
			usrstr +='<option value="'+i+'">'+jsusers[i]+'</option>';
		}

		var userdrop = '<select name="verordnetvon['+medcount+']">'+usrstr+'</select>';

		var trInnerHtml = $('<tr id="medadd'+medcount+'"><td align="left" valign="top"><input name="addbedarf[medication]['+medcount+']" value="" id="medication'+medcount+'" type="text" class="livesearchmedinp med"><input name="addbedarf[hidd_medication]['+medcount+']" value="" id="hidd_medication'+medcount+'" type="hidden"><div id="medidropdown'+medcount+'" style="position:absolute;display:none;" class="listPatMedEd livesearchdropdown"></div></td><td align="left" valign="top"><input  name="addbedarf[dosage]['+medcount+']" id="dosage" class="dosage" value=""  /></td><td align="left" valign="top"><input  name="addbedarf[comments]['+medcount+']" value=""    id="comment'+medcount+'" /></td><td align="left" valign="top">'+userdrop+'</td><td width="60" align="left" valign="top"><a href="javascript:void(0)" onclick="delmedicationRow('+medcount+');removeElem(\'#medadd'+medcount+'\')"><img src="images/action_delete.png" border="0" /></a></td></tr>');

		$('#medbedarfaddtable').append(trInnerHtml);


		$('#medication'+medcount).bind('keyup keydown change paste',function(){
			//livesearch medications ls
			$(this).live('change', function() {
				var input_row = parseInt($(this).attr('id').substr(('medication').length));
				reset_medications(input_row);
			}).liveSearch({
				url: 'ajax/medications?q=',
				id: 'livesearch_admission_medications',
				aditionalWidth: '300',
				noResultsDelay: '900',
				typeDelay: '900',
				returnRowId: function (input) {return parseInt($(input).attr('id').substr(('medication').length));}
			});
		});
		medcount++;
	}
	
	function formattedDate(date) {
		var d = new Date(date || Date.now()),
			month = '' + (d.getMonth() + 1),
			day = '' + d.getDate(),
			year = d.getFullYear();

		if (month.length < 2) month = '0' + month;
		if (day.length < 2) day = '0' + day;

		return [day, month, year].join('.');
	}
	
</script>
<style>
.completedtime{
	width: 40px!important;
}
.completeddate{
	width: 90px!important;
}
.starttime{
	width: 40px!important;
}
.startdate{
	width: 90px!important;
}
.reeval{
	width: 158px!important;
}

#doc_id,#pfl_id{
	width: 250px!important;
}
</style>

<form action="" name="kvnoassessment" id="kvnoassessment" method="post" target="_blank">
	<div style="display: none;"> <img id="calImg" src="<?php echo RES_FILE_PATH; ?>/images/calendar.png" alt="Popup" class="trigger" style="margin-top: 5px;"> </div>
	<?php echo $this->patientinfo ?>
	<?php echo $this->tabmenus ?>

	<?php $last_assessment = end($this->assessments);  ?>
	<?php if($last_assessment['iscompleted'] == '1'): ?>
		<input type="submit" name="btnnewassessment" value="Neues Assessment Starten" id="new_assessment">
	<?php endif; ?>
	<div id="Einzel" class="tab_container"> <br />
		<div class="kvnotitle"><h1>Patientenaufnahmeformular für Assessment und Koordination der Versorgung</h1></div>



	<?php if(isset($this->error_form_not_saved) && !empty($this->error_form_not_saved)):?>
		<div class="clear"></div>
		<div class="err"><?php echo $this->error_form_not_saved; ?></div>
	<?php endif; ?>
	
	<?php if(isset($this->error_message) && !empty($this->error_message)):?>
	<div class="success"><?php echo $this->error_message; ?></div>
	<?php endif; ?>

		<div class="kvnoheader">
			<div class="left_side kvnohalf left_align" ><h2>Name:</h2><?php echo $this->patientname; ?><br /><br /><h2>IK:</h2><?php echo $this->iknumber; ?></div>
			<div class="right_side kvnohalf right_align"><h2>Geburtsdatum:</h2><?php echo $this->birthd; ?></div>
		</div>

	</div>
	<br />

	<div class="kvnocontainer">
		<div class="kvnofull">
			<p class="label">Familien- und Versorgungssituation:</p>
			<textarea name="fammore" tabindex="5" rows="4" cols="110"><?php echo $this->fammore; ?></textarea>
			<p class="label">Ängste / Sorgen:</p>
			<table class="kvnofull">
				<tr>
					<td width="45%"  class="dotted">Depressivität</td>
					<td width="3%"  class="dotted"><label for="kein1"><input id="kein1" type="radio" name="depresiv" value="1" /> kein</label></td>
					<td width="3%"  class="dotted"><label for="leicht1"><input id="leicht1" type="radio" name="depresiv" value="2" /> leicht</label></td>
					<td width="3%"  class="dotted"><label for="mittel1"><input id="mittel1" type="radio" name="depresiv" value="3" /> mittel</label></td>
					<td width="3%"  class="dotted"><label for="stark1"><input id="stark1" type="radio" name="depresiv" value="4" /> stark</label></td>
				</tr>
				<tr>
					<td width="45%"  class="dotted">Angst</td>
					<td width="3%"  class="dotted"><label for="kein2"><input id="kein2" type="radio" name="angst" value="1" /> kein</label></td>
					<td width="3%"  class="dotted"><label for="leicht2"><input id="leicht2" type="radio" name="angst" value="2" /> leicht</label></td>
					<td width="3%"  class="dotted"><label for="mittel2"><input id="mittel2" type="radio" name="angst" value="3" /> mittel</label></td>
					<td width="3%"  class="dotted"><label for="stark2"><input id="stark2" type="radio" name="angst" value="4" /> stark</label></td>
				</tr>
				<tr>
					<td width="45%"  class="dotted">Anspannung</td>
					<td width="3%"  class="dotted"><label for="kein3"><input id="kein3" type="radio" name="anspannung" value="1" /> kein</label></td>
					<td width="3%"  class="dotted"><label for="leicht3"><input id="leicht3" type="radio" name="anspannung" value="2" /> leicht</label></td>
					<td width="3%"  class="dotted"><label for="mittel3"><input id="mittel3" type="radio" name="anspannung" value="3" /> mittel</label></td>
					<td width="3%"  class="dotted"><label for="stark3"><input id="stark3" type="radio" name="anspannung" value="4" /> stark</label></td>
				</tr>
				<tr>
					<td width="45%"   >Desorientiertheit / Verwirrtheit</td>
					<td width="3%"   ><label for="kein4"><input id="kein4" type="radio" name="desorientier" value="1" /> kein</label></td>
					<td width="3%"   ><label for="leicht4"><input id="leicht4" type="radio" name="desorientier" value="2" /> leicht</label></td>
					<td width="3%"   ><label for="mittel4"><input id="mittel4" type="radio" name="desorientier" value="3" /> mittel</label></td>
					<td width="3%"   ><label for="stark4"><input id="stark4" type="radio" name="desorientier" value="4" /> stark</label></td>
				</tr>
			</table>
			<br />
			<textarea class="kvnoa" name="angstemore" tabindex="5" rows="4" cols="110"><?php echo $this->angstemore; ?></textarea>

			<br />
			<p class="label">Wünsche und Hoffnung (Mutmaßlicher Wille):</p>
			<textarea class="kvnoa" name="wuschemore" tabindex="5" rows="4" cols="110"><?php echo $this->wuschemore; ?></textarea>

			<br />
			<p class="label">Was ist Grund der Behandlung:</p>
			<textarea class="kvnoa" name="behandlungmore" tabindex="5" rows="4" cols="110"><?php echo $this->behandlungmore; ?></textarea>

			<br />
			<p class="label">Ressourcen:</p>
			<textarea class="kvnoa" name="ressourcenmore" tabindex="5" rows="4" cols="110"><?php echo $this->ressourcenmore; ?></textarea>
			<br />
			<p class="label">Hilfsbedürftigkeit:</p>
			<table class="kvnofull">
				<tr>
					<td width="45%"  class="dotted" >Pflegeprobleme wg. Wunden / Dekubitus</td>
					<td width="3%"  class="dotted" <label for="kein5"><input id="kein5" type="radio" name="dekubitus" value="1" /> kein</label></td>
					<td width="3%"  class="dotted" ><label for="leicht5"><input id="leicht5" type="radio" name="dekubitus" value="2" /> leicht</label></td>
					<td width="3%"  class="dotted" ><label for="mittel5"><input id="mittel5" type="radio" name="dekubitus" value="3" /> mittel</label></td>
					<td width="3%"  class="dotted" ><label for="stark5"><input id="stark5" type="radio" name="dekubitus" value="4" /> stark</label></td>
				</tr>
				<tr>
					<td width="45%"  class="dotted">Hilfebedarf b. Aktivitäten d. tägl. Lebens</td>
					<td width="3%"  class="dotted"><label for="kein6"><input id="kein6" type="radio" name="hilfebedarf" value="1" /> kein</label></td>
					<td width="3%"  class="dotted"><label for="leicht6"><input id="leicht6" type="radio" name="hilfebedarf" value="2" /> leicht</label></td>
					<td width="3%"  class="dotted"><label for="mittel6"><input id="mittel6" type="radio" name="hilfebedarf" value="3" /> mittel</label></td>
					<td width="3%"  class="dotted"><label for="stark6"><input id="stark6" type="radio" name="hilfebedarf" value="4" /> stark</label></td>
				</tr>
				<tr>
					<td width="45%"  class="dotted">Probleme mit Organisation der Versorgung</td>
					<td width="3%"  class="dotted"><label for="kein7"><input id="kein7" type="radio" name="versorgung" value="1" /> kein</label></td>
					<td width="3%"  class="dotted"><label for="leicht7"><input id="leicht7" type="radio" name="versorgung" value="2" /> leicht</label></td>
					<td width="3%"  class="dotted"><label for="mittel7"><input id="mittel7" type="radio" name="versorgung" value="3" /> mittel</label></td>
					<td width="3%"  class="dotted"><label for="stark7"><input id="stark7" type="radio" name="versorgung" value="4" /> stark</label></td>
				</tr>
				<tr>
					<td width="45%" >Überforderung der Familie, des Umfelds</td>
					<td width="3%"  ><label for="kein8"><input id="kein8" type="radio" name="umfelds" value="1" /> kein</label></td>
					<td width="3%"  ><label for="leicht8"><input id="leicht8" type="radio" name="umfelds" value="2" /> leicht</label></td>
					<td width="3%"  ><label for="mittel8"><input id="mittel8" type="radio" name="umfelds" value="3" /> mittel</label></td>
					<td width="3%"  ><label for="stark8"><input id="stark8" type="radio" name="umfelds" value="4" /> stark</label></td>
				</tr>
			</table>

			<textarea class="kvnoa" name="hilfsmore" tabindex="5" rows="4" cols="110"><?php echo $this->hilfsmore; ?></textarea>
			<br /><br />
			<table class="kvnofull">
				<tr>
					<td width="45%" ><p class="label">Vigilanz:</p></td>
					<td width="3%"  ><label for="kein9"><input id="kein9" type="radio" name="vigilanz" value="1" /> kein</label></td>
					<td width="3%"  ><label for="leicht9"><input id="leicht9" type="radio" name="vigilanz" value="2" /> leicht</label></td>
					<td width="3%"  ><label for="mittel9"><input id="mittel9" type="radio" name="vigilanz" value="3" /> mittel</label></td>
					<td width="3%"  ><label for="stark9"><input id="stark9" type="radio" name="vigilanz" value="4" /> stark</label></td>
				</tr>
			</table>
			<textarea class="kvnoa" name="vigilanzmore" tabindex="5" rows="4" cols="110"><?php echo $this->vigilanzmore; ?></textarea>
			<br />
			<p class="label">Mobilität:</p>
			<textarea class="kvnoa" name="mobilitatmore" tabindex="5" rows="4" cols="110"><?php echo $this->mobilitatmore; ?></textarea>

			<br /><br />
			<table class="kvnofull">
				<tr>
					<td width="45%"  class="dotted"><p class="label">Schmerzen: </p></td>
					<td width="3%"  class="dotted"><label for="kein10"><input id="kein10" type="radio" name="schmerzen" value="1" /> kein</label></td>
					<td width="3%"  class="dotted"><label for="leicht10"><input id="leicht10" type="radio" name="schmerzen" value="2" /> leicht</label></td>
					<td width="3%"  class="dotted"><label for="mittel10"><input id="mittel10" type="radio" name="schmerzen" value="3" /> mittel</label></td>
					<td width="3%"  class="dotted"><label for="stark10"><input id="stark10" type="radio" name="schmerzen" value="4" /> stark</label></td>
				</tr>
				<tr>
					<td width="45%">bisher behandelt nach WHO III</td>
					<td width="3%" colspan="2"></td>
					<td width="3%" ><label for="ja1"><input id="ja1" type="radio" name="who" value="1" /><br />Ja</label></td>
					<td width="3%" ><label for="nein1"><input id="nein1" type="radio" name="who" value="2" /><br	/> Nein</label></td>
				</tr>
			</table>
			<textarea class="kvnoa" name="whomore" tabindex="5" rows="4" cols="110"><?php echo $this->whomore; ?></textarea>

			<br />
			<p class="label">Andere schwerwiegende Symptome:</p>
			<table class="kvnofull">
				<tr>
					<td width="45%"  class="dotted">Übelkeit</td>
					<td width="3%"  class="dotted"><label for="kein11"><input id="kein11" type="radio" name="ubelkeit" value="1" /> kein</label></td>
					<td width="3%"  class="dotted"><label for="leicht11"><input id="leicht11" type="radio" name="ubelkeit" value="2" /> leicht</label></td>
					<td width="3%"  class="dotted"><label for="mittel11"><input id="mittel11" type="radio" name="ubelkeit" value="3" /> mittel</label></td>
					<td width="3%"  class="dotted"><label for="stark11"><input id="stark11" type="radio" name="ubelkeit" value="4" /> stark</label></td>
				</tr>
				<tr>
					<td width="45%"  class="dotted">Erbrechen</td>
					<td width="3%"  class="dotted"><label for="kein12"><input id="kein12" type="radio" name="erbrechen" value="1" /> kein</label></td>
					<td width="3%"  class="dotted"><label for="leicht12"><input id="leicht12" type="radio" name="erbrechen" value="2" /> leicht</label></td>
					<td width="3%"  class="dotted"><label for="mittel12"><input id="mittel12" type="radio" name="erbrechen" value="3" /> mittel</label></td>
					<td width="3%"  class="dotted"><label for="stark12"><input id="stark12" type="radio" name="erbrechen" value="4" /> stark</label></td>
				</tr>
				<tr>
					<td width="45%"  class="dotted">Luftnot</td>
					<td width="3%"  class="dotted"><label for="kein13"><input id="kein13" type="radio" name="luftnot" value="1" /> kein</label></td>
					<td width="3%"  class="dotted"><label for="leicht13"><input id="leicht13" type="radio" name="luftnot" value="2" /> leicht</label></td>
					<td width="3%"  class="dotted"><label for="mittel13"><input id="mittel13" type="radio" name="luftnot" value="3" /> mittel</label></td>
					<td width="3%"  class="dotted"><label for="stark13"><input id="stark13" type="radio" name="luftnot" value="4" /> stark</label></td>
				</tr>
				<tr>
					<td width="45%"  class="dotted">Verstopfung</td>
					<td width="3%"  class="dotted"><label for="kein14"><input id="kein14" type="radio" name="verstopfung" value="1" /> kein</label></td>
					<td width="3%"  class="dotted"><label for="leicht14"><input id="leicht14" type="radio" name="verstopfung" value="2" /> leicht</label></td>
					<td width="3%"  class="dotted"><label for="mittel14"><input id="mittel14" type="radio" name="verstopfung" value="3" /> mittel</label></td>
					<td width="3%"  class="dotted"><label for="stark14"><input id="stark14" type="radio" name="verstopfung" value="4" /> stark</label></td>
				</tr>
				<tr>
					<td width="45%"  class="dotted">Schwäche</td>
					<td width="3%"  class="dotted"><label for="kein15"><input id="kein15" type="radio" name="swache" value="1" /> kein</label></td>
					<td width="3%"  class="dotted"><label for="leicht15"><input id="leicht15" type="radio" name="swache" value="2" /> leicht</label></td>
					<td width="3%"  class="dotted"><label for="mittel15"><input id="mittel15" type="radio" name="swache" value="3" /> mittel</label></td>
					<td width="3%"  class="dotted"><label for="stark15"><input id="stark15" type="radio" name="swache" value="4" /> stark</label></td>
				</tr>
				<tr>
					<td width="45%">Appetitmangel</td>
					<td width="3%"><label for="kein16"><input id="kein16" type="radio" name="appetitmangel" value="1" /> kein</label></td>
					<td width="3%"><label for="leicht16"><input id="leicht16" type="radio" name="appetitmangel" value="2" /> leicht</label></td>
					<td width="3%"><label for="mittel16"><input id="mittel16" type="radio" name="appetitmangel" value="3" /> mittel</label></td>
					<td width="3%"><label for="stark16"><input id="stark16" type="radio" name="appetitmangel" value="4" /> stark</label></td>
				</tr>
			</table>
			<p class="label">Besonderer Aufwand mit:</p>
			<textarea class="kvnoa" name="anderemore" tabindex="5" rows="4" cols="110"><?php echo $this->anderemore; ?></textarea>
			<br />
			<p class="label">Biographie:</p>
			<textarea class="kvnoa" name="biographiemore" tabindex="5" rows="4" cols="110"><?php echo $this->biographiemore; ?></textarea>

			<br />
			<p class="label">Angaben zur Erkrankung:</p>
			Hauptdiagnose / Grundkrankheit
			<?php echo $this->diagno; ?>
			<div class="add_new_medi"><a href="javascript:newdiagnosisrow()"><img src="<?php echo RES_FILE_PATH;  ?>/images/action_add.png" width="30" height="30" /><div class="add_new_medi_link"><?php echo $this->translate('diagnose_add') ?></div></a></div><div class="clearer"></div>
			<br />
<p class="label">Angaben zur Versorgung:</p>
			Behandlung, Begleitung (bei Behandlungsbeginn oder bei Übernahme des Patienten)
				<br/>
				<style>
				.dgp_partners{
				}
				.dgp_partners label{
					width: 180px;
					float: left;
				}
				.kvnofull td{
/* 				border:1px solid red; */
				}
				</style>
			<table class="kvnofull">

				<tr>
					<td style="width: 200px;"><label for="care_at_admission">Versorgung bei Übernahme</label></td>
					<td colspan="4" ><input id="care_at_admission" type="text" name="care_at_admission" placeholder="Krankenhaus, Pflegeheim, zu Hause,.." value="<?php echo $this->care_at_admission;?>" class="w400" style="width: 98%!important"/></td>
				</tr>
			
				<tr class="dotted">
					<td style="width: 200px;">Ambulant</td>
					<td colspan="4" class="dgp_partners">
						 <?php echo $this->formMultiCheckbox('partners[]', $this->partners, array ('onclick' => ''), $this->dgp_partners['ambulant'], ' &nbsp;'); ?>
						 
						 
						 <input type="hidden" value="<?php echo $this->pfledge_id ?>" name="pflidhidden" id="pflidhidden" />
						 <input type="hidden" value="<?php echo $this->ppd_id; ?>" name="pflidhiddenppd" id="pflidhiddenppd" />
					</td>
				</tr>
				<tr class="dotted">
					<td style="width: 200px;">Stationär</td>
					<td colspan="4" class="dgp_partners">
						 <?php echo $this->formMultiCheckbox('partners[]', $this->partners, array ('onclick' => ''), $this->dgp_partners['stationar'] , ' &nbsp;'); ?>
					</td>
				</tr>							
							
				<tr>
					<td style="width: 100px;"  class="dotted"><?php echo $this->translate('patientlocation');?>r:</td>
					<td colspan="4"  class="dotted">
						<?php echo $this->formSelect('stationar', $this->stationar, null, $this->locaarray) ?>
					</td>
				</tr>
				<tr>
					<td style="width: 100px;"  class="dotted"><?php echo $this->translate('carelevel')?>:</td>
					<td  class="dotted">
					   <select style="width:150px;" class="combo" id="stage" name="stage" onchange="updatePatientInformation('MaintainanceStage','stage','grow7',this,<?php echo $this->patid?>,'drop')">
			                <option value=""><?php echo $this->translate('pleaseselect')?>...</option>
			                <option value="1" <?php if($this->stage=="1"){echo "selected='selected'";}?>>1</option>
			                <option value="2" <?php if($this->stage=="2"){echo "selected='selected'";}?>>2</option>
			                <option value="3" <?php if($this->stage=="3"){echo "selected='selected'";}?>>3</option>
			                <option value="4" <?php if($this->stage=="4"){echo "selected='selected'";}?>>4</option>
			                <option value="5" <?php if($this->stage=="5"){echo "selected='selected'";}?>>5</option>
			                <option value="keine" <?php if($this->stage=="keine"){echo "selected='selected'";}?>>Keine</option>
              			</select>
					</td>
					<td  class="dotted"><label for="erstantrag"> <?php echo  $this->formCheckbox('erstantrag', $this->erstantrag, array('onclick'=>'updatePatientInformation(\'MaintainanceStage\',\'erstantrag\',\'grow7\',this,'.$this->patid.')'), array('1')); ?>Erstantrag </label></td>
					<td  class="dotted" colspan="2"><label for="horherstufung"> <?php echo  $this->formCheckbox('horherstufung', $this->horherstufung, array('onclick'=>'updatePatientInformation(\'MaintainanceStage\',\'horherstufung\',\'grow7\',this,'.$this->patid.')'), array('1')); ?>Höherstufung beantragt </label></td>

				</tr>
			<?php  if($this->pathealthinsurance !="0" ): ?>
		    <tr>
		    <td  class="dotted">Rezeptgebühren</td>
 			<td  class="dotted">
 				<?php echo  $this->formRadio('rezeptgebuhrenbefreiung', $this->rezeptgebuhrenbefreiung, null, array("1"=>" ")); ?>
	 			<label for="rezeptgebuhrenbefreiung-1"><?php echo $this->translate('gebuhrenbefreit');?></label>
			</td>
			<td colspan="2"  class="dotted">
				<?php echo  $this->formRadio('rezeptgebuhrenbefreiung', $this->rezeptgebuhrenbefreiung, null, array("2"=>" ")); ?>
				<label for="rezeptgebuhrenbefreiung-2"><?php echo $this->translate('gebuhrenpflichtig');?></label>
		    </td>
		    <td  class="dotted"></td>
		    </tr>
		    <?php endif;?>
		    <tr>
		    <td><?php echo $this->translate('lives')?></td>
		    <td>
			    <label for="alone"> <?php echo  $this->formCheckbox('alone', $this->alone, array('onclick'=>'updatePatientInformation(\'Lives\',\'alone\',\'grow1\',this,'.$this->patid.')'), array('1')); ?>
				<?php echo $this->translate('alone')?> </label></td>
		    <td colspan="2">
			    <label for="house_of_relatives"> <?php echo  $this->formCheckbox('house_of_relatives', $this->house_of_relatives, array('onclick'=>'updatePatientInformation(\'Lives\',\'house_of_relatives\',\'grow1\',this,'.$this->patid.')'), array('1')); ?>
				<?php echo $this->translate('houseofrelatives')?> </label></td>
		    <td>
			    <label for="apartment"> <?php echo  $this->formCheckbox('apartment', $this->apartment, array('onclick'=>'updatePatientInformation(\'Lives\',\'apartment\',\'grow1\',this,'.$this->patid.')'), array('1')); ?>
				<?php echo $this->translate('apartment')?> </label> </td>
		    </tr>
		    <tr  class="dotted">
		    <td class="dotted"></td>
		    <td  class="dotted">
			    <label for="home"> <?php echo  $this->formCheckbox('home', $this->home, array('onclick'=>'updatePatientInformation(\'Lives\',\'home\',\'grow1\',this,'.$this->patid.')'), array('1')); ?>
				<?php echo $this->translate('home')?> </label></td>
		    <td  class="dotted">
			    <label for="hospiz"> <?php echo  $this->formCheckbox('hospiz', $this->hospiz, array('onclick'=>'updatePatientInformation(\'Lives\',\'hospiz\',\'grow1\',this,'.$this->patid.')'), array('1')); ?>
				Hospiz </label> </td>
		    <td  class="dotted">
		    	<label id="patiLocn_left_hme_lbl" for="sonstiges"> <?php echo  $this->formCheckbox('sonstiges', $this->sonstiges, array('onclick'=>'updatePatientInformation(\'Lives\',\'sonstiges\',\'grow1\',this,'.$this->patid.')'), array('1')); ?>
				Sonstiges </label></td>
					<td></td>

		    </tr>

			</table>
			<div class="ClrBoth"></div>
			<br />

			<table class="kvnofull" >
				<tr>
					<td colspan="5" ><p class="label">Psychosoziale Betreuung durch Hospiz-Bewegung</p></td>
				</tr>
				<tr>
					<td width="10%" class="dotted"></td>
					<td width="18%" class="dotted"><label for="erwunscht"><input id="erwunscht" type="radio" name="psycho" value="1" />erwünscht</label></td>
					<td width="18%" class="dotted"><label for="veranlasst"><input id="veranlasst" type="radio" name="psycho" value="2" />veranlasst</label></td>
					<td width="18%" class="dotted"><label for="nerwunscht"><input id="nerwunscht" type="radio" name="psycho" value="3" />nicht erwünscht</label></td>
					<td width="10%" class="dotted"><label for="ps_nochunklar"><input id="ps_nochunklar" type="radio" name="psycho" value="4" />noch unklar</label></td>
				</tr>
				<tr>
					<td colspan="5"> <div id="ps_nochunklar_div" style="text-align: right;  display: none; border-bottom: 1px dashed #000;"><textarea name="ps_nochunklar_txt" id="ps_nochunklar_txt" rows="10" cols="" style="width: 100%;"><?php echo $this->ps_nochunklar_txt; ?></textarea></div></p></td>
				</tr>
				<tr>
					<td colspan="5"><p class="label">Anzahl d. beteiligten Angehörigen:</p></td>
				</tr>
				<tr>
					<td width="10%"  class="dotted"></td>
					<td colspan="4"  class="dotted">
						<?php echo $this->formSelect('anzahl', $this->anzahl, null, $this->numbers) ?>
					</td>
				</tr>
				<tr>
					<td colspan="5"><p class="label">Absprache / Vorlage:</p></td>
				</tr>
				<tr>
					<td width="10%" class="dotted"></td>
					<td width="18%" class="dotted"><label for="pverfungung"><input id="pverfungung" type="checkbox" name="pverfungung" value="1" />Patientenverfügung </label></td>
					<td width="18%" class="dotted"><label for="versorgevoll"><input id="versorgevoll" type="checkbox" name="versorgevoll" value="1" />Vorsorgevollmacht </label></td>
					<td width="18%" class="dotted"><label for="gesetzl"><input id="gesetzl" type="checkbox" name="gesetzl" value="1" />gesetzl. Betreuung</label></td>
					<td width="15%" class="dotted"><label for="a_nochunklar"><input id="a_nochunklar" type="checkbox" name="a_nochunklar" value="1" />noch unklar</label></td>
				</tr>
			</table>
			 <div id="a_nochunklar_div" style="text-align: right;  display: none; border-bottom: 1px dashed #000;"><textarea name="a_nochunklar_txt" id="a_nochunklar_txt" rows="10" cols="" style="width: 100%;"><?php echo $this->a_nochunklar_txt; ?></textarea></div>
			<div class="ClrBoth"></div>

			<table class="kvnofull">

			</table>
			<div class="ClrBoth"></div>
			<br />

			<p class="label">Aktuelle Medikation:</p>
			<?php echo $this->medications; ?>
			<br />
			<div class="ClrBoth"></div>
			<p class="label">Medikamente hinzufügen</p>
			<?php echo $this->medicgrid; ?>
			<br />
			<div class="add_new_medi"><a href="javascript:createnewmedic()"><img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="20" height="20" /><div class="add_new_medi_link"><?php echo $this->translate('addnewmedication'); ?></div></a></div><br />
			<div class="ClrBoth"></div>
			<br />
			<p class="label">Bedarfs Medikation:</p>
<?php echo $this->bedarfsmedications; ?>
			<div class="ClrBoth"></div>
			<p class="label">Bedarf Medikamente hinzufügen</p>
<?php echo $this->bedarfmedicgrid; ?>
			<br />
			<div class="add_new_medi"><a href="javascript:createnewmedicrowbedarf();"><img src="<?php echo RES_FILE_PATH; ?>/images/edit_add.png" width="20" height="20" /><div class="add_new_medi_link"><?php echo $this->translate('addnewmedication'); ?></div></a></div><br />





			<div class="ClrBoth"></div>
			<br />
			<div class="ClrBoth"></div>
			<p class="label"><?php echo $this->translate('discontinuedmedlist');?></p>
			<input type="hidden" value="<?php echo $this->jsmedadd; ?>" id="jsmedadd" />
<?php echo $this->delmedications ?>
			<br />
			<div class="ClrBoth"></div>
			<table class="kvnofull">
				<tr>
					<td colspan="5">
						<p class="label">Körperlicher Befund:</p>
					</td>
				</tr>
				<!-- ISPC-2508 Carmen 06.02.2020  new box grow100-->
				<tr>
					<td width="16%"><label for="pegsonde"><input id="pegsonde" type="checkbox" name="pegsonde" value="1" onclick="updatePatientInformation('MoreInfo','peg','grow100',this,<?php echo $this->patid; ?>)" />PEG-Sonde</label></td>
					<td width="16%"><label for="magesonde"><input id="magesonde" type="checkbox" name="magesonde" value="1" onclick="updatePatientInformation('MoreInfo','magensonde','grow100',this,<?php echo $this->patid; ?>)" />Magensonde</label></td>
					<td width="16%"><label for="port"><input id="port" type="checkbox" name="port" value="1" onclick="updatePatientInformation('MoreInfo','port','grow100',this,<?php echo $this->patid; ?>)" />Port</label></td>
					<td width="16%"><label for="zvk"><input id="zvk" type="checkbox" name="zvk" value="1" onclick="updatePatientInformation('MoreInfo','zvk','grow100',this,<?php echo $this->patid; ?>)"/>ZVK</label></td>
					<td width="16%"><label for="pumps"><input id="pumps" type="checkbox" name="pumps" value="1" onclick="updatePatientInformation('MoreInfo','pumps','grow24',this,<?php echo $this->patid; ?>)" />Pumpe</label></td>
					<!-- <td width="16%"><label for="dk"><input id="dk" type="checkbox" name="dk" value="1" onclick="updatePatientInformation('MoreInfo','dk','grow100',this,'<?php echo $this->patid; ?>')" />DK</label></td> -->
					<td width="16%"><label for="dk">
					<!-- ISPC-2508 Carmen 06.02.2020 dk moved from moreinfo to ausscheidung <input id="dk" type="checkbox" name="dk" value="1" onclick="updatePatientInformation('MoreInfo','dk','grow100',this,'<?php echo $this->patid; ?>')" />-->
					<input type="checkbox" onclick="updatePatientInformation('Ausscheidung','ausscheidung-4','grow100',this,'<?php echo $this->patid; ?>', 'aus')"  value="4" id="ausscheidung-4" name="ausscheidung[]">DK</label></td>
				</tr>
				<tr>
		    		<td colspan="2"  class="dotted">
		    			<input type="hidden" name="kunstlichevalues" value="<?php echo $this->kunstlichevalues; ?>" />
		    			<label for="kunstliche"><input id="kunstliche" type="checkbox" name="kunstliche" value="5"  <?php if($this->kunstliche == '5'){echo 'checked="checked"';} else {} ?>  />besonderer Aus-/ Eingang</label>
		    		</td>
					<td colspan="3"  class="dotted">
						<div id="kunstlichemorediv"><input type="text" name="kunstlichemore" value="<?php echo $this->kunstlichemore; ?>" /></div>
					</td>
		    	</tr>
				<tr>
					<td colspan="2"  class="dotted"><p class="label">Klinisch:</p></td>

					<td width="15%" class="dotted"><label for="kachexie"><input id="kachexie" type="checkbox" name="kachexie" value="1" />Kachexie</label></td>
					<td width="15%" class="dotted"><label for="mager"><input id="mager" type="checkbox" name="mager" value="1" />mager</label></td>
					<td width="15%" class="dotted"><label for="normal"><input id="normal" type="checkbox" name="normal" value="1" />normal</label></td>
					<td width="15%" class="dotted"><label for="adipos"><input id="adipos" type="checkbox" name="adipos" value="1" />adipös</label></td>
				</tr>
				<tr>
					<td colspan="6">
						<p class="label">Funktionsstatus (ECOG)</p>
					</td>
				</tr>
				<tr>
					<td colspan="6"  class="dotted">
						<div style="padding-left: 20px;">
							<label for="nromaleaktiv"><input id="nromaleaktiv" type="radio" name="nromaleaktiv" value="1" />Normale Aktivität</label><br />
							<label for="gehfahig"><input id="gehfahig" type="radio" name="nromaleaktiv" value="2" />Gehfähig, leichte Arbeit möglich</label><br />
							<label for="arbeitsfahig"><input id="arbeitsfahig" type="radio" name="nromaleaktiv" value="3" />nicht arbeitsfähig, kann > 50 % der Wachzeit aufstehen</label><br />
							<label for="begrenzte"><input id="begrenzte" type="radio" name="nromaleaktiv" value="4" />begrenzte Selbstversorgung, > 50 % Wachzeit bettlägerig</label><br />
							<label for="pflegebedurftig"><input id="pflegebedurftig" type="radio" name="nromaleaktiv" value="5" />Pflegebedürftig, permanent bettlägerig</label>
						</div>
					</td>
				</tr>
				<tr>
					<td colspan="2" class="dotted">Kopf</td>
					<td width="27%" class="dotted"><label for="kopfk"><input type="radio" value="1" name="kopf" id="kopfk" />krankheitsentsprechend</label></td>
					<td width="16%" class="dotted"><label for="kopfb"><input type="radio" value="2" name="kopf" id="kopfb" />Befund</label></td>
					<td colspan="2" class="dotted"><div id="kopfmorediv" style="text-align: right;  display: none;"><input type="text" name="kopfmore" id="kopfmore"  style="width: 90%" value="<?php echo $this->kopfmore; ?>" /></div></td>
				</tr>
				<tr>
					<td colspan="2" class="dotted">Thorax</td>
					<td width="27%" class="dotted"><label for="thoraxk"><input type="radio" value="1" name="thorax" id="thoraxk" />krankheitsentsprechend</label></td>
					<td width="16%" class="dotted"><label for="thoraxb"><input type="radio" value="2" name="thorax" id="thoraxb" />Befund</label></td>
					<td colspan="2" class="dotted"><div id="thoraxmorediv" style="text-align: right;  display: none;"><input type="text" name="thoraxmore" id="thoraxmore" style="width: 90%" value="<?php echo $this->thoraxmore; ?>" /></div></td>
				</tr>
				<tr>
					<td colspan="2" class="dotted">Abdomen</td>
					<td width="27%" class="dotted"><label for="abdomenk"><input type="radio" value="1" name="abdomen" id="abdomenk" />krankheitsentsprechend</label></td>
					<td width="16%" class="dotted"><label for="abdomenb"><input type="radio" value="2" name="abdomen" id="abdomenb" />Befund</label></td>
					<td colspan="2" class="dotted"><div id="abdomenmorediv" style="text-align: right;  display: none;"><input type="text" name="abdomenmore" id="abdomenmore" style="width: 90%" value="<?php echo $this->abdomenmore; ?>" /></div></td>
				</tr>
				<tr>
					<td colspan="2" class="dotted">Extremitäten</td>
					<td width="27%" class="dotted"><label for="extremitatenk"><input type="radio" value="1" name="extremitaten" id="extremitatenk" />krankheitsentsprechend</label></td>
					<td width="16%" class="dotted"><label for="extremitatenb"><input type="radio" value="2" name="extremitaten" id="extremitatenb" />Befund</label></td>
					<td colspan="2" class="dotted"><div id="extremitatenmorediv" style="text-align: right;  display: none;"><input type="text" name="extremitatenmore" style="width: 90%" id="extremitatenmore" value="<?php echo $this->extremitatenmore; ?>" /></div></td>
				</tr>
				<tr>
					<td colspan="2">Haut/Wunden</td>
					<td width="27%"><label for="hautk"><input type="radio" value="1" name="haut" id="hautk" />krankheitsentsprechend</label></td>
					<td width="16%"><label for="hautb"><input type="radio" value="2" name="haut" id="hautb" />Befund</label></td>
					<td colspan="2"><div id="hautmorediv" style="text-align: right;  display: none;"><input type="text" name="hautmore" id="hautmore" style="width: 90%" value="<?php echo $this->hautmore; ?>"/></div></td>
				</tr>
			</table>
			<div class="ClrBoth"></div>
			<br /><br />
			<table  class="kvnofull">
				<tr>
					<td width="150"><p class="label">Fotodokumentation:&nbsp;</p></td>
					<td><input type="text" name="fotodokmore" value="<?php echo $this->fotodokmore; ?>" style="width:100%;" /></td>
				</tr>
			</table>


			<div class="ClrBoth"></div>
			<br />

			<p class="label">Sonstiges und oder zusammenfassende Beurteilung:</p>
			<textarea class="kvnoa" name="sonstigesmore" tabindex="5" rows="4" cols="110"><?php echo $this->sonstigesmore; ?></textarea>

			<div class="ClrBoth"></div>
			<br />
			<table class="kvnofull">
				<tr>
					<td width="40%"><p class="label">Geschätzte Lebenserwartung:</p></td>
					<td width="15%"><label for="days"><input id="days" type="radio" name="estimation" value="1" />Tage</label></td>
					<td width="15%"><label for="weeks"><input id="weeks" type="radio" name="estimation" value="2" />Wochen</label></td>
					<td width="15%"><label for="months"><input id="months" type="radio" name="estimation" value="3" />Monaten</label></td>
					<td width="15%"><label for="langer"><input id="langer" type="radio" name="estimation" value="4" />länger</label></td>
				</tr>
			</table>
			<div class="ClrBoth"></div>
			<br />
			<?php echo $this->todos; ?>

			<div class="ClrBoth"></div>
			<br />

			<table class="kvnofull">
				<?php if($this->module_change_billing == "1"): ?>
				<tr>
					<td colspan="2">
						<table class="kvnofull">
							<tr>
								<td width="48%"><p class="label"></p></td>
								<td width="15%" class="dotted"><label for="koord"><input id="koord" type="radio" name="billing_mode" value="1" <?php if($this->billing_mode == '1'): ?>checked="checked"<?php endif; ?>>Koordination</label></td>
								<td width="15%" class="dotted"><label for="assesment"><input id="assesment" type="radio" name="billing_mode" value="2" <?php if($this->billing_mode == '2'): ?>checked="checked"<?php endif; ?>>Assessment</label></td>
								<td width="25%" class="dotted"><label for="koord_assessment"><input id="koord_assessment" type="radio" name="billing_mode" value="3" <?php if($this->billing_mode == '3' || $this->billing_mode == "0" || $this->billing_mode == ""): ?>checked="checked"<?php endif; ?>>Assessment & Koordination</label></td>
							</tr>
						</table>
					</td>
				</tr>
				<?php endif; ?>
			</table>	
			
			
			
			<table class="dates_table">
				<?php if($this->assessments):  ?>
					<?php
					$assessments_nr = count($this->assessments);
					$incr = '1';
					foreach($this->assessments as $assessment_data): 
					?>
					<tr>
						<td width="20%"><label>Assessment Anfang:</label></td>
						<td>
							<div  class="date_div" id="startdiv-<?php echo $assessment_data['id']; ?>">
							<label for="startdate-<?php echo $assessment_data['id']; ?>">
								<input id="startdate-<?php echo $assessment_data['id']; ?>" class="startdate" type="text" autocomplete="off" name="startdate[<?php echo $assessment_data['id']; ?>]" value="<?php if(strlen($assessment_data['start_date']) > 0 && $assessment_data['start_date'] != '0000-00-00 00:00:00') { echo date('d.m.Y', strtotime($assessment_data['start_date'])); }  ?>" <?php if($assessments_nr != $incr) { echo 'disabled="disabled"'; }  ?> />
								<input id="starttime-<?php echo $assessment_data['id']; ?>" class="starttime" type="text" autocomplete="off" name="starttime[<?php echo $assessment_data['id']; ?>]" value="<?php if(strlen($assessment_data['start_date']) > 0 && $assessment_data['start_date'] != '0000-00-00 00:00:00') { echo date('H:i', strtotime($assessment_data['start_date'])); }  ?>" <?php if($assessments_nr != $incr) { echo 'disabled="disabled"'; }  ?> />
							</label>
						</div></td>
						<td>
							<label>Assessment abgeschlossen:
								<input type="checkbox" value="1" name="completed[<?php echo $assessment_data['id']; ?>]" rel="<?php echo $assessment_data['id']; ?>" id="completed"  class="completed_chk" <?php if($assessment_data['iscompleted'] == '1') { echo 'checked="checked" disabled="disabled"'; } ?> >
							</label>
						</td>
						<td>
							<div id="completeddiv-<?php echo $assessment_data['id']; ?>" style="display:none;">
							<label for="completeddate-<?php echo $assessment_data['id']; ?>">
								<input id="completeddate-<?php echo $assessment_data['id']; ?>" class="completeddate" type="text" autocomplete="off" name="completeddate[<?php echo $assessment_data['id']; ?>]" value="<?php if($assessment_data['iscompleted'] == 1 && $assessment_data['completed_date'] != '0000-00-00 00:00:00') { echo date('d.m.Y', strtotime($assessment_data['completed_date'])); } else { echo date('d.m.Y'); } ?>" <?php if($assessments_nr != $incr) { echo 'disabled="disabled"'; }  ?> />
								<input id="completedtime-<?php echo $assessment_data['id']; ?>" class="completedtime" type="text" autocomplete="off" name="completedtime[<?php echo $assessment_data['id']; ?>]" value="<?php if($assessment_data['iscompleted'] == 1 && $assessment_data['completed_date'] != '0000-00-00 00:00:00') { echo date('H:i', strtotime($assessment_data['completed_date'])); } else { echo date('H:i'); } ?>" <?php if($assessments_nr != $incr) { echo 'disabled="disabled"'; }  ?> />
						
							</label>
						</div></td>
					</tr>
					<?php if($assessment_data['iscompleted'] == '1'): ?>
					<?php

						//last completed date and id
						$last_assessment_id = $assessment_data['id'];
						$last_assessment_date = ($assessment_data['completed_date'] != '0000-00-00 00:00:00') ? date('d.m.Y', strtotime($assessment_data['completed_date'])) : date('d.m.Y');
					?>


					<?php endif;  ?>
					<?php $incr++; endforeach;  ?>

				<?php else: ?>
					<tr id="newassessment_start">
						<td width="20%"><label>Assessment Anfang:</label></td>
						<td class="right_align"><div id="sratdatediv-0" style="display:block;">
							<label for="startdate">
							<input class="startdate" id="startdate-0" type="text" autocomplete="off" name="startdate[0]" value="<?php echo $this->start_date; ?>" />
							<input class="starttime"   id="starttime-0" name="starttime[0]" value="<?php echo $this->start_time; ?>"  />
						</label></div></td>
					
						<td class="label_row"><p class="label">Assessment abgeschlossen: <input type="checkbox" class="completed" rel="0" value="1" name="completed[0]" id="completed" ></p></td>
						<td class="right_align"><div id="completeddiv-0" style="display:none;">
							<label for="completeddate">
							<input class="completeddate" id="completeddate-0" type="text" autocomplete="off" name="completeddate[0]" value="<?php echo date('d.m.Y'); ?>" />
							<input class="completedtime"   id="completedtime-0" name="completedtime[0]" value="<?php echo date('H:i',time()); ?>"  />
						</label></div></td>
					</tr>
				<?php endif;  ?>
				<input type="hidden" name="last_completed_id" id="last_completed_id" value="<?php echo $last_assessment_id; ?>" />
				<input type="hidden" name="last_completed_date" id="last_completed_date" value="<?php echo $last_assessment_date; ?>" />
				<?php if($this->date_err): ?>
					<tr>
					    <td colspan="2" class="right_align"><div class="errorfont"><span class="error_assessment"><?php echo $this->date_err; ?></span></div></td>
					</tr>
				<?php endif;?>
			</table>
			<table class="kvnofull">
				<tr>
					<td width="40%"><p class="label">Reevaluation:</p></td>
					<td width="15%" class="right_align"><label for="reeval"><input id="reeval" type="text" name="reeval" value="<?php echo $this->reeval; ?>" /></label></td>
				</tr>
				<tr>
					<td><p class="label">Arzt:</p></td>
					<td class="right_align" ><?php echo $this->formSelect('doc_id', $this->doc_id, null, $this->doctors); ?></td>
				</tr>
				<tr>
					<td><p class="label">Pflege / Koordination:</p></td>
					<td class="right_align"><?php echo $this->formSelect('pfl_id', $this->pfl_id, null, $this->pfleges); ?></td>
				</tr>
			</table>

		</div>
		<hr />
	</div>

	<div id="patientDet_Infor_denPat" class="dtbox" style="display: none">
		<h4 class="LineHeading"><?php echo $this->translate('carelevellist')?></h4>
		<div id="listcarelevel" class="grid">
<?php echo $this->carelevellist; ?>
		</div>
		<div class="ClrBoth"></div>
	</div>
	<input type="hidden" name="kvno_assessment_id" value="<?php echo $this->assessment_id; ?>" />
	<input type="hidden" name="btnsave" id="btnsaveh" value="" />
	<input type="hidden" name="btnsubmit" id="btnsubmith" value="" />

	<button type="button"  id="btnsave" class="submit_form" ><?php echo $this->translate('save') ?></button>&nbsp;&nbsp;
	<button type="button"  id="btnsubmit-pdf" class="submit_form"  ><?php echo $this->translate('generatepdf') ?></button>
	
</form>
<script type="text/javascript" >

	//radiobuttons
	getSelected('<?php echo $this->depresiv; ?>', 'depresiv');
	getSelected('<?php echo $this->angst; ?>', 'angst');
	getSelected('<?php echo $this->anspannung; ?>', 'anspannung');
	getSelected('<?php echo $this->desorientier; ?>', 'desorientier');
	getSelected('<?php echo $this->dekubitus; ?>', 'dekubitus');
	getSelected('<?php echo $this->hilfebedarf; ?>', 'hilfebedarf');
	getSelected('<?php echo $this->versorgung; ?>', 'versorgung');
	getSelected('<?php echo $this->umfelds; ?>', 'umfelds');
	getSelected('<?php echo $this->vigilanz; ?>', 'vigilanz');
	getSelected('<?php echo $this->schmerzen; ?>', 'schmerzen');
	getSelected('<?php echo $this->who; ?>', 'who');
	getSelected('<?php echo $this->ubelkeit; ?>', 'ubelkeit');
	getSelected('<?php echo $this->erbrechen; ?>', 'erbrechen');
	getSelected('<?php echo $this->luftnot; ?>', 'luftnot');
	getSelected('<?php echo $this->verstopfung; ?>', 'verstopfung');
	getSelected('<?php echo $this->swache; ?>', 'swache');
	getSelected('<?php echo $this->appetitmangel; ?>', 'appetitmangel');
	getSelected('<?php echo $this->psycho; ?>', 'psycho');
	getSelected('<?php echo $this->absprache; ?>', 'absprache');
	getSelected('<?php echo $this->kopf; ?>', 'kopf');
	getSelected('<?php echo $this->thorax; ?>', 'thorax');
	getSelected('<?php echo $this->abdomen; ?>', 'abdomen');
	getSelected('<?php echo $this->extremitaten; ?>', 'extremitaten');
	getSelected('<?php echo $this->haut; ?>', 'haut');
	getSelected('<?php echo $this->estimation; ?>', 'estimation');
	getSelected('<?php echo $this->nromaleaktiv; ?>', 'nromaleaktiv');
	//stammdaten checkboxes
	getSelected('<?php echo $this->dk; ?>', 'dk');
	getSelected('<?php echo $this->peg; ?>', 'pegsonde');
	getSelected('<?php echo $this->port; ?>', 'port');
	getSelected('<?php echo $this->zvk; ?>', 'zvk');
	getSelected('<?php echo $this->pumps; ?>', 'pumps');
	getSelected('<?php echo $this->magensonde; ?>', 'magesonde');
	getSelected('<?php echo $this->iscompleted; ?>', 'completed');

	//ambulant checkboxes
	getSelected('<?php echo $this->sapvteam; ?>', 'sapvteam');
	getSelected('<?php echo $this->hausarzt; ?>', 'hausarzt');
	getSelected('<?php echo $this->pflege; ?>', 'pflege');
	getSelected('<?php echo $this->palliativ; ?>', 'palliativ');
	getSelected('<?php echo $this->palliativpf; ?>', 'palliativpf');
	getSelected('<?php echo $this->palliativber; ?>', 'palliativber');
	getSelected('<?php echo $this->dienst; ?>', 'dienst');

	//Klinisch checkboxes
	getSelected('<?php echo $this->kachexie; ?>', 'kachexie');
	getSelected('<?php echo $this->mager; ?>', 'mager');
	getSelected('<?php echo $this->normal; ?>', 'normal');
	getSelected('<?php echo $this->adipos; ?>', 'adipos');

	//Absprache / Vorlage checkboxes
	getSelected('<?php echo $this->pverfungung; ?>', 'pverfungung');
	getSelected('<?php echo $this->versorgevoll; ?>', 'versorgevoll');
	getSelected('<?php echo $this->gesetzl; ?>', 'gesetzl');
	getSelected('<?php echo $this->a_nochunklar; ?>', 'a_nochunklar');

	//ISPC-2508 Carmen 06.02.2020 dk moved from moreinfo to ausscheidung
	//Auscheidung checkboxes
	getSelected('<?php echo $this->ausscheidung; ?>', 'ausscheidung[]','1');

	function getSelected(dbvalue,fieldname, checkbox = null){
		var fieldarray = document.getElementsByName(fieldname);
		for(i=0; i<fieldarray.length;i++){
			if(fieldarray[i].value==dbvalue){
				fieldarray[i].checked = true;
			}
		}
		//ISPC-2508 Carmen 06.02.2020 dk moved from moreinfo to ausscheidung
		//Auscheidung checkboxes
		if(checkbox == "1"){
			var checkbox_values = $.parseJSON(dbvalue);
				var checkbox_results = $.makeArray(checkbox_values);
			for(i=0; i<fieldarray.length;i++){
				if($.inArray(fieldarray[i].value, checkbox_results) > '-1'){
					fieldarray[i].checked = true;
				}
			}
		}
	}
</script>

<div style="display:none;">
	<img src="<?php echo RES_FILE_PATH; ?>/images/ajax-title-loader.gif" width="14"/>
</div>
