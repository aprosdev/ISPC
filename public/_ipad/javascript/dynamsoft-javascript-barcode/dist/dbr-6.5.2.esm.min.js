/**
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Barcode Reader JS Edition
 * @website http://www.dynamsoft.com
 * @preserve Copyright 2019, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 6.5.2
 * @fileoverview Dynamsoft JavaScript Library for Barcode Reader
 * More info on DBR JS: https://www.dynamsoft.com/Products/barcode-recognition-javascript.aspx
 */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var h=0;return function(){return h<b.length?{done:!1,value:b[h++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var h="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return h?h.call(b):$jscomp.arrayIterator(b)};
var TaskQueue=function(){var b=function(){this._queue=[];this.isWorking=!1;this.timeout=100};b.prototype.push=function(b,a,l){this._queue.push({task:b,context:a,args:l});this.isWorking||this.next()};b.prototype.unshift=function(b,a,l){this._queue.unshift({task:b,context:a,args:l});this.isWorking||this.next()};b.prototype.next=function(){if(0==this._queue.length)this.isWorking=!1;else{this.isWorking=!0;var b=this._queue.shift(),a=b.task,l=b.context?b.context:null,f=b.args?b.args:[];setTimeout(function(){a.apply(l,
f)},this.timeout)}};return b}(),dbrEnv={};"undefined"!=typeof self?(dbrEnv._self=self,self.document?dbrEnv._bDom=!0:dbrEnv._bWorker=!0):(dbrEnv._self=global,dbrEnv._bNodejs=!0);
var BarcodeReader=function(){var b=dbrEnv,h=b._self,a=function(c){c=c||a.licenseKey||"";if(!("string"==typeof c||"object"==typeof c&&c instanceof String))throw TypeError("'Constructor BarcodeReader(licenseKey)': Type of 'licenseKey' should be 'String'.");this._licenseKey=c;if(!a.isLoaded())throw Error("'Constructor BarcodeReader(licenseKey)': Autoload haven't start or you want to call `loadWasm` manually.");if(!b._bDom){this._instance=new a._BarcodeReaderWasm(c);if(!this._instance)throw a.BarcodeReaderException(a.EnumErrorCode.DBR_NULL_REFERENCE,
"Can't create BarcodeReader instance.");!c&&a._runtimeLicenseResponse&&(this._runtimeLicenseKey=a.runtimeLicenseKey,this._instance.InitSettingsFromServer(JSON.stringify({key:a.runtimeLicenseKey,licenseinfo:a._runtimeLicenseResponse.licenseinfo,units:a._runtimeLicenseResponse.units})))}};a._jsVersion="6.5.2";a._jsEditVersion="20190606";a.version="loading...(JS "+a._jsVersion+"."+a._jsEditVersion+")";a.isLoaded=function(){return"loaded"==this._loadWasmStatus};a._dbName="dynamsoft-dbr-wasm-"+a._jsVersion;
a._DB=void 0;a._licenseUrl="https://www.keillion.site/other/license.txt";a.licenseKey=h.__dbrLicenseKey__;a.runtimeLicenseKey=h.__dbrRuntimeLicenseKey__;a._runtimeLicenseResponse=void 0;var l=b._bDom?h.__dbrWasmCurrentScript__?__dbrWasmCurrentScript__:import.meta.url.substring(0, import.meta.url.lastIndexOf("/")):void 0;a._resourcesPath=l;a._workerName=void 0;a._wasmjsName=void 0;a._wasmName=void 0;a._workerResourcePath=void 0;a._wasmjsResourcePath=void 0;a._wasmResourcePath=void 0;a._isShowRelDecodeTimeInResults=!1;a._bCustomWorker=void 0;
a._bWithio=void 0;a._onWasmDownloaded=void 0;a._bLoadWorkerDirectlyFromUrl=void 0;a._onLog=void 0;a._canvasMaxWH=4096;a._bUseIndexDB=!0;a._bDebuggerInWorker=!1;a.createInstance=function(c){return a.loadWasm().then(function(){var d=new a(c);return b._bDom?d._createWorkerInstance():Promise.resolve(d)})};var f={};a._loadWorker=function(){return new Promise(function(c,d){var b=a._workerName||"dbr-"+a._jsVersion+".min.js";if(a._workerResourcePath||a._resourcesPath){var e=a._workerResourcePath||a._resourcesPath;
"/"!=e.charAt(e.length-1)&&(e+="/");void 0===a._bLoadWorkerDirectlyFromUrl&&location&&location.origin&&0==a._resourcesPath.indexOf(location.origin)&&(a._bLoadWorkerDirectlyFromUrl=!0);b=e+b}Promise.resolve().then(function(){return a._bLoadWorkerDirectlyFromUrl?b:fetch(b).then(function(a){return a.blob()}).then(function(a){return URL.createObjectURL(a)})}).then(function(e){var b=a._dbrWorker=new Worker(e);b.onerror=function(c){c="worker error, you should host the page in web service: "+c.message;a._onLog&&
a._onLog(c);d(c)};b.onmessage=function(b){b=b.data;switch(b.type){case "log":a._onLog&&a._onLog(b.message);break;case "load":b.success?(a.version=b.version,a._defaultRuntimeSettings=b._defaultRuntimeSettings,a._onLog&&a._onLog("load dbr worker success"),c()):d(b.exception);a._bLoadWorkerDirectlyFromUrl||URL.revokeObjectURL(e);break;case "task":try{f[b.id](b.body),f[b.id]=void 0}catch(r){throw f[b.id]=void 0,r;}break;default:a._onLog&&a._onLog(b)}};var n=document.createElement("a");n.href=a._resourcesPath||
"./";var g=void 0;a._wasmjsResourcePath&&(g=document.createElement("a"),g.href=a._wasmjsResourcePath||"./",g=g.href);var q=void 0;a._wasmResourcePath&&(q=document.createElement("a"),q.href=a._wasmResourcePath||"./",q=q.href);b.postMessage({type:"loadWorker",_licenseUrl:a._licenseUrl,runtimeLicenseKey:a.runtimeLicenseKey,_resourcesPath:n.href,_wasmjsResourcePath:g,_wasmResourcePath:q,_bUseIndexDB:a._bUseIndexDB,_bDebuggerInWorker:a._bDebuggerInWorker,origin:location.origin})}).catch(function(a){d(a)})})};
a.prototype._createWorkerInstance=function(){var c=this;return new Promise(function(d,b){var e=Math.random();f[e]=function(e){return e.success?e.instanceID?(c._instanceID=e.instanceID,d(c)):b(a.BarcodeReaderException(a.EnumErrorCode.DBR_NULL_REFERENCE,"Can't create BarcodeReader instance.")):b(e.exception)};a._dbrWorker.postMessage({type:"createInstance",id:e,licenseKey:c._licenseKey})})};a.prototype.deleteInstance=function(){var c=this;if(this._instance)this._instance.delete();else if(this._instanceID)return new Promise(function(d,
b){var e=Math.random();f[e]=function(a){return a.success?d():b(a.exception)};a._dbrWorker.postMessage({type:"deleteInstance",id:e,instanceID:c._instanceID})})};a.prototype._decodeBlob=function(a,d){var c=this;if(!(h.Blob&&a instanceof Blob))return Promise.reject("'_decodeBlob(blob, templateName)': Type of 'blob' should be 'Blob'.");d=d||"";return b._bDom?(new Promise(function(c,d){var b=URL.createObjectURL(a),e=new Image;e.dbrObjUrl=b;e.src=b;e.onload=function(){c(e)};e.onerror=function(){d(TypeError("'_decodeBlob(blob, templateName)': Can't convert the blob to image."))}})).then(function(a){return c._decodeImage(a)}):
(new Promise(function(c){var d=new FileReader;d.onload=function(){c(d.result)};d.readAsArrayBuffer(a)})).then(function(a){return c._decodeArrayBuffer(a,d)})};a.prototype._decodeArrayBuffer=function(a,d){if(!(h.arrayBuffer&&a instanceof ArrayBuffer||h.Buffer&&a instanceof Buffer))return Promise.reject("'_decodeBlob(arrayBuffer, templateName)': Type of 'arrayBuffer' should be 'ArrayBuffer' or 'Buffer'.");d=d||"";return b._bDom?this._decodeBlob(new Blob(a),d):this._decodeUint8Array(new Uint8Array(a))};
a.prototype._decodeUint8Array=function(c,d){var g=this;if(!(h.Uint8Array&&c instanceof Uint8Array||h.Uint8ClampedArray&&c instanceof Uint8ClampedArray))return Promise.reject("'_decodeBlob(uint8Array, templateName)': Type of 'uint8Array' should be 'Uint8Array'.");d=d||"";return b._bDom?g._decodeBlob(new Blob(c),d):new Promise(function(b){if(a._isShowRelDecodeTimeInResults){var e=(new Date).getTime(),k=g._instance.DecodeFileInMemory(c,d);e=(new Date).getTime()-e;k=m(k);k._decodeTime=e;return b(k)}return b(m(g._instance.DecodeFileInMemory(c,
d)))})};a.prototype._decodeImage=function(a,d){var c=this;return(new Promise(function(c){if(!(h.HTMLImageElement&&a instanceof HTMLImageElement))throw TypeError("'_decodeImage(image, templateName)': Type of 'image' should be 'HTMLImageElement'.");if(a.crossOrigin&&"anonymous"!=a.crossOrigin)throw"cors";d=d||"";c()})).then(function(){var b=document.createElement("canvas"),g=Math.max(a.naturalWidth,a.naturalHeight);if(4096<g){var k=4096/g;g=Math.round(a.naturalWidth*k);k=Math.round(a.naturalHeight*
k)}else g=a.naturalWidth,k=a.naturalHeight;b.width=g;b.height=k;b.getContext("2d").drawImage(a,0,0,g,b.height);a.dbrObjUrl&&URL.revokeObjectURL(a.dbrObjUrl);return c._decodeCanvas(b,d)})};a.prototype._decodeCanvas=function(c,d){var b=this;return(new Promise(function(a){if(!(h.HTMLCanvasElement&&c instanceof HTMLCanvasElement))throw TypeError("'_decodeCanvas(canvas, templateName)': Type of 'canvas' should be 'HTMLCanvasElement'.");if(c.crossOrigin&&"anonymous"!=c.crossOrigin)throw"cors";d=d||"";var b=
c.getContext("2d").getImageData(0,0,c.width,c.height).data;a(b)})).then(function(e){return b._decodeRawImageUint8Array(e,c.width,c.height,4*c.width,a.EnumImagePixelFormat.IPF_ARGB_8888,d)})};a.prototype._decodeVideo=a.prototype.decodeVideo=function(a){var c=this,b,e=arguments,n,k;return(new Promise(function(d){if(!(h.HTMLVideoElement&&a instanceof HTMLVideoElement))throw TypeError("'_decodeVideo(video [ [, sx, sy, sWidth, sHeight], dWidth, dHeight] [, templateName] )': Type of 'video' should be 'HTMLVideoElement'.");
if(a.crossOrigin&&"anonymous"!=a.crossOrigin)throw"cors";var g,p,f;if(2>=e.length){var m=g=0;var l=p=a.videoWidth;var u=f=a.videoHeight}else 4>=e.length?(m=g=0,l=a.videoWidth,u=a.videoHeight,p=e[1],f=e[2]):(m=e[1],g=e[2],l=e[3],u=e[4],p=e[5],f=e[6]);b="string"==typeof e[e.length-1]?e[e.length-1]:"";k=document.createElement("canvas");k.width=p;k.height=f;var t=k.getContext("2d");c._bAddOriVideoCanvasToResult&&(n=document.createElement("canvas"),n.width=a.videoWidth,n.height=a.videoHeight,n.getContext("2d").drawImage(a,
0,0));t.drawImage(n||a,m,g,l,u,0,0,p,f);d()})).then(function(){return c._decodeCanvas(k,b)}).then(function(a){if(c._bAddOriVideoCanvasToResult)for(var b=$jscomp.makeIterator(a),d=b.next();!d.done;d=b.next())d.value.oriVideoCanvas=n;if(c._bAddSearchRegionCanvasToResult)for(b=$jscomp.makeIterator(a),d=b.next();!d.done;d=b.next())d.value.searchRegionCanvas=k;return a})};a.prototype._decodeBase64=a.prototype.decodeBase64String=function(a,d){var c=this;if(!("string"==typeof a||"object"==typeof a&&a instanceof
String))return Promise.reject("'decodeBase64(base64Str, templateName)': Type of 'base64Str' should be 'String'.");"data:image/"==a.substring(0,11)&&(a=a.substring(a.indexOf(",")+1));d=d||"";return new Promise(function(e){if(b._bNodejs)e(c._decodeArrayBuffer(Buffer.from(a,"base64"),d));else{for(var g=atob(a),k=g.length,f=new Uint8Array(k);k--;)f[k]=g.charCodeAt(k);b._bDom?e(c._decodeBlob(new Blob([f]),d)):e(c._decodeUint8Array(f,d))}})};a.prototype._decodeUrl=function(a,d){var c=this;return new Promise(function(e,
g){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'_decodeUrl(url, templateName)': Type of 'url' should be 'String'.");d=d||"";if(b._bNodejs)(a.startsWith("https")?require("https"):require("http")).get(a,function(a){if(200==a.statusCode){var b=[];a.on("data",function(a){b.push(a)}).on("end",function(){e(c._decodeArrayBuffer(Buffer.concat(b),d))})}else g("http get fail, statusCode: "+a.statusCode)});else{var k=new XMLHttpRequest;k.open("GET",a,!0);k.responseType=
b._bDom?"blob":"arraybuffer";k.send();k.onloadend=function(){b._bDom?e(c._decodeBlob(this.response,d)):e(c._decodeArrayBuffer(this.response,d))};k.onerror=function(){g(k.error)}}})};a.prototype._decodeFilePath=function(a,b){var c=this;return new Promise(function(d,g){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'_decodeFilePath(path, templateName)': Type of 'path' should be 'String'.");b=b||"";require("fs").readFile(a,function(a,e){a?g(a):d(c._decodeArrayBuffer(e,
b))})})};a.prototype._decodeRawImageBlob=function(a,b,g,e,f,k){var c=this;return(new Promise(function(c,b){if(!(h.Blob&&a instanceof Blob))throw TypeError("'_decodeRawImageBlob(buffer, width, height, stride, enumImagePixelFormat, templateName)': Type of 'buffer' should be 'Blob'.");k=k||"";var d=new FileReader;d.readAsArrayBuffer(a);d.onload=function(){c(d.result)};d.onerror=function(){b(d.error)}})).then(function(a){return c._decodeRawImageUint8Array(new Uint8Array(a),b,g,e,f,k)})};a.prototype._decodeRawImageArrayBuffer=
function(a,b,g,e,f,k){var c=this;return(new Promise(function(c){if(!(h.ArrayBuffer&&a instanceof ArrayBuffer))throw TypeError("'_decodeRawImageArrayBuffer(buffer, width, height, stride, enumImagePixelFormat, templateName)': Type of 'buffer' should be 'ArrayBuffer'.");k=k||"";c()})).then(function(){return c._decodeRawImageUint8Array(new Uint8Array(a),b,g,e,f,k)})};a.prototype._decodeRawImageUint8Array=function(c,b,g,e,n,k){var d=this;return(new Promise(function(a){if(!(h.Uint8Array&&c instanceof Uint8Array||
h.Uint8ClampedArray&&c instanceof Uint8ClampedArray))throw TypeError("'_decodeRawImageUint8Array(buffer, width, height, stride, enumImagePixelFormat, templateName)': Type of 'buffer' should be 'Uint8Array'.");k=k||"";d._localizationResultArray=void 0;a()})).then(function(){if(d._instance){if(a._isShowRelDecodeTimeInResults){var h=(new Date).getTime(),l=d._instance.DecodeBuffer(c,b,g,e,n,k);h=(new Date).getTime()-h;l=m(l);l._decodeTime=h;return Promise.resolve(l)}try{l=d._instance.DecodeBuffer(c,b,
g,e,n,k)}catch(r){return setTimeout(function(){console.error("wasm error!");throw r;},0),Promise.reject(r)}return Promise.resolve(m(l))}var p;l=d._instanceID?Promise.resolve():d._createWorkerInstance();return l.then(function(){return null===d._runtimeSettings?new Promise(function(c,b){var e=Math.random();f[e]=function(a){return a.success?(d._runtimeSettings=void 0,c()):b(a.exception)};a._dbrWorker.postMessage({type:"resetRuntimeSettings",id:e,instanceID:d._instanceID})}):Promise.resolve()}).then(function(){return new Promise(function(h,
m){var l=Math.random();f[l]=function(a){return a.success?h(a.results):m(a.exception)};a._dbrWorker.postMessage({type:"decodeRawImageUint8Array",id:l,instanceID:d._instanceID,body:{buffer:c,width:b,height:g,stride:e,enumImagePixelFormat:n,templateName:k},_isShowRelDecodeTimeInResults:a._isShowRelDecodeTimeInResults})})}).then(function(c){p=c;return new Promise(function(c,b){var e=Math.random();f[e]=function(a){return a.success?c(a.results):b(a.exception)};a._dbrWorker.postMessage({type:"getAllLocalizationResults",
id:e,instanceID:d._instanceID})})}).then(function(a){d._localizationResultArray=a;return Promise.resolve(p)})})};a.prototype.decode=a.prototype.decodeFileInMemory=function(a,d){return h.Blob&&a instanceof Blob?this._decodeBlob(a,d):h.ArrayBuffer&&a instanceof ArrayBuffer||h.Buffer&&a instanceof Buffer?this._decodeArrayBuffer(a,d):h.Uint8Array&&a instanceof Uint8Array||h.Uint8ClampedArray&&a instanceof Uint8ClampedArray?this._decodeUint8Array(a,d):h.HTMLImageElement&&a instanceof HTMLImageElement?
this._decodeImage(a,d):h.HTMLCanvasElement&&a instanceof HTMLCanvasElement?this._decodeCanvas(a,d):h.HTMLVideoElement&&a instanceof HTMLVideoElement?this._decodeVideo(a,d):"string"==typeof a||a instanceof String?"data:image/"==a.substring(0,11)?this._decodeBase64(a,d):b._bNodejs?"http"==a.substring(0,4)?this._decodeUrl(a,d):this._decodeFilePath(a,d):this._decodeUrl(a,d):Promise.reject(TypeError("'_decode(source, templateName)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))};
a.prototype._decodeRawImage=a.prototype.decodeBuffer=function(a,b,g,e,f,k){return h.Blob&&a instanceof Blob?this._decodeRawImageBlob(a,b,g,e,f,k):h.ArrayBuffer&&a instanceof ArrayBuffer?this._decodeRawImageArrayBuffer(a,b,g,e,f,k):h.Uint8Array&&a instanceof Uint8Array||h.Uint8ClampedArray&&a instanceof Uint8ClampedArray?this._decodeRawImageUint8Array(a,b,g,e,f,k):Promise.reject(TypeError("'_decodeRawImage(source, width, height, stride, enumImagePixelFormat, templateName)': Type of 'source' should be 'Blob', 'ArrayBuffer' or 'Uint8Array'."))};
var m=a._handleRetJsonString=function(c){c="string"==typeof c||"object"==typeof c&&c instanceof String?JSON.parse(c):c;var d=a.EnumErrorCode;switch(c.exception){case d.DBR_SUCCESS:case d.DBR_LICENSE_INVALID:case d.DBR_LICENSE_EXPIRED:case d.DBR_1D_LICENSE_INVALID:case d.DBR_QR_LICENSE_INVALID:case d.DBR_PDF417_LICENSE_INVALID:case d.DBR_DATAMATRIX_LICENSE_INVALID:case d.DBR_DBRERR_AZTEC_LICENSE_INVALID:case d.DBR_RECOGNITION_TIMEOUT:if(c.textResult)for(d=0;d<c.textResult.length;++d){var g=c.textResult[d];
try{g.BarcodeText=b._bNodejs?Buffer.from(g.BarcodeText,"base64").toString():atob(g.BarcodeText)}catch(e){g.BarcodeText=""}}return c.textResult||c.localizationResultArray||c.Result||c.templateSettings||c.settings||c.outputSettings||c;default:throw a.BarcodeReaderException(c.exception,c.description);}};a.prototype.getAllLocalizationResults=function(){return this._localizationResultArray?this._localizationResultArray:m(this._instance.GetAllLocalizationResults())};a.prototype.getAllParameterTemplateNames=
function(){return m(this._instance.GetAllParameterTemplateNames())};a.prototype.getRuntimeSettings=function(){return this._instance?m(this._instance.GetRuntimeSettings()):this._runtimeSettings?JSON.parse(this._runtimeSettings):JSON.parse(a._defaultRuntimeSettings)};a.prototype.updateRuntimeSettings=function(c){var b=this;if("string"==typeof c||"object"==typeof c&&c instanceof String)var g=c;else if("object"==typeof c)g=JSON.stringify(c);else throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'String' or 'PlainObject'.");
if(b._instance)try{return m(b._instance.UpdateRuntimeSettings(g)),Promise.resolve()}catch(e){return Promise.reject(e)}else return Promise.resolve().then(function(){return b._instanceID?Promise.resolve():b._createWorkerInstance()}).then(function(){return new Promise(function(c,d){var e=Math.random();f[e]=function(a){return a.success?(b._runtimeSettings=g,c()):d(a.exception)};a._dbrWorker.postMessage({type:"updateRuntimeSettings",id:e,instanceID:b._instanceID,body:{settings:g}})})}).catch(function(a){return Promise.reject(a)})};
a.prototype.resetRuntimeSettings=function(){this._instance?m(this._instance.ResetRuntimeSettings()):this._runtimeSettings=null};a.prototype.outputSettingsToString=function(a){return m(this._instance.OutputSettingsToString(a||""))};a.prototype.initRuntimeSettingsWithString=function(a,b){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))if("object"==typeof a)a=JSON.stringify(a);else throw TypeError("'initRuntimeSettingstWithString(template, enumComflictMode)': Type of 'template' should be 'String' or 'PlainObject'.");
m(this._instance.InitRuntimeSettingstWithString(a,b?b:2))};a.prototype.appendTplStringToRuntimeSettings=function(a,b){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))if("object"==typeof a)a=JSON.stringify(a);else throw TypeError("'appendTplStringToRuntimeSettings(template, enumComflictMode)': Type of 'template' should be 'String' or 'PlainObject'.");m(this._instance.AppendTplStringToRuntimeSettings(a,b?b:2))};a.EnumBarcodeFormat={All:503317503,OneD:1023,CODE_39:1,CODE_128:2,CODE_93:4,
CODABAR:8,ITF:16,EAN_13:32,EAN_8:64,UPC_A:128,UPC_E:256,INDUSTRIAL_25:512,PDF417:33554432,QR_CODE:67108864,DATAMATRIX:134217728,AZTEC:268435456};a.EnumErrorCode={DBR_SYSTEM_EXCEPTION:1,DBR_SUCCESS:0,DBR_UNKNOWN:-1E4,DBR_NO_MEMORY:-10001,DBR_NULL_REFERENCE:-10002,DBR_LICENSE_INVALID:-10003,DBR_LICENSE_EXPIRED:-10004,DBR_FILE_NOT_FOUND:-10005,DBR_FILETYPE_NOT_SUPPORTED:-10006,DBR_BPP_NOT_SUPPORTED:-10007,DBR_INDEX_INVALID:-10008,DBR_BARCODE_FORMAT_INVALID:-10009,DBR_CUSTOM_REGION_INVALID:-10010,DBR_MAX_BARCODE_NUMBER_INVALID:-10011,
DBR_IMAGE_READ_FAILED:-10012,DBR_TIFF_READ_FAILED:-10013,DBR_QR_LICENSE_INVALID:-10016,DBR_1D_LICENSE_INVALID:-10017,DBR_DIB_BUFFER_INVALID:-10018,DBR_PDF417_LICENSE_INVALID:-10019,DBR_DATAMATRIX_LICENSE_INVALID:-10020,DBR_PDF_READ_FAILED:-10021,DBR_PDF_DLL_MISSING:-10022,DBR_PAGE_NUMBER_INVALID:-10023,DBR_CUSTOM_SIZE_INVALID:-10024,DBR_CUSTOM_MODULESIZE_INVALID:-10025,DBR_RECOGNITION_TIMEOUT:-10026,DBR_JSON_PARSE_FAILED:-10030,DBR_JSON_TYPE_INVALID:-10031,DBR_JSON_KEY_INVALID:-10032,DBR_JSON_VALUE_INVALID:-10033,
DBR_JSON_NAME_KEY_MISSING:-10034,DBR_JSON_NAME_VALUE_DUPLICATED:-10035,DBR_TEMPLATE_NAME_INVALID:-10036,DBR_JSON_NAME_REFERENCE_INVALID:-10037,DBR_PARAMETER_VALUE_INVALID:-10038,DBR_DOMAIN_NOT_MATCHED:-10039,DBR_RESERVEDINFO_NOT_MATCHED:-10040,DBR_DBRERR_AZTEC_LICENSE_INVALID:-10041};a.EnumImagePixelFormat={IPF_Binary:0,IPF_BinaryInverted:1,IPF_GrayScaled:2,IPF_NV21:3,IPF_RGB_565:4,IPF_RGB_555:5,IPF_RGB_888:6,IPF_ARGB_8888:7,IPF_RGB_161616:8,IPF_ARGB_16161616:9};a.EnumResultType={EDT_StandardText:0,
EDT_RawText:1,EDT_CandidateText:2,EDT_PartialText:3};a.EnumTerminateStage={ETS_Prelocalized:0,ETS_Localized:1,ETS_Recognized:2};a.EnumConflictMode={ECM_Ignore:1,ECM_Overwrite:2};a.BarcodeReaderException=function(){return function(b,d){var c=a.EnumErrorCode.DBR_UNKNOWN;"number"==typeof b?(c=b,b=Error(d)):b=Error(b);b.code=c;return b}}();return a}();
!dbrEnv._bWorker||BarcodeReader._bCustomWorker||dbrEnv._self.onmessage||function(){var b=dbrEnv,h=b._self,a=BarcodeReader;a._onLog=a._onLog||function(b){if(h.onmessage!=a._onWorkerMessage)a._onLog=void 0;else{var f=void 0;if(void 0===b)f="undefined";else{try{f=JSON.stringify(b,function(){var a=[],b=[];return function(c,d){if("object"===typeof d&&null!==d){var e=a.indexOf(d);if(-1!==e)return"[Circular "+b[e]+"]";a.push(d);b.push(c||"root")}return d}}())}catch(c){}if(void 0===f||"{}"===f)f=b.toString()}try{postMessage({type:"log",
message:f})}catch(c){h.console&&console.error(message)}}};a._onLog("have detected in worker: "+a.version);var l={};h.onmessage=a._onWorkerMessage=function(f){f=f.data;switch(f.type){case "loadWorker":(function(){a._licenseUrl=f._licenseUrl;a.runtimeLicenseKey=f.runtimeLicenseKey;a._resourcesPath=f._resourcesPath;a._wasmjsResourcePath=f._wasmjsResourcePath;a._wasmResourcePath=f._wasmResourcePath;a._bUseIndexDB=f._bUseIndexDB;if(f._bDebuggerInWorker)debugger;b.origin=f.origin;a.loadWasm().then(function(){postMessage({type:"load",
success:!0,version:a.version,_defaultRuntimeSettings:a._defaultRuntimeSettings})},function(a){postMessage({type:"load",success:!1,exception:a.message||a})})})();break;case "createInstance":(function(){try{var b=Math.random();l[b]=new a(f.licenseKey);postMessage({type:"task",id:f.id,body:{success:!0,instanceID:b}})}catch(c){postMessage({type:"task",id:f.id,body:{success:!1,exception:c.message||c}})}})();break;case "deleteInstance":try{l[f.instanceID].deleteInstance(),l[f.instanceID]=void 0,postMessage({type:"task",
id:f.id,body:{success:!0}})}catch(m){postMessage({type:"task",id:f.id,body:{success:!1,exception:m.message||m}})}break;case "decodeRawImageUint8Array":(function(){try{a._isShowRelDecodeTimeInResults=f._isShowRelDecodeTimeInResults;var b=f.body;l[f.instanceID]._decodeRawImageUint8Array(b.buffer,b.width,b.height,b.stride,b.enumImagePixelFormat,b.templateName).then(function(a){postMessage({type:"task",id:f.id,body:{success:!0,results:a}})}).catch(function(a){postMessage({type:"task",id:f.id,body:{success:!1,
exception:a.message||a}})})}catch(c){postMessage({type:"task",id:f.id,body:{success:!1,exception:c.message||c}})}})();break;case "getAllLocalizationResults":(function(){try{var a=l[f.instanceID].getAllLocalizationResults();postMessage({type:"task",id:f.id,body:{success:!0,results:a}})}catch(c){postMessage({type:"task",id:f.id,body:{success:!1,exception:c.message||c}})}})();break;case "getRuntimeSettings":(function(){try{var a=l[f.instanceID].getRuntimeSettings();postMessage({type:"task",id:f.id,body:{success:!0,
settings:a}})}catch(c){postMessage({type:"task",id:f.id,body:{success:!1,exception:c.message||c}})}})();break;case "updateRuntimeSettings":try{l[f.instanceID].updateRuntimeSettings(f.body.settings),postMessage({type:"task",id:f.id,body:{success:!0}})}catch(m){postMessage({type:"task",id:f.id,body:{success:!1,exception:m.message||m}})}break;case "resetRuntimeSettings":try{l[f.instanceID].resetRuntimeSettings(),postMessage({type:"task",id:f.id,body:{success:!0}})}catch(m){postMessage({type:"task",id:f.id,
body:{success:!1,exception:m.message||m}})}break;default:postMessage({type:"task",id:f.id,body:{success:!1,exception:"No such task."}})}}}();
(function(){var b=dbrEnv,h=b._self,a=BarcodeReader;a.loadWasm=function(){return new Promise(function(c,d){if("loaded"==a._loadWasmStatus)return c();a._loadWasmTaskQueue.push(function(g){if("loaded"==a._loadWasmStatus)return a._loadWasmTaskQueue.next(),c();if(g)return a._loadWasmTaskQueue.next(),d(a._loadWasmStatus);a._loadWasmStatus="loading";return(new Promise(function(c,d){a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(licenseKey)': The wasm hasn't finish loading.");};if(!h.WebAssembly||
"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))throw Error("'Constructor BarcodeReader(licenseKey)': The browser doesn't support Webassembly.");if(b._bDom)return a._loadWorker().then(function(){return c()},function(b){a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(licenseKey)': The wasm load failed. ex: "+(b.message||b));};return d(b)});var e={locateFile:function(){var c=
a._wasmName;if(a._wasmResourcePath||a._resourcesPath){var d=a._wasmResourcePath||a._resourcesPath;"/"!=d.charAt(d.length-1)&&(d+="/");c=d+c}else b._bNodejs&&(c=require("path").join(__dirname,c));return c},onRuntimeInitialized:function(){a._BarcodeReaderWasm=e.BarcodeReaderWasm;var g=new e.BarcodeReaderWasm("");a.version=g.GetVersion()+"(JS "+a._jsVersion+"."+a._jsEditVersion+")";a._defaultRuntimeSettings=JSON.stringify(a._handleRetJsonString(g.GetRuntimeSettings()));g.delete();a._onLog&&a._onLog("load dbr wasm success, version: "+
a.version);b._bNodejs?c():f.then(function(){c()},function(a){d(a)})}};e.onExit=e.onAbort=function(b){a._onLog&&a._onLog(b);a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(licenseKey)': The wasm load failed. Error: "+(b.message||b));};d(b)};e.print=function(b){a._onLog&&a._onLog(b)};if("undefined"==typeof _dbrLoadWasm){void 0==a._bWithio&&(a._bWithio=b._bNodejs||b._bWorker&&(a._bCustomWorker||h.onmessage!=a._onWorkerMessage));a._wasmjsName=a._wasmjsName||"dbr-"+a._jsVersion+
".wasm"+(a._bWithio?".withio":"")+".min.js";a._wasmName=a._wasmName||"dbr-"+a._jsVersion+(a._bWithio?".withio":"")+".wasm";var g=a._wasmjsName;if(a._wasmjsResourcePath||a._resourcesPath){var n=a._wasmjsResourcePath||a._resourcesPath;"/"!=n.charAt(n.length-1)&&(n+="/");g=n+g}else b._bNodejs&&(g=require("path").join(__dirname,g));b._bWorker?importScripts(g):_dbrLoadWasm=require(g)}_dbrLoadWasm(e,l,a)})).then(function(){a._loadWasmStatus="loaded";a._loadWasmTaskQueue.next();c()}).catch(function(b){a._loadWasmStatus=
b;a._loadWasmTaskQueue.next();d(b)})},null,["loading"==a._loadWasmStatus])})};a._loadWasmTaskQueue=function(){var a=new TaskQueue;a.timeout=0;return a}();a._openDb=function(){var a=this;return new Promise(function(b,c){var d=function(){f.result.createObjectStore("info");f.result.createObjectStore("wasm");f.result.createObjectStore("license");f.result.createObjectStore("consume")},g="open db ["+a._dbName+"] fail",f=indexedDB.open(a._dbName,1);f.onupgradeneeded=d;f.onsuccess=function(){a._DB=f.result;
b(f.result)};f.onerror=function(){var e=f.error.message||f.error;-1!=e.indexOf("version")?(f=indexedDB.deleteDatabase(a._dbName),f.onsuccess=function(){var e=indexedDB.open(a._dbName,1);e.onupgradeneeded=d;e.onsuccess=function(){a._DB=e.result;b(e.result)};e.onerror=function(){c(g)}},f.onerror=function(){c(g)}):c(g+": "+e)}})};a._lookupInDatabase=function(a,b,f){return new Promise(function(c,d){var e=a.transaction([b]).objectStore(b),g=f?e.get(f):e.getAll();g.onsuccess=function(){g.result?c(g.result):
d(f+" was not found in "+b)}})};a._storeInDatabase=function(a,b,f,e){return new Promise(function(c,d){var g=a.transaction([b],"readwrite").objectStore(b).put(e,f);g.onerror=function(){d("Failed to store "+f+" in indexDB: "+(g.error.message||g.error))};g.onsuccess=function(){c("Successfully stored "+f+" in "+b)}})};var l=function(c,d,g){a._onLog&&a._onLog("start handle dbr wasm, version: "+c);var e=(new Date).getTime();if(b._bNodejs)return new Promise(function(b,c){require("fs").readFile(d,function(d,
f){if(d)return c(d);var h=(new Date).getTime();b(WebAssembly.instantiate(f,g).then(function(b){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-h));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve(b)}))})});var h=function(a){return new Promise(function(b,c){var d=a.transaction(["info"]).objectStore("info").get("bSupportStoreModuleInDb"),e=function(){var d=a.transaction(["info"],"readwrite").objectStore("info"),
e=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,127,3,2,1,0,7,6,1,2,95,97,0,0,10,6,1,4,0,65,1,11]);try{var f=d.put(new WebAssembly.Module(e.buffer),"testStoreModule");f.onsuccess=function(){d.put(!0,"bSupportStoreModuleInDb").onsuccess=function(){b("set bSupportStoreModuleInDb = true success")}};f.onerror=function(){c("Failed to store [testStoreModule] in wasm cache, bSupportStoreModuleInDb == false: "+(f.error.message||f.error))}}catch(t){c("Failed to store [testStoreModule] in wasm cache, bSupportStoreModuleInDb == false: "+
(t.message||t))}};d.onsuccess=function(){d.result?b("bSupportStoreModuleInDb == true"):e()}})};return(a._bUseIndexDB?a._openDb():Promise.reject("bUseIndexDB false")).then(function(b){a._onLog&&a._onLog("open db success");f=m();return h(b).then(function(b){a._onLog&&a._onLog(b);return Promise.resolve(!0)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.resolve(!1)}).then(function(c){var f=(new Date).getTime();return a._lookupInDatabase(b,"wasm",a._wasmName).then(function(d){if(d instanceof
WebAssembly.Module){a._onLog&&a._onLog("get a wasm module from db, timecost:"+((new Date).getTime()-f));var h=(new Date).getTime();return WebAssembly.instantiate(d,g).then(function(b){a._onLog&&a._onLog("build instance from module timecost: "+((new Date).getTime()-h));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve({module:d,instance:b})})}a._onLog&&a._onLog("get a wasm binary from db, timecost:"+((new Date).getTime()-f));var l=(new Date).getTime();
return WebAssembly.instantiate(d,g).then(function(d){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-l));if(c){var f=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,d.module).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-f));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve(d)})}a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-
e));return Promise.resolve(d)})},function(f){a._onLog&&a._onLog(f.message||f);a._onLog&&a._onLog("downloading...");var h=(new Date).getTime();return c?WebAssembly.instantiateStreaming(fetch(d),g).then(function(c){a._onWasmDownloaded&&a._onWasmDownloaded();a._onLog&&a._onLog("download with build timecost: "+((new Date).getTime()-h));var d=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,c.module).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-d));a._onLog&&
a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve(c)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.reject("Can't store wasm in db.")})}):fetch(d).then(function(a){if(a.ok)return a.arrayBuffer();throw Error("Network error during fetch wasm.");}).then(function(c){a._onLog&&a._onLog("download timecost: "+((new Date).getTime()-h));a._onWasmDownloaded&&a._onWasmDownloaded();var d=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,
c).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-d));return Promise.resolve(c)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.reject("Can't store wasm in db.")})}).then(function(b){var c=(new Date).getTime();return WebAssembly.instantiate(b,g).then(function(b){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-c));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve(b)})})})})},
function(b){a._onLog&&a._onLog(b.message||b);f=m();return WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(fetch(d),g).then(function(b){a._onWasmDownloaded&&a._onWasmDownloaded();a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve(b)}):fetch(d).then(function(a){if(a.ok)return a.arrayBuffer();throw Error("Network error during fetch wasm.");}).then(function(b){a._onWasmDownloaded&&a._onWasmDownloaded();return WebAssembly.instantiate(b,
g).then(function(b){a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve(b)})})})},f,m=function(){var b=a.runtimeLicenseKey,d=(new Date).getTime();if(!b||!/^[0-9a-z]{7,20}$/.test(b))return Promise.resolve(!1);var f=null,e=!1;return a._lookupInDatabase(a._DB,"license",b).then(function(a){f=a;e=f["next-expire-time"]<d},function(){e=!0}).then(function(){a._onLog&&a._onLog("licenseResponseFromDB:");a._onLog&&a._onLog(f);a._onLog&&a._onLog("bNeedGetFromServer: "+
e);return e?fetch(a._licenseUrl+"?key="+b+"&version=1").then(function(a){if(a.ok)return a.json();throw Error("Network Error: fetch licenseinfo.");}).then(function(c){a._onLog&&a._onLog("licenseResponseFromServer:");a._onLog&&a._onLog(c);if("ok"==c.status)return a._runtimeLicenseResponse=c,c["next-expire-time"]=d+1E3*c["min-expire-during"],c["max-expire-time"]=d+1E3*c["max-expire-during"],a._storeInDatabase(a._DB,"license",b,c).catch(function(b){a._onLog&&a._onLog("store update to db fail:"+(b.message||
b))});if("error"==c.status)throw Error(c.message);if("exceeded"==c.status)throw Error("Authorized Scan Count Reached");throw Error("Unknow Response: fetch licenseinfo");}).catch(function(c){a._onLog&&a._onLog(c.message||c);if(f&&f["max-expire-time"]>d)return f["next-expire-time"]=d+1E3*f["check-interval-after-expire"],a._runtimeLicenseResponse=f,a._storeInDatabase(a._DB,"license",b,f).catch(function(b){a._onLog&&a._onLog("store update to db fail:"+(b.message||b))});throw Error("Can't get valid licenseinfo from runtimekey.");
}).then(function(){}):a._runtimeLicenseResponse=f})};a.clearCache=function(){return new Promise(function(b,d){try{var c=window.indexedDB.deleteDatabase(a._dbName);c.onsuccess=c.onerror=function(){c.error?d("Clear failed: "+(c.error.message||c.error)):b()}}catch(e){d(e)}})};dbrEnv._self._dbrConsume=function(b){a._onLog&&a._onLog(b);var c=0,f=a._runtimeLicenseResponse["post-urls"],e=function(){return fetch(f[c],{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",body:b}).then(function(a){if(!a.ok)throw Error("consume status: "+
a.status);}).catch(function(d){a._onLog&&a._onLog(""+(d.message||d));++c<f.length?e():a._storeInDatabase(a._DB,"consume",Math.random().toString(),b).catch(function(b){a._onLog&&a._onLog(b)})})};e()}})();
if(!dbrEnv._bNodejs){var BR=BarcodeReader;BR.Scanner=function(b){b=b||{};var h;(h=b.htmlElement)||(h=document.createElement("div"),h.style.position="fixed",h.style.width="100%",h.style.height="100%",h.style.left="0",h.style.top="0",h.style.background="#eee",h.innerHTML='<p style="width:100%;height:32px;line-height:32px;position:absolute;margin:auto 0;top:0;bottom:0;text-align:center;">loading</p><video class="dbrScanner-video" playsinline="true" style="width:100%;height:100%;position:absolute;left:0;top:0;"></video><select class="dbrScanner-sel-camera" style="position:absolute;left:0;top:0;"></select><select class="dbrScanner-sel-resolution" style="position:absolute;left:0;top:20px;"></select><button class="dbrScanner-btn-close" style="position:absolute;right:0;top:0;"><svg width="16" height="16" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/></svg></button>');this.htmlElement=
h;this.videoSettings=b.videoSettings;this.confidence=b.confidence;void 0==this.confidence&&(this.confidence=30);this.intervalTime=b.intervalTime;void 0==this.intervalTime&&(this.intervalTime=100);this.runtimeSettings=b.runtimeSettings||{};this.searchRegion=b.searchRegion||{sx:void 0,sy:void 0,sWidth:void 0,sHeight:void 0,dWidth:void 0,dHeight:void 0};this.bAddOriVideoCanvasToResult=b.bAddOriVideoCanvasToResult;this.bAddSearchRegionCanvasToResult=b.bAddSearchRegionCanvasToResult;this.onFrameRead=b.onFrameRead;
this.duplicateForgetTime=b.duplicateForgetTime;void 0==this.duplicateForgetTime&&(this.duplicateForgetTime=3E3);this.onNewCodeRead=b.onNewCodeRead;this._isOpen=!1;this._barcodeReader=b.barcodeReader};BR.Scanner.prototype.deleteInstance=function(){this._barcodeReader&&this._barcodeReader.deleteInstance()};BR.Scanner.prototype.isOpen=function(){return this._isOpen};BR.Scanner.prototype.open=function(){var b=this;if(!navigator.mediaDevices)return Promise.reject("`navigator.mediaDevices` is not available. Please ensure that you host the site in https.");
if(b._isOpen)return Promise.reject("The scanner is already open.");b._isOpen=!0;b.arrDiffCodeInfo=[];var h,a=b.htmlElement,l,f,m,c,d;(function(){for(var b=[a],e=$jscomp.makeIterator(a.children),g=e.next();!g.done;g=e.next())b.push(g.value);for(e=0;e<b.length;++e){var h=$jscomp.makeIterator(b[e].children);for(g=h.next();!g.done;g=h.next())b.push(g.value)}b=$jscomp.makeIterator(b);for(g=b.next();!g.done;g=b.next())g=g.value,g.classList.contains("dbrScanner-video")?l=g:g.classList.contains("dbrScanner-sel-camera")?
f=g:g.classList.contains("dbrScanner-sel-resolution")?(m=g,m.options.length||(m.innerHTML='<option class="dbrScanner-opt-gotResolution" value="got"></option><option data-width="3840" data-height="2160">ask 3840 x 2160</option><option data-width="2560" data-height="1440">ask 2560 x 1440</option><option data-width="1920" data-height="1080">ask 1920 x 1080</option><option data-width="1600" data-height="1200">ask 1600 x 1200</option><option data-width="1280" data-height="720">ask 1280 x 720</option><option data-width="800" data-height="600">ask 800 x 600</option><option data-width="640" data-height="480">ask 640 x 480</option><option data-width="640" data-height="360">ask 640 x 360</option>',
c=m.options[0])):g.classList.contains("dbrScanner-opt-gotResolution")?c=g:g.classList.contains("dbrScanner-btn-close")&&(d=g)})();var g=void 0,e=b._updateDevice=function(){return navigator.mediaDevices.enumerateDevices().then(function(a){var b=[],c;if(f){var d=f.value;f.innerHTML=""}for(var e=0;e<a.length;++e){var h=a[e];if("videoinput"==h.kind){var k={};k.deviceId=h.deviceId;k.label=h.label||"camera "+e;b.push(k)}}a=$jscomp.makeIterator(l.srcObject.getTracks());for(e=a.next();!e.done;e=a.next()){e=
e.value;if(m)break;if("video"==e.kind)for(h=$jscomp.makeIterator(b),k=h.next();!k.done;k=h.next())if(k=k.value,e.label==k.label){var m=k;g=k.deviceId;break}}if(f){a=$jscomp.makeIterator(b);for(k=a.next();!k.done;k=a.next())e=k.value,h=document.createElement("option"),h.value=e.deviceId,h.innerText=e.label,f.appendChild(h),d==e.deviceId&&(c=h);d=f.childNodes;if(!c&&m&&d.length)for(d=$jscomp.makeIterator(d),a=d.next();!a.done;a=d.next())if(a=a.value,m.label==a.innerText){c=a;break}c&&(f.value=c.value)}return Promise.resolve({current:m,
all:b})})};b._pausevideo=function(){l.pause()};var n=function(){l.srcObject&&(BR._onLog&&BR._onLog("======stop video========"),l.srcObject.getTracks().forEach(function(a){a.stop()}))},k=b._playvideo=function(a,d,e){return new Promise(function(f,h){n();BR._onLog&&BR._onLog("======before video========");var k=b.videoSettings=b.videoSettings||{video:{facingMode:{ideal:"environment"}}};/Safari/.test(navigator.userAgent)&&/iPhone/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)?1280<=d?
k.video.width=1280:640<=d?k.video.width=640:320<=d&&(k.video.width=320):(d&&(k.video.width={ideal:d}),e&&(k.video.height={ideal:e}));a?(k.video.facingMode=void 0,k.video.deviceId={exact:a}):k.video.deviceId=k.video.deviceId||{ideal:g};var y=!1,t=function(){BR._onLog&&BR._onLog("======try getUserMedia========");BR._onLog&&BR._onLog("ask "+JSON.stringify(k.video.width)+"x"+JSON.stringify(k.video.height));navigator.mediaDevices.getUserMedia(k).then(function(a){BR._onLog&&BR._onLog("======get video========");
return new Promise(function(b,d){l.srcObject=a;l.onloadedmetadata=function(){BR._onLog&&BR._onLog("======play video========");l.play().then(function(){BR._onLog&&BR._onLog("======played video========");var a="got "+l.videoWidth+"x"+l.videoHeight;m&&c&&(c.setAttribute("data-width",l.videoWidth),c.setAttribute("data-height",l.videoHeight),m.value="got",c.innerText=a);BR._onLog&&BR._onLog(a);b();f({width:l.videoWidth,height:l.videoHeight})},function(a){d(a)})};l.onerror=function(){d()}})}).catch(function(a){BR._onLog&&
BR._onLog(a);!y&&k.video?(y=!0,k.video.deviceId=void 0,k.video.width=void 0,k.video.height=void 0,t()):h(a)})};t()})},p=function(a,b){if(a instanceof Array){var c=[];a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next())c.push(p(d.value,b));return c}c=JSON.parse(JSON.stringify(a,function(a,b){if("oriVideoCanvas"!=a&&"searchRegionCanvas"!=a)return b}));b||(c.oriVideoCanvas=a.oriVideoCanvas,c.searchRegionCanvas=a.searchRegionCanvas);return c},v=function(){if(b._isOpen){if(l.paused)return BR._onLog&&
BR._onLog("Video is paused. Ask in 1s."),setTimeout(v,1E3);BR._onLog&&BR._onLog("======= once read =======");var a=(new Date).getTime();Promise.all([JSON.stringify(h.getRuntimeSettings())!=JSON.stringify(b.runtimeSettings)?h.updateRuntimeSettings(b.runtimeSettings):Promise.resolve(),function(){var a=b.searchRegion;if(a&&(a.sx||a.sy||a.sWidth||a.sHeight||a.dWidth||a.dHeight)){var c=a.sx||0,d=a.sy||0,e=a.sWidth||l.videoWidth,f=a.sHeight||l.videoHeight,g=a.dWidth||a.sWidth||l.videoWidth;a=a.dHeight||
a.sHeight||l.videoHeight;0<c&&1>c&&(c=Math.round(c*l.videoWidth));0<d&&1>d&&(d=Math.round(d*l.videoHeight));1>=e&&(e=Math.round(e*l.videoWidth));1>=f&&(f=Math.round(f*l.videoHeight));1>=g&&(g=Math.round(g*l.videoWidth));1>=a&&(a=Math.round(a*l.videoHeight));return[l,c,d,e,f,g,a]}return l}()]).then(function(a){a=a[1];a instanceof Array||(a=[a]);h._bAddOriVideoCanvasToResult=b.bAddOriVideoCanvasToResult;h._bAddSearchRegionCanvasToResult=b.bAddSearchRegionCanvasToResult;return h.decodeVideo.apply(h,
a)}).then(function(c){var d=(new Date).getTime();BR._onLog&&BR._onLog("time cost: "+(d-a)+"ms");for(var e=[],f=0;f<c.length;++f){var g=c[f],h=g.BarcodeText;BR._onLog&&BR._onLog(h);g.LocalizationResult.ExtendedResultArray[0].Confidence>=b.confidence&&e.push(g)}e=p(e);for(f=0;f<b.arrDiffCodeInfo.length;++f){g=b.arrDiffCodeInfo[f];h=-1;for(var k in e){var l=e[k];if(g.result.BarcodeText==l.BarcodeText&&g.result.BarcodeFormat==l.BarcodeFormat){h=k;break}}-1!=h?(g.time=d,g.result=e[h],++g.count,e.splice(h,
1)):d-g.time>b.duplicateForgetTime&&(b.arrDiffCodeInfo.splice(f,1),--f)}for(k=0;k<e.length;++k)for(f=e[k],g=k+1;g<e.length;)h=e[g],f.BarcodeText==h.BarcodeText&&f.BarcodeFormat==h.BarcodeFormat?e.splice(g,1):++g;f=$jscomp.makeIterator(e);for(k=f.next();!k.done;k=f.next())b.arrDiffCodeInfo.push({result:p(k.value,!0),time:d,count:1});if(b.onFrameRead)b.onFrameRead(p(c));c=$jscomp.makeIterator(e);for(k=c.next();!k.done;k=c.next())if(d=k.value,b.onNewCodeRead)b.onNewCodeRead(d.BarcodeText,p(d));setTimeout(v,
b.intervalTime)}).catch(function(a){BR._onLog&&BR._onLog(a);setTimeout(v,b.intervalTime);throw a;})}},q=function(){k(f.value).then(function(){b._isOpen||n()}).catch(function(a){alert("Play video failed: "+(a.message||a))})};f&&f.addEventListener("change",q);var w=function(){if(m&&-1!=m.selectedIndex){var a=m.options[m.selectedIndex];var c=a.getAttribute("data-width");a=a.getAttribute("data-height")}k(void 0,c,a).then(function(){b._isOpen||n()}).catch(function(a){alert("Play video failed: "+(a.message||
a))})};m&&m.addEventListener("change",w);var r=!!a.parentNode,x="none"===a.style.display,u=b._closeWindow=function(){n();b._isOpen=!1;f&&f.removeEventListener("change",q);m&&m.removeEventListener("change",w);b._closeWindow=void 0;d&&d.removeEventListener("click",u);var c=a.parentNode;c&&!r&&c.removeChild(a);x&&(a.style.display="none")};d&&d.addEventListener("click",u);r||document.body.appendChild(a);x&&(a.style.display="");return Promise.all([BR.loadWasm(),k()]).then(function(a){if(!b._isOpen)return n(),
Promise.resolve();h=b._barcodeReader=b._barcodeReader||new BR;var c=h.getRuntimeSettings();c.mAntiDamageLevel=3;c.mDeblurLevel=0;for(var d in b.runtimeSettings)void 0!=c[d]&&(c[d]=b.runtimeSettings[d]);b.runtimeSettings=c;return Promise.all([a[1],h.updateRuntimeSettings(c)])}).then(function(a){v();return Promise.all([a[0],e()])}).then(function(a){var b=a[0];a=a[1];return Promise.resolve({width:b.width,height:b.height,current:a.current,all:a.all})})};BR.Scanner.prototype.play=function(b,h,a){return this._isOpen?
this._playvideo(b,h,a):Promise.reject("The scanner is not open.")};BR.Scanner.prototype.pause=function(){this._isOpen&&this._pausevideo()};BR.Scanner.prototype.close=function(){this._isOpen&&this._closeWindow()};BR.Scanner.prototype.updateDevice=function(){return this._isOpen?this._updateDevice():navigator.mediaDevices.enumerateDevices().then(function(b){for(var h=[],a=0;a<b.length;++a){var l=b[a];if("videoinput"==l.kind){var f={};f.deviceId=l.deviceId;f.label=l.label||"camera "+a;h.push(f)}}return Promise.resolve({current:void 0,
all:h})})}};
export default BarcodeReader;